{"meta":{"title":"light","subtitle":"stan","description":"å•Šå’§å’§å•Šå’§å’§å•Šå’§å•Šå’§å’§~","author":"Light","url":"http://example.com","root":"/"},"pages":[{"title":"about","date":"2024-04-24T02:39:53.000Z","updated":"2024-04-26T12:54:38.247Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":"åŒéç ”ä¸€åœ¨è¯»"},{"title":"categories","date":"2024-09-11T03:20:45.000Z","updated":"2024-09-11T03:21:12.040Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"Java8","date":"2024-10-28T13:37:10.000Z","updated":"2025-03-11T13:46:15.722Z","comments":true,"path":"Java8/index.html","permalink":"http://example.com/Java8/index.html","excerpt":"","text":"JavaåŸºç¡€ é›†åˆæ¡†æ¶ Javaå¹¶å‘ Mysql Redis æ¡†æ¶ è®¡ç®—æœºç½‘ç»œ JVM ä¸­é—´ä»¶ æ“ä½œç³»ç»Ÿ å…¶å®ƒ"},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2025-01-31T08:58:37.808Z","updated":"2025-01-31T08:58:37.808Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""},{"title":"algorithm","date":"2024-04-27T11:19:37.000Z","updated":"2024-07-30T08:12:55.914Z","comments":true,"path":"algorithm/index.html","permalink":"http://example.com/algorithm/index.html","excerpt":"","text":"äºŒåˆ†æŸ¥æ‰¾çš„ä¸¤ç§å†™æ³• äºŒåˆ†æŸ¥æ‰¾ä»…é€‚ç”¨äºæœ‰åºçš„æ•°æ®é›†åˆï¼ˆå½“ç„¶æ•°ç»„æ˜¯æœ€å¸¸è§çš„ ä¸€ã€å·¦é—­å³é—­æ­¥éª¤å¦‚ä¸‹ï¼š åˆå§‹åŒ– ä»£ç å¦‚ä¸‹ï¼š åŒæŒ‡é’ˆ å¯¹æ’æŒ‡é’ˆå®šä¹‰æŒ‡çš„æ˜¯ä¸¤ä¸ªæŒ‡é’ˆ ğ‘™ğ‘’ğ‘“ğ‘¡leftã€ğ‘Ÿğ‘–ğ‘”â„ğ‘¡right åˆ†åˆ«æŒ‡å‘åºåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œç„¶å ğ‘™ğ‘’ğ‘“ğ‘¡left æŒ‡é’ˆä¸æ–­é€’å¢ï¼Œğ‘Ÿğ‘–ğ‘”â„ğ‘¡right ä¸æ–­é€’å‡ï¼Œç›´åˆ°ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼ç›¸æ’ï¼ˆå³ ğ‘™ğ‘’ğ‘“ğ‘¡&#x3D;&#x3D;ğ‘Ÿğ‘–ğ‘”â„ğ‘¡left&#x3D;&#x3D;rightï¼‰ï¼Œæˆ–è€…æ»¡è¶³å…¶ä»–è¦æ±‚çš„ç‰¹æ®Šæ¡ä»¶ä¸ºæ­¢ã€‚ æ¨¡æ¿1234567891011left, right = 0, len(nums) - 1while left &lt; right: if æ»¡è¶³è¦æ±‚çš„ç‰¹æ®Šæ¡ä»¶: return ç¬¦åˆæ¡ä»¶çš„å€¼ elif ä¸€å®šæ¡ä»¶ 1: left += 1 elif ä¸€å®šæ¡ä»¶ 2: right -= 1return æ²¡æ‰¾åˆ° æˆ– æ‰¾åˆ°å¯¹åº”å€¼ é€‚ç”¨èŒƒå›´å¯¹æ’æŒ‡é’ˆä¸€èˆ¬ç”¨æ¥è§£å†³æœ‰åºæ•°ç»„æˆ–è€…å­—ç¬¦ä¸²é—®é¢˜ï¼š æŸ¥æ‰¾æœ‰åºæ•°ç»„ä¸­æ»¡è¶³æŸäº›çº¦æŸæ¡ä»¶çš„ä¸€ç»„å…ƒç´ é—®é¢˜ï¼šæ¯”å¦‚äºŒåˆ†æŸ¥æ‰¾ã€æ•°å­—ä¹‹å’Œç­‰é—®é¢˜ã€‚ å­—ç¬¦ä¸²åè½¬é—®é¢˜ï¼šåè½¬å­—ç¬¦ä¸²ã€å›æ–‡æ•°ã€é¢ å€’äºŒè¿›åˆ¶ç­‰é—®é¢˜ã€‚ å¿«æ…¢æŒ‡é’ˆå®šä¹‰æŒ‡çš„æ˜¯ä¸¤ä¸ªæŒ‡é’ˆä»åŒä¸€ä¾§å¼€å§‹éå†åºåˆ—ï¼Œä¸”ç§»åŠ¨çš„æ­¥é•¿ä¸€ä¸ªå¿«ä¸€ä¸ªæ…¢ã€‚ç§»åŠ¨å¿«çš„æŒ‡é’ˆè¢«ç§°ä¸º ã€Œå¿«æŒ‡é’ˆï¼ˆfastï¼‰ã€ï¼Œç§»åŠ¨æ…¢çš„æŒ‡é’ˆè¢«ç§°ä¸ºã€Œæ…¢æŒ‡é’ˆï¼ˆslowï¼‰ã€ã€‚ä¸¤ä¸ªæŒ‡é’ˆä»¥ä¸åŒé€Ÿåº¦ã€ä¸åŒç­–ç•¥ç§»åŠ¨ï¼Œç›´åˆ°å¿«æŒ‡é’ˆç§»åŠ¨åˆ°æ•°ç»„å°¾ç«¯ï¼Œæˆ–è€…ä¸¤æŒ‡é’ˆç›¸äº¤ï¼Œæˆ–è€…æ»¡è¶³å…¶ä»–ç‰¹æ®Šæ¡ä»¶æ—¶ä¸ºæ­¢ã€‚ æ¨¡æ¿1234567slow = 0fast = 1while æ²¡æœ‰éå†å®Œï¼š if æ»¡è¶³è¦æ±‚çš„ç‰¹æ®Šæ¡ä»¶: slow += 1 fast += 1return åˆé€‚çš„å€¼ é€‚ç”¨èŒƒå›´å¿«æ…¢æŒ‡é’ˆä¸€èˆ¬ç”¨äºå¤„ç†æ•°ç»„ä¸­çš„ç§»åŠ¨ã€åˆ é™¤å…ƒç´ é—®é¢˜ï¼Œæˆ–è€…é“¾è¡¨ä¸­çš„åˆ¤æ–­æ˜¯å¦æœ‰ç¯ã€é•¿åº¦é—®é¢˜ã€‚ å£è¯€æœç´¢ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæœç´¢åŒºé—´ä¸¤ç«¯é—­ã€‚while æ¡ä»¶å¸¦ç­‰å·ï¼Œå¦åˆ™éœ€è¦æ‰“è¡¥ä¸ã€‚if ç›¸ç­‰å°±è¿”å›ï¼Œå…¶ä»–çš„äº‹ç”­æ“å¿ƒã€‚mid å¿…é¡»åŠ å‡ä¸€ï¼Œå› ä¸ºåŒºé—´ä¸¤ç«¯é—­ã€‚whileç»“æŸå°±å‡‰äº†ï¼Œå‡„å‡„æƒ¨æƒ¨è¿” -1ã€‚ æœç´¢å·¦å³è¾¹ç•Œæ—¶ï¼Œæœç´¢åŒºé—´è¦é˜æ˜ã€‚ å·¦é—­å³å¼€æœ€å¸¸è§ï¼Œå…¶ä½™é€»è¾‘ä¾¿è‡ªæ˜: whileè¦ç”¨å°äºå·ï¼Œè¿™æ ·æ‰èƒ½ä¸æ¼æ‰ã€‚ if ç›¸ç­‰åˆ«è¿”å›ï¼Œåˆ©ç”¨ mid é”è¾¹ç•Œã€‚ mid åŠ ä¸€æˆ–å‡ä¸€?è¦çœ‹åŒºé—´å¼€æˆ–é—­ã€‚ whileç»“æŸä¸ç®—å®Œï¼Œå› ä¸ºä½ è¿˜æ²¡è¿”å›ã€‚ ç´¢å¼•å¯èƒ½å‡ºè¾¹ç•Œï¼Œif æ£€æŸ¥ä¿å¹³å®‰ã€‚ äºŒå‰æ ‘å‰ä¸­ååºéå†ï¼ˆé€’å½’ï¼‰1234567891011121314151617181920212223242526272829//å‰åºpublic void preorder(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) &#123; return; &#125; result.add(root.val);; //ä¸­é—´èŠ‚ç‚¹åœ¨å‰é¢ preorder(root.left, result); preorder(root.right, result);&#125;//ä¸­åºpublic void preorder(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) &#123; return; &#125; preorder(root.left, result); result.add(root.val); //ä¸­é—´èŠ‚ç‚¹åœ¨ä¸­é—´ preorder(root.right, result);&#125;//ååºpublic void preorder(TreeNode root, List&lt;Integer&gt; result) &#123; if (root == null) &#123; return; &#125; preorder(root.left, result); preorder(root.right, result); result.add(root.val);; //ä¸­é—´èŠ‚ç‚¹åœ¨åé¢&#125; å‰ä¸­ååºéå†ï¼ˆè¿­ä»£ï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243//å‰åº public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;Integer&gt;(); if (root == null) &#123; return res; &#125; Deque&lt;TreeNode&gt; stack = new LinkedList&lt;TreeNode&gt;(); //æ˜¾ç¤ºå£°æ˜ä¸€ä¸ªæ ˆ TreeNode node = root; while (!stack.isEmpty() || node != null) &#123; while (node != null) &#123; res.add(node.val); stack.push(node); node = node.left; &#125; node = stack.pop(); //å¯ä»¥è®©nodeé‡æ–°è¿”å›ä¸Šä¸€ä¸ªçˆ¶èŠ‚ç‚¹ node = node.right; &#125; return res;&#125;//ä¸­åºpublic List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;Integer&gt;(); if (root == null) &#123; return res; &#125; Deque&lt;TreeNode&gt; stk = new LinkedList&lt;TreeNode&gt;(); while (root != null || !stk.isEmpty()) &#123; while (root != null) &#123; //æ‰¾ç¬¬ä¸€ä¸ªå·¦å¶å­èŠ‚ç‚¹ï¼Œä¸”è¯¥å·¦å¶å­èŠ‚ç‚¹æ˜¯å…¥æ ˆäº†çš„ï¼Œæ‰€ä»¥ä¸‹é¢è¦å…ˆå‡ºæ ˆï¼Œå†ç»™ç»“æœèµ‹å€¼ stk.push(root); root = root.left; &#125; root = stk.pop(); res.add(root.val); root = root.right; &#125; return res;&#125;//ååº"},{"title":"","date":"2024-10-03T15:39:20.336Z","updated":"2024-10-03T15:39:20.336Z","comments":true,"path":"css/custom.css","permalink":"http://example.com/css/custom.css","excerpt":"","text":"/* ä¾§è¾¹æ ä¸ªäººä¿¡æ¯å¡ç‰‡åŠ¨æ€æ¸å˜è‰² */ #aside-content > .card-widget.card-info { background: linear-gradient( -45deg, #e8d8b9, #eccec5, #a3e9eb, #bdbdf0, #eec1ea ); box-shadow: 0 0 5px rgb(66, 68, 68); position: relative; background-size: 400% 400%; -webkit-animation: Gradient 10s ease infinite; -moz-animation: Gradient 10s ease infinite; animation: Gradient 10s ease infinite !important; } @-webkit-keyframes Gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } } @-moz-keyframes Gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } } @keyframes Gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } } /* é»‘å¤œæ¨¡å¼é€‚é… */ [data-theme=\"dark\"] #aside-content > .card-widget.card-info { background: #191919ee; } /* ä¸ªäººä¿¡æ¯Follow meæŒ‰é’® */ #aside-content > .card-widget.card-info > #card-info-btn { background-color: #3eb8be; border-radius: 8px; }"},{"title":"ç®—æ³•å­¦ä¹ ","date":"2024-04-27T11:25:24.000Z","updated":"2024-07-05T11:57:20.083Z","comments":true,"path":"algorithm/äºŒåˆ†æŸ¥æ‰¾.html","permalink":"http://example.com/algorithm/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html","excerpt":"","text":"äºŒåˆ†æŸ¥æ‰¾äºŒåˆ†æŸ¥æ‰¾ä»…é€‚ç”¨äºæœ‰åºçš„æ•°æ®é›†åˆï¼ˆå½“ç„¶æ•°ç»„æ˜¯æœ€å¸¸è§çš„ äºŒåˆ†æŸ¥æ‰¾çš„ä¸¤ç§æ€è·¯ç›´æ¥æ³•12345678910111213141516int left = 0;int right = nums.length - 1;while(left &lt;= right)&#123; int mid = (left + right ) &gt;&gt; 1; //å¦‚æœæ‰¾åˆ°ç›®æ ‡å€¼ï¼Œåˆ™ç›´æ¥èŒƒå›´ä¸­å¿ƒä½ç½® if (nums[mid] == target) return mid; //å¦‚æœ nums[mid] å°äºç›®æ ‡å€¼ï¼Œåˆ™åœ¨ [mid + 1, right] ä¸­ç»§ç»­æœç´¢ else if(nums[mid] &lt; target) left = mid + 1; //å¦‚æœ nums[mid] å¤§äºç›®æ ‡å€¼ï¼Œåˆ™åœ¨ [left, mid - 1] ä¸­ç»§ç»­æœç´¢ else right = mid - 1;&#125;//æœªæœç´¢åˆ°å…ƒç´ ï¼Œè¿”å› -1return -1; æ’é™¤æ³•12345678910111213int left = 0;int right = nums.length - 1;while(left &lt; right)&#123; int mid = (left + right ) &gt;&gt; 1; //å¦‚æœ nums[mid] å°äºç›®æ ‡å€¼ï¼Œæ’é™¤æ‰ä¸å¯èƒ½åŒºé—´ [left, mid]ï¼Œåœ¨ [mid + 1, right] ä¸­ç»§ç»­æœç´¢ else if(nums[mid] &lt; target) left = mid + 1; //å¦‚æœ nums[mid] å¤§äºç›®æ ‡å€¼ï¼Œç›®æ ‡å…ƒç´ å¯èƒ½åœ¨ [left, mid] ä¸­ï¼Œåœ¨ [left, mid] ä¸­ç»§ç»­æœç´¢ else if(nums[mid] &lt; target) right = mid; //æœªæœç´¢åˆ°å…ƒç´ ï¼Œè¿”å› -1 return left if nums[left] == target else -1&#125;"},{"title":"æˆ‘çš„æœ‹å‹ä»¬","date":"2025-02-01T04:37:52.996Z","updated":"2025-02-01T04:37:52.996Z","comments":true,"path":"friends/index.html","permalink":"http://example.com/friends/index.html","excerpt":"è¿™é‡Œå†™å‹é“¾ä¸Šæ–¹çš„å†…å®¹ã€‚","text":"è¿™é‡Œå†™å‹é“¾ä¸Šæ–¹çš„å†…å®¹ã€‚ è¿™é‡Œå¯ä»¥å†™å‹é“¾é¡µé¢ä¸‹æ–¹çš„æ–‡å­—å¤‡æ³¨ï¼Œä¾‹å¦‚è‡ªå·±çš„å‹é“¾è§„èŒƒã€ç¤ºä¾‹ç­‰ã€‚"}],"posts":[{"title":"ç¾å›¢æš‘æœŸé¢è¯•","slug":"é¢ç»/ç¾å›¢æš‘æœŸé¢è¯•","date":"2025-03-08T09:06:26.000Z","updated":"2025-03-08T10:09:30.060Z","comments":true,"path":"2025/03/08/é¢ç»/ç¾å›¢æš‘æœŸé¢è¯•/","permalink":"http://example.com/2025/03/08/%E9%9D%A2%E7%BB%8F/%E7%BE%8E%E5%9B%A2%E6%9A%91%E6%9C%9F%E9%9D%A2%E8%AF%95/","excerpt":"ç¾å›¢æš‘æœŸé¢è¯•ï¼Œå¸Œæœ›èƒ½æ‹¿åˆ°offer","text":"ç¾å›¢æš‘æœŸé¢è¯•ï¼Œå¸Œæœ›èƒ½æ‹¿åˆ°offer 1.Aié¢è¯•(3.8æ—¥) TCPé‡ä¼ æœºåˆ¶æœ‰å“ªäº›è§¦å‘æ¡ä»¶ï¼Ÿè¶…æ—¶é‡ä¼ å’Œå¿«é€Ÿé‡ä¼ çš„åŒºåˆ«ï¼Ÿ è§£é‡ŠLinuxç®¡é“çš„æ¦‚å¿µï¼Œç»™å‡ºä¸€ä¸ªä½¿ç”¨ç®¡é“çš„ä¾‹å­ å¯¹explainå…³é”®å­—çš„ç†è§£ï¼ŒåŒ…æ‹¬å®ƒçš„ç”¨é€”å¦‚ä½•ä½¿ç”¨å…¸å‹è¾“å‡ºä¿¡æ¯çš„å«ä¹‰ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ– è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ï¼Ÿç»™å‡ºä¸€ä¸ªä¾‹å­ hashCodeå’Œequalsçš„å…³ç³»ï¼Ÿä¸ºä»€ä¹ˆè¦é‡å†™hashcodeå’Œequals è§£é‡ŠJavaä¸­çš„çº¿ç¨‹ï¼Œå¦‚ä½•åˆ›å»ºå’Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ è®¾è®¡ä¸€ä¸ªç®€å•çš„æ–‡ç« çƒ­åº¦è®¡ç®—ç³»ç»Ÿè€ƒè™‘æµè§ˆé‡è¯„è®ºæ•°å’Œåˆ†äº«æ•°ç­‰å› ç´  è¿½é—®ï¼šæ˜¯å¦è€ƒè™‘è¿‡æ—¶é—´å› ç´ å¯¹æ–‡ç« çƒ­åº¦çš„å½±å“ï¼Ÿæ¯”å¦‚ï¼Œä¸€ç¯‡æ–‡ç« ä¸­å‘å¸ƒåçš„ä¸åŒæ—¶é—´æ®µå†…çƒ­åº¦çš„å˜åŒ–æƒ…å†µï¼Œå¦‚æœè€ƒè™‘çš„è¯ï¼Œä½ ä¼šå¦‚ä½•å°†æ—¶é—´å› ç´ æ•´åˆåˆ°çƒ­åº¦è®¡ç®—ä¸­å‘¢ï¼Ÿ åœ¨ç¼–ç¨‹å­¦ä¹ ä¸­å¦‚ä½•å¤„ç†æŒ«æŠ˜æ„Ÿå’ŒæŒç»­ä¿æŒå­¦ä¹ åŠ¨åŠ›çš„ï¼Ÿä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[]},{"title":"ä¸Šæµ·å°–å³°åˆè®¯é¢ç»","slug":"é¢ç»/ä¸Šæµ·å°–å³°åˆè®¯é¢ç»","date":"2025-03-03T07:13:03.000Z","updated":"2025-03-03T09:21:22.684Z","comments":true,"path":"2025/03/03/é¢ç»/ä¸Šæµ·å°–å³°åˆè®¯é¢ç»/","permalink":"http://example.com/2025/03/03/%E9%9D%A2%E7%BB%8F/%E4%B8%8A%E6%B5%B7%E5%B0%96%E5%B3%B0%E5%90%88%E8%AE%AF%E9%9D%A2%E7%BB%8F/","excerpt":"æœ€è¿‘å¼€å­¦è¿›åº¦ä¸€ç›´æ‹–å»¶ï¼Œè¿™åœºé¢è¯•ç®—æ˜¯æ‰¾å›ä¸€ä¸‹â€œæ‰‹æ„Ÿâ€äº†ï¼Œé—®çš„ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸è¿‡ä¹Ÿä¸å‡†å¤‡å»ï¼Œæ„Ÿè§‰æ˜¯é»‘å¤–åŒ…ğŸ˜…","text":"æœ€è¿‘å¼€å­¦è¿›åº¦ä¸€ç›´æ‹–å»¶ï¼Œè¿™åœºé¢è¯•ç®—æ˜¯æ‰¾å›ä¸€ä¸‹â€œæ‰‹æ„Ÿâ€äº†ï¼Œé—®çš„ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸è¿‡ä¹Ÿä¸å‡†å¤‡å»ï¼Œæ„Ÿè§‰æ˜¯é»‘å¤–åŒ…ğŸ˜… è‡ªæˆ‘ä»‹ç» é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾ï¼Œç„¶ååˆ†åˆ«ä»‹ç»ä¸€ä¸‹ ä¸€ä¸ªç±»èƒ½ä¸èƒ½ç»§æ‰¿å¤šä¸ªç±» &#x3D;&#x3D;å’Œequalsçš„åŒºåˆ« å¸¸ç”¨é›†åˆ ArrayListå¦‚ä½•å»é‡ ç­”ï¼šå€ŸåŠ©hashSet hashmapå¹¶å‘ä¸‹æœ‰ä»€ä¹ˆé—®é¢˜ mybatisçš„#å’Œ $æœ‰ä»€ä¹ˆåŒºåˆ« mybatiså¦‚ä½•åˆ†é¡µ ç­”ï¼šä½¿ç”¨limitå…³é”®å­—ã€‚è¿˜æœ‰ä¸€ä¸ªpagehelperæ’ä»¶è¿™ä¸ªæ²¡ç­”åˆ° ç´¢å¼•å¤±æ•ˆæœ‰å“ªäº›æƒ…å†µ æ¼ç­”äº†æ¨¡ç³ŠåŒ¹é…å’Œè¡¨è¾¾å¼è®¡ç®—è¿™ä¸¤ä¸ª æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«ï¼ˆä¸ä¼š åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ runableå’Œcallableçš„åŒºåˆ« startå’Œrunæœ‰ä»€ä¹ˆåŒºåˆ« èƒ½ç›´æ¥è°ƒç”¨runæ–¹æ³•å— æˆ‘ç”¨è¿‡gitå“ªäº›å‘½ä»¤ ç„¶ååé—®ã€‚é—®äº†ä¸€ä¸‹è¿›å…¥åšä»€ä¹ˆä¸šåŠ¡ä»¥åŠå¯èƒ½ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆã€‚ä¸è¿‡æ„Ÿè§‰è¿™ä¸ªå¯èƒ½æœ‰ç‚¹å‘ï¼Œå®ä¹ åˆ°äº”æœˆåº•ä¹‹å‰ä¸èƒ½ç¦»èŒå¦åˆ™æœ‰è¿çº¦é‡‘ï¼Œè€Œä¸”å®ä¹ ç”Ÿå½“æ­£å¼å·¥ç”¨ã€‚ è¿‡äº†ä¿©å°æ—¶æ‰“ç”µè¯ocï¼Œæ‹’ç»äº†","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[]},{"title":"ideaå·¥å…·","slug":"ideaå·¥å…·","date":"2025-02-04T13:52:54.000Z","updated":"2025-02-05T10:23:31.285Z","comments":true,"path":"2025/02/04/ideaå·¥å…·/","permalink":"http://example.com/2025/02/04/idea%E5%B7%A5%E5%85%B7/","excerpt":"ideaæ–°æ‰‹æ•™ç¨‹","text":"ideaæ–°æ‰‹æ•™ç¨‹ å¿«æ·é”®ç³»åˆ— å—æ³¨é‡ŠCTRL+SHIFT+/ å¦‚æœæƒ³å¯¹ä¸€æ®µä»£ç ç”¨ä¸€äº›å¸¸ç”¨å‡½æ•°åŒ…å›´èµ·æ¥ï¼Œå¯ä»¥ç”¨CTRL+ALT+Tï¼Œæ¯”å¦‚FOR,IF,TRY...CATCH æ¥è§¦ä¸Šä¸€æ­¥çš„åŒ…å›´æ“ä½œï¼šCTRL+SHIFT+DELETE é‡å‘½åï¼šSHIFT+F6 CTRL+P æŸ¥çœ‹æ–¹æ³•éœ€è¦çš„å‚æ•° CTRL+Qå¯æŸ¥çœ‹å…‰æ ‡å¤„ç¬¦å·çš„æ–‡æ¡£ F2å¯ç›´æ¥è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæŠ¥é”™çš„åœ°æ–¹ Gitç›¸å…³æäº¤ä¹‹ååˆ°æš‚å­˜åŒºï¼Œä½¿ç”¨å¿«æ·é”®CTRL+SHIFT+Kå¯ä»¥æ‰“å¼€æ¨é€çª—å£","categories":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://example.com/categories/%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"IDEA","slug":"IDEA","permalink":"http://example.com/tags/IDEA/"}]},{"title":"ACMæ¨¡å¼å­¦ä¹ ","slug":"ACMæ¨¡å¼å­¦ä¹ ","date":"2025-02-01T03:56:05.000Z","updated":"2025-02-21T03:50:17.399Z","comments":true,"path":"2025/02/01/ACMæ¨¡å¼å­¦ä¹ /","permalink":"http://example.com/2025/02/01/ACM%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/","excerpt":"ç”±äºä¹‹å‰åˆ·é¢˜ä¸€ç›´æ˜¯åœ¨åŠ›æ‰£ç”¨çš„æ ¸å¿ƒæ¨¡å¼ï¼Œè€Œåœ¨æ‰¾å·¥ä½œæ—¶å¾ˆå¤šæƒ…å†µéœ€è¦ç”¨ACMæ¨¡å¼æ¥åšé¢˜ï¼Œå› æ­¤éœ€è¦ç†Ÿæ‚‰ä¸€ä¸‹ACMæ¨¡å¼çš„å†™æ³•ï¼Œåç»­ä¹Ÿä¼šç”¨ACMæ¨¡å¼é‡æ–°åšä¸€éhot100ï¼Œè¿›ä¸€æ­¥ç†Ÿæ‚‰è¿™ç§æ¨¡å¼ã€‚åŠ æ²¹ï¼(â‰§âˆ‡â‰¦)ï¾‰","text":"ç”±äºä¹‹å‰åˆ·é¢˜ä¸€ç›´æ˜¯åœ¨åŠ›æ‰£ç”¨çš„æ ¸å¿ƒæ¨¡å¼ï¼Œè€Œåœ¨æ‰¾å·¥ä½œæ—¶å¾ˆå¤šæƒ…å†µéœ€è¦ç”¨ACMæ¨¡å¼æ¥åšé¢˜ï¼Œå› æ­¤éœ€è¦ç†Ÿæ‚‰ä¸€ä¸‹ACMæ¨¡å¼çš„å†™æ³•ï¼Œåç»­ä¹Ÿä¼šç”¨ACMæ¨¡å¼é‡æ–°åšä¸€éhot100ï¼Œè¿›ä¸€æ­¥ç†Ÿæ‚‰è¿™ç§æ¨¡å¼ã€‚åŠ æ²¹ï¼(â‰§âˆ‡â‰¦)ï¾‰ hot100çš„ACMæ¨¡å¼è§£é¢˜ 1.åŒºåˆ†nextã€nextIntã€nextLine1. next() åŠŸèƒ½ï¼šè¯»å–è¾“å…¥ä¸­çš„ä¸‹ä¸€ä¸ªå•è¯ï¼ˆä»¥ç©ºç™½ç¬¦ä¸ºåˆ†éš”ç¬¦ï¼‰ã€‚ è¡Œä¸ºï¼š è·³è¿‡è¾“å…¥ä¸­çš„å‰å¯¼ç©ºæ ¼&#x2F;æ¢è¡Œç¬¦ã€‚ è¯»å–å­—ç¬¦ç›´åˆ°é‡åˆ°ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦æˆ–æ¢è¡Œç¬¦ã€‚ ä¸åŒ…å«æœ«å°¾çš„ç©ºç™½ç¬¦ï¼Œä¸”ä¸ä¼šæ¶ˆè€—æ¢è¡Œç¬¦ã€‚ ç¤ºä¾‹ï¼š java å¤åˆ¶ 12Scanner sc = new Scanner(System.in);String word = sc.next(); è¾“å…¥ &quot; Hello World\\n&quot;ï¼Œword = &quot;Hello&quot;ï¼Œå‰©ä½™è¾“å…¥ä¸º &quot;World\\n&quot;ã€‚ 2. nextInt() åŠŸèƒ½ï¼šè¯»å–è¾“å…¥ä¸­çš„ä¸‹ä¸€ä¸ªæ•´æ•°ã€‚ è¡Œä¸ºï¼š è·³è¿‡å‰å¯¼ç©ºæ ¼&#x2F;æ¢è¡Œç¬¦ã€‚ è¯»å–è¿ç»­æ•°å­—å­—ç¬¦ï¼Œç›´åˆ°é‡åˆ°éæ•°å­—å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼æˆ–å­—æ¯ï¼‰ã€‚ ä¸ä¼šæ¶ˆè€—åç»­çš„æ¢è¡Œç¬¦æˆ–ç©ºæ ¼ï¼Œå¯èƒ½å¯¼è‡´åç»­nextLine()è¯»åˆ°ç©ºå­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ï¼š java å¤åˆ¶ 12Scanner sc = new Scanner(System.in);int num = sc.nextInt(); è¾“å…¥ &quot; 42\\n&quot;ï¼Œnum = 42ï¼Œå‰©ä½™è¾“å…¥ä¸º &quot;\\n&quot;ã€‚ è¾“å…¥ &quot;abc&quot; ä¼šæŠ›å‡º InputMismatchExceptionã€‚ 3. nextLine() åŠŸèƒ½ï¼šè¯»å–è¾“å…¥ä¸­çš„ä¸€æ•´è¡Œå†…å®¹ï¼ˆåˆ°æ¢è¡Œç¬¦ä¸ºæ­¢ï¼‰ã€‚ è¡Œä¸ºï¼š è¯»å–ä»å½“å‰ä½ç½®åˆ°æ¢è¡Œç¬¦ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ã€‚ æ¶ˆè€—æ¢è¡Œç¬¦ï¼Œè¾“å…¥æµä¸­ä¸å†æ®‹ç•™æ¢è¡Œç¬¦ã€‚ ç¤ºä¾‹ï¼š java å¤åˆ¶ 12Scanner sc = new Scanner(System.in);String line = sc.nextLine(); è¾“å…¥ &quot;Hello World\\n&quot;ï¼Œline = &quot;Hello World&quot;ï¼Œå‰©ä½™è¾“å…¥ä¸ºç©ºã€‚ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆé—®é¢˜ï¼šæ··åˆä½¿ç”¨nextInt()å’ŒnextLine()å¯¼è‡´è·³è¿‡è¾“å…¥ åœºæ™¯ï¼š java å¤åˆ¶ 123Scanner sc = new Scanner(System.in);int num = sc.nextInt(); // è¾“å…¥ &quot;42\\n&quot;String line = sc.nextLine(); // line ä¸ºç©ºå­—ç¬¦ä¸² åŸå› ï¼šnextInt()è¯»å–äº†42ï¼Œä½†æœªæ¶ˆè€—åé¢çš„æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰ï¼ŒnextLine()ç›´æ¥è¯»å–äº†æ®‹ç•™çš„æ¢è¡Œç¬¦ã€‚ è§£å†³ï¼šåœ¨nextInt()åè°ƒç”¨ä¸€æ¬¡nextLine()æ¶ˆè€—æ¢è¡Œç¬¦ï¼š java å¤åˆ¶ 123int num = sc.nextInt();sc.nextLine(); // æ¸…é™¤æ®‹ç•™çš„æ¢è¡Œç¬¦String line = sc.nextLine(); æ€»ç»“ **next()**ï¼šé€‚åˆè¯»å–ä»¥ç©ºæ ¼åˆ†éš”çš„å•è¯ã€‚ **nextInt()**ï¼šè¯»å–æ•´æ•°ï¼Œéœ€æ³¨æ„å¤„ç†æ®‹ç•™çš„æ¢è¡Œç¬¦ã€‚ **nextLine()**ï¼šè¯»å–æ•´è¡Œå†…å®¹ï¼Œå¸¸ç”¨äºå¤„ç†å«ç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚ è°¨æ…æ··ç”¨next() å’ŒnextLine() 2.é«˜æ•ˆå¤„ç†å¤§é‡æ•°æ® BufferedReaderï¼š ç”¨äºé«˜æ•ˆè¯»å–è¾“å…¥æµï¼ˆæ¯” Scanner æ›´å¿«ï¼‰ã€‚ readLine() æ–¹æ³•é€è¡Œè¯»å–è¾“å…¥ã€‚ StringTokenizerï¼š ç”¨äºå°†æ¯è¡Œè¾“å…¥æŒ‰ç©ºæ ¼åˆ†å‰²æˆå¤šä¸ªæ•´æ•°ã€‚ hasMoreTokens() æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æœªå¤„ç†çš„æ ‡è®°ã€‚ nextToken() è·å–ä¸‹ä¸€ä¸ªæ ‡è®°å¹¶è½¬æ¢ä¸ºæ•´æ•°ã€‚ ä¸¾ä¾‹è¯´æ˜ 123456789//è¾“å…¥ï¼š1 2 34 50 0 0 0 0 //è¾“å‡º690 123456789101112131415161718192021222324import java.io.*;import java.util.*;public class Main &#123; public static void main(String[] args) throws IOException &#123; BufferedReader br = new BufferedReader(new InputStreamReader(System.in)); String line; // é€è¡Œè¯»å–è¾“å…¥ while ((line = br.readLine()) != null) &#123; StringTokenizer st = new StringTokenizer(line); // åˆ†å‰²æ¯è¡Œçš„æ•°æ® int sum = 0; // éå†æ¯è¡Œçš„æ‰€æœ‰æ•´æ•° while (st.hasMoreTokens()) &#123; int num = Integer.parseInt(st.nextToken()); sum += num; &#125; // è¾“å‡ºå½“å‰è¡Œçš„æ±‚å’Œç»“æœ System.out.println(sum); &#125; &#125;&#125; ä½¿ç”¨æŠ€å·§ StringTokenizer é«˜æ•ˆåˆ†å‰²å­—ç¬¦ä¸² æ¯” split() æ›´å¿« 3.äºŒå‰æ ‘ç›¸å…³1.äºŒå‰æ ‘çš„æ„é€ è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼Œå¯ä»¥é…åˆè¯»å–ä¸€è¡Œæ•°æ®ï¼Œç„¶åå°†è¯¥è¡Œæ•°æ®è½¬ä¸ºå­—ç¬¦ä¸²æ•°ç»„ä¼ å…¥è¯¥å‡½æ•°å¾—åˆ°æ ‘æ ¹èŠ‚ç‚¹ 1234567891011121314151617181920212223242526public static TreeNode buildTree(String[] nodes)&#123; if(nodes == null || nodes.length == 0 || nodes[0].equals(&quot;null&quot;)) return null; TreeNode root = new TreeNode(Integer.parseInt(nodes[0])); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.offer(root); int index = 1; while (!queue.isEmpty() &amp;&amp; index &lt; nodes.length)&#123; TreeNode cur = queue.poll(); if(index &lt; nodes.length &amp;&amp; !nodes[index].equals(&quot;null&quot;))&#123; cur.left = new TreeNode(Integer.parseInt(nodes[index])); queue.offer(cur.left); &#125; index++; if(index &lt; nodes.length &amp;&amp; !nodes[index].equals(&quot;null&quot;))&#123; cur.right = new TreeNode(Integer.parseInt(nodes[index])); queue.offer(cur.right); &#125; index++; &#125; return root; &#125; 2.äºŒå‰æ ‘çš„å±‚åºéå†è¿™ä¸ªä¹Ÿè¦ç†Ÿç»ƒæŒæ¡ï¼Œå› ä¸ºæœ‰äº›é¢˜ç›®çš„è¾“å‡ºéœ€è¦ï¼Œè€Œä¸”æœ‰å¾ˆå¤šå±‚åºéå†çš„å˜ç§é¢˜ç›®ï¼Œä½œä¸ºæœ€åŸºç¡€çš„å±‚åºéå†æŒæ¡äº†å†å†™å˜ç§é¢˜ç›®ä¹Ÿä¼šç®€å•çš„å¤šã€‚ 123456789101112131415161718192021public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); if(root == null) return ans; ArrayDeque&lt;TreeNode&gt; deque = new ArrayDeque&lt;&gt;(); deque.offer(root); while (!deque.isEmpty())&#123; int size = deque.size(); ArrayList&lt;Integer&gt; temp = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; size; i++) &#123; TreeNode node = deque.poll(); if(node.left != null) deque.offer(node.left); if(node.right != null) deque.offer(node.right); temp.add(node.val); &#125; ans.add(temp); &#125; return ans; &#125; 4.æ•°ç»„ç›¸å…³1.ä¸€ç»´æ•°ç»„è¾“å‡º1Arrays.toString(nums) 2.äºŒç»´æ•°ç»„è¾“å‡º1Arrays.deepToString(martrix) 3.ç”±è¾“å…¥å­—ç¬¦ä¸²æ„å»ºæ•´æ•°æ•°ç»„1234567Scanner sc = new Scanner(System.in); String s = sc.nextLine(); String[] split = s.split(&quot;,&quot;); int[] nums = new int[split.length]; for (int i = 0; i &lt; nums.length; i++) &#123; nums[i] = Integer.parseInt(split[i]); &#125;","categories":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://example.com/categories/%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/tags/%E5%88%B7%E9%A2%98/"}]},{"title":"æ›´æ¢ä¸»é¢˜","slug":"æ›´æ¢ä¸»é¢˜","date":"2025-01-21T08:30:26.000Z","updated":"2025-01-21T08:37:41.121Z","comments":true,"path":"2025/01/21/æ›´æ¢ä¸»é¢˜/","permalink":"http://example.com/2025/01/21/%E6%9B%B4%E6%8D%A2%E4%B8%BB%E9%A2%98/","excerpt":"","text":"ä¸€ã€æŸ¥çœ‹å‰ç½®æ¡ä»¶ä»¥ä¸‹æ˜¯å®˜æ–¹çš„å‰ç½®æ¡ä»¶ï¼š è¿™æ˜¯æˆ‘çš„hexoç‰ˆæœ¬ä¿¡æ¯ è¿™æ˜¯nodeå’Œnpmç‰ˆæœ¬ä¿¡æ¯ äºŒã€æ›´æ–°ä¸»é¢˜ä¿®æ”¹åšå®¢é…ç½®æ–‡ä»¶ 1theme: volantis","categories":[],"tags":[]},{"title":"springcloudå­¦ä¹ ","slug":"springcloudå­¦ä¹ ","date":"2025-01-18T12:32:05.000Z","updated":"2025-01-31T08:06:14.252Z","comments":true,"path":"2025/01/18/springcloudå­¦ä¹ /","permalink":"http://example.com/2025/01/18/springcloud%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"ä¸€ã€Docker1.åŸºç¡€å‘½ä»¤2.æ•°æ®å·å®¹å™¨å†…éƒ¨çš„æ•°æ®ä¸å¥½ä¿®æ”¹ï¼Œå› æ­¤æ•°æ®å·åº”è¿è€Œç”Ÿï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼Œæ˜¯è”é€šå®¿ä¸»æœºç›®å½•å’Œå®¹å™¨ç›®å½•çš„ä¸­é—´æ¡¥æ¢ã€‚ æ•°æ®å·å‘½ä»¤ï¼š æ³¨æ„ï¼šå®¹å™¨ä¸æ•°æ®å·çš„æŒ‚è½½è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶é…ç½®ï¼Œå¯¹äºåˆ›å»ºå¥½çš„å®¹å™¨ï¼Œæ˜¯ä¸èƒ½è®¾ç½®æ•°æ®å·çš„ã€‚è€Œä¸”åˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å·ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ æ•°æ®å·çš„ç›®å½•ç»“æ„è¾ƒæ·±ï¼Œå¦‚æœæˆ‘ä»¬å»æ“ä½œæ•°æ®å·ç›®å½•ä¼šä¸å¤ªæ–¹ä¾¿ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šç›´æ¥å°†å®¹å™¨ç›®å½•ä¸å®¿ä¸»æœºæŒ‡å®šç›®å½•æŒ‚è½½ã€‚æŒ‚è½½è¯­æ³•ä¸æ•°æ®å·ç±»ä¼¼ï¼š 1234# æŒ‚è½½æœ¬åœ°ç›®å½•-v æœ¬åœ°ç›®å½•:å®¹å™¨å†…ç›®å½•# æŒ‚è½½æœ¬åœ°æ–‡ä»¶-v æœ¬åœ°æ–‡ä»¶:å®¹å™¨å†…æ–‡ä»¶ æ³¨æ„ï¼šæœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶å¿…é¡»ä»¥ / æˆ– ./å¼€å¤´ï¼Œå¦‚æœç›´æ¥ä»¥åå­—å¼€å¤´ï¼Œä¼šè¢«è¯†åˆ«ä¸ºæ•°æ®å·åè€Œéæœ¬åœ°ç›®å½•åã€‚ ä¾‹å¦‚ï¼š 12-v mysql:/var/lib/mysql # ä¼šè¢«è¯†åˆ«ä¸ºä¸€ä¸ªæ•°æ®å·å«mysqlï¼Œè¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªæ•°æ®å·-v ./mysql:/var/lib/mysql # ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½• äºŒã€é¡¹ç›® å¯¼å…¥é¡¹ç›® å‡ºç°é”™è¯¯ï¼šdocker: Error response from daemon: Get â€œhttps://registry-1.docker.io/v2/â€œ: net&#x2F;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers). åœ¨è¿™é‡Œè§£å†³äº†ï¼Œä¿®æ”¹äº†daemon.jsonå°±å¯ä»¥äº†ï¼Œæ•ˆæœå¦‚ä¸‹ æ¥ä¸‹æ¥è¿æ¥æ•°æ®åº“ï¼Œè¿™é‡Œè´¦å·å¯†ç åº”è¯¥æ˜¯æ•°æ®åº“çš„è€Œä¸æ˜¯è™šæ‹Ÿæœºçš„ æ¥ä¸‹æ¥æŒ‰ç…§è§†é¢‘é‡Œé¢å¯åŠ¨åç«¯é¡¹ç›®ï¼Œæœ‰ä¸¤ä¸ªå°æ’æ›²ï¼Œä¸€ä¸ªæ˜¯lombokç‰ˆæœ¬é—®é¢˜ï¼Œä¿®æ”¹ä¸ºäº†1.18.30ï¼Œå¦ä¸€ä¸ªæ˜¯8080ç«¯å£è¢«å ç”¨äº†ï¼Œç›´æ¥åœ¨ä»»åŠ¡ç®¡ç†å™¨é‡Œé¢æ€æ­»äº† åé¢ä¸ºitem-serviceåˆ›å»ºå•ç‹¬æ•°æ®åº“çš„æ—¶å€™ï¼Œå‘ç°è¿æ¥ä¸ä¸Šå»ï¼Œåé¢è§£å†³äº†ï¼Œæ˜¯dockeré‡Œé¢çš„mysqlæ²¡æœ‰å¯åŠ¨ï¼Œè®¾ç½®è‡ªå¯åŠ¨å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œåé¢å†çœ‹çœ‹ è®¾ç½®dockerå¼€å¯è‡ªå¯åŠ¨ï¼š 1systemctl enable docker ç„¶åå¯åŠ¨MySQLå®¹å™¨ 12# docker start å®¹å™¨ådocker start mysql ç„¶åå°±æ˜¯æ‹†åˆ†äº†å•†å“æœåŠ¡å’Œè´­ç‰©è½¦æœåŠ¡ äºŒã€æ³¨å†Œä¸­å¿ƒåœ¨å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªè§’è‰²ï¼š æœåŠ¡æä¾›è€…ï¼šæä¾›æ¥å£ä¾›å…¶å®ƒå¾®æœåŠ¡è®¿é—®ï¼Œæ¯”å¦‚item-service æœåŠ¡æ¶ˆè´¹è€…ï¼šè°ƒç”¨å…¶å®ƒå¾®æœåŠ¡æä¾›çš„æ¥å£ï¼Œæ¯”å¦‚cart-service åœ¨å¤§å‹å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼ŒæœåŠ¡æä¾›è€…çš„æ•°é‡ä¼šéå¸¸å¤šï¼Œä¸ºäº†ç®¡ç†è¿™äº›æœåŠ¡å°±å¼•å…¥äº†æ³¨å†Œä¸­å¿ƒçš„æ¦‚å¿µã€‚æ³¨å†Œä¸­å¿ƒã€æœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ä¸‰è€…é—´å…³ç³»å¦‚ä¸‹ï¼š æµç¨‹å¦‚ä¸‹ï¼š æœåŠ¡å¯åŠ¨æ—¶å°±ä¼šæ³¨å†Œè‡ªå·±çš„æœåŠ¡ä¿¡æ¯ï¼ˆæœåŠ¡åã€IPã€ç«¯å£ï¼‰åˆ°æ³¨å†Œä¸­å¿ƒ è°ƒç”¨è€…å¯ä»¥ä»æ³¨å†Œä¸­å¿ƒè®¢é˜…æƒ³è¦çš„æœåŠ¡ï¼Œè·å–æœåŠ¡å¯¹åº”çš„å®ä¾‹åˆ—è¡¨ï¼ˆ1ä¸ªæœåŠ¡å¯èƒ½å¤šå®ä¾‹éƒ¨ç½²ï¼‰ è°ƒç”¨è€…è‡ªå·±å¯¹å®ä¾‹åˆ—è¡¨è´Ÿè½½å‡è¡¡ï¼ŒæŒ‘é€‰ä¸€ä¸ªå®ä¾‹ è°ƒç”¨è€…å‘è¯¥å®ä¾‹å‘èµ·è¿œç¨‹è°ƒç”¨ å½“æœåŠ¡æä¾›è€…çš„å®ä¾‹å®•æœºæˆ–è€…å¯åŠ¨æ–°å®ä¾‹æ—¶ï¼Œè°ƒç”¨è€…å¦‚ä½•å¾—çŸ¥å‘¢ï¼Ÿ æœåŠ¡æä¾›è€…ä¼šå®šæœŸå‘æ³¨å†Œä¸­å¿ƒå‘é€è¯·æ±‚ï¼ŒæŠ¥å‘Šè‡ªå·±çš„å¥åº·çŠ¶æ€ï¼ˆå¿ƒè·³è¯·æ±‚ï¼‰ å½“æ³¨å†Œä¸­å¿ƒé•¿æ—¶é—´æ”¶ä¸åˆ°æä¾›è€…çš„å¿ƒè·³æ—¶ï¼Œä¼šè®¤ä¸ºè¯¥å®ä¾‹å®•æœºï¼Œå°†å…¶ä»æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ä¸­å‰”é™¤ å½“æœåŠ¡æœ‰æ–°å®ä¾‹å¯åŠ¨æ—¶ï¼Œä¼šå‘é€æ³¨å†ŒæœåŠ¡è¯·æ±‚ï¼Œå…¶ä¿¡æ¯ä¼šè¢«è®°å½•åœ¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å®ä¾‹åˆ—è¡¨ å½“æ³¨å†Œä¸­å¿ƒæœåŠ¡åˆ—è¡¨å˜æ›´æ—¶ï¼Œä¼šä¸»åŠ¨é€šçŸ¥å¾®æœåŠ¡ï¼Œæ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ 1.æœåŠ¡æ³¨å†Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠitem-serviceæ³¨å†Œåˆ°Nacosï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š å¼•å…¥ä¾èµ– 12345&lt;!--nacos æœåŠ¡æ³¨å†Œå‘ç°--&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½®Nacosåœ°å€ åœ¨item-serviceçš„application.ymlä¸­æ·»åŠ nacosåœ°å€é…ç½®ï¼š 123456spring: application: name: item-service # æœåŠ¡åç§° cloud: nacos: server-addr: 192.168.150.101:8848 # nacosåœ°å€ é‡å¯ 2.æœåŠ¡å‘ç°æœåŠ¡çš„æ¶ˆè´¹è€…è¦å»nacosè®¢é˜…æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æœåŠ¡å‘ç°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š å¼•å…¥ä¾èµ– æœåŠ¡å‘ç°é™¤äº†è¦å¼•å…¥nacosä¾èµ–ä»¥å¤–ï¼Œç”±äºè¿˜éœ€è¦è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤è¦å¼•å…¥SpringCloudæä¾›çš„LoadBalancerä¾èµ–ã€‚ æˆ‘ä»¬åœ¨cart-serviceä¸­çš„pom.xmlä¸­æ·»åŠ ä¸‹é¢çš„ä¾èµ–ï¼š 12345&lt;!--nacos æœåŠ¡æ³¨å†Œå‘ç°--&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;&lt;/dependency&gt; å¯ä»¥å‘ç°ï¼Œè¿™é‡ŒNacosçš„ä¾èµ–äºæœåŠ¡æ³¨å†Œæ—¶ä¸€è‡´ï¼Œè¿™ä¸ªä¾èµ–ä¸­åŒæ—¶åŒ…å«äº†æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„åŠŸèƒ½ã€‚å› ä¸ºä»»ä½•ä¸€ä¸ªå¾®æœåŠ¡éƒ½å¯ä»¥è°ƒç”¨åˆ«äººï¼Œä¹Ÿå¯ä»¥è¢«åˆ«äººè°ƒç”¨ï¼Œå³å¯ä»¥æ˜¯è°ƒç”¨è€…ï¼Œä¹Ÿå¯ä»¥æ˜¯æä¾›è€…ã€‚ å› æ­¤ï¼Œç­‰ä¸€ä¼šå„¿cart-serviceå¯åŠ¨ï¼ŒåŒæ ·ä¼šæ³¨å†Œåˆ°Nacos é…ç½®Nacosåœ°å€ 1234spring: cloud: nacos: server-addr: 192.168.150.101:8848 å‘ç°å¹¶è°ƒç”¨æœåŠ¡ ä¸‰ã€OpenFeignåœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬åˆ©ç”¨Nacoså®ç°äº†æœåŠ¡çš„æ²»ç†ï¼Œåˆ©ç”¨RestTemplateå®ç°äº†æœåŠ¡çš„è¿œç¨‹è°ƒç”¨ã€‚ä½†æ˜¯è¿œç¨‹è°ƒç”¨çš„ä»£ç å¤ªå¤æ‚äº†ï¼š è€Œä¸”è¿™ç§è°ƒç”¨æ–¹å¼ï¼Œä¸åŸæœ¬çš„æœ¬åœ°æ–¹æ³•è°ƒç”¨å·®å¼‚å¤ªå¤§ï¼Œç¼–ç¨‹æ—¶çš„ä½“éªŒä¹Ÿä¸ç»Ÿä¸€ï¼Œä¸€ä¼šå„¿è¿œç¨‹è°ƒç”¨ï¼Œä¸€ä¼šå„¿æœ¬åœ°è°ƒç”¨ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•æ”¹å˜è¿œç¨‹è°ƒç”¨çš„å¼€å‘æ¨¡å¼ï¼Œè®©è¿œç¨‹è°ƒç”¨åƒæœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·ç®€å•ã€‚è€Œè¿™å°±è¦ç”¨åˆ°OpenFeignç»„ä»¶äº†ã€‚ å…¶å®è¿œç¨‹è°ƒç”¨çš„å…³é”®ç‚¹å°±åœ¨äºå››ä¸ªï¼š è¯·æ±‚æ–¹å¼ è¯·æ±‚è·¯å¾„ è¯·æ±‚å‚æ•° è¿”å›å€¼ç±»å‹ æ‰€ä»¥ï¼ŒOpenFeignå°±åˆ©ç”¨SpringMVCçš„ç›¸å…³æ³¨è§£æ¥å£°æ˜ä¸Šè¿°4ä¸ªå‚æ•°ï¼Œç„¶ååŸºäºåŠ¨æ€ä»£ç†å¸®æˆ‘ä»¬ç”Ÿæˆè¿œç¨‹è°ƒç”¨çš„ä»£ç ï¼Œè€Œæ— éœ€æˆ‘ä»¬æ‰‹åŠ¨å†ç¼–å†™ï¼Œéå¸¸æ–¹ä¾¿ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªå¿«é€Ÿå…¥é—¨çš„æ¡ˆä¾‹æ¥ä½“éªŒä¸€ä¸‹OpenFeignçš„ä¾¿æ·å§ã€‚ ä»¥cart-serviceä¸­çš„æŸ¥è¯¢æˆ‘çš„è´­ç‰©è½¦ä¸ºä¾‹ 1.å¼•å…¥ä¾èµ–åœ¨cart-serviceæœåŠ¡çš„pom.xmlä¸­å¼•å…¥OpenFeignçš„ä¾èµ–å’ŒloadBalancerä¾èµ–ï¼š 12345678910&lt;!--openFeign--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--è´Ÿè½½å‡è¡¡å™¨--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt;&lt;/dependency&gt; 2.å¯ç”¨OpenFeignåœ¨cart-serviceçš„CartApplicationå¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œå¯åŠ¨OpenFeignåŠŸèƒ½ï¼š @EnableFeignClients 3.ç¼–å†™OpenFeignå®¢æˆ·ç«¯åœ¨cart-serviceä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œç¼–å†™Feignå®¢æˆ·ç«¯ï¼š 123456789101112131415package com.hmall.cart.client;import com.hmall.cart.domain.dto.ItemDTO;import org.springframework.cloud.openfeign.FeignClient;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestParam;import java.util.List;@FeignClient(&quot;item-service&quot;)public interface ItemClient &#123; @GetMapping(&quot;/items&quot;) List&lt;ItemDTO&gt; queryItemByIds(@RequestParam(&quot;ids&quot;) Collection&lt;Long&gt; ids);&#125; è¿™é‡Œåªéœ€è¦å£°æ˜æ¥å£ï¼Œæ— éœ€å®ç°æ–¹æ³•ã€‚æ¥å£ä¸­çš„å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼š @FeignClient(&quot;item-service&quot;) ï¼šå£°æ˜æœåŠ¡åç§° @GetMapping ï¼šå£°æ˜è¯·æ±‚æ–¹å¼ @GetMapping(&quot;/items&quot;) ï¼šå£°æ˜è¯·æ±‚è·¯å¾„ @RequestParam(&quot;ids&quot;) Collection&lt;Long&gt; ids ï¼šå£°æ˜è¯·æ±‚å‚æ•° List&lt;ItemDTO&gt; ï¼šè¿”å›å€¼ç±»å‹ æœ‰äº†ä¸Šè¿°ä¿¡æ¯ï¼ŒOpenFeignå°±å¯ä»¥åˆ©ç”¨åŠ¨æ€ä»£ç†å¸®æˆ‘ä»¬å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å‘http://item-service/itemså‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œæºå¸¦idsä¸ºè¯·æ±‚å‚æ•°ï¼Œå¹¶è‡ªåŠ¨å°†è¿”å›å€¼å¤„ç†ä¸ºList&lt;ItemDTO&gt;ã€‚ æˆ‘ä»¬åªéœ€è¦ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå³å¯å®ç°è¿œç¨‹è°ƒç”¨äº†ã€‚ 4.è¿æ¥æ± Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚æ”¯æŒçš„httpå®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š HttpURLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ±  Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ±  OKHttpï¼šæ”¯æŒè¿æ¥æ±  å› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¸¦æœ‰è¿æ¥æ± çš„å®¢æˆ·ç«¯æ¥ä»£æ›¿é»˜è®¤çš„HttpURLConnectionã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨OK Http. è¿æ¥æ± ä½¿ç”¨å¦‚ä¸‹ï¼š åœ¨cart-serviceçš„pom.xmlä¸­å¼•å…¥ä¾èµ–ï¼š 12345&lt;!--OK http çš„ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt;&lt;/dependency&gt; åœ¨cart-serviceçš„application.ymlé…ç½®æ–‡ä»¶ä¸­å¼€å¯Feignçš„è¿æ¥æ± åŠŸèƒ½ï¼š 123feign: okhttp: enabled: true # å¼€å¯OKHttpåŠŸèƒ½","categories":[],"tags":[]},{"title":"åˆ†å¸ƒå¼","slug":"å…«è‚¡/åˆ†å¸ƒå¼","date":"2025-01-18T07:13:37.000Z","updated":"2025-01-18T09:06:32.531Z","comments":true,"path":"2025/01/18/å…«è‚¡/åˆ†å¸ƒå¼/","permalink":"http://example.com/2025/01/18/%E5%85%AB%E8%82%A1/%E5%88%86%E5%B8%83%E5%BC%8F/","excerpt":"","text":"åˆ†å¸ƒå¼ï¼ˆdistributedï¼‰æ˜¯ä¸ºäº†è§£å†³å•ä¸ªç‰©ç†æœåŠ¡å™¨å®¹é‡å’Œæ€§èƒ½ç“¶é¢ˆé—®é¢˜è€Œé‡‡ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œå°†ä¸€ä¸ªä¸šåŠ¡æ‹†åˆ†æˆä¸åŒçš„å­ä¸šåŠ¡ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šæ‰§è¡Œã€‚æœåŠ¡ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨ååŒå·¥ä½œï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚ ä¸€ã€åˆ†å¸ƒå¼ç†è®º1ã€CAPåŸåˆ™åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒConsistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰è¿™ 3 ä¸ªåŸºæœ¬éœ€æ±‚ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­çš„ 2 ä¸ªã€‚ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼š æŒ‡æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´èƒ½å¤Ÿä¿æŒä¸€è‡´çš„ç‰¹æ€§ï¼ˆä¸¥æ ¼çš„ä¸€è‡´æ€§ï¼‰ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ï¼šæŒ‡ç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½èƒ½è·å–åˆ°éé”™çš„å“åº”ï¼ˆä¸ä¿è¯è·å–çš„æ•°æ®ä¸ºæœ€æ–°æ•°æ®ï¼‰ Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚ ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒºï¼Ÿ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œæœ¬æ¥æ˜¯è¿é€šçš„ï¼Œä½†æ˜¯å› ä¸ºæŸäº›æ•…éšœï¼ˆæ¯”å¦‚éƒ¨åˆ†èŠ‚ç‚¹ç½‘ç»œå‡ºäº†é—®é¢˜ï¼‰æŸäº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œ æ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œè¿™å°±å« ç½‘ç»œåˆ†åŒºã€‚ 2ã€ä¸ºä»€ä¹ˆCAPä¸èƒ½åŒæ—¶æ»¡è¶³é¦–å…ˆï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºæ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œå› æ­¤På°±å¿…é¡»è¦æ»¡è¶³ï¼Œå¦åˆ™å°±è¿èƒŒäº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„åˆè¡·ï¼Œåœ¨æ»¡è¶³Pçš„å‰æä¸‹ï¼Œç³»ç»Ÿä¸­çš„æŸä¸ªèŠ‚ç‚¹åœ¨è¿›è¡Œå†™æ“ä½œã€‚ä¸ºäº†ä¿è¯ Cï¼Œ å¿…é¡»è¦ç¦æ­¢å…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œï¼Œè¿™å°±å’Œ A å‘ç”Ÿå†²çªäº†ã€‚å¦‚æœä¸ºäº†ä¿è¯ Aï¼Œå…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œæ­£å¸¸çš„è¯ï¼Œé‚£å°±å’Œ C å‘ç”Ÿå†²çªäº†ã€‚ å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ï¼Œåªèƒ½é€‰æ‹© CP æˆ–è€… AP æ¶æ„ã€‚ å¦å¤–ï¼Œéœ€è¦è¡¥å……è¯´æ˜çš„ä¸€ç‚¹æ˜¯ï¼šå¦‚æœç½‘ç»œåˆ†åŒºæ­£å¸¸çš„è¯ï¼ˆç³»ç»Ÿåœ¨ç»å¤§éƒ¨åˆ†æ—¶å€™æ‰€å¤„çš„çŠ¶æ€ï¼‰ï¼Œä¹Ÿå°±è¯´ä¸éœ€è¦ä¿è¯ P çš„æ—¶å€™ï¼ŒC å’Œ A èƒ½å¤ŸåŒæ—¶ä¿è¯ã€‚ Spring Cloudåœ¨CAPæ³•åˆ™ä¸Šä¸»è¦æ»¡è¶³çš„æ˜¯APæ³•åˆ™ï¼ŒDubboå’ŒZookeeperåœ¨CAPæ³•åˆ™ä¸»è¦æ»¡è¶³çš„æ˜¯CPæ³•åˆ™ ï¼ŒNacos ä¸ä»…æ”¯æŒ CP ä¹Ÿæ”¯æŒ AP 3ã€BASEç†è®ºBASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft-stateï¼ˆè½¯çŠ¶æ€ï¼‰ å’Œ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚ å…¶æ ¸å¿ƒæ€æƒ³æ—¶ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ ä¹Ÿå°±æ˜¯ç‰ºç‰²æ•°æ®çš„ä¸€è‡´æ€§æ¥æ»¡è¶³ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œç³»ç»Ÿä¸­ä¸€éƒ¨åˆ†æ•°æ®ä¸å¯ç”¨æˆ–è€…ä¸ä¸€è‡´æ—¶ï¼Œä»éœ€è¦ä¿æŒç³»ç»Ÿæ•´ä½“â€œä¸»è¦å¯ç”¨â€ã€‚ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ï¼šä»€ä¹ˆæ˜¯åŸºæœ¬å¯ç”¨å‘¢ï¼Ÿå‡è®¾ç³»ç»Ÿå‡ºç°äº†ä¸å¯é¢„çŸ¥çš„æ•…éšœï¼Œä½†è¿˜æ˜¯èƒ½ç”¨ï¼Œåªæ˜¯ç›¸æ¯”è¾ƒæ­£å¸¸çš„ç³»ç»Ÿè€Œè¨€ï¼Œå¯èƒ½ä¼šæœ‰å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼Œæˆ–è€…åŠŸèƒ½ä¸Šçš„é™çº§ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè®¿é—®é‡çªç„¶å‰§å¢ï¼Œç³»ç»Ÿçš„éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨ï¼‰ã€‚ Soft-stateï¼ˆè½¯çŠ¶æ€ï¼‰ï¼šä»€ä¹ˆæ˜¯ç¡¬çŠ¶æ€å‘¢ï¼Ÿè¦æ±‚å¤šä¸ªèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ˜¯ä¸€ç§â€œç¡¬çŠ¶æ€â€ã€‚ è½¯çŠ¶æ€ä¹Ÿç§°ä¸ºå¼±çŠ¶æ€ï¼Œç›¸æ¯”è¾ƒç¡¬çŠ¶æ€è€Œè¨€ï¼Œå…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥çŠ¶æ€ä¸å½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨å¤šä¸ªä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬å­˜åœ¨æ•°æ®å»¶æ—¶ã€‚ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ï¼šæœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚ äºŒã€åˆ†å¸ƒå¼é”çš„å®ç° 1ã€MYSQLå®ç° ç”¨æ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åˆ›å»ºä¸€å¼ é”è¡¨ï¼Œæ•°æ®åº“å¯¹å­—æ®µä½œå”¯ä¸€æ€§çº¦æŸã€‚ åŠ é”çš„æ—¶å€™ï¼Œåœ¨é”è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•å³å¯ï¼›é‡Šæ”¾é”çš„æ—¶å€™åˆ é™¤è®°å½•å°±è¡Œã€‚ å¦‚æœæœ‰å¹¶å‘è¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªè¯·æ±‚èƒ½å¤Ÿå¾—åˆ°é”ã€‚ è¿™ç§å±äºæ•°æ®åº“ IO æ“ä½œï¼Œæ•ˆç‡ä¸é«˜ï¼Œè€Œä¸”é¢‘ç¹æ“ä½œä¼šå¢å¤§æ•°æ®åº“çš„å¼€é”€ï¼Œå› æ­¤è¿™ç§æ–¹å¼åœ¨é«˜å¹¶å‘ã€é«˜æ€§èƒ½çš„åœºæ™¯ä¸­ç”¨çš„ä¸å¤šã€‚ 2ã€Rediså®ç° Redis æ‰§è¡Œå‘½ä»¤æ˜¯å•çº¿ç¨‹çš„ï¼ŒRedis å®ç°åˆ†å¸ƒå¼é”å°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚ é€šè¿‡ setnx å’Œè¿‡æœŸæ—¶é—´å®ç°åˆ†å¸ƒå¼é”ã€‚ å½“ç„¶ï¼Œä¸€èˆ¬ç”Ÿäº§ä¸­éƒ½æ˜¯ä½¿ç”¨ Redission å®¢æˆ·ç«¯ï¼Œéå¸¸è‰¯å¥½åœ°å°è£…äº†åˆ†å¸ƒå¼é”çš„ apiï¼Œè€Œä¸”æ”¯æŒ RedLockã€‚ 3ã€Zookeeperå®ç° ä¸‰ã€åˆ†å¸ƒå¼äº‹åŠ¡ å››ã€åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://example.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}]},{"title":"å¸¸ç”¨ç®—æ³•ç³»åˆ—","slug":"ç®—æ³•å­¦ä¹ ","date":"2024-12-24T07:24:36.000Z","updated":"2025-03-14T03:03:52.434Z","comments":true,"path":"2024/12/24/ç®—æ³•å­¦ä¹ /","permalink":"http://example.com/2024/12/24/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/","excerpt":"å­¦ä¹ ä¸€ä¸‹ä¸€äº›ç»å…¸æ•°æ®ç»“æ„å’Œæ’åºç®—æ³•","text":"å­¦ä¹ ä¸€ä¸‹ä¸€äº›ç»å…¸æ•°æ®ç»“æ„å’Œæ’åºç®—æ³• 1.å¿«é€Ÿæ’åº1.åŸºæœ¬æ€æƒ³å¿«é€Ÿæ’åºæ˜¯ä¸€ç§é«˜æ•ˆçš„åˆ†æ²»ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š é€‰æ‹©ä¸€ä¸ªåŸºå‡†å…ƒç´ ï¼ˆpivotï¼‰ï¼šé€šå¸¸æ˜¯æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ ã€‚ åˆ†åŒºï¼ˆPartitionï¼‰ï¼šå°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä½¿å¾—å·¦è¾¹å…ƒç´ å‡ â‰¤ åŸºå‡†ï¼Œå³è¾¹å…ƒç´ å‡ â‰¥ åŸºå‡†ã€‚ é€’å½’æ’åºï¼šå¯¹å·¦å³å­æ•°ç»„é€’å½’æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œç›´åˆ°å­æ•°ç»„é•¿åº¦ä¸º1æˆ–0ï¼ˆå·²æœ‰åºï¼‰ã€‚ 2.åˆ†åŒºï¼ˆPartitionï¼‰è¿‡ç¨‹è¯¦è§£åˆ†åŒºæ˜¯å¿«é€Ÿæ’åºçš„æ ¸å¿ƒæ­¥éª¤ï¼Œç›®çš„æ˜¯å°†æ•°ç»„åˆ’åˆ†ä¸ºä¸¤ä¸ªå­æ•°ç»„ã€‚ä»¥åŒæŒ‡é’ˆæ³•ä¸ºä¾‹ï¼š åŸºå‡†é€‰æ‹©ï¼šé€šå¸¸é€‰ç¬¬ä¸€ä¸ªå…ƒç´  arr[left] ä½œä¸ºåŸºå‡†ï¼ˆä¹Ÿå¯éšæœºé€‰æ‹©ä¼˜åŒ–æ€§èƒ½ï¼‰ã€‚ åŒæŒ‡é’ˆç§»åŠ¨ï¼š å·¦æŒ‡é’ˆï¼ˆiï¼‰ï¼šä»å·¦å‘å³æ‰¾ç¬¬ä¸€ä¸ª &gt; åŸºå‡†çš„å…ƒç´ ã€‚ å³æŒ‡é’ˆï¼ˆjï¼‰ï¼šä»å³å‘å·¦æ‰¾ç¬¬ä¸€ä¸ª &lt; åŸºå‡†çš„å…ƒç´ ã€‚ äº¤æ¢å…ƒç´ ï¼šå½“æ‰¾åˆ°åï¼Œäº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œç»§ç»­ç§»åŠ¨æŒ‡é’ˆã€‚ æ”¾ç½®åŸºå‡†ï¼šæœ€ç»ˆå°†åŸºå‡†å…ƒç´ äº¤æ¢åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œè¿”å›å…¶ä¸‹æ ‡ã€‚ 3.Java ä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041class Solution &#123; private static final Random RANDOM=new Random(); public int[] sortArray(int[] nums) &#123; if(nums==null||nums.length==0) return nums; quickselect(nums,0,nums.length-1); return nums; &#125; public void quickselect(int[] nums,int left,int right)&#123; if(left &lt; right)&#123; int pivotIndex=partition(nums,left,right); quickselect(nums,left,pivotIndex-1); quickselect(nums,pivotIndex+1,right); &#125; &#125; public int partition(int[] nums,int left,int right)&#123; //æœ€å…³é”®æ ¸å¿ƒçš„éƒ¨åˆ† int randomIndex=RANDOM.nextInt(right-left+1)+left; //éšæœºé€‰æ‹©åŸºå‡† swap(nums,left,randomIndex); int i=left+1,j=right; int pivot=nums[left]; while(true)&#123; while(i&lt;=j &amp;&amp; nums[i]&lt;pivot) i++; while(i&lt;=j &amp;&amp; nums[j]&gt;pivot) j--; if(i&gt;=j) break; swap(nums,i,j); i++; j--; &#125; swap(nums,left,j); return j; &#125; public void swap(int[] nums,int i,int j)&#123; int tmp=nums[i]; nums[i]=nums[j]; nums[j]=tmp; &#125;&#125; 4.æ—¶é—´å¤æ‚åº¦åˆ†æ å¹³å‡æƒ…å†µï¼šO(n log n)æ¯æ¬¡åˆ†åŒºå°†æ•°ç»„å¤§è‡´åˆ†ä¸ºä¸¤åŠã€‚ æœ€åæƒ…å†µï¼šO(nÂ²)å½“æ•°ç»„å·²æœ‰åºä¸”æ€»é€‰ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºåŸºå‡†æ—¶ï¼Œé€€åŒ–ä¸ºå†’æ³¡æ’åºã€‚ ä¼˜åŒ–ç­–ç•¥ï¼š éšæœºé€‰æ‹©åŸºå‡†ï¼šå‡å°‘æœ€åæƒ…å†µæ¦‚ç‡ã€‚ ä¸‰æ•°å–ä¸­æ³•ï¼šé€‰å·¦ã€ä¸­ã€å³ä¸‰ä¸ªæ•°çš„ä¸­ä½æ•°ä½œä¸ºåŸºå‡†ã€‚ 2.åŠ¨æ€è§„åˆ’ä¹‹0-1èƒŒåŒ…é—®é¢˜ä¸ºä»€ä¹ˆè¦å‹ç¼©æ•°ç»„ï¼Ÿ1.0-1èƒŒåŒ…é—®é¢˜ç®€ä»‹0-1èƒŒåŒ…é—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„åŠ¨æ€è§„åˆ’é—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰ n ä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“æœ‰é‡é‡ w[i] å’Œä»·å€¼ v[i]ï¼Œä»¥åŠä¸€ä¸ªå®¹é‡ä¸ºWçš„èƒŒåŒ…ã€‚æ¯ä¸ªç‰©å“åªèƒ½é€‰æ‹©æ‹¿æˆ–ä¸æ‹¿ï¼ˆ0æˆ–1ï¼‰ï¼Œç›®æ ‡æ˜¯é€‰æ‹©ä¸€äº›ç‰©å“æ”¾å…¥èƒŒåŒ…ï¼Œä½¿å¾—æ€»é‡é‡ä¸è¶…è¿‡ Wï¼ŒåŒæ—¶æ€»ä»·å€¼æœ€å¤§ã€‚ 2.äºŒç»´DPçš„æ€è·¯æˆ‘ä»¬å…ˆä»ä¼ ç»Ÿçš„äºŒç»´DPæ•°ç»„è®²èµ·ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ç»´DPçš„åŸºç¡€ã€‚ å®šä¹‰DPæ•°ç»„ å®šä¹‰ dp[i][j] è¡¨ç¤ºï¼šå‰ i ä¸ªç‰©å“ï¼ˆä» 0 åˆ° i-1ï¼‰ï¼ŒèƒŒåŒ…å®¹é‡ä¸º j æ—¶ï¼Œèƒ½è·å¾—çš„æœ€å¤§ä»·å€¼ã€‚ å…¶ä¸­ï¼š i è¡¨ç¤ºè€ƒè™‘å‰ i ä¸ªç‰©å“ã€‚ j è¡¨ç¤ºèƒŒåŒ…çš„å½“å‰å®¹é‡ã€‚ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ å¯¹äºç¬¬ i ä¸ªç‰©å“ï¼ˆç¼–å·ä» 1 å¼€å§‹ï¼‰ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š ä¸æ‹¿ç¬¬ i ä¸ªç‰©å“ï¼š dp[i][j] = dp[i-1][j]ï¼Œå³ä¸æ”¾å…¥å½“å‰ç‰©å“ï¼Œä»·å€¼ç­‰äºå‰ i-1 ä¸ªç‰©å“åœ¨å®¹é‡ j ä¸‹çš„æœ€å¤§ä»·å€¼ã€‚ æ‹¿ç¬¬ i ä¸ªç‰©å“ï¼ˆå‰ææ˜¯èƒŒåŒ…å®¹é‡è¶³å¤Ÿï¼Œå³ j &gt;= w[i]ï¼‰ï¼š dp[i][j] = dp[i-1][j - w[i]] + v[i]ï¼Œå³æ”¾å…¥å½“å‰ç‰©å“ï¼Œç”¨æ‰ w[i]çš„å®¹é‡ï¼Œä»·å€¼å¢åŠ  v[i]ã€‚ ç»¼åˆé€‰æ‹©ï¼š dp[i][j] = max(dp[i-1][j], dp[i-1][j - w[i]] + v[i])ï¼ˆå¦‚æœ j &gt;= w[i]ï¼‰ã€‚ å¦‚æœ j &lt; w[i]ï¼Œåˆ™åªèƒ½ä¸æ‹¿ï¼Œdp[i][j] = dp[i-1][j]ã€‚ åˆå§‹åŒ– å½“æ²¡æœ‰ç‰©å“æ—¶ï¼ˆi &#x3D; 0ï¼‰ï¼Œä»·å€¼ä¸º 0ï¼Œå³ dp[0][j] = 0 å¯¹äºæ‰€æœ‰ jã€‚ ç›®æ ‡ æœ€ç»ˆç­”æ¡ˆæ˜¯ dp[n][W]ï¼Œè¡¨ç¤ºå‰ n ä¸ªç‰©å“åœ¨å®¹é‡ W ä¸‹çš„æœ€å¤§ä»·å€¼ã€‚ ç©ºé—´å¤æ‚åº¦ äºŒç»´DPéœ€è¦ä¸€ä¸ª n Ã— W çš„æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(nW)ã€‚ 3.ä¼˜åŒ–åˆ°ä¸€ç»´DPè§‚å¯ŸäºŒç»´DPçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæˆ‘ä»¬å‘ç°dp[i][j]åªä¾èµ–äºä¸Šä¸€è¡Œï¼ˆi-1ï¼‰çš„æ•°æ®ï¼Œå³dp[i-1][j]å’Œ dp[i-1][j - w[i]]ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å­˜å‚¨æ•´ä¸ªäºŒç»´æ•°ç»„ï¼Œåªéœ€è¦ç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„ä¿å­˜â€œä¸Šä¸€è¡Œâ€çš„ç»“æœï¼Œå¹¶åœ¨è®¡ç®—å½“å‰ç‰©å“æ—¶æ›´æ–°å®ƒã€‚ å®šä¹‰ä¸€ç»´DPæ•°ç»„ å®šä¹‰ dp[j] è¡¨ç¤ºï¼šèƒŒåŒ…å®¹é‡ä¸º j æ—¶ï¼Œèƒ½è·å¾—çš„æœ€å¤§ä»·å€¼ã€‚ è¿™ä¸ªæ•°ç»„ä¼šéšç€ç‰©å“çš„éå†ä¸æ–­æ›´æ–°ï¼Œæœ€ç»ˆåæ˜ æ‰€æœ‰ç‰©å“è€ƒè™‘åçš„ç»“æœã€‚ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ å¯¹äºæ¯ä¸ªç‰©å“ iï¼Œæ›´æ–° dp[j]ï¼š å¦‚æœ j &gt;= w[i]ï¼Œåˆ™ dp[j] = max(dp[j], dp[j - w[i]] + v[i])ã€‚ å¦‚æœ j &lt; w[i]ï¼Œåˆ™ dp[j] ä¸å˜ï¼ˆå› ä¸ºè£…ä¸ä¸‹å½“å‰ç‰©å“ï¼‰ã€‚ å…³é”®é—®é¢˜ï¼šéå†é¡ºåº åœ¨ä¸€ç»´DPä¸­ï¼Œdp[j] ä¼šè¢«åå¤æ›´æ–°ã€‚å¦‚æœæˆ‘ä»¬æ­£å‘éå†ï¼ˆä» j &#x3D; 0 åˆ° Wï¼‰ï¼Œä¼šå¯¼è‡´é—®é¢˜ï¼›è€Œå€’ç€éå†ï¼ˆä» j &#x3D; W åˆ° 0ï¼‰åˆ™èƒ½æ­£ç¡®è§£å†³é—®é¢˜ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šè¯¦ç»†è§£é‡Šä¸ºä»€ä¹ˆã€‚ ä¸ºä»€ä¹ˆéœ€è¦å€’ç€éå†ï¼Ÿ åœ¨ä¸€ç»´DPä¸­ï¼Œdp[j] çš„æ›´æ–°ä¾èµ–äº dp[j - w[i]]ã€‚å¦‚æœéå†é¡ºåºä¸å½“ï¼Œä¼šå¯¼è‡´å½“å‰ç‰©å“è¢«é‡å¤ä½¿ç”¨ï¼Œè€Œ0-1èƒŒåŒ…è¦æ±‚æ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚ ä¾‹å­ å‡è®¾ï¼š èƒŒåŒ…å®¹é‡ W &#x3D; 5ã€‚ åªæœ‰ä¸€ä¸ªç‰©å“ï¼Œé‡é‡ w[1] &#x3D; 2ï¼Œä»·å€¼ v[1] &#x3D; 3ã€‚ åˆå§‹dp[j] = 0å¯¹äºæ‰€æœ‰ jã€‚ æ­£å‘éå†ï¼ˆä» 0 åˆ° Wï¼‰ j &#x3D; 2ï¼šdp[2] = max(dp[2], dp[2-2] + 3) = max(0, dp[0] + 3) = max(0, 0 + 3) = 3ã€‚ j &#x3D; 3ï¼šdp[3] = max(dp[3], dp[3-2] + 3) = max(0, dp[1] + 3) = max(0, 0 + 3) = 3ã€‚ j &#x3D; 4ï¼šdp[4] = max(dp[4], dp[4-2] + 3) = max(0, dp[2] + 3) = max(0, 3 + 3) = 6ã€‚ é—®é¢˜ï¼šdp[4] &#x3D; 6 è¡¨ç¤ºä»·å€¼è¾¾åˆ° 6ï¼Œç›¸å½“äºæ‹¿äº†ä¸¤æ¬¡ç‰©å“ï¼ˆ2 Ã— 3 &#x3D; 6ï¼‰ï¼Œä½†0-1èƒŒåŒ…ä¸å…è®¸é‡å¤æ‹¿å–ï¼ åŸå› ï¼šæ­£å‘éå†æ—¶ï¼Œdp[2] è¢«æ›´æ–°ä¸º 3 åï¼Œdp[4] ç”¨åˆ°äº†æ›´æ–°åçš„ dp[2]ï¼Œç›¸å½“äºå½“å‰ç‰©å“è¢«å¤šæ¬¡ä½¿ç”¨ã€‚ å€’ç€éå†ï¼ˆä» W åˆ° 0ï¼‰ j &#x3D; 5ï¼šdp[5] = max(dp[5], dp[5-2] + 3) = max(0, dp[3] + 3) = max(0, 0 + 3) = 3ã€‚ j &#x3D; 4ï¼šdp[4] = max(dp[4], dp[4-2] + 3) = max(0, dp[2] + 3) = max(0, 0 + 3) = 3ã€‚ j &#x3D; 3ï¼šdp[3] = max(dp[3], dp[3-2] + 3) = max(0, dp[1] + 3) = max(0, 0 + 3) = 3ã€‚ j &#x3D; 2ï¼šdp[2] = max(dp[2], dp[2-2] + 3) = max(0, dp[0] + 3) = max(0, 0 + 3) = 3ã€‚ ç»“æœï¼šdp[5] &#x3D; 3ï¼Œè¡¨ç¤ºæœ€å¤šæ”¾å…¥ä¸€ä¸ªç‰©å“ï¼Œç¬¦åˆ0-1èƒŒåŒ…çš„è§„åˆ™ã€‚ åŸå› ï¼šå€’ç€éå†æ—¶ï¼Œdp[j] æ›´æ–°æ—¶ç”¨åˆ°çš„dp[j - w[i]]æ˜¯è¿˜æœªè¢«å½“å‰ç‰©å“æ›´æ–°çš„å€¼ï¼Œç›¸å½“äºäºŒç»´DPä¸­çš„ dp[i-1][j - w[i]]ã€‚ ä¸€ç»´DPçš„è¯¦ç»†æµç¨‹ åˆå§‹åŒ–ï¼š dp[j] = 0 å¯¹äºæ‰€æœ‰ j ä» 0 åˆ° Wã€‚ éå†ç‰©å“ å¯¹äºæ¯ä¸ªç‰©å“ iï¼ˆä» 1 åˆ° nï¼‰ï¼š å€’ç€éå†å®¹é‡ jï¼ˆä» W åˆ° w[i]ï¼‰ï¼š å¦‚æœ j &gt;&#x3D; w[i]ï¼Œåˆ™ dp[j] &#x3D; max(dp[j], dp[j - w[i]] + v[i])ã€‚ å¦‚æœ j &lt; w[i]ï¼Œè·³è¿‡ï¼ˆå®é™…ä¸Šä¸éœ€è¦æ˜¾å¼å¤„ç†ï¼Œå› ä¸ºå¾ªç¯ä» w[i] å¼€å§‹ï¼‰ã€‚ ç»“æœ dp[W] å³ä¸ºæœ€ç»ˆç­”æ¡ˆã€‚ 3.ç®—æ³•å¯¹æ¯” ç®—æ³• æ—¶é—´å¤æ‚åº¦ ç¨³å®šæ€§ å†’æ³¡ O(nÂ²) ç¨³å®š æ’å…¥ O(nÂ²) ç¨³å®š å½’å¹¶ O(nlogn); éœ€è¦ O(n) é¢å¤–ç©ºé—´ ç¨³å®š é€‰æ‹© O(nÂ²) ä¸ç¨³å®š å¸Œå°” O(nlogn) ä¸ç¨³å®š å †æ’åº O(nlogn) ä¸ç¨³å®š å¿«æ’ O(nlogn) ï¼Œ O(nÂ²) æœ€åæƒ…å†µ; ä¸ç¨³å®š","categories":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://example.com/categories/%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://example.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"é»‘é©¬ç‚¹è¯„è®°å½•","slug":"é»‘é©¬ç‚¹è¯„è®°å½•","date":"2024-12-18T14:28:12.000Z","updated":"2025-02-19T09:57:43.269Z","comments":true,"path":"2024/12/18/é»‘é©¬ç‚¹è¯„è®°å½•/","permalink":"http://example.com/2024/12/18/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84%E8%AE%B0%E5%BD%95/","excerpt":"","text":"ä¸€ã€ç™»å½•rediså¯åŠ¨å‘½ä»¤ï¼šåœ¨finalsellä¸­systemctl start redis 1ã€å‘é€éªŒè¯ç 12345678910111213141516171819/** * å‘é€éªŒè¯ç  * @param phone * @param session * @return */ public Result sendCode(String phone, HttpSession session) &#123; //1ã€æ ¡éªŒæ‰‹æœºå·æ ¼å¼ if (RegexUtils.isPhoneInvalid(phone)) &#123; return Result.fail(&quot;æ‰‹æœºå·æ— æ•ˆ&quot;); &#125; //2ã€å¦‚æœæˆåŠŸï¼Œç”Ÿæˆ6ä½çš„éªŒè¯ç  String code = RandomUtil.randomNumbers(6); //3ã€ä¿å­˜åˆ°session session.setAttribute(&quot;code&quot;, code); //4ã€å‘é€éªŒè¯ç éœ€è¦è°ƒç¬¬ä¸‰æ–¹æ¥å£ï¼Œæš‚ä¸åšï¼Œæ‰“å°æ—¥å¿— log.info(&quot;éªŒè¯ç ä¸ºï¼š&#123;&#125;&quot;, code); return Result.ok(); &#125; 2ã€ç™»å½•åŠŸèƒ½è¿™é‡Œä¸€å¼€å§‹å¿˜äº†åœ¨createNewUserç”¨mpçš„savaå°†æ–°ç”Ÿæˆçš„userä¿å­˜åˆ°æ•°æ®åº“äº†ï¼Œæˆ‘è¯´æ€ä¹ˆåŠå¤©ä¸è§æ•°æ®åº“æœ‰æ–°æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * ç™»å½• * @param loginForm * @param session * @return */ public Result login(LoginFormDTO loginForm, HttpSession session) &#123; //1ã€æ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆè§„ String phone = loginForm.getPhone(); if (RegexUtils.isPhoneInvalid(phone)) &#123; return Result.fail(&quot;æ‰‹æœºå·æ— æ•ˆ&quot;); &#125; //2ã€æ ¡éªŒéªŒè¯ç æ˜¯å¦æœ‰æ•ˆ String code = loginForm.getCode(); Object cacheCode = session.getAttribute(&quot;code&quot;); if(cacheCode == null || !cacheCode.equals(code))&#123; //éªŒè¯ç æ— æ•ˆ return Result.fail(&quot;éªŒè¯ç æ— æ•ˆ&quot;); &#125; //3ã€æŸ¥è¯¢ç”¨æˆ·â€”â€”æ­¤å¤„ä½¿ç”¨MP User user = query().eq(&quot;phone&quot;, phone).one(); if(user == null)&#123; //userä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„user user = createNewUser(phone); &#125; //4ã€æ ¹æ®ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œæœ€ç»ˆéƒ½ä¿å­˜åˆ°sessionä¸­ //BeanUtil.copyProperties(user, UserDTO.class)å°†userçš„ä¿¡æ¯å¤åˆ¶åˆ°UserDTOå¹¶åˆ›å»ºä¸€ä¸ªUserDTOå¯¹è±¡è¿”å› session.setAttribute(&quot;user&quot;, BeanUtil.copyProperties(user, UserDTO.class)); return Result.ok(); &#125; private User createNewUser(String phone) &#123; //1ã€åˆ›å»ºç”¨æˆ· User user = new User(); user.setPhone(phone); user.setNickName(&quot;user_&quot; + RandomUtil.randomString(10)); //2ã€ä¿å­˜ç”¨æˆ·ï¼Œç”¨çš„MP save(user); return user; &#125; 3ã€ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºå…¶å®ƒä¸šåŠ¡ï¼ˆControllerï¼‰ï¼Œæ¯ä¸ªéƒ½è¦å†™ç™»å½•é€»è¾‘å²‚ä¸æ˜¯å¾ˆéº»çƒ¦ ç­”ï¼šå¼•å…¥æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨æ‰€æœ‰Controllerä¹‹å‰åˆ¤æ–­æ˜¯å¦æ”¾è¡Œ åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•æŠŠæ‹¦æˆªå™¨æ‹¦æˆªåˆ°çš„ä¿¡æ¯ä¼ ç»™å…¶å®ƒControllerå‘¢ï¼Ÿ ç­”ï¼šThreadLocalï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥é¿å…å¹¶å‘é—®é¢˜çš„å‡ºç° 12345678910111213141516171819202122232425262728293031323334353637public class LoginInterceptor implements HandlerInterceptor &#123; @Override /** * Controlleræ‰§è¡Œä¹‹å‰è°ƒç”¨æ­¤æ–¹æ³•ï¼Œåšç™»å½•æ ¡éªŒ */ public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; //1ã€è·å–session HttpSession session = request.getSession(); //2ã€ä»sessionä¸­è·å–user Object user = session.getAttribute(&quot;user&quot;); //3ã€åˆ¤æ–­useræ˜¯å¦å­˜åœ¨ if(user == null)&#123; return false; &#125; //å¦åˆ™å°±ä¿å­˜åˆ°å½“å‰çº¿ç¨‹ UserHolder.saveUser((UserDTO) user); return true; &#125; /** * æ¸²æŸ“ä¹‹åï¼Œå°†ä¿å­˜çš„ä¿¡æ¯åˆ é™¤ï¼Œé¿å…å†…å­˜æ³„éœ² * @param request * @param response * @param handler * @param ex * @throws Exception */ @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; //ç›´æ¥è°ƒç”¨UserHolder UserHolder.removeUser(); &#125;&#125; æ‹¦æˆªå™¨å†™å¥½äº†è¿˜æ²¡æœ‰ç”Ÿæ•ˆï¼Œéœ€è¦é…ç½® 123456789101112131415@Configurationpublic class MvcConfig implements WebMvcConfigurer &#123; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(new LoginInterceptor()). excludePathPatterns( //æ’é™¤ä¸éœ€è¦è¢«æ‹¦æˆªç™»å½•çš„è·¯å¾„ &quot;/shop/**&quot;, &quot;/voucher/**&quot;, &quot;shop-type/**&quot;, &quot;/upload/**&quot;, &quot;/blog/hot&quot;, &quot;/user/code&quot;, &quot;/user/login&quot;); &#125;&#125; 4 ã€Redisä»£æ›¿sessionè§£å†³sessioné—®é¢˜STARæ³•åˆ™ Sï¼ˆSituation ï¼‰ï¼šå°½ç®¡ç°åœ¨æ˜¯ä¸€ä¸ªå•ä½“å¼çš„æ¶æ„ï¼Œä½†ä¸ºäº†åº”å¯¹å¹¶å‘ï¼Œè‚¯å®šè¦å¸ƒç½®å¤šå°tomcatæœåŠ¡å™¨å½¢æˆè´Ÿè½½å‡è¡¡çš„é›†ç¾¤ã€‚è¿™æ—¶å°±æœ‰é—®é¢˜äº†ï¼šå› ä¸ºå¤šå°tomcatä¸èƒ½å…±äº«ç©ºé—´ï¼Œå¯èƒ½å¯¼è‡´å¤šæ¬¡è¯·æ±‚æ‰“åˆ°ä¸åŒçš„tomcatæœåŠ¡å™¨ä¸Šï¼Œå‡ºç°æ•°æ®ä¸¢å¤±é—®é¢˜ Tï¼ˆTaskï¼‰ï¼šsessionçš„æ›¿ä»£æ–¹æ¡ˆåº”æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š æ•°æ®å…±äº« å†…å­˜å­˜å‚¨ï¼ˆå› ä¸ºsessionå°±æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰€ä»¥è¯»å†™æ•ˆç‡æ‰ä¼šæ¯”è¾ƒé«˜ï¼‰ key-valueç»“æ„ Aï¼ˆAction ï¼‰ï¼š 12//ä¿®æ”¹å‘é€éªŒè¯ç ï¼Œä¿å­˜éªŒè¯ç åˆ°redisï¼Œå¹¶è®¾ç½®æœ‰æ•ˆæœŸé˜²æ­¢å †ç§¯å ç”¨å†…å­˜stringRedisTemplate.opsForValue().set(LOGIN_CODE_KEY + phone, code, LOGIN_CODE_TTL, TimeUnit.MINUTES); æ¥ä¸‹æ¥ä¿®æ”¹ç™»å½•é€»è¾‘ï¼Œåœ¨ç™»å½•é€»è¾‘å®ç°ä¸­ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š 1234567//2ã€æ ¡éªŒéªŒè¯ç æ˜¯å¦æœ‰æ•ˆï¼Œä»redisä¸­å– String code = loginForm.getCode(); Object cacheCode = redisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone); if(cacheCode == null || !cacheCode.equals(code))&#123; //éªŒè¯ç æ— æ•ˆ return Result.fail(&quot;éªŒè¯ç æ— æ•ˆ&quot;); &#125; 123456789101112131415//ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°redisä¸­ //1ã€ç”Ÿæˆtokenä½œä¸ºkey UUID token = UUID.randomUUID(true); //2ã€å°†userè½¬ä¸ºmapå­˜å‚¨ UserDTO userDTO = BeanUtil.copyProperties(user, UserDTO.class); Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO); //3ã€å­˜å‚¨åˆ°redis redisTemplate.opsForHash().putAll(LOGIN_USER_KEY + token, userMap); //3ã€è®¾ç½®tokenæœ‰æ•ˆæœŸ redisTemplate.expire(LOGIN_USER_KEY + token, LOGIN_USER_TTL, TimeUnit.MINUTES); return Result.ok(token); æ‹¦æˆªå™¨ä¸­ä»£ç ä¹Ÿè¦ä¿®æ”¹ï¼ŒåŒæ—¶åªè¦æ‹¦æˆªåˆ°è¯·æ±‚ï¼Œè¯´æ˜ç”¨æˆ·è¿˜åœ¨æ´»è·ƒçŠ¶æ€ï¼Œå°±åˆ·æ–°tokençš„æœ‰æ•ˆæœŸï¼ˆä¸ç„¶å¯èƒ½ä¼šå‡ºç°ç”¨æˆ·ä¸€ç›´åœ¨ä½¿ç”¨ä½†tokenæœ‰æ•ˆæœŸè¿‡äº†å°±è¦é‡æ–°ç™»å½•çš„é”™è¯¯ï¼‰ 5ã€åŒé‡æ‹¦æˆªå™¨è§£å†³éç™»å½•é¡µé¢tokenåˆ·æ–°é—®é¢˜ä½†æ˜¯åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨åªæ‹¦æˆªäº†éœ€è¦ç™»å½•çš„é¡µé¢çš„è¯·æ±‚ã€‚å¦‚æœç”¨æˆ·ä¸€ç›´å¤„äºä¸éœ€è¦ç™»å½•çš„é¡µé¢ï¼Œæ˜¯åœ¨æ´»è·ƒçš„ï¼Œä½†è¿™æ—¶tokenæœ‰æ•ˆæœŸè¿‡äº†å†å‘è¯·æ±‚å¯èƒ½å°±è¦é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥å¯ä»¥å†åŠ ä¸€ä¸ªæ‹¦æˆªå™¨æ¥æ‹¦æˆªä¸€åˆ‡è¯·æ±‚ï¼Œåªè¦æ¥äº†è¯·æ±‚å°±è¯´æ˜ç”¨æˆ·è¿˜åœ¨æ´»è·ƒï¼Œç„¶åæ›´æ–°tokenæœ‰æ•ˆæœŸã€‚ æœ€ç»ˆåŒé‡æ‹¦æˆªå™¨çš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public class RefreshTokenInterceptor implements HandlerInterceptor &#123; private StringRedisTemplate stringRedisTemplate; public RefreshTokenInterceptor(StringRedisTemplate stringRedisTemplate)&#123; this.stringRedisTemplate = stringRedisTemplate; &#125; @Override /** * Controlleræ‰§è¡Œä¹‹å‰è°ƒç”¨æ­¤æ–¹æ³•ï¼Œåšç™»å½•æ ¡éªŒ */ public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; //1ã€è·å–token String token = request.getHeader(&quot;authorization&quot;); if (StrUtil.isBlank(token)) &#123; return true; &#125; //2ã€æ ¹æ®tokenä»redisä¸­è·å–ç”¨æˆ· Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(RedisConstants.LOGIN_USER_KEY + token); //3ã€åˆ¤æ–­useræ˜¯å¦å­˜åœ¨ if(userMap.isEmpty())&#123; return true; &#125; //4ã€å°†mapè½¬ä¸ºdto UserDTO userDTO = BeanUtil.fillBeanWithMap(userMap, new UserDTO(), false); //ä¿å­˜åˆ°å½“å‰çº¿ç¨‹ UserHolder.saveUser(userDTO); return true; &#125; /** * æ¸²æŸ“ä¹‹åï¼Œå°†ä¿å­˜çš„ä¿¡æ¯åˆ é™¤ï¼Œé¿å…å†…å­˜æ³„éœ² * @param request * @param response * @param handler * @param ex * @throws Exception */ @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; //ç›´æ¥è°ƒç”¨UserHolder UserHolder.removeUser(); &#125;&#125; 12345678910111213141516public class LoginInterceptor implements HandlerInterceptor &#123; @Override /** * Controlleræ‰§è¡Œä¹‹å‰è°ƒç”¨æ­¤æ–¹æ³•ï¼Œåšç™»å½•æ ¡éªŒ */ public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; if (UserHolder.getUser() == null) &#123; return false; &#125; return true; &#125;&#125; åŒæ—¶éœ€è¦åœ¨MvcConfigä¸­æ›´æ–°é…ç½®ï¼Œæ³¨æ„ç”¨orderæŒ‡å®šæ‹¦æˆªå™¨é¡ºåº 1234567891011121314151617181920@Configurationpublic class MvcConfig implements WebMvcConfigurer &#123; @Resource private StringRedisTemplate stringRedisTemplate; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(new LoginInterceptor()). excludePathPatterns( //æ’é™¤ä¸éœ€è¦è¢«æ‹¦æˆªç™»å½•çš„è·¯å¾„ &quot;/shop/**&quot;, &quot;/voucher/**&quot;, &quot;/shop-type/**&quot;, &quot;/upload/**&quot;, &quot;/blog/hot&quot;, &quot;/user/code&quot;, &quot;/user/login&quot;).order(1); registry.addInterceptor(new RefreshTokenInterceptor(stringRedisTemplate)).addPathPatterns(&quot;/**&quot;).order(0); &#125;&#125; äºŒã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜1ã€æ·»åŠ å•†é“ºç¼“å­˜1234567891011121314151617181920212223242526272829@Servicepublic class ShopServiceImpl extends ServiceImpl&lt;ShopMapper, Shop&gt; implements IShopService &#123; @Autowired private StringRedisTemplate stringRedisTemplate; @Override public Result queryById(Long id) &#123; String key = CACHE_SHOP_KEY + id; //1ã€ä»redisä¸­æŸ¥ï¼ŒæŸ¥åˆ°äº†ç›´æ¥è¿”å› String shopJson = stringRedisTemplate.opsForValue().get(key); if(StrUtil.isNotBlank(shopJson))&#123; Shop shop = JSONUtil.toBean(shopJson, Shop.class); return Result.ok(shop); &#125; //2ã€æ²¡æœ‰æŸ¥åˆ°å°±å»æ•°æ®åº“æŸ¥ï¼Œå¦‚æœæ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œå°±è¿”å› Shop shop = getById(id); if(shop == null) return Result.fail(&quot;å•†é“ºä¿¡æ¯ä¸å­˜åœ¨&quot;); //3ã€å¦‚æœæ•°æ®åº“æœ‰ï¼Œä¿å­˜åˆ°redisä¾¿äºä¸‹æ¬¡æŸ¥æ‰¾ï¼Œç„¶åå†è¿”å› stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop)); return Result.ok(shop); &#125;&#125; 2ã€ç»ƒä¹ ï¼šæ·»åŠ å•†é“ºç±»å‹ç¼“å­˜3ã€ç¼“å­˜æ›´æ–°ç­–ç•¥issue1ã€é‡‡ç”¨ä»€ä¹ˆç¼“å­˜æ›´æ–°ç­–ç•¥ï¼Ÿ å†…å­˜æ·˜æ±° è¶…æ—¶å‰”é™¤ ä¸»åŠ¨æ›´æ–° è¯´æ˜ ä¸ç”¨è‡ªå·±ç»´æŠ¤ï¼Œ åˆ©ç”¨Redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œ å½“å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨æ·˜æ±°éƒ¨åˆ†æ•°æ®ã€‚ ä¸‹æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°ç¼“å­˜ã€‚ ç»™ç¼“å­˜æ•°æ®æ·»åŠ TTLæ—¶é—´ï¼Œ åˆ°æœŸåè‡ªåŠ¨åˆ é™¤ç¼“å­˜ã€‚ ä¸‹æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°ç¼“å­˜ã€‚ ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œ åœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œ æ›´æ–°ç¼“å­˜ã€‚ ä¸€è‡´æ€§ å·® ä¸€èˆ¬ å¥½ ç»´æŠ¤æˆæœ¬ æ—  ä½ é«˜ ä¸šåŠ¡åœºæ™¯ ä½ä¸€è‡´æ€§éœ€æ±‚ï¼šä½¿ç”¨å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œä¾‹å¦‚åº—é“ºç±»å‹çš„æŸ¥è¯¢ç¼“å­˜ï¼ˆå› ä¸ºè¿™ä¸ªå¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ä¸éœ€è¦æ›´æ–°ï¼‰ é«˜ä¸€è‡´æ€§éœ€æ±‚ï¼šä¸»åŠ¨æ›´æ–°ï¼Œå¹¶ä»¥è¶…æ—¶å‰”é™¤ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œä¾‹å¦‚åº—é“ºè¯¦æƒ…æŸ¥è¯¢çš„ç¼“å­˜ ans1ï¼šæœ¬é¡¹ç›®é‡‡ç”¨ä¸»åŠ¨æ›´æ–°+è¶…æ—¶å‰”é™¤ï¼ˆå…œåº•ï¼‰ æ›´æ–°æ–¹æ¡ˆé‡‡ç”¨åŒå†™æ–¹æ¡ˆï¼ˆCache Aside Patternï¼‰ï¼šäººå·¥ç¼–ç æ–¹å¼ï¼Œç¼“å­˜è°ƒç”¨è€…åœ¨æ›´æ–°å®Œæ•°æ®åº“åå†å»æ›´æ–°ç¼“å­˜ã€‚ issue2ï¼šåœ¨å¯¹ç¼“å­˜çš„æ›´æ–°ä¸Šï¼Œå¯¹æ¯”åˆ é™¤ç¼“å­˜ä¸æ›´æ–°ç¼“å­˜ æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“éƒ½éœ€è¦æ›´æ–°ç¼“å­˜ï¼Œæ— æ•ˆå†™æ“ä½œè¾ƒå¤š åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶è®©ç¼“å­˜å¤±æ•ˆï¼Œå†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°ç¼“å­˜ ans2ï¼šæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ç›´æ¥åˆ é™¤ç¼“å­˜ issue3ï¼šæ˜¯å…ˆæ“ä½œç¼“å­˜ï¼ˆå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼‰è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼ˆå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ“ä½œç¼“å­˜ï¼‰ï¼Ÿ å¯¹æ¯”å¦‚ä¸‹ï¼š å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼š åˆ é™¤ç¼“å­˜çš„æ“ä½œå¾ˆå¿«ï¼Œä½†æ˜¯æ›´æ–°æ•°æ®åº“çš„æ“ä½œç›¸å¯¹è¾ƒæ…¢ï¼Œå¦‚æœæ­¤æ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹2åˆšå¥½è¿›æ¥æŸ¥è¯¢ç¼“å­˜ï¼Œç”±äºæˆ‘ä»¬åˆšåˆšæ‰åˆ é™¤ç¼“å­˜ï¼Œæ‰€ä»¥çº¿ç¨‹2éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å†™å…¥ç¼“å­˜ï¼Œä½†æ˜¯æˆ‘ä»¬æ›´æ–°æ•°æ®åº“çš„æ“ä½œè¿˜æœªå®Œæˆï¼Œæ‰€ä»¥çº¿ç¨‹2æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®ï¼Œå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ“ä½œç¼“å­˜ å½“çº¿ç¨‹1åœ¨æŸ¥è¯¢ç¼“å­˜ä¸”æœªå‘½ä¸­ï¼Œæ­¤æ—¶çº¿ç¨‹1æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢å®Œå‡†å¤‡å†™å…¥ç¼“å­˜æ—¶ï¼Œç”±äºæ²¡æœ‰åŠ é”çº¿ç¨‹2ä¹˜è™šè€Œå…¥ï¼Œçº¿ç¨‹2åœ¨è¿™æœŸé—´å¯¹æ•°æ®åº“è¿›è¡Œäº†æ›´æ–°ï¼Œæ­¤æ—¶çº¿ç¨‹1å°†æ—§æ•°æ®è¿”å›äº†ï¼Œå‡ºç°äº†è„è¯»ï¼Œè¿™ä¸ªäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡å¾ˆä½ï¼Œå› ä¸ºå…ˆæ˜¯éœ€è¦æ»¡è¶³ç¼“å­˜æœªå‘½ä¸­ï¼Œä¸”åœ¨å†™å…¥ç¼“å­˜çš„é‚£æ®µäº‹ä»¶å†…æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ›´æ–°æ“ä½œï¼Œç¼“å­˜çš„æŸ¥è¯¢å¾ˆå¿«ï¼Œè¿™æ®µç©ºéš™æ—¶é—´å¾ˆå°ï¼Œæ‰€ä»¥å‡ºç°è„è¯»ç°è±¡çš„æ¦‚ç‡ä¹Ÿå¾ˆä½ è¿™ç§æ–¹å¼çš„ä¸è¶³ä¹‹å¤„ï¼šå­˜åœ¨è„è¯»ç°è±¡ï¼Œä½†æ¦‚ç‡è¾ƒå° ans3ï¼šè™½ç„¶è¿™äºŒè€…éƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´ï¼Œåè€…å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ¦‚ç‡ç›¸å¯¹è¾ƒä½ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆé‡‡ç”¨åè€…å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜çš„æ–¹æ¡ˆ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * æ ¹æ®idæŸ¥è¯¢å•†é“ºæ•°æ®ï¼ˆæŸ¥è¯¢æ—¶ï¼Œé‡å»ºç¼“å­˜ï¼‰ * * @param id * @return */@Overridepublic Result queryById(Long id) &#123; String key = CACHE_SHOP_KEY + id; // 1ã€ä»Redisä¸­æŸ¥è¯¢åº—é“ºæ•°æ® String shopJson = stringRedisTemplate.opsForValue().get(key); Shop shop = null; // 2ã€åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ if (StrUtil.isNotBlank(shopJson)) &#123; // 2.1 ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›åº—é“ºæ•°æ® shop = JSONUtil.toBean(shopJson, Shop.class); return Result.ok(shop); &#125; // 2.2 ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“ä¸­æŸ¥è¯¢åº—é“ºæ•°æ® shop = this.getById(id); // 4ã€åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å­˜åœ¨åº—é“ºæ•°æ® if (Objects.isNull(shop)) &#123; // 4.1 æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œè¿”å›å¤±è´¥ä¿¡æ¯ return Result.fail(&quot;åº—é“ºä¸å­˜åœ¨&quot;); &#125; // 4.2 æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œé‡å»ºç¼“å­˜ï¼Œå¹¶è¿”å›åº—é“ºæ•°æ® stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop), CACHE_SHOP_TTL, TimeUnit.MINUTES); return Result.ok(shop);&#125;/** * æ›´æ–°å•†é“ºæ•°æ®ï¼ˆæ›´æ–°æ—¶ï¼Œæ›´æ–°æ•°æ®åº“ï¼Œåˆ é™¤ç¼“å­˜ï¼‰ * * @param shop * @return */@Transactional@Overridepublic Result updateShop(Shop shop) &#123; // å‚æ•°æ ¡éªŒ, ç•¥ // 1ã€æ›´æ–°æ•°æ®åº“ä¸­çš„åº—é“ºæ•°æ® boolean f = this.updateById(shop); if (!f)&#123; // ç¼“å­˜æ›´æ–°å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡å›æ»š throw new RuntimeException(&quot;æ•°æ®åº“æ›´æ–°å¤±è´¥&quot;); &#125; // 2ã€åˆ é™¤ç¼“å­˜ f = stringRedisTemplate.delete(CACHE_SHOP_KEY + shop.getId()); if (!f)&#123; // ç¼“å­˜åˆ é™¤å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡å›æ»š throw new RuntimeException(&quot;ç¼“å­˜åˆ é™¤å¤±è´¥&quot;); &#125; return Result.ok();&#125; 4ã€ç¼“å­˜ç©¿é€æ¦‚å¿µï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚ è§£å†³æ–¹æ¡ˆï¼š ç¼“å­˜ç©ºå¯¹è±¡ ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿ ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œå¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´ å¸ƒéš†è¿‡æ»¤ ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œå­˜åœ¨è¯¯åˆ¤å¯èƒ½ï¼ˆæœ‰ç©¿é€çš„é£é™©ï¼‰ï¼Œæ— æ³•åˆ é™¤æ•°æ® æœ¬æ–‡é‡‡ç”¨æ˜¯ç¼“å­˜ç¼“å­˜ç©ºå¯¹è±¡ 12345678910111213141516171819202122232425262728@Overridepublic Result queryById(Long id) &#123; //å…ˆä»Redisä¸­æŸ¥ï¼Œè¿™é‡Œçš„å¸¸é‡å€¼æ˜¯å›ºå®šçš„å‰ç¼€ + åº—é“ºid String shopJson = stringRedisTemplate.opsForValue().get(CACHE_SHOP_KEY + id); //å¦‚æœä¸ä¸ºç©ºï¼ˆæŸ¥è¯¢åˆ°äº†ï¼‰ï¼Œåˆ™è½¬ä¸ºShopç±»å‹ç›´æ¥è¿”å› if (StrUtil.isNotBlank(shopJson)) &#123; Shop shop = JSONUtil.toBean(shopJson, Shop.class); return Result.ok(shop); &#125; //å¦‚æœæŸ¥è¯¢åˆ°çš„æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è¯´æ˜æ˜¯æˆ‘ä»¬ç¼“å­˜çš„ç©ºæ•°æ® if (shopjson != null) &#123; return Result.fail(&quot;åº—é“ºä¸å­˜åœ¨ï¼ï¼&quot;); &#125; //å¦åˆ™å»æ•°æ®åº“ä¸­æŸ¥ Shop shop = getById(id); //æŸ¥ä¸åˆ°ï¼Œåˆ™å°†ç©ºå­—ç¬¦ä¸²å†™å…¥Redis if (shop == null) &#123; //è¿™é‡Œçš„å¸¸é‡å€¼æ˜¯2åˆ†é’Ÿ stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, &quot;&quot;, CACHE_NULL_TTL, TimeUnit.MINUTES); return Result.fail(&quot;åº—é“ºä¸å­˜åœ¨ï¼ï¼&quot;); &#125; //æŸ¥åˆ°äº†åˆ™è½¬ä¸ºjsonå­—ç¬¦ä¸² String jsonStr = JSONUtil.toJsonStr(shop); //å¹¶å­˜å…¥redisï¼Œè®¾ç½®TTL stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, jsonStr, CACHE_SHOP_TTL, TimeUnit.MINUTES); //æœ€ç»ˆæŠŠæŸ¥è¯¢åˆ°çš„å•†æˆ·ä¿¡æ¯è¿”å›ç»™å‰ç«¯ return Result.ok(shop);&#125; 5ã€ç¼“å­˜é›ªå´© æ¦‚å¿µï¼šç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚ è§£å†³æ–¹æ¡ˆ ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥ï¼Œæ¯”å¦‚å¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼Œè®©è¯·æ±‚å°½å¯èƒ½æ‰“ä¸åˆ°æ•°æ®åº“ä¸Š ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ è¿™é‡Œé‡‡ç”¨æ–¹æ¡ˆ1 6ã€ç¼“å­˜å‡»ç©¿ æ¦‚å¿µï¼šç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚ è§£å†³æ–¹æ¡ˆ äº’æ–¥é”ï¼ˆæ—¶é—´æ¢ç©ºé—´ï¼‰ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å°ï¼Œä¸€è‡´æ€§é«˜ï¼Œå®ç°ç®€å•ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒä½ï¼Œå®¹æ˜“å‡ºç°æ­»é” é€»è¾‘è¿‡æœŸï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰ä¼˜ç‚¹ï¼šæ€§èƒ½é«˜ç¼ºç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå¤§ï¼Œå®¹æ˜“å‡ºç°è„è¯» ä¸¤è€…ç›¸æ¯”è¾ƒï¼Œäº’æ–¥é”æ›´åŠ æ˜“äºå®ç°ï¼Œä½†æ˜¯å®¹æ˜“å‘ç”Ÿæ­»é”ï¼Œä¸”é”å¯¼è‡´å¹¶è¡Œå˜æˆä¸²è¡Œï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œé€»è¾‘è¿‡æœŸå®ç°èµ·æ¥ç›¸è¾ƒå¤æ‚ï¼Œä¸”éœ€è¦è€—è´¹é¢å¤–çš„å†…å­˜ï¼Œä½†æ˜¯é€šè¿‡å¼€å¯å­çº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œä½¿åŸæ¥çš„åŒæ­¥é˜»å¡å˜æˆå¼‚æ­¥ï¼Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ï¼Œä½†æ˜¯å®¹æ˜“å‡ºç°è„è¯» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596//äº’æ–¥é”è§£å†³æ–¹æ¡ˆ/** * æ ¹æ®idæŸ¥è¯¢å•†é“ºæ•°æ® * * @param id * @return */ @Override public Result queryById(Long id) &#123; String key = CACHE_SHOP_KEY + id; // 1ã€ä»Redisä¸­æŸ¥è¯¢åº—é“ºæ•°æ®ï¼Œå¹¶åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ Result result = getShopFromCache(key); if (Objects.nonNull(result)) &#123; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å› return result; &#125; try &#123; // 2ã€ç¼“å­˜æœªå‘½ä¸­ï¼Œéœ€è¦é‡å»ºç¼“å­˜ï¼Œåˆ¤æ–­èƒ½å¦èƒ½å¤Ÿè·å–äº’æ–¥é” String lockKey = LOCK_SHOP_KEY + id; boolean isLock = tryLock(lockKey); if (!isLock) &#123; // 2.1 è·å–é”å¤±è´¥ï¼Œå·²æœ‰çº¿ç¨‹åœ¨é‡å»ºç¼“å­˜ï¼Œåˆ™ä¼‘çœ é‡è¯• Thread.sleep(50); return queryById(id); &#125; // 2.2 è·å–é”æˆåŠŸï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦é‡å»ºï¼Œé˜²æ­¢å †ç§¯çš„çº¿ç¨‹å…¨éƒ¨è¯·æ±‚æ•°æ®åº“ï¼ˆæ‰€ä»¥è¯´åŒæ£€æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼‰ result = getShopFromCache(key); if (Objects.nonNull(result)) &#123; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å› return result; &#125; // 3ã€ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åº—é“ºæ•°æ®ï¼Œå¹¶åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å­˜åœ¨åº—é“ºæ•°æ® Shop shop = this.getById(id); if (Objects.isNull(shop)) &#123; // æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œç¼“å­˜ç©ºå¯¹è±¡ï¼ˆè§£å†³ç¼“å­˜ç©¿é€ï¼‰ï¼Œè¿”å›å¤±è´¥ä¿¡æ¯ stringRedisTemplate.opsForValue().set(key, &quot;&quot;, CACHE_NULL_TTL, TimeUnit.SECONDS); return Result.fail(&quot;åº—é“ºä¸å­˜åœ¨&quot;); &#125; // 4ã€æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œé‡å»ºç¼“å­˜ï¼Œå“åº”æ•°æ® stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop), CACHE_SHOP_TTL, TimeUnit.MINUTES); return Result.ok(shop); &#125;catch (Exception e)&#123; throw new RuntimeException(&quot;å‘ç”Ÿå¼‚å¸¸&quot;); &#125; finally &#123; // 5ã€é‡Šæ”¾é”ï¼ˆé‡Šæ”¾é”ä¸€å®šè¦è®°å¾—æ”¾åœ¨finallyä¸­ï¼Œé˜²æ­¢æ­»é”ï¼‰ unlock(key); &#125; &#125; /** * ä»ç¼“å­˜ä¸­è·å–åº—é“ºæ•°æ® * @param key * @return */ private Result getShopFromCache(String key) &#123; String shopJson = stringRedisTemplate.opsForValue().get(key); // åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ if (StrUtil.isNotBlank(shopJson)) &#123; // ç¼“å­˜æ•°æ®æœ‰å€¼ï¼Œè¯´æ˜ç¼“å­˜å‘½ä¸­äº†ï¼Œç›´æ¥è¿”å›åº—é“ºæ•°æ® Shop shop = JSONUtil.toBean(shopJson, Shop.class); return Result.ok(shop); &#125; // åˆ¤æ–­ç¼“å­˜ä¸­æŸ¥è¯¢çš„æ•°æ®æ˜¯å¦æ˜¯ç©ºå­—ç¬¦ä¸²(isNotBlankæŠŠ null å’Œ ç©ºå­—ç¬¦ä¸² ç»™æ’é™¤äº†) if (Objects.nonNull(shopJson)) &#123; // å½“å‰æ•°æ®æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜ç¼“å­˜ä¹Ÿå‘½ä¸­äº†ï¼ˆè¯¥æ•°æ®æ˜¯ä¹‹å‰ç¼“å­˜çš„ç©ºå¯¹è±¡ï¼‰ï¼Œç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ return Result.fail(&quot;åº—é“ºä¸å­˜åœ¨&quot;); &#125; // ç¼“å­˜æœªå‘½ä¸­ï¼ˆç¼“å­˜æ•°æ®æ—¢æ²¡æœ‰å€¼ï¼Œåˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰ return null; &#125; /** * è·å–é” * * @param key * @return */ private boolean tryLock(String key) &#123; Boolean flag = stringRedisTemplate.opsForValue().setIfAbsent(key, &quot;1&quot;, 10, TimeUnit.SECONDS); // æ‹†ç®±è¦åˆ¤ç©ºï¼Œé˜²æ­¢NPE return BooleanUtil.isTrue(flag); &#125; /** * é‡Šæ”¾é” * * @param key */ private void unlock(String key) &#123; stringRedisTemplate.delete(key); &#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108//é€»è¾‘è¿‡æœŸå®ç°/** * ç¼“å­˜é‡å»ºçº¿ç¨‹æ±  */ public static final ExecutorService CACHE_REBUILD_EXECUTOR = Executors.newFixedThreadPool(10); /** * æ ¹æ®idæŸ¥è¯¢å•†é“ºæ•°æ® * * @param id * @return */ @Override public Result queryById(Long id) &#123; String key = CACHE_SHOP_KEY + id; // 1ã€ä»Redisä¸­æŸ¥è¯¢åº—é“ºæ•°æ®ï¼Œå¹¶åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ String shopJson = stringRedisTemplate.opsForValue().get(key); if (StrUtil.isBlank(shopJson)) &#123; // 1.1 ç¼“å­˜æœªå‘½ä¸­ï¼Œç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ return Result.fail(&quot;åº—é“ºæ•°æ®ä¸å­˜åœ¨&quot;); &#125; // 1.2 ç¼“å­˜å‘½ä¸­ï¼Œå°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–æœªå¯¹è±¡ï¼Œå¹¶åˆ¤æ–­ç¼“å­˜æ•°æ®æ˜¯å¦é€»è¾‘è¿‡æœŸ RedisData redisData = JSONUtil.toBean(shopJson, RedisData.class); // è¿™é‡Œéœ€è¦å…ˆè½¬æˆJSONObjectå†è½¬æˆååºåˆ—åŒ–ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ­£ç¡®æ˜ å°„Shopçš„å­—æ®µ JSONObject data = (JSONObject) redisData.getData(); Shop shop = JSONUtil.toBean(data, Shop.class); LocalDateTime expireTime = redisData.getExpireTime(); if (expireTime.isAfter(LocalDateTime.now())) &#123; // å½“å‰ç¼“å­˜æ•°æ®æœªè¿‡æœŸï¼Œç›´æ¥è¿”å› return Result.ok(shop); &#125; // 2ã€ç¼“å­˜æ•°æ®å·²è¿‡æœŸï¼Œè·å–äº’æ–¥é”ï¼Œå¹¶ä¸”é‡å»ºç¼“å­˜ String lockKey = LOCK_SHOP_KEY + id; boolean isLock = tryLock(lockKey); if (isLock) &#123; // è·å–é”æˆåŠŸï¼Œå¼€å¯ä¸€ä¸ªå­çº¿ç¨‹å»é‡å»ºç¼“å­˜ CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123; try &#123; this.saveShopToCache(id, 20L); &#125; catch (InterruptedException e) &#123; throw new RuntimeException(e); &#125; finally &#123; unlock(lockKey); &#125; &#125;); &#125; // 3ã€è·å–é”å¤±è´¥ï¼Œå†æ¬¡æŸ¥è¯¢ç¼“å­˜ï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦é‡å»ºï¼ˆè¿™é‡ŒåŒæ£€æ˜¯æœ‰å¿…è¦çš„ï¼‰ shopJson = stringRedisTemplate.opsForValue().get(key); if (StrUtil.isBlank(shopJson)) &#123; // 3.1 ç¼“å­˜æœªå‘½ä¸­ï¼Œç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ return Result.fail(&quot;åº—é“ºæ•°æ®ä¸å­˜åœ¨&quot;); &#125; // 3.2 ç¼“å­˜å‘½ä¸­ï¼Œå°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–æœªå¯¹è±¡ï¼Œå¹¶åˆ¤æ–­ç¼“å­˜æ•°æ®æ˜¯å¦é€»è¾‘è¿‡æœŸ redisData = JSONUtil.toBean(shopJson, RedisData.class); // è¿™é‡Œéœ€è¦å…ˆè½¬æˆJSONObjectå†è½¬æˆååºåˆ—åŒ–ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ­£ç¡®æ˜ å°„Shopçš„å­—æ®µ data = (JSONObject) redisData.getData(); shop = JSONUtil.toBean(data, Shop.class); expireTime = redisData.getExpireTime(); if (expireTime.isAfter(LocalDateTime.now())) &#123; // å½“å‰ç¼“å­˜æ•°æ®æœªè¿‡æœŸï¼Œç›´æ¥è¿”å› return Result.ok(shop); &#125; // 4ã€è¿”å›è¿‡æœŸæ•°æ® return Result.ok(shop); &#125; /** * ä»ç¼“å­˜ä¸­è·å–åº—é“ºæ•°æ® * @param key * @return */ private Result getShopFromCache(String key) &#123; String shopJson = stringRedisTemplate.opsForValue().get(key); // åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ if (StrUtil.isNotBlank(shopJson)) &#123; // ç¼“å­˜æ•°æ®æœ‰å€¼ï¼Œè¯´æ˜ç¼“å­˜å‘½ä¸­äº†ï¼Œç›´æ¥è¿”å›åº—é“ºæ•°æ® Shop shop = JSONUtil.toBean(shopJson, Shop.class); return Result.ok(shop); &#125; // åˆ¤æ–­ç¼“å­˜ä¸­æŸ¥è¯¢çš„æ•°æ®æ˜¯å¦æ˜¯ç©ºå­—ç¬¦ä¸²(isNotBlankæŠŠ null å’Œ ç©ºå­—ç¬¦ä¸² ç»™æ’é™¤äº†) if (Objects.nonNull(shopJson)) &#123; // å½“å‰æ•°æ®æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜ç¼“å­˜ä¹Ÿå‘½ä¸­äº†ï¼ˆè¯¥æ•°æ®æ˜¯ä¹‹å‰ç¼“å­˜çš„ç©ºå¯¹è±¡ï¼‰ï¼Œç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ return Result.fail(&quot;åº—é“ºä¸å­˜åœ¨&quot;); &#125; // ç¼“å­˜æœªå‘½ä¸­ï¼ˆç¼“å­˜æ•°æ®æ—¢æ²¡æœ‰å€¼ï¼Œåˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰ return null; &#125; /** * å°†æ•°æ®ä¿å­˜åˆ°ç¼“å­˜ä¸­ * * @param id å•†é“ºid * @param expireSeconds é€»è¾‘è¿‡æœŸæ—¶é—´ */ public void saveShopToCache(Long id, Long expireSeconds) throws InterruptedException &#123; // ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åº—é“ºæ•°æ® Shop shop = this.getById(id); Thread.sleep(200); // å°è£…é€»è¾‘è¿‡æœŸæ•°æ® RedisData redisData = new RedisData(); redisData.setData(shop); redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds)); // å°†é€»è¾‘è¿‡æœŸæ•°æ®å­˜å…¥Redisä¸­ stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, JSONUtil.toJsonStr(redisData)); &#125; å°ç»“ä¸ºäº†è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©é€‚å½“çš„ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼š ä»¥ç¼“å­˜ä¸»åŠ¨æ›´æ–°ï¼ˆåŒå†™æ–¹æ¡ˆ+åˆ é™¤ç¼“å­˜æ¨¡å¼+å…ˆæ“ä½œæ•°æ®åº“åæ“ä½œç¼“å­˜+äº‹åŠ¡ï¼‰ä¸ºä¸»ï¼Œè¶…æ—¶å‰”é™¤ä¸ºè¾… æŸ¥è¯¢æ—¶ï¼Œå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œç¼“å­˜å‘½ä¸­ç›´æ¥è¿”å›ï¼Œç¼“å­˜æœªå‘½ä¸­æŸ¥è¯¢æ•°æ®åº“å¹¶é‡å»ºç¼“å­˜ï¼Œè¿”å›æŸ¥è¯¢ç»“æœ æ›´æ–°æ—¶ï¼Œå…ˆä¿®æ”¹æ•°æ®åˆ é™¤ç¼“å­˜ï¼Œä½¿ç”¨äº‹åŠ¡ä¿è¯ç¼“å­˜å’Œæ•°æ®æ“ä½œä¸¤è€…çš„åŸå­æ€§ã€ é™¤äº†ä¼šé‡åˆ°æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ„å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šé‡åˆ°ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ç­‰é—®é¢˜ å¯¹äºç¼“å­˜ç©¿é€ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ç¼“å­˜ç©ºå¯¹è±¡è§£å†³ å¯¹äºç¼“å­˜å‡»ç©¿ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¼”ç¤ºäº†äº’æ–¥é”ï¼ˆsetnxå®ç°æ–¹å¼ï¼‰å’Œé€»è¾‘è¿‡æœŸä¸¤ç§æ–¹å¼è§£å†³ ä¸‰ã€ä¼˜æƒ åˆ¸ç§’æ€1ã€å…¨å±€å”¯ä¸€IDè‡ªå¢IDå­˜åœ¨çš„é—®é¢˜ å½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œè€Œè®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDå°±å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾ï¼Œå®¹æ˜“å‡ºç°ä¿¡æ¯çš„æ³„éœ²ï¼Œè¢«ä¸æ€€å¥½æ„çš„äººä¼ªé€ è¯·æ±‚ å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶ï¼ŒMySQLä¸­è¡¨èƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®æœ‰é™ï¼Œä¼šå‡ºç°åˆ†åº“åˆ†è¡¨çš„æƒ…å†µï¼Œidä¸èƒ½å¤Ÿä¸€ç›´è‡ªå¢ é‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼IDï¼ˆä¹Ÿå¯ä»¥å«å…¨å±€å”¯ä¸€IDï¼‰ï¼Œåˆ†å¸ƒå¼IDæ»¡è¶³ä»¥ä¸‹ç‰¹ç‚¹ï¼š å…¨å±€å”¯ä¸€æ€§ï¼šåˆ†å¸ƒå¼IDä¿è¯åœ¨æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å”¯ä¸€æ€§ï¼Œä¸ä¼šå‡ºç°é‡å¤çš„æ ‡è¯†ç¬¦ã€‚è¿™å¯¹äºåŒºåˆ†å’Œè¿½è¸ªç³»ç»Ÿä¸­çš„ä¸åŒå®ä½“éå¸¸é‡è¦ã€‚ é«˜å¯ç”¨æ€§ï¼šåˆ†å¸ƒå¼IDç”Ÿæˆå™¨é€šå¸¸è¢«è®¾è®¡ä¸ºé«˜å¯ç”¨çš„ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡æ°´å¹³æ‰©å±•ã€å†—ä½™å¤‡ä»½æˆ–é›†ç¾¤éƒ¨ç½²æ¥ç¡®ä¿æœåŠ¡çš„å¯ç”¨æ€§ã€‚å³ä½¿æŸä¸ªèŠ‚ç‚¹æˆ–ç»„ä»¶å‘ç”Ÿæ•…éšœï¼Œä»ç„¶èƒ½å¤Ÿæ­£å¸¸ç”Ÿæˆå”¯ä¸€çš„IDæ ‡è¯†ç¬¦ã€‚ å®‰å…¨æ€§ï¼šåˆ†å¸ƒå¼IDç”Ÿæˆå™¨é€šå¸¸æ˜¯ç‹¬ç«‹äºåº”ç”¨ç¨‹åºå’Œä¸šåŠ¡é€»è¾‘çš„ã€‚å®ƒä»¬è¢«è®¾è®¡ä¸ºä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶æˆ–æœåŠ¡ï¼Œå¯ä»¥è¢«å„ç§åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æ‰€å…±äº«å’Œä½¿ç”¨ï¼Œä½¿å¾—å„ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„IDç”Ÿæˆè¿‡ç¨‹äº’ä¸å¹²æ‰°ã€‚ é«˜æ€§èƒ½ï¼šåˆ†å¸ƒå¼IDç”Ÿæˆå™¨é€šå¸¸è¦æ±‚åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ç”Ÿæˆå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ä¸ºäº†å®ç°ä½å»¶è¿Ÿï¼Œè®¾è®¡è€…é€šå¸¸é‡‡ç”¨é«˜æ•ˆçš„ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œä»¥åŠä¼˜åŒ–çš„ç½‘ç»œé€šä¿¡å’Œå­˜å‚¨ç­–ç•¥ã€‚ é€’å¢æ€§ï¼šåˆ†å¸ƒå¼IDé€šå¸¸å¯ä»¥è¢«è®¾è®¡æˆå¯æŒ‰æ—¶é—´é¡ºåºæ’åºï¼Œä»¥ä¾¿æ›´å®¹æ˜“å¯¹ç”Ÿæˆçš„IDè¿›è¡Œç´¢å¼•ã€æ£€ç´¢æˆ–æ’åºæ“ä½œã€‚è¿™å¯¹äºä¸€äº›åœºæ™¯ï¼Œå¦‚æ—¥å¿—è®°å½•å’Œäº‹ä»¶æº¯æºç­‰ï¼Œéå¸¸é‡è¦ã€‚ 1234567891011121314151617181920212223242526272829303132//ç”Ÿæˆåˆ†å¸ƒå¼ID@Componentpublic class RedisIdWorker &#123; @Resource private StringRedisTemplate stringRedisTemplate; /** * å¼€å§‹æ—¶é—´æˆ³ */ private static final long BEGIN_TIMESTAMP = 1640995200; /** * åºåˆ—åŒ–ä½æ•° */ private static final int COUNT_BITS = 32; /** * ç”Ÿæˆåˆ†å¸ƒå¼ID * @param keyPrefix * @return */ public long nextId(String keyPrefix)&#123; // 1ã€ç”Ÿæˆæ—¶é—´æˆ³ LocalDateTime now = LocalDateTime.now(); long nowSecond = now.toEpochSecond(ZoneOffset.UTC); long timestamp = nowSecond - BEGIN_TIMESTAMP; // 2ã€ç”Ÿæˆåºåˆ—å· // ä»¥å½“å¤©çš„æ—¶é—´æˆ³ä¸ºkeyï¼Œé˜²æ­¢ä¸€ç›´è‡ªå¢ä¸‹å»å¯¼è‡´è¶…æ—¶ï¼Œè¿™æ ·æ¯å¤©çš„æé™éƒ½æ˜¯ 2^&#123;31&#125; String date = now.format(DateTimeFormatter.ofPattern(&quot;yyyyMMdd&quot;)); Long count = stringRedisTemplate.opsForValue().increment(&quot;icr:&quot; + keyPrefix + &quot;:&quot; + date); // 3ã€æ‹¼æ¥å¹¶è¿”å› return timestamp &lt;&lt; COUNT_BITS | count; &#125;&#125; æ³¨æ„ï¼šæµ‹è¯•ç±»åŒ…æ‹¬CountDownLatchçš„ä½¿ç”¨ 1234567891011121314151617181920212223242526272829303132333435//æµ‹è¯•ç±»@SpringBootTestpublic class RedisIdWorkerTest &#123; @Resource private RedisIdWorker redisIdWorker; private ExecutorService es = Executors.newFixedThreadPool(500); /** * æµ‹è¯•åˆ†å¸ƒå¼IDç”Ÿæˆå™¨çš„æ€§èƒ½ï¼Œä»¥åŠå¯ç”¨æ€§ */ @Test public void testNextId() throws InterruptedException &#123; // ä½¿ç”¨CountDownLatchè®©çº¿ç¨‹åŒæ­¥ç­‰å¾… CountDownLatch latch = new CountDownLatch(300); // åˆ›å»ºçº¿ç¨‹ä»»åŠ¡ Runnable task = () -&gt; &#123; for (int i = 0; i &lt; 100; i++) &#123; long id = redisIdWorker.nextId(&quot;order&quot;); System.out.println(&quot;id = &quot; + id); &#125; // ç­‰å¾…æ¬¡æ•°-1 latch.countDown(); &#125;; long begin = System.currentTimeMillis(); // åˆ›å»º300ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ›å»º100ä¸ªidï¼Œæ€»è®¡ç”Ÿæˆ3wä¸ªid for (int i = 0; i &lt; 300; i++) &#123; es.submit(task); &#125; // çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’0æ—¶æ‰å…¨éƒ¨å”¤é†’æ‰€æœ‰çº¿ç¨‹ latch.await(); long end = System.currentTimeMillis(); System.out.println(&quot;ç”Ÿæˆ3wä¸ªidå…±è€—æ—¶&quot; + (end - begin) + &quot;ms&quot;); &#125;&#125; 2ã€ç§’æ€åˆ¸ä¸‹å•åŠŸèƒ½é¦–å…ˆæ·»åŠ ç§’æ€åˆ¸ï¼Œtb_voucherä¿å­˜çš„æ˜¯æ™®é€šä¼˜æƒ åˆ¸ï¼Œè€Œtb_seckill_voucherä¿å­˜çš„æ˜¯ç§’æ€åˆ¸çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç§’æ€åˆ¸ä¹Ÿæ˜¯ä¼˜æƒ åˆ¸ï¼Œåªæ˜¯ç§’æ€åˆ¸æ¯”ä¼˜æƒ åˆ¸æœ‰æ›´å¤šçš„ä¸€äº›ä¿¡æ¯ã€‚åœ¨è¿™é‡Œè¸©äº†ä¸€ä¸ªå‘ã€‚å°±æ˜¯è®¾ç½®ç§’æ€åˆ¸çš„end_timeæ—¶ï¼Œè¿™ä¸ªæ—¶é—´å¿…é¡»åœ¨ä½ ç”µè„‘å½“å‰æ—¶é—´ä¹‹åï¼Œå¦åˆ™å°±ä¼šä¸æ˜¾ç¤ºï¼ï¼ ç„¶åæ˜¯ç§’æ€åˆ¸çš„ä¸‹å•åŠŸèƒ½ 12345678910111213141516171819202122232425262728293031323334@Transactional public Result seckillVocher(Long voucherId) &#123; // 1ã€æŸ¥è¯¢ç§’æ€åˆ¸ SeckillVoucher voucher = seckillVoucherService.getById(voucherId); log.info(&quot;å½“å‰ç§’æ€åˆ¸&quot;); // 2ã€åˆ¤æ–­ç§’æ€åˆ¸æ˜¯å¦åˆæ³• if (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123; // ç§’æ€åˆ¸çš„å¼€å§‹æ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å return Result.fail(&quot;ç§’æ€å°šæœªå¼€å§‹&quot;); &#125; if (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123; // ç§’æ€åˆ¸çš„ç»“æŸæ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å‰ return Result.fail(&quot;ç§’æ€å·²ç»“æŸ&quot;); &#125; if (voucher.getStock() &lt; 1) &#123; return Result.fail(&quot;ç§’æ€åˆ¸å·²æŠ¢ç©º&quot;); &#125; // 5ã€ç§’æ€åˆ¸åˆæ³•ï¼Œåˆ™ç§’æ€åˆ¸æŠ¢è´­æˆåŠŸï¼Œç§’æ€åˆ¸åº“å­˜æ•°é‡å‡ä¸€ boolean flag = seckillVoucherService.update(new LambdaUpdateWrapper&lt;SeckillVoucher&gt;() .eq(SeckillVoucher::getVoucherId, voucherId) .setSql(&quot;stock = stock -1&quot;)); if (!flag)&#123; throw new RuntimeException(&quot;ç§’æ€åˆ¸æ‰£å‡å¤±è´¥&quot;); &#125; // 6ã€ç§’æ€æˆåŠŸï¼Œåˆ›å»ºå¯¹åº”çš„è®¢å•ï¼Œå¹¶ä¿å­˜åˆ°æ•°æ®åº“ VoucherOrder voucherOrder = new VoucherOrder(); long orderId = redisIdWorker.nextId(&quot;order&quot;); voucherOrder.setId(orderId); voucherOrder.setUserId(UserHolder.getUser().getId()); voucherOrder.setVoucherId(voucherOrder.getId()); save(voucherOrder); // è¿”å›è®¢å•id return Result.ok(orderId); &#125; è¿™é‡Œä¹Ÿè¸©äº†ä¸€ä¸ªå‘ï¼Œå°±æ˜¯æ‰§è¡Œäº†åŠå¤©ç‚¹å‡»ä½†å‘ç°ä¼˜æƒ åˆ¸å¹¶æ²¡æœ‰æ‰£é™¤ï¼Œç”šè‡³controllerå¤„çš„å†™çš„æ‰“å°ä¿¡æ¯éƒ½æ²¡æœ‰åœ¨æ§åˆ¶å°æ‰“å°ï¼ŒåŸå› å¥½åƒè·Ÿè®¿é—®è·¯å¾„æœ‰å…³ç³»ï¼Ÿï¼Ÿåˆšè§£å†³å®Œå°±å¿˜äº†ã€‚ã€‚é±¼çš„è®°å¿†-_- 3ã€å•ä½“ä¸‹ä¸€äººå¤šå•è¶…å–é—®é¢˜ä¸Šä¸€èŠ‚æˆ‘ä»¬é€šè¿‡åˆ†å¸ƒå¼ID+äº‹åŠ¡æˆåŠŸå®Œæˆäº†ä¼˜æƒ åˆ¸ç§’æ€åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨æµ‹è¯•åå‘ç°é€»è¾‘è·‘é€šäº†ï¼Œçœ‹ä¸Šå»å·²ç»æˆåŠŸçš„è§£å†³äº†ç§’æ€ä¼˜æƒ åˆ¸åŠŸèƒ½ã€‚ä½†æ˜¯å‰é¢æˆ‘ä»¬åªæ˜¯æ­£å¸¸çš„æµ‹è¯•ï¼Œé‚£å¦‚æœæ¢åˆ°é«˜å¹¶å‘çš„åœºæ™¯ä¸‹èƒ½å¦æˆåŠŸè§£å†³ï¼Ÿç°åœ¨å°±è®©æˆ‘ä»¬ä½¿ç”¨ Jmeter æ¥è¿›è¡Œå‹åŠ›æµ‹è¯•çœ‹çœ‹å§ï¼ jmeterè®¾ç½® ç»è¿‡æµ‹è¯•ï¼Œ å‘ç°æœ‰è¶…å–é—®é¢˜ã€‚ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¶…å–å‘¢ï¼Ÿ çº¿ç¨‹1æŸ¥è¯¢åº“å­˜ï¼Œå‘ç°åº“å­˜å……è¶³ï¼Œåˆ›å»ºè®¢å•ï¼Œç„¶åå‡†å¤‡å¯¹åº“å­˜è¿›è¡Œæ‰£å‡ï¼Œä½†æ­¤æ—¶çº¿ç¨‹2å’Œçº¿ç¨‹3ä¹Ÿè¿›è¡ŒæŸ¥è¯¢ï¼ŒåŒæ ·å‘ç°åº“å­˜å……è¶³ï¼Œç„¶åçº¿ç¨‹1æ‰§è¡Œå®Œæ‰£å‡æ“ä½œåï¼Œåº“å­˜å˜ä¸ºäº†0ï¼Œçº¿ç¨‹2å’Œçº¿ç¨‹3åŒæ ·å®Œæˆäº†åº“å­˜æ‰£å‡æ“ä½œï¼Œæœ€ç»ˆå¯¼è‡´åº“å­˜å˜æˆäº†è´Ÿæ•°ï¼è¿™å°±æ˜¯è¶…å–é—®é¢˜çš„å®Œæ•´æµç¨‹ é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•æœ‰æ•ˆé˜²æ­¢è¶…å–é—®é¢˜çš„å‘ç”Ÿå‘¢ï¼Œä»¥ä¸‹æä¾›å‡ ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆ è¶…å–é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆï¼š æ‚²è§‚é”ï¼Œè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€å®šä¼šå‘ç”Ÿï¼Œå› æ­¤æ“ä½œæ•°æ®åº“ä¹‹å‰éƒ½éœ€è¦å…ˆè·å–é”ï¼Œç¡®ä¿çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œã€‚å¸¸è§çš„æ‚²è§‚é”æœ‰ï¼šsynchronizedã€lock ä¹è§‚é”ï¼Œè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸ä¸€å®šå‘ç”Ÿï¼Œå› æ­¤ä¸åŠ é”ï¼Œåªä¼šåœ¨æ›´æ–°æ•°æ®åº“çš„æ—¶å€™å»åˆ¤æ–­æœ‰æ²¡æœ‰å…¶å®ƒçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹åˆ™è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®å³å¯ï¼Œå¦‚æœä¿®æ”¹äº†åˆ™è¯´æ˜ä¸å®‰å…¨ï¼Œç›´æ¥æŠ›å¼‚å¸¸æˆ–è€…ç­‰å¾…é‡è¯•ã€‚å¸¸è§çš„å®ç°æ–¹å¼æœ‰ï¼šç‰ˆæœ¬å·æ³•ã€CASæ“ä½œã€ä¹è§‚é”ç®—æ³• æ‚²è§‚é”å’Œä¹è§‚é”çš„æ¯”è¾ƒ æ‚²è§‚é”æ¯”ä¹è§‚é”çš„æ€§èƒ½ä½ï¼šæ‚²è§‚é”éœ€è¦å…ˆåŠ é”å†æ“ä½œï¼Œè€Œä¹è§‚é”ä¸éœ€è¦åŠ é”ï¼Œæ‰€ä»¥ä¹è§‚é”é€šå¸¸å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ æ‚²è§‚é”æ¯”ä¹è§‚é”çš„å†²çªå¤„ç†èƒ½åŠ›ä½ï¼šæ‚²è§‚é”åœ¨å†²çªå‘ç”Ÿæ—¶ç›´æ¥é˜»å¡å…¶ä»–çº¿ç¨‹ï¼Œä¹è§‚é”åˆ™æ˜¯åœ¨æäº¤é˜¶æ®µæ£€æŸ¥å†²çªå¹¶è¿›è¡Œé‡è¯•ã€‚ æ‚²è§‚é”æ¯”ä¹è§‚é”çš„å¹¶å‘åº¦ä½ï¼šæ‚²è§‚é”å­˜åœ¨é”ç²’åº¦è¾ƒå¤§çš„é—®é¢˜ï¼Œå¯èƒ½ä¼šé™åˆ¶å¹¶å‘æ€§èƒ½ï¼›è€Œä¹è§‚é”å¯ä»¥å®ç°è¾ƒé«˜çš„å¹¶å‘åº¦ã€‚ åº”ç”¨åœºæ™¯ï¼šä¸¤è€…éƒ½æ˜¯äº’æ–¥é”ï¼Œæ‚²è§‚é”é€‚åˆå†™å…¥æ“ä½œè¾ƒå¤šã€å†²çªé¢‘ç¹çš„åœºæ™¯ï¼›ä¹è§‚é”é€‚åˆè¯»å–æ“ä½œè¾ƒå¤šã€å†²çªè¾ƒå°‘çš„åœºæ™¯ã€‚ æ‹“å±•ï¼šCAS CASï¼ˆCompare and Swapï¼‰æ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹ä¸­å¸¸ç”¨çš„åŸå­æ“ä½œï¼Œç”¨äºè§£å†³å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚å®ƒæ˜¯ä¹è§‚é”ç®—æ³•çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ CASæ“ä½œåŒ…å«ä¸‰ä¸ªå‚æ•°ï¼šå†…å­˜åœ°å€Vã€æ—§çš„é¢„æœŸå€¼Aå’Œæ–°çš„å€¼Bã€‚CASçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š æ¯”è¾ƒï¼ˆCompareï¼‰ï¼šå°†å†…å­˜åœ°å€Vä¸­çš„å€¼ä¸é¢„æœŸå€¼Aè¿›è¡Œæ¯”è¾ƒã€‚ åˆ¤æ–­ï¼ˆJudgmentï¼‰ï¼šå¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜å½“å‰å€¼å’Œé¢„æœŸå€¼ç›¸ç­‰ï¼Œè¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿå…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹ã€‚ äº¤æ¢ï¼ˆSwapï¼‰ï¼šä½¿ç”¨æ–°çš„å€¼Bæ¥æ›´æ–°å†…å­˜åœ°å€Vä¸­çš„å€¼ã€‚ CASæ“ä½œæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ„å‘³ç€åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ã€‚å¦‚æœCASæ“ä½œå¤±è´¥ï¼ˆå³å½“å‰å€¼ä¸é¢„æœŸå€¼ä¸ç›¸ç­‰ï¼‰ï¼Œé€šå¸¸ä¼šè¿›è¡Œé‡è¯•ï¼Œç›´åˆ°CASæ“ä½œæˆåŠŸä¸ºæ­¢ã€‚ CASæ“ä½œé€‚ç”¨äºç²¾ç»†ç²’åº¦çš„å¹¶å‘æ§åˆ¶ï¼Œå¯ä»¥é¿å…ä½¿ç”¨ä¼ ç»Ÿçš„åŠ é”æœºåˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€å’Œçº¿ç¨‹é˜»å¡ã€‚ç„¶è€Œï¼ŒCASæ“ä½œä¹Ÿå­˜åœ¨ä¸€äº›é™åˆ¶å’Œæ³¨æ„äº‹é¡¹ï¼š ABAé—®é¢˜ï¼šCASæ“ä½œæ— æ³•æ„ŸçŸ¥åˆ°å¯¹è±¡å€¼ä»Aå˜ä¸ºBåˆå˜å›Açš„æƒ…å†µï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ä¸ºäº†è§£å†³ABAé—®é¢˜ï¼Œå¯ä»¥å¼•å…¥ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ç­‰æœºåˆ¶ã€‚ è‡ªæ—‹å¼€é”€ï¼šå½“CASæ“ä½œå¤±è´¥æ—¶ï¼Œéœ€è¦ä¸æ–­åœ°è¿›è¡Œé‡è¯•ï¼Œä¼šå ç”¨CPUèµ„æºã€‚å¦‚æœé‡è¯•æ¬¡æ•°è¿‡å¤šæˆ–è€…çº¿ç¨‹äº‰ç”¨æ¿€çƒˆï¼Œå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚ å¹¶å‘æ€§é™åˆ¶ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€å†…å­˜åœ°å€è¿›è¡ŒCASæ“ä½œï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„CASæ“ä½œä¼šæˆåŠŸï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦é‡è¯•æˆ–æ”¾å¼ƒæ“ä½œã€‚ åœ¨Javaä¸­ï¼Œæä¾›äº†ç›¸å…³çš„CASæ“ä½œæ”¯æŒï¼Œå¦‚AtomicIntegerã€AtomicLongã€AtomicReferenceç­‰ç±»ï¼Œå¯ä»¥å®ç°åŸºäºCASæ“ä½œçš„çº¿ç¨‹å®‰å…¨æ“ä½œã€‚ ä¹è§‚é”è§£å†³ä¸€äººå¤šå•è¶…å–é—®é¢˜ CASæ³•ç±»ä¼¼ä¸ç‰ˆæœ¬å·æ³•ï¼Œä½†æ˜¯ä¸éœ€è¦å¦å¤–åœ¨æ·»åŠ ä¸€ä¸ª version å­—æ®µï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨åº“å­˜æ›¿ä»£ç‰ˆæœ¬å·ï¼Œçº¿ç¨‹1æŸ¥è¯¢å®Œåº“å­˜åè¿›è¡Œåº“å­˜æ‰£å‡æ“ä½œï¼Œçº¿ç¨‹2åœ¨æŸ¥è¯¢åº“å­˜æ—¶ï¼Œå‘ç°åº“å­˜å……è¶³ï¼Œä¹Ÿå‡†å¤‡æ‰§è¡Œåº“å­˜æ‰£å‡æ“ä½œï¼Œä½†æ˜¯éœ€è¦åˆ¤æ–­å½“å‰çš„åº“å­˜æ˜¯å¦æ˜¯ä¹‹å‰æŸ¥è¯¢æ—¶çš„åº“å­˜ï¼Œç»“æœå‘ç°åº“å­˜æ•°é‡å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™å°±è¯´æ˜æ•°æ®åº“ä¸­çš„æ•°æ®å·²ç»å‘ç”Ÿäº†ä¿®æ”¹ï¼Œéœ€è¦è¿›è¡Œé‡è¯•ï¼ˆæˆ–è€…ç›´æ¥æŠ›å¼‚å¸¸ä¸­æ–­ï¼‰ qps200ï¼Œå¼‚å¸¸90%ï¼Œååé‡1652.9 è¿™åˆæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿè¿™å°±æ˜¯ä¹è§‚é”çš„å¼Šç«¯ï¼Œæˆ‘ä»¬åªè¦å‘ç°æ•°æ®ä¿®æ”¹å°±ç›´æ¥ç»ˆæ­¢æ“ä½œäº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹åˆ¤æ–­æ¡ä»¶ï¼Œå³åªè¦åº“å­˜å¤§äº0å°±å¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸æ˜¯åº“å­˜æ•°æ®ä¿®æ”¹æˆ‘ä»¬å°±ç»ˆæ­¢æ“ä½œ 12345// 5ã€ç§’æ€åˆ¸åˆæ³•ï¼Œåˆ™ç§’æ€åˆ¸æŠ¢è´­æˆåŠŸï¼Œç§’æ€åˆ¸åº“å­˜æ•°é‡å‡ä¸€boolean flag = seckillVoucherService.update(new LambdaUpdateWrapper&lt;SeckillVoucher&gt;() .eq(SeckillVoucher::getVoucherId, voucherId) .gt(SeckillVoucher::getStock, 0) .setSql(&quot;stock = stock -1&quot;)); æ‰§è¡Œå®Œä¹‹ååº“å­˜æ°å¥½ä¸º0ï¼Œè®¢å•è¡¨ä¸­æ°å¥½æ˜¯ä¸€ç™¾æ¡ 4ã€å•ä½“ä¸‹ä¸€äººä¸€å•é—®é¢˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445@Override @Transactional public Result seckillVocher(Long voucherId) &#123; // 1ã€æŸ¥è¯¢ç§’æ€åˆ¸ SeckillVoucher voucher = seckillVoucherService.getById(voucherId); log.info(&quot;å½“å‰ç§’æ€åˆ¸&quot;); // 2ã€åˆ¤æ–­ç§’æ€åˆ¸æ˜¯å¦åˆæ³• if (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123; // ç§’æ€åˆ¸çš„å¼€å§‹æ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å return Result.fail(&quot;ç§’æ€å°šæœªå¼€å§‹&quot;); &#125; if (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123; // ç§’æ€åˆ¸çš„ç»“æŸæ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å‰ return Result.fail(&quot;ç§’æ€å·²ç»“æŸ&quot;); &#125; if (voucher.getStock() &lt; 1) &#123; return Result.fail(&quot;ç§’æ€åˆ¸å·²æŠ¢ç©º&quot;); &#125; // 3ã€åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç¬¬ä¸€å• int count = this.count(new LambdaQueryWrapper&lt;VoucherOrder&gt;() .eq(VoucherOrder::getUserId, UserHolder.getUser().getId())); if (count &gt;= 1) &#123; // å½“å‰ç”¨æˆ·ä¸æ˜¯ç¬¬ä¸€å• return Result.fail(&quot;ç”¨æˆ·å·²è´­ä¹°&quot;); &#125; // 4ã€ç”¨æˆ·æ˜¯ç¬¬ä¸€å•ï¼Œå¯ä»¥ä¸‹å•ï¼Œç§’æ€åˆ¸åº“å­˜æ•°é‡å‡ä¸€ boolean flag = seckillVoucherService.update(new LambdaUpdateWrapper&lt;SeckillVoucher&gt;() .eq(SeckillVoucher::getVoucherId, voucherId) .gt(SeckillVoucher::getStock, 0) .setSql(&quot;stock = stock -1&quot;)); if (!flag) &#123; throw new RuntimeException(&quot;ç§’æ€åˆ¸æ‰£å‡å¤±è´¥&quot;); &#125; // 6ã€ç§’æ€æˆåŠŸï¼Œåˆ›å»ºå¯¹åº”çš„è®¢å•ï¼Œå¹¶ä¿å­˜åˆ°æ•°æ®åº“ VoucherOrder voucherOrder = new VoucherOrder(); long orderId = redisIdWorker.nextId(&quot;order&quot;); voucherOrder.setId(orderId); voucherOrder.setUserId(UserHolder.getUser().getId()); voucherOrder.setVoucherId(voucherOrder.getId()); save(voucherOrder); // è¿”å›è®¢å•id return Result.ok(orderId); &#125; ç°åœ¨æ˜¯ä¸æ˜¯å¯ä»¥æˆåŠŸå®Œæˆäº†ä¸€äººä¸€å•çš„è¦æ±‚å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥ä½¿ç”¨ Jmeter æµ‹ä¸€ä¸‹å§ é€šè¿‡æµ‹è¯•ï¼Œå‘ç°å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬æƒ³è±¡ä¸­çš„ç›®æ ‡ï¼Œä¸€ä¸ªäººåªèƒ½è´­ä¹°ä¸€æ¬¡ï¼Œä½†æ˜¯å‘ç°ä¸€ä¸ªç”¨æˆ·å±…ç„¶èƒ½å¤Ÿè´­ä¹°10æ¬¡ã€‚è¿™è¯´æ˜è¿˜æ˜¯å­˜åœ¨è¶…å–é—®é¢˜ï¼ é—®é¢˜åŸå› ï¼šå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å’Œå‰é¢åº“å­˜ä¸ºè´Ÿæ•°æ•°çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œçº¿ç¨‹1æŸ¥è¯¢å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è®¢å•ï¼Œå½“å‰ç”¨æˆ·æ²¡æœ‰è®¢å•å‡†å¤‡ä¸‹å•ï¼Œæ­¤æ—¶çº¿ç¨‹2ä¹ŸæŸ¥è¯¢å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è®¢å•ï¼Œç”±äºçº¿ç¨‹1è¿˜æ²¡æœ‰å®Œæˆä¸‹å•æ“ä½œï¼Œçº¿ç¨‹2åŒæ ·å‘ç°å½“å‰ç”¨æˆ·æœªä¸‹å•ï¼Œä¹Ÿå‡†å¤‡ä¸‹å•ï¼Œè¿™æ ·æ˜æ˜ä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€å•ï¼Œç»“æœä¸‹äº†ä¸¤å•ï¼Œä¹Ÿå°±å‡ºç°äº†è¶…å–é—®é¢˜ è§£å†³æ–¹æ¡ˆï¼šä¸€èˆ¬è¿™ç§è¶…å–é—®é¢˜å¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆ æ‚²è§‚é” ä¹è§‚é” æ‚²è§‚é”è§£å†³è¶…å–é—®é¢˜ ä¹è§‚é”éœ€è¦åˆ¤æ–­æ•°æ®æ˜¯å¦ä¿®æ”¹ï¼Œè€Œå½“å‰æ˜¯åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥æ— æ³•åƒè§£å†³åº“å­˜è¶…å–ä¸€æ ·ä½¿ç”¨CASæœºåˆ¶ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æ³•ï¼Œä½†æ˜¯ç‰ˆæœ¬å·æ³•éœ€è¦æ–°å¢ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå°±ç›´æ¥æ¼”ç¤ºä½¿ç”¨æ‚²è§‚é”è§£å†³è¶…å–é—®é¢˜ ä»£ç è¿™é‡Œæ³¨æ„ï¼ŒseckillVocherä¸Šé¢çš„@Transactionalè¦å»æ‰ï¼Œç„¶åè¦åŠ ä¸€ä¸ªä¾èµ–ï¼Œå¯åŠ¨ç±»ä¸ŠåŠ ä¸Šä¸€ä¸ªæ³¨è§£@EnableAspectJAutoProxy(exposeProxy = true) 12345&lt;dependency&gt; &lt;groupId&gt;org.aspectj&lt;/groupId&gt; &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt; &lt;version&gt;1.9.21&lt;/version&gt; &lt;/dependency&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Override public Result seckillVocher(Long voucherId) &#123; // 1ã€æŸ¥è¯¢ç§’æ€åˆ¸ SeckillVoucher voucher = seckillVoucherService.getById(voucherId); log.info(&quot;å½“å‰ç§’æ€åˆ¸&quot;); // 2ã€åˆ¤æ–­ç§’æ€åˆ¸æ˜¯å¦åˆæ³• if (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123; // ç§’æ€åˆ¸çš„å¼€å§‹æ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å return Result.fail(&quot;ç§’æ€å°šæœªå¼€å§‹&quot;); &#125; if (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123; // ç§’æ€åˆ¸çš„ç»“æŸæ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å‰ return Result.fail(&quot;ç§’æ€å·²ç»“æŸ&quot;); &#125; if (voucher.getStock() &lt; 1) &#123; return Result.fail(&quot;ç§’æ€åˆ¸å·²æŠ¢ç©º&quot;); &#125; // 3ã€åˆ›å»ºè®¢å• Long userId = UserHolder.getUser().getId(); synchronized (userId.toString().intern()) &#123; // åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨ç¬¬ä¸‰æ–¹äº‹åŠ¡æ–¹æ³•ï¼Œ é˜²æ­¢äº‹åŠ¡å¤±æ•ˆ IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy(); return proxy.createVoucherOrder(userId, voucherId); &#125; &#125; /** * åˆ›å»ºè®¢å• * * @param userId * @param voucherId * @return */ @Transactional public Result createVoucherOrder(Long userId, Long voucherId) &#123;// synchronized (userId.toString().intern()) &#123; // 1ã€åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç¬¬ä¸€å• int count = this.count(new LambdaQueryWrapper&lt;VoucherOrder&gt;() .eq(VoucherOrder::getUserId, userId)); if (count &gt;= 1) &#123; // å½“å‰ç”¨æˆ·ä¸æ˜¯ç¬¬ä¸€å• return Result.fail(&quot;ç”¨æˆ·å·²è´­ä¹°&quot;); &#125; // 2ã€ç”¨æˆ·æ˜¯ç¬¬ä¸€å•ï¼Œå¯ä»¥ä¸‹å•ï¼Œç§’æ€åˆ¸åº“å­˜æ•°é‡å‡ä¸€ boolean flag = seckillVoucherService.update(new LambdaUpdateWrapper&lt;SeckillVoucher&gt;() .eq(SeckillVoucher::getVoucherId, voucherId) .gt(SeckillVoucher::getStock, 0) .setSql(&quot;stock = stock -1&quot;)); if (!flag) &#123; throw new RuntimeException(&quot;ç§’æ€åˆ¸æ‰£å‡å¤±è´¥&quot;); &#125; // 3ã€åˆ›å»ºå¯¹åº”çš„è®¢å•ï¼Œå¹¶ä¿å­˜åˆ°æ•°æ®åº“ VoucherOrder voucherOrder = new VoucherOrder(); long orderId = redisIdWorker.nextId(&quot;order&quot;); voucherOrder.setId(orderId); voucherOrder.setUserId(UserHolder.getUser().getId()); voucherOrder.setVoucherId(voucherOrder.getId()); flag = this.save(voucherOrder); if (!flag) &#123; throw new RuntimeException(&quot;åˆ›å»ºç§’æ€åˆ¸è®¢å•å¤±è´¥&quot;); &#125; // 4ã€è¿”å›è®¢å•id return Result.ok(orderId); &#125; TODOè¿™é‡Œä»£ç çš„å®ç°ç»†èŠ‚æœ‰ç‚¹çœ‹ä¸æ‡‚ï¼ˆä»¥ä¸‹å†…å®¹çœ‹çš„åˆ«äººçš„æ€»ç»“ï¼Œè¿™é‡Œå›å¤´å†çœ‹çœ‹ é”çš„èŒƒå›´å°½é‡å°ã€‚synchronizedå°½é‡é”ä»£ç å—ï¼Œè€Œä¸æ˜¯æ–¹æ³•ï¼Œé”çš„èŒƒå›´è¶Šå¤§æ€§èƒ½è¶Šä½ é”çš„å¯¹è±¡ä¸€å®šè¦æ˜¯ä¸€ä¸ªä¸å˜çš„å€¼ã€‚æˆ‘ä»¬ä¸èƒ½ç›´æ¥é” Long ç±»å‹çš„ userIdï¼Œæ¯è¯·æ±‚ä¸€æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ userId å¯¹è±¡ï¼Œsynchronized è¦é”ä¸å˜çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°† Long ç±»å‹çš„ userId é€šè¿‡ toString()æ–¹æ³•è½¬æˆ String ç±»å‹çš„ userIdï¼ŒtoString()æ–¹æ³•åº•å±‚ï¼ˆå¯ä»¥ç‚¹å‡»å»çœ‹æºç ï¼‰æ˜¯ç›´æ¥ new ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œæ˜¾ç„¶è¿˜æ˜¯åœ¨å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨ intern() æ–¹æ³•ä»å¸¸é‡æ± ä¸­å¯»æ‰¾ä¸å½“å‰ å­—ç¬¦ä¸²å€¼ä¸€è‡´çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè¿™å°±èƒ½å¤Ÿä¿éšœä¸€ä¸ªç”¨æˆ· å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚çš„ userId éƒ½æ˜¯ä¸å˜çš„ï¼Œä»è€Œèƒ½å¤Ÿå®Œæˆé”çš„æ•ˆæœï¼ˆå¹¶è¡Œå˜ä¸²è¡Œï¼‰ æˆ‘ä»¬è¦é”ä½æ•´ä¸ªäº‹åŠ¡ï¼Œè€Œä¸æ˜¯é”ä½äº‹åŠ¡å†…éƒ¨çš„ä»£ç ã€‚å¦‚æœæˆ‘ä»¬é”ä½äº‹åŠ¡å†…éƒ¨çš„ä»£ç ä¼šå¯¼è‡´å…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥äº‹åŠ¡ï¼Œå½“æˆ‘ä»¬äº‹åŠ¡è¿˜æœªæäº¤ï¼Œé”ä¸€æ—¦é‡Šæ”¾ï¼Œä»ç„¶ä¼šå­˜åœ¨è¶…å–é—®é¢˜ Springçš„@Transactionalæ³¨è§£è¦æƒ³äº‹åŠ¡ç”Ÿæ•ˆï¼Œå¿…é¡»ä½¿ç”¨åŠ¨æ€ä»£ç†ã€‚Serviceä¸­ä¸€ä¸ªæ–¹æ³•ä¸­è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œå¦ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨äº†äº‹åŠ¡ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´@Transactionalå¤±æ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä½¿ç”¨ä»£ç†å¯¹è±¡æ¥è°ƒç”¨æ–¹æ³•ã€‚ æ€»ç»“ï¼š é¦–å…ˆç”¨å…¨å±€å”¯ä¸€idä»£è¡¨ä¼˜æƒ åˆ¸çš„ä¸‹å•è®¢å•å·ã€‚å¦‚æœä¸€ä¸ªäººå¯ä»¥ä¹°å¤šå•çš„æƒ…å†µä¸‹ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¼šå‡ºç°è¶…å–æƒ…å†µï¼Œæ­¤æ—¶ç”¨ä¹è§‚é”çš„casæ¥å®ç°é˜²æ­¢è¶…å–ã€‚ç„¶åæ˜¯å•ä½“çš„ä¸€äººä¸€å•ï¼Œè¿™é‡Œå°±æ˜¯ä¸‹å•å‰éœ€è¦éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ä¸‹å•äº†ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœç¡¬è¦ç”¨ä¹è§‚é”ï¼Œä½¿ç”¨ç‰ˆæœ¬å·æ³•éœ€è¦åŠ ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥ç”¨çš„æ˜¯æ‚²è§‚é”ã€‚ä½†å¦‚æœåœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œç”±äºé”ä¾èµ–äºjvmå†…éƒ¨çš„ç›‘è§†å™¨ï¼Œå¦‚æœæ˜¯å¤šå°æœºå™¨ï¼Œæ¯ä¸ªæœºå™¨å†…éƒ¨çš„é”åªèƒ½é”ä½è‡ªå·±è¿™ä¸ªè¿›ç¨‹çš„ï¼Œæ‰€ä»¥è¦ç”¨åˆ†å¸ƒå¼é”äº†ã€‚ å››ã€åˆ†å¸ƒå¼é”ç”±äºsynchronizedæ˜¯æœ¬åœ°é”ï¼Œåªèƒ½æä¾›çº¿ç¨‹çº§åˆ«çš„åŒæ­¥ï¼Œæ¯ä¸ªJVMä¸­éƒ½æœ‰ä¸€æŠŠsynchronizedé”ï¼Œä¸èƒ½è·¨ JVM è¿›è¡Œä¸Šé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¢« synchronized å…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶ï¼Œå®ƒä¼šå°è¯•è·å–å¯¹è±¡çš„å†…ç½®é”ï¼ˆä¹Ÿç§°ä¸ºç›‘è§†å™¨é”ï¼‰ã€‚å¦‚æœè¯¥é”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œä»£ç ï¼›å¦åˆ™ï¼Œå½“å‰çº¿ç¨‹å°†è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ã€‚è€Œç°åœ¨æˆ‘ä»¬æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ„å‘³ç€æœ‰ä¸¤ä¸ªJVMï¼Œæ‰€ä»¥synchronizedä¼šå¤±æ•ˆï¼ä»è€Œå‡ºç°è¶…å–é—®é¢˜ï¼š åˆ†å¸ƒå¼é”çš„å¸¸è§å®ç° åŸºäºå…³ç³»æ•°æ®åº“ï¼šå¯ä»¥åˆ©ç”¨æ•°æ®åº“çš„äº‹åŠ¡ç‰¹æ€§å’Œå”¯ä¸€ç´¢å¼•æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚é€šè¿‡å‘æ•°æ®åº“æ’å…¥ä¸€æ¡å…·æœ‰å”¯ä¸€çº¦æŸçš„è®°å½•ä½œä¸ºé”ï¼Œå…¶ä»–è¿›ç¨‹åœ¨è·å–é”æ—¶ä¼šå—åˆ°æ•°æ®åº“çš„å¹¶å‘æ§åˆ¶æœºåˆ¶é™åˆ¶ã€‚ åŸºäºç¼“å­˜ï¼ˆå¦‚Redisï¼‰ï¼šä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡ï¼ˆå¦‚Redisï¼‰æä¾›çš„åŸå­æ“ä½œæ¥å®ç°åˆ†å¸ƒå¼é”ã€‚é€šè¿‡å°†é”ä¿¡æ¯å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå…¶ä»–è¿›ç¨‹å¯ä»¥é€šè¿‡æ£€æŸ¥ç¼“å­˜ä¸­çš„é”çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è·å–é”ã€‚ åŸºäºZooKeeperï¼šZooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¯ä»¥ç”¨äºå®ç°åˆ†å¸ƒå¼é”ã€‚é€šè¿‡åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„èŠ‚ç‚¹ï¼Œå¹¶æ£€æŸ¥è‡ªå·±æ˜¯å¦æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºè·å–åˆ°äº†é”ã€‚ ä»æ€§èƒ½è§’åº¦ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š ç¼“å­˜ &gt; Zookeeper &gt; æ•°æ®åº“ ä»å¯é æ€§è§’åº¦ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š Zookeeper &gt; ç¼“å­˜ &gt; æ•°æ®åº“ setnxæŒ‡ä»¤çš„ç‰¹ç‚¹ï¼šsetnxåªèƒ½è®¾ç½®keyä¸å­˜åœ¨çš„å€¼ï¼Œå€¼ä¸å­˜åœ¨è®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ï¼›å€¼å­˜åœ¨è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 è·å–é” 12# æ·»åŠ é”set [key] [value] ex [time] nx é‡Šæ”¾é” 12# é‡Šæ”¾é”ï¼ˆé™¤äº†ä½¿ç”¨delæ‰‹åŠ¨é‡Šæ”¾ï¼Œè¿˜å¯è¶…æ—¶é‡Šæ”¾ï¼‰del [key] 1ã€åŸºäºrediså®ç°çš„åˆ†å¸ƒå¼é”åˆ›å»ºåˆ†å¸ƒå¼é” 12345678910111213public interface ILock &#123; /** * å°è¯•è·å–é” * @param timeoutSec é”æŒæœ‰çš„æ—¶é—´ï¼Œè¿‡æœŸåè‡ªåŠ¨é‡Šæ”¾ * @return true trueä»£è¡¨è·å–é”æˆåŠŸï¼Œåä¹‹ä»£è¡¨å¤±è´¥ */ boolean tryLock(long timeoutSec); /** * é‡Šæ”¾é” */ void unlock();&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142public class SimpleRedisLock implements ILock &#123; /** * RedisTemplate */ private StringRedisTemplate stringRedisTemplate; /** * é”çš„åç§° */ private String name; public SimpleRedisLock(StringRedisTemplate stringRedisTemplate, String name) &#123; this.stringRedisTemplate = stringRedisTemplate; this.name = name; &#125; /** * è·å–é” * * @param timeoutSec è¶…æ—¶æ—¶é—´ * @return */ @Override public boolean tryLock(long timeoutSec) &#123; String id = Thread.currentThread().getId() + &quot;&quot;; // SET lock:name id EX timeoutSec NX Boolean result = stringRedisTemplate.opsForValue() .setIfAbsent(&quot;lock:&quot; + name, id, timeoutSec, TimeUnit.SECONDS); return Boolean.TRUE.equals(result); &#125; /** * é‡Šæ”¾é” */ @Override public void unlock() &#123; stringRedisTemplate.delete(&quot;lock:&quot; + name); &#125;&#125; ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼šæ”¹é€ å‰é¢VoucherOrderServiceImplä¸­çš„ä»£ç ï¼Œå°†ä¹‹å‰ä½¿ç”¨sychronizedé”çš„åœ°æ–¹ï¼Œæ”¹æˆæˆ‘ä»¬è‡ªå·±å®ç°çš„åˆ†å¸ƒå¼é”ï¼š 1234567891011121314Long userId = UserHolder.getUser().getId(); SimpleRedisLock lock = new SimpleRedisLock(stringRedisTemplate, &quot;order:&quot; + userId); boolean isLock = lock.tryLock(1200); if (!isLock) &#123; // ç´¢å–é”å¤±è´¥ï¼Œé‡è¯•æˆ–è€…ç›´æ¥æŠ›å¼‚å¸¸ï¼ˆè¿™ä¸ªä¸šåŠ¡æ˜¯ä¸€äººä¸€å•ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ï¼‰ return Result.fail(&quot;ä¸€äººåªèƒ½ä¸‹ä¸€å•&quot;); &#125; try &#123; // ç´¢å–é”æˆåŠŸï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨ç¬¬ä¸‰æ–¹äº‹åŠ¡æ–¹æ³•ï¼Œ é˜²æ­¢äº‹åŠ¡å¤±æ•ˆ IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy(); return proxy.createVoucherOrder(userId, voucherId); &#125; finally &#123; lock.unlock(); &#125; ç„¶åç”¨apifoxå‘é€ä¸¤ä¸ªè¯·æ±‚ å¯ä»¥çœ‹åˆ°8081ç«¯å£ä¸ºfalseï¼Œ8082ç«¯å£ä¸ºtrue è¿™é‡Œé‡åˆ°äº†ä¸€ä¸ªbugï¼Œå°±æ˜¯æ‰“äº†æ–­ç‚¹ä½†æ˜¯å˜é‡é‚£é‡Œçœ‹ä¸åˆ°ï¼Œæ ¹æœ¬å°±æ²¡æœ‰è¿›å…¥æ–­ç‚¹ã€‚æœ€åå‘ç°æ˜¯apifoxå‘é€çš„è¯·æ±‚ä¸­ï¼Œæºå¸¦ç™»å½•tokençš„å‚æ•°Authorizationåº”è¯¥æ˜¯æ”¾åœ¨headerä¸­ï¼Œæˆ‘ä¸€å¼€å§‹æ”¾åœ¨äº†paramsä¸­ 2ã€åˆ†å¸ƒå¼é”ä¼˜åŒ–1â€”â€”è§£å†³é‡Šæ”¾ä¸å±äºè‡ªå·±é”çš„é—®é¢˜ ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“çº¿ç¨‹1è·å–é”åï¼Œç”±äºä¸šåŠ¡é˜»å¡ï¼Œçº¿ç¨‹1çš„é”è¶…æ—¶é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™çº¿ç¨‹2è¶è™šè€Œå…¥æ‹¿åˆ°äº†é”ï¼Œç„¶åæ­¤æ—¶çº¿ç¨‹1ä¸šåŠ¡å®Œæˆäº†ï¼Œç„¶åæŠŠçº¿ç¨‹2åˆšåˆšè·å–çš„é”ç»™é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™çº¿ç¨‹3åˆè¶è™šè€Œå…¥æ‹¿åˆ°äº†é”ï¼Œè¿™å°±å¯¼è‡´åˆå‡ºç°äº†è¶…å–é—®é¢˜ï¼ï¼ˆä½†æ˜¯è¿™ä¸ªåœ¨å°é¡¹ç›®ï¼ˆå¹¶å‘æ•°ä¸é«˜ï¼‰ä¸­å‡ºç°çš„æ¦‚ç‡æ¯”è¾ƒä½ï¼Œåœ¨å¤§å‹é¡¹ç›®ï¼ˆå¹¶å‘æ•°é«˜ï¼‰æƒ…å†µä¸‹æ˜¯æœ‰ä¸€å®šæ¦‚ç‡çš„ï¼‰ å¤‡æ³¨ï¼šæˆ‘ä»¬å¯ä»¥æŠŠé”çš„æœ‰æ•ˆæœŸé™ä½ä¸€ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæµ‹è¯•ä¸Šé¢å“ªç§æƒ…å†µäº†(â—â€™â—¡â€™â—) å¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬ä¸ºåˆ†å¸ƒå¼é”æ·»åŠ ä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ï¼Œåœ¨é‡Šæ”¾é”æ—¶åˆ¤æ–­å½“å‰é”æ˜¯å¦æ˜¯è‡ªå·±çš„é”ï¼Œæ˜¯è‡ªå·±çš„å°±ç›´æ¥é‡Šæ”¾ï¼Œä¸æ˜¯è‡ªå·±çš„å°±ä¸é‡Šæ”¾é”ï¼Œä»è€Œè§£å†³å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—é”çš„æƒ…å†µå¯¼è‡´å‡ºç°è¶…å– 3ã€åˆ†å¸ƒå¼é”ä¼˜åŒ–2â€”â€”é‡Šæ”¾é”æ—¶çš„åŸå­æ€§é—®é¢˜ã€‚è¯´åˆ°åº•ä¹Ÿæ˜¯é”è¶…æ—¶é‡Šæ”¾çš„é—®é¢˜ åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»™é”æ·»åŠ ä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ï¼Œå¹¶ä¸”åœ¨é‡Šæ”¾é”æ—¶æ·»åŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œä»è€Œé˜²æ­¢é”è¶…æ—¶é‡Šæ”¾äº§ç”Ÿçš„è¶…å–é—®é¢˜ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¶…å–é—®é¢˜ï¼Œä½†æ˜¯ä»æœ‰å¯èƒ½å‘ç”Ÿè¶…å–é—®é¢˜ï¼ˆå‡ºç°è¶…å–æ¦‚ç‡æ›´ä½äº†ï¼‰ï¼šå½“çº¿ç¨‹1è·å–é”ï¼Œæ‰§è¡Œå®Œä¸šåŠ¡ç„¶åå¹¶ä¸”åˆ¤æ–­å®Œå½“å‰é”æ˜¯è‡ªå·±çš„é”æ—¶ï¼Œä½†å°±åœ¨æ­¤æ—¶å‘ç”Ÿäº†é˜»å¡ï¼Œç»“æœé”è¢«è¶…æ—¶é‡Šæ”¾äº†ï¼Œçº¿ç¨‹2ç«‹é©¬å°±è¶è™šè€Œå…¥äº†ï¼Œè·å¾—é”æ‰§è¡Œä¸šåŠ¡ï¼Œä½†å°±åœ¨æ­¤æ—¶çº¿ç¨‹1é˜»å¡å®Œæˆï¼Œç”±äºå·²ç»åˆ¤æ–­è¿‡é”ï¼Œå·²ç»ç¡®å®šé”æ˜¯è‡ªå·±çš„é”äº†ï¼Œäºæ˜¯ç›´æ¥å°±åˆ é™¤äº†é”ï¼Œç»“æœåˆ çš„æ˜¯çº¿ç¨‹2çš„é”ï¼Œè¿™å°±åˆå¯¼è‡´çº¿ç¨‹3è¶è™šè€Œå…¥äº†ï¼Œä»è€Œç»§ç»­å‘ç”Ÿè¶…å–é—®é¢˜ å¤‡æ³¨ï¼šæˆ‘ä»¬å¯ä»¥åœ¨åˆ¤æ–­åˆ é™¤é”çš„é‚£è¡Œä»£ç ä¸Šæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åuser1å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè·å–é”ï¼Œæ‰‹åŠ¨æŠŠé”åˆ äº†ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶é‡Šæ”¾ï¼Œç„¶åä½¿ç”¨user2å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒæˆåŠŸè·å–é”ï¼Œä»è€Œæ¨¡æ‹Ÿä¸Šè¯‰è¿‡ç¨‹ï¼Œæ£€éªŒè¶…å–é—®é¢˜ PSï¼šè™½ç„¶è¿™ä¸ªæƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡è¾ƒä½ï¼Œä½†æ˜¯æ ¹æ®å¢¨è²å®šå¾‹ï¼Œæˆ‘ä»¬æœ€å¥½ä¸è¦æŠ±æœ‰ä¾¥å¹¸å¿ƒç†ï¼Œä¸ç„¶æœ€ç»ˆæˆ‘ä»¬ä¼šåœ¨è¿™ä¸ªç»†å¾®çš„é—®é¢˜ä¸Šä»˜è¯¸æ²‰é‡çš„ä»£ä»·ï¼ä½ å¯èƒ½è¿˜ä¼šæƒ³ï¼Œåˆ¤æ–­é”å’Œé‡Šæ”¾é”åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”ä¸¤è€…ä¹‹é—´æ²¡æœ‰åˆ«çš„ä»£ç ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿé˜»å¡å‘¢ï¼ŸJVMçš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šå¯¼è‡´çŸ­æš‚çš„é˜»å¡ï¼ˆæˆ‘ä¸ªäººæ„Ÿè§‰è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡çœŸçš„ä¸é«˜ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ²¡æœ‰å®é™…æ¥è§¦è¿‡çœŸæ­£çš„å¤§å‹é«˜å¹¶å‘é¡¹ç›®ï¼Œæ‰€ä»¥å…·ä½“ä¹Ÿåªèƒ½é æ£æ‘©ï¼‰ é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä¿éšœ åˆ¤æ–­é” å’Œ é‡Šæ”¾é” è¿™è¿æ®µä»£ç çš„åŸå­æ€§å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨Luaè„šæœ¬ 4ã€Redissonç»è¿‡ä¼˜åŒ–1å’Œä¼˜åŒ–2ï¼Œæˆ‘ä»¬å®ç°çš„åˆ†å¸ƒå¼é”å·²ç»è¾¾åˆ°ç”Ÿäº§å¯ç”¨çº§åˆ«äº†ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿå®Œå–„ï¼Œæ¯”å¦‚ï¼š åˆ†å¸ƒå¼é”ä¸å¯é‡å…¥ï¼šä¸å¯é‡å…¥æ˜¯æŒ‡åŒä¸€çº¿ç¨‹ä¸èƒ½é‡å¤è·å–åŒä¸€æŠŠé”ã€‚æ¯”å¦‚ï¼Œæ–¹æ³•Aä¸­è°ƒç”¨æ–¹æ³•Bï¼Œæ–¹æ³•Aéœ€è¦è·å–åˆ†å¸ƒå¼é”ï¼Œæ–¹æ³•BåŒæ ·éœ€è¦è·å–åˆ†å¸ƒå¼é”ï¼Œçº¿ç¨‹1è¿›å…¥æ–¹æ³•Aè·å–äº†ä¸€æ¬¡é”ï¼Œè¿›å…¥æ–¹æ³•Båˆè·å–ä¸€æ¬¡é”ï¼Œç”±äºé”ä¸å¯é‡å…¥ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´æ­»é” åˆ†å¸ƒå¼é”ä¸å¯é‡è¯•ï¼šè·å–é”åªå°è¯•ä¸€æ¬¡å°±è¿”å›falseï¼Œæ²¡æœ‰é‡è¯•æœºåˆ¶ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œæ¯”å¦‚çº¿ç¨‹1è·å–é”ï¼Œç„¶åè¦å°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œä½†æ˜¯å½“å‰çš„é”è¢«çº¿ç¨‹2å ç”¨äº†ï¼Œçº¿ç¨‹1ç›´æ¥å°±ç»“æŸäº†è€Œä¸å»é‡è¯•ï¼Œè¿™å°±å¯¼è‡´æ•°æ®å‘ç”Ÿäº†ä¸¢å¤± åˆ†å¸ƒå¼é”è¶…æ—¶é‡Šæ”¾ï¼šè¶…å¸‚é‡Šæ”¾æœºæœºåˆ¶è™½ç„¶ä¸€å®šç¨‹åº¦é¿å…äº†æ­»é”å‘ç”Ÿçš„æ¦‚ç‡ï¼Œä½†æ˜¯å¦‚æœä¸šåŠ¡æ‰§è¡Œè€—æ—¶è¿‡é•¿ï¼ŒæœŸé—´é”å°±é‡Šæ”¾äº†ï¼Œè¿™æ ·å­˜åœ¨å®‰å…¨éšæ‚£ã€‚é”çš„æœ‰æ•ˆæœŸè¿‡çŸ­ï¼Œå®¹æ˜“å‡ºç°ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œå°±è¢«é‡Šæ”¾ï¼Œé”çš„æœ‰æ•ˆæœŸè¿‡é•¿ï¼Œå®¹æ˜“å‡ºç°æ­»é”ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¤§éš¾é¢˜ï¼ æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„æœ‰æ•ˆæœŸï¼Œä½†æ˜¯åŠ ä¸Šä¸€ä¸ª å¿ƒè·³æœºåˆ¶ å’Œ è‡ªåŠ¨ç»­æœŸï¼šåœ¨é”è¢«è·å–åï¼Œå¯ä»¥ä½¿ç”¨å¿ƒè·³æœºåˆ¶å¹¶è‡ªåŠ¨ç»­æœŸé”çš„æŒæœ‰æ—¶é—´ã€‚é€šè¿‡å®šæœŸå‘é€å¿ƒè·³è¯·æ±‚ï¼Œæ˜¾ç¤ºåœ°å‘ŠçŸ¥å…¶ä»–çº¿ç¨‹æˆ–ç³»ç»Ÿé”è¿˜åœ¨ä½¿ç”¨ä¸­ï¼ŒåŒæ—¶æ›´æ–°é”çš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´è¶…è¿‡äº†é¢„è®¾çš„æœ‰æ•ˆæ—¶é—´ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å°è¯•é‡æ–°è·å–é”ã€‚ ä¸»ä»ä¸€è‡´æ€§é—®é¢˜ï¼šå¦‚æœRedisæä¾›äº†ä¸»ä»é›†ç¾¤ï¼Œä¸»ä»åŒæ­¥å­˜åœ¨å»¶è¿Ÿï¼Œçº¿ç¨‹1è·å–äº†é” æˆ‘ä»¬å¦‚æœæƒ³è¦æ›´è¿›ä¸€æ­¥ä¼˜åŒ–åˆ†å¸ƒå¼é”ï¼Œå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ²¡å¿…è¦ï¼Œé™¤éæ˜¯è¿«ä¸å¾—å·²ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç»é€ å¥½çš„è½®å­ï¼Œæ¯”å¦‚ï¼šRedissonã€‚Redssionæ˜¯ä¸€ä¸ªååˆ†æˆç†Ÿçš„Redisæ¡†æ¶ï¼ŒåŠŸèƒ½ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚ï¼šåˆ†å¸ƒå¼é”å’ŒåŒæ­¥å™¨ã€åˆ†å¸ƒå¼å¯¹è±¡ã€åˆ†å¸ƒå¼é›†åˆã€åˆ†å¸ƒå¼æœåŠ¡ï¼Œå„ç§Rediså®ç°åˆ†å¸ƒå¼çš„è§£å†³æ–¹æ¡ˆã€‚ç®€è€Œè¨€ä¹‹Redissonå°±æ˜¯ä¸€ä¸ªä½¿ç”¨Redisè§£å†³åˆ†å¸ƒå¼é—®é¢˜çš„æ–¹æ¡ˆçš„é›†åˆï¼Œå½“ç„¶å®ƒä¸ä»…ä»…æ˜¯è§£å†³åˆ†å¸ƒå¼ç›¸å…³é—®é¢˜ï¼Œè¿˜åŒ…å«å…¶å®ƒçš„ä¸€äº›é—®é¢˜ã€‚ æ‰€ä»¥è¯´åˆ†å¸ƒå¼é”çš„ç©¶æä¼˜åŒ–å°±æ˜¯ä½¿ç”¨åˆ«äººé€ å¥½çš„è½®å­ğŸ¤£redissonåˆ†å¸ƒå¼é”çš„å®ç°ä½¿ç”¨ 1ï¼‰ã€å¼•å…¥ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson&lt;/artifactId&gt; &lt;version&gt;3.13.6&lt;/version&gt;&lt;/dependency&gt; 2ï¼‰ã€é…ç½®Redissonå®¢æˆ·ç«¯ 1234567891011121314151617@Configurationpublic class RedissonConfig &#123; /** * åˆ›å»ºRedissoné…ç½®å¯¹è±¡ï¼Œç„¶åäº¤ç»™IOCç®¡ç† * * @return */ @Bean public RedissonClient redissonClient() &#123; // è·å–Redissoné…ç½®å¯¹è±¡ Config config = new Config(); // æ·»åŠ redisåœ°å€ï¼Œè¿™é‡Œæ·»åŠ çš„æ˜¯å•èŠ‚ç‚¹åœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ config.userClusterServers()æ·»åŠ é›†ç¾¤åœ°å€ config.useSingleServer().setAddress(&quot;redis://192.168.200.100:6379&quot;).setPassword(&quot;123321&quot;); // è·å–RedisClientå¯¹è±¡ï¼Œå¹¶äº¤ç»™IOCè¿›è¡Œç®¡ç† return Redisson.create(config); &#125;&#125; æ¸©é¦¨æç¤ºï¼šæ­¤å¤–è¿˜æœ‰ä¸€ç§å¼•å…¥æ–¹å¼ï¼Œå¯ä»¥å¼•å…¥ redission çš„ starter ä¾èµ–ï¼Œç„¶ååœ¨ymlæ–‡ä»¶ä¸­é…ç½®Redissonï¼Œä½†æ˜¯ä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºä»–ä¼šæ›¿æ¢æ‰ Springå®˜æ–¹ æä¾›çš„è¿™å¥—å¯¹ Redisson çš„é…ç½® 3ï¼‰ã€ä¿®æ”¹ä¸€ä¸‹ä½¿ç”¨é”çš„åœ°æ–¹ï¼Œå…¶å®ƒçš„ä¸šåŠ¡ä»£ç éƒ½ä¸éœ€è¦æ”¹ 123//SimpleRedisLock lock = new SimpleRedisLock(stringRedisTemplate, &quot;order:&quot; + userId); RLock lock = redissonClient.getLock(&quot;lock:order:&quot; + userId); boolean isLock = lock.tryLock(); äº”ã€MQå¼‚æ­¥ä¼˜åŒ–æ­¤æ—¶å…ˆæµ‹ä¸€ä¸‹ä¹‹å‰åŒæ­¥çš„æ–¹å¼æ€§èƒ½å¦‚ä½• ç”¨ä¸€ä¸‹æµ‹è¯•ä»£ç ç”Ÿæˆ1000ä¸ªç™»å½•ç”¨æˆ·çš„tokenå¹¶ä¿å­˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.hmdp;import cn.hutool.core.bean.BeanUtil;import cn.hutool.core.bean.copier.CopyOptions;import com.hmdp.dto.UserDTO;import com.hmdp.entity.User;import com.hmdp.service.IUserService;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.data.redis.core.StringRedisTemplate;import javax.annotation.Resource;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.util.HashMap;import java.util.List;import java.util.Map;import java.util.UUID;import java.util.concurrent.TimeUnit;import static com.hmdp.utils.RedisConstants.LOGIN_USER_KEY;import static com.hmdp.utils.RedisConstants.LOGIN_USER_TTL;@SpringBootTestpublic class yibuTest &#123; @Resource IUserService userService; @Resource private StringRedisTemplate stringRedisTemplate; @Test public void testGetAll() &#123; List&lt;User&gt; users = userService.list();// for(User user : users)&#123;// System.out.println(user);// &#125;// System.exit(0); users.forEach( user -&gt; &#123; // 7.1,éšæœºç”Ÿæˆtoken,ä½œä¸ºç™»å½•ä»¤ç‰Œ String token = UUID.randomUUID().toString();// 7.2,å°†Userå¯¹è±¡è½¬åŒ–ä¸ºHashMapå­˜å‚¨ UserDTO userDTO = BeanUtil.copyProperties(user, UserDTO.class); File file = new File(&quot;D:\\\\code\\\\token.txt&quot;); FileOutputStream output = null; try &#123; output = new FileOutputStream(file, true); byte[] bytes = token.getBytes(); output.write(bytes); output.write(&quot;\\r\\n&quot;.getBytes()); &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; finally &#123; try &#123; output.close(); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; &#125; Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO, new HashMap&lt;&gt;(), CopyOptions.create() .setIgnoreNullValue(true) .setFieldValueEditor((fieldName, fieldValue) -&gt; fieldValue.toString()));// 7.3,å­˜å‚¨ String tokenKey = LOGIN_USER_KEY + token; stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);// 7.4,è®¾ç½®tokenæœ‰æ•ˆæœŸ stringRedisTemplate.expire(tokenKey, LOGIN_USER_TTL, TimeUnit.MINUTES); &#125; ); &#125;&#125; æ›´æ”¹ä¼˜æƒ åˆ¸æ•°é‡ä¸º200ï¼Œå¹¶æ¸…ç©ºè®¢å•è¡¨ æ³¨æ„ä¼˜æƒ åˆ¸çš„è¿‡æœŸæ—¶é—´ï¼ï¼ï¼ï¼ï¼ æ‰§è¡Œå®Œä¹‹åï¼Œåº“å­˜æ‰£å‡ä¸º0ï¼Œè®¢å•è¡¨ä¸­æ­£å¥½200æ¡è®¢å• jmeteræ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼šè¿˜æ˜¯æ¯”è¾ƒæ…¢çš„ ç¬¬äºŒæ¬¡æµ‹è¯• ç¬¬ä¸‰æ¬¡æµ‹è¯• 1ã€ä¼˜åŒ–æ€è·¯ä¹‹å‰çš„æµç¨‹å¦‚ä¸‹ï¼š 2ã€å®‰è£…rabbitMQå·²æœ‰centOS7,docker,finalshell å®‰è£…å‚è€ƒé“¾æ¥ï¼šrabbitMQå®‰è£…å‚è€ƒ å®‰è£…Erlang æˆåŠŸæˆªå›¾ rabbitmqå¯åŠ¨æˆåŠŸ å¼€å¯webç®¡ç†åŠŸèƒ½ å¼€å¯åï¼Œåœ¨æœ¬æœºè®¿é—®è™šæ‹ŸæœºipåŠ ç«¯å£å·15672å³å¯è®¿é—® ç„¶åæ˜¯åˆ›å»ºç”¨æˆ·ã€‚å› ä¸ºåœ¨finalshellå¼€å¯äº†rabbitmqåï¼Œå°±ä¸èƒ½ç»§ç»­è¾“å…¥å‘½ä»¤äº†ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘æ˜¯å…ˆåœ¨centosé‡Œé¢å¼€å¯rabbitmqï¼Œç„¶åå†åœ¨finalshellè¾“å…¥åˆ›å»ºç”¨æˆ·çš„å‘½ä»¤ã€‚æ‰§è¡Œåå¦‚ä¸‹ï¼š ç„¶åç™»å½•webç®¡ç†é¡µé¢ï¼š 3.å®ç°å¼‚æ­¥å¤„ç†çš„ä»£ç æ–°å¢ä»£ç ç»“æ„å¦‚ä¸‹ï¼š é…ç½®mqé€šä¿¡ä¸ºä¸»é¢˜æ¨¡å¼ 12345678910111213141516171819202122232425262728293031package com.hmdp.config;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.context.annotation.Bean;import org.springframework.amqp.core.TopicExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Configuration;// è¿™æ®µä»£ç ç”¨äºé…ç½® RabbitMQ çš„è¯é¢˜æ¨¡å¼ï¼ŒåŒ…æ‹¬é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œç»‘å®šã€‚ä¸‹é¢æ˜¯åŠ ä¸Šæ³¨é‡Šåçš„ä»£ç ï¼š@Configurationpublic class RabbitMQTopicConfig &#123; public static final String QUEUE = &quot;seckillQueue&quot;; // é˜Ÿåˆ—å public static final String EXCHANGE = &quot;seckillExchange&quot;; // äº¤æ¢æœºå public static final String ROUTINGKEY = &quot;seckill.lua.#&quot;; @Bean public Queue queue()&#123; return new Queue(QUEUE); &#125; @Bean public TopicExchange topicExchange()&#123; return new TopicExchange(EXCHANGE); &#125; @Bean public Binding binding()&#123; return BindingBuilder.bind(queue()).to(topicExchange()).with(ROUTINGKEY); &#125;&#125; 123456789101112131415161718192021222324252627package com.hmdp.rabbitmq;import com.hmdp.config.RabbitMQTopicConfig;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.rabbit.core.RabbitTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;/** * æ¶ˆæ¯å‘é€è€… */@Slf4j@Servicepublic class MQSender &#123; @Autowired private RabbitTemplate rabbitTemplate; private static final String ROUTINGKEY = &quot;seckill.lua.message&quot;; /** * å‘é€ç§’æ€ä¿¡æ¯ * @param msg */ public void sendSeckillMessage(String msg)&#123; log.info(&quot;å‘é€æ¶ˆæ¯&quot;+msg); rabbitTemplate.convertAndSend(RabbitMQTopicConfig.EXCHANGE,ROUTINGKEY,msg); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.hmdp.rabbitmq;import com.alibaba.fastjson.JSON;import com.hmdp.config.RabbitMQTopicConfig;import com.hmdp.entity.VoucherOrder;import com.hmdp.service.ISeckillVoucherService;import com.hmdp.service.IVoucherOrderService;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import javax.annotation.Resource;/** * æ¶ˆæ¯æ¶ˆè´¹è€… */@Slf4j@Servicepublic class MQReceiver &#123; @Resource IVoucherOrderService voucherOrderService; @Resource ISeckillVoucherService seckillVoucherService; /** * æ¥æ”¶ç§’æ€ä¿¡æ¯å¹¶ä¸‹å• * @param msg */ @Transactional @RabbitListener(queues = RabbitMQTopicConfig.QUEUE) public void receiveSeckillMessage(String msg)&#123; log.info(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯: &quot;+msg); VoucherOrder voucherOrder = JSON.parseObject(msg, VoucherOrder.class); Long voucherId = voucherOrder.getVoucherId(); //5.ä¸€äººä¸€å• Long userId = voucherOrder.getUserId(); //5.1æŸ¥è¯¢è®¢å• int count = voucherOrderService.query().eq(&quot;user_id&quot;,userId).eq(&quot;voucher_id&quot;, voucherId).count(); //5.2åˆ¤æ–­æ˜¯å¦å­˜åœ¨ if(count&gt;0)&#123; //ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº† log.error(&quot;è¯¥ç”¨æˆ·å·²è´­ä¹°è¿‡&quot;); return ; &#125; log.info(&quot;æ‰£å‡åº“å­˜&quot;); //6.æ‰£å‡åº“å­˜ boolean success = seckillVoucherService .update() .setSql(&quot;stock = stock-1&quot;) .eq(&quot;voucher_id&quot;, voucherId) .gt(&quot;stock&quot;,0)//casä¹è§‚é” .update(); if(!success)&#123; log.error(&quot;åº“å­˜ä¸è¶³&quot;); return; &#125; //ç›´æ¥ä¿å­˜è®¢å• voucherOrderService.save(voucherOrder); &#125;&#125; æ³¨æ„è¿™é‡Œéœ€è¦æ‰‹åŠ¨å‘redisä¸­æ·»åŠ åº“å­˜é”®åŠæ•°é‡ï¼Œé”®åå°±æ˜¯ä¸‹é¢luaä»£ç ä¸­stockKeyçš„åå­—ï¼Œè¿™é‡ŒvoucherIdä¸º7ï¼Œé”®åå°±æ˜¯stock:7ï¼Œè¿™é‡Œä¹Ÿç®—ä¸€ä¸ªbugï¼Œæäº†æœ‰ä¸€é˜µå­ 12345678910111213141516171819202122232425262728-- 1.å‚æ•°åˆ—è¡¨-- 1.1ä¼˜æƒ å·idlocal voucherId = ARGV[1]-- 1.2ç”¨æˆ·idlocal userId = ARGV[2]-- 2.æ•°æ®key-- 2.1åº“å­˜keylocal stockKey = &#x27;stock:&#x27; .. voucherId-- 2.2è®¢å•keylocal orderKey = &#x27;order:&#x27; .. voucherId-- 3.è„šæœ¬ä¸šåŠ¡-- 3.1åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³if(tonumber(redis.call(&#x27;get&#x27;,stockKey)) &lt;= 0)then -- 3.2 åº“å­˜ä¸è¶³ è¿”å›1 return 1end--3.2åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å•if(redis.call(&#x27;sismember&#x27;,orderKey,userId) == 1) then -- 3.3å­˜åœ¨,è¯´æ˜æ˜¯é‡å¤ä¸‹å• return 2end-- 3.4æ‰£åº“å­˜redis.call(&#x27;incrby&#x27;,stockKey,-1)-- 3.5ä¸‹å•å¹¶ä¿å­˜ç”¨æˆ·redis.call(&#x27;sadd&#x27;,orderKey,userId)return 0 ä¸‹é¢æ˜¯VoucherOrderServiceImplçš„ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class VoucherOrderServiceImpl extends ServiceImpl&lt;VoucherOrderMapper, VoucherOrder&gt; implements IVoucherOrderService &#123; @Resource private MQSender mqSender; @Resource private RedisIdWorker redisIdWorker; //private RateLimiter rateLimiter = RateLimiter.create(10); @Resource private StringRedisTemplate stringRedisTemplate; //@Resource //private RedissonClient redissonClient; //luaè„šæœ¬ private static final DefaultRedisScript&lt;Long&gt; SECKILL_SCRIPT; static &#123; SECKILL_SCRIPT = new DefaultRedisScript&lt;&gt;(); SECKILL_SCRIPT.setLocation(new ClassPathResource(&quot;seckill.lua&quot;)); SECKILL_SCRIPT.setResultType(Long.class); &#125; @Override public Result seckillVocher(Long voucherId) &#123; //1.æ‰§è¡Œluaè„šæœ¬ Long userId = UserHolder.getUser().getId(); Long r = stringRedisTemplate.execute( SECKILL_SCRIPT, Collections.emptyList(), voucherId.toString(), userId.toString() ); //2.åˆ¤æ–­ç»“æœä¸º0 int result = r.intValue(); if (result != 0) &#123; //2.1ä¸ä¸º0ä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼ return Result.fail(r == 1 ? &quot;åº“å­˜ä¸è¶³&quot; : &quot;è¯¥ç”¨æˆ·é‡å¤ä¸‹å•&quot;); &#125; //2.2ä¸º0ä»£è¡¨æœ‰è´­ä¹°èµ„æ ¼,å°†ä¸‹å•ä¿¡æ¯ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ— //2.3åˆ›å»ºè®¢å• VoucherOrder voucherOrder = new VoucherOrder(); //2.4è®¢å•id long orderId = redisIdWorker.nextId(&quot;order&quot;); voucherOrder.setId(orderId); //2.5ç”¨æˆ·id voucherOrder.setUserId(userId); //2.6ä»£é‡‘å·id voucherOrder.setVoucherId(voucherId); //2.7å°†ä¿¡æ¯æ”¾å…¥MQä¸­ mqSender.sendSeckillMessage(JSON.toJSONString(voucherOrder)); //2.7 è¿”å›è®¢å•id return Result.ok(orderId); &#125;&#125; 4.ç»“æœåˆ†ææ³¨æ„åœ¨ç”¨jmeteræµ‹è¯•ä¹‹å‰ï¼Œå…ˆæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œå¦‚ä¸‹ï¼š å®éªŒç»“æœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°æœ€å°è€—æ—¶2msï¼Œæœ€å¤§è€—æ—¶112msï¼Œæé«˜äº†å°†è¿‘20å€ï¼Œå¹³å‡è€—æ—¶34msï¼Œæé«˜äº†å°†è¿‘30å€å·¦å³","categories":[],"tags":[]},{"title":"å­—èŠ‚è·³åŠ¨-ç•ªèŒ„å°è¯´é¢ç»","slug":"é¢ç»/å­—èŠ‚è·³åŠ¨-ç•ªèŒ„å°è¯´é¢ç»","date":"2024-12-14T03:17:09.000Z","updated":"2024-12-21T06:18:19.192Z","comments":true,"path":"2024/12/14/é¢ç»/å­—èŠ‚è·³åŠ¨-ç•ªèŒ„å°è¯´é¢ç»/","permalink":"http://example.com/2024/12/14/%E9%9D%A2%E7%BB%8F/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-%E7%95%AA%E8%8C%84%E5%B0%8F%E8%AF%B4%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"Qï¼šjavaå¹¶å‘ç¼–ç¨‹å¹¶å‘çš„æ˜¯çº¿ç¨‹è¿˜æ˜¯è¿›ç¨‹ï¼ŸAï¼šçº¿ç¨‹ï¼Œä¸è¿‡è¯´çš„å¾ˆç´Šä¹±ï¼Œè®²äº†å¾ˆå¤šæ²¡å¿…è¦è®²çš„ä¸œè¥¿ ä»¥ä¸‹æ˜¯gptå›ç­” è§£é‡Šï¼š çº¿ç¨‹ æ˜¯ç¨‹åºä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œçº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Œå®ƒä»¬å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ã€‚åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ˜¯é€šè¿‡å®ç° Runnable æ¥å£æˆ–ç»§æ‰¿ Thread ç±»æ¥åˆ›å»ºçš„ã€‚ è¿›ç¨‹ æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚Javaç¨‹åºé€šå¸¸è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œè¯¥è¿›ç¨‹å†…å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹ã€‚ å¹¶å‘çš„å®šä¹‰ï¼š å¹¶å‘ æŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œåœ¨æ—¶é—´ä¸Šæœ‰é‡å ï¼Œè€Œä¸ä¸€å®šæ˜¯åŒæ—¶è¿›è¡Œã€‚é€šè¿‡å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼ŒJavaèƒ½å¤Ÿåœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šé«˜æ•ˆåœ°åˆ©ç”¨å¤šä¸ªCPUæ ¸å¿ƒï¼Œä½†å¹¶å‘æœ¬èº«å¹¶ä¸ç­‰åŒäºå¹¶è¡Œã€‚å¹¶è¡Œæ˜¯æŒ‡å¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œã€‚ æ€»ç»“ï¼š Javaå¹¶å‘ç¼–ç¨‹ä¸­ï¼Œâ€œå¹¶å‘â€æ˜¯æŒ‡ å¤šä¸ªçº¿ç¨‹ çš„æ‰§è¡Œã€‚ å¦‚æœæ¶‰åŠå¤šä¸ªè¿›ç¨‹ï¼Œé€šå¸¸ç§°ä¹‹ä¸º å¤šè¿›ç¨‹ ç¼–ç¨‹ï¼Œè€Œä¸å±äºå¹¶å‘çš„èŒƒç•´ã€‚ Qï¼šè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«Aï¼šä¸€ä¸ªè¿›ç¨‹å¯èƒ½å°±æ˜¯ä¼šåŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹å¯ä»¥ç†è§£ä¸ºè½»é‡çº§çš„è¿›ç¨‹ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢è¿™ä¸ªå¼€é”€ä¸€èˆ¬æ˜¯æ¯”è¾ƒå°çš„ï¼Œçº¿ç¨‹å¯ä»¥å…±äº«è¿™ä¸ªè¿›ç¨‹çš„ä¸€äº›èµ„æºæ¯”å¦‚è¯´å†…å­˜ç©ºé—´ï¼ˆå†…å­˜ç©ºé—´åŸ‹é›·äº†ï¼‰ Qï¼šé‚£ä½ è§‰å¾—ä½ å¯¹äºä»–ä»¬çš„åº•å±‚ç»“æ„äº†è§£å—ï¼Œæ¯”å¦‚è¯´ä½ åˆšæ‰æåˆ°äº†å…±äº«å†…å­˜é‚£ä½ å…±äº«çš„èµ„æºå˜›å¯¹å§é‚£ä½ èƒ½è¯´ä¸€ä¸‹æ¯”å¦‚è¯´æˆ‘å¯åŠ¨äº†ä¸€ä¸ªé‚£ä¸ªè¿›ç¨‹ç„¶åé‚£è¿›ç¨‹è·Ÿçº¿ç¨‹ä¹‹é—´åº”è¯¥æ˜¯å¦‚ä½•å»ç”³è¯·è¿™ä¸ªèµ„æºä»¥åŠå®ç°èµ„æºå…±äº«å‘¢ã€‚åç»­åˆè¡¥å……äº†ä¸€ç‚¹ï¼Œæ¯”å¦‚è¯´åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ç„¶åè¿™ä¸ªèµ„æºæˆ‘æ˜¯æ€ä¹ˆç”³è¯·çš„ä»¥åŠçº¿ç¨‹å»æ€ä¹ˆå»å…±äº«è¿™äº›èµ„æºçš„ã€‚Aï¼šçš„ä¸€å¡Œç³Šæ¶‚ Qï¼šçº¿ç¨‹æ± çš„ä½œç”¨ä»¥åŠå®ç°åŸç†ã€‚Aï¼šå¤ç”¨çº¿ç¨‹ï¼Œå®ç°åŸç†ä¸ä¼šï¼ˆå…¶å®å°±æ˜¯çº¿ç¨‹æ± å¤„ç†ä»»åŠ¡çš„æµç¨‹ï¼Œä¸çŸ¥é“æ˜¯è¿™ä¸ªé¢˜ç›®ï¼ŒèƒŒäº†å…«è‚¡ä¹Ÿæ²¡ç”¨ä¸ŠğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ ä»¥ä¸‹æ˜¯gptå›ç­” çº¿ç¨‹æ± çš„å®ç°åŸç† çº¿ç¨‹æ± çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»»åŠ¡æäº¤-çº¿ç¨‹å¤ç”¨ã€‚ä»¥ä¸‹æ˜¯çº¿ç¨‹æ± çš„åŸºæœ¬ç»„æˆå’Œå·¥ä½œåŸç†ï¼š 1. åŸºæœ¬ç»„æˆ ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰ï¼š ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚ ä»»åŠ¡æ˜¯å®ç°äº†æŸç§æ¥å£ï¼ˆå¦‚ Runnable æˆ– Callableï¼‰çš„å¯¹è±¡ã€‚ å·¥ä½œçº¿ç¨‹ï¼ˆWorker Threadsï¼‰ï¼š çº¿ç¨‹æ± ä¸­å®é™…æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹é›†åˆã€‚çº¿ç¨‹æ± åœ¨åˆå§‹åŒ–æ—¶ä¼šåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œå¹¶åœ¨ä»»åŠ¡æäº¤åå¤ç”¨è¿™äº›çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚ çº¿ç¨‹ç®¡ç†å™¨ï¼š ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œç»´æŠ¤çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡ã€‚ æ ¹æ®é…ç½®åŠ¨æ€å¢åŠ æˆ–å‡å°‘çº¿ç¨‹æ•°ï¼ˆå¦‚æ‰©å±•æˆ–ç¼©å‡çº¿ç¨‹æ± å¤§å°ï¼‰ã€‚ ä»»åŠ¡æäº¤æ¥å£ï¼š æä¾›ç»™ç”¨æˆ·ç”¨äºæäº¤ä»»åŠ¡çš„æ–¹æ³•ï¼Œæ¯”å¦‚ execute() æˆ– submit()ã€‚ ä»»åŠ¡è°ƒåº¦å™¨ï¼š ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶åˆ†é…ç»™å·¥ä½œçº¿ç¨‹ã€‚ å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå·¥ä½œçº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ 2. çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ çº¿ç¨‹æ± åˆå§‹åŒ–ï¼š æ ¹æ®é…ç½®ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¸€å®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶å¤„äºç­‰å¾…ä»»åŠ¡çš„çŠ¶æ€ã€‚ ä»»åŠ¡æäº¤ï¼š ç”¨æˆ·é€šè¿‡çº¿ç¨‹æ± çš„æ¥å£ï¼ˆå¦‚ execute() æˆ– submit()ï¼‰æäº¤ä»»åŠ¡ï¼Œä»»åŠ¡è¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ ä»»åŠ¡è°ƒåº¦ï¼š çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ä¼šä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œæ‰§è¡Œã€‚ å¦‚æœæ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½åœ¨å¿™ï¼Œä»»åŠ¡ä¼šåœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…ã€‚ ä»»åŠ¡æ‰§è¡Œï¼š å·¥ä½œçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åï¼Œçº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œè€Œæ˜¯è¿”å›çº¿ç¨‹æ± ç»§ç»­ç­‰å¾…æ–°çš„ä»»åŠ¡ã€‚ åŠ¨æ€æ‰©å±•ï¼ˆå¯é€‰ï¼‰ï¼š å¦‚æœä»»åŠ¡é˜Ÿåˆ—è¿‡é•¿ä¸”æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œçº¿ç¨‹æ± å¯ä»¥åŠ¨æ€åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼ˆå—æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ï¼‰ã€‚ çº¿ç¨‹å›æ”¶ï¼š å¦‚æœçº¿ç¨‹æ± ä¸­æŸäº›çº¿ç¨‹é•¿æ—¶é—´æ²¡æœ‰ä»»åŠ¡å¯æ‰§è¡Œï¼Œçº¿ç¨‹æ± å¯ä»¥é”€æ¯è¿™äº›ç©ºé—²çº¿ç¨‹ä»¥èŠ‚çœèµ„æºã€‚ Qã€å¦‚æœæ²¡æœ‰é”æœºåˆ¶çš„è¯åœ¨å¹¶å‘ç¼–ç¨‹çš„åœºæ™¯ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚Aï¼šæ•°æ®çš„ä¸€è‡´æ€§å¯èƒ½å‡ºç°é—®é¢˜ï¼ˆé—®æˆ‘è¿˜æœ‰æ²¡æœ‰è¡¥å……ï¼Œæˆ‘ä¹Ÿæ²¡æƒ³åˆ°å…¶å®ƒçš„äº† ä»¥ä¸‹æ˜¯åœ¨ç½‘ä¸Šæœçš„ï¼Œå¹¶å‘ç¼–ç¨‹éœ€è¦åŠ é”çš„æ—¶å€™ï¼Œå¦‚æœå°±ä¸åŠ ä¼šæ€ä¹ˆæ ·ï¼Ÿ æ•°æ®ä¸ä¸€è‡´ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹å…±äº«èµ„æºæ—¶ï¼Œå¦‚æœæ²¡æœ‰åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ç«äº‰ï¼Œå³ä¸€ä¸ªçº¿ç¨‹åœ¨è¯»å–æ•°æ®çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æ•°æ®ï¼Œä»è€Œå¯¼è‡´æœ€ç»ˆçš„æ•°æ®çŠ¶æ€ä¸é¢„æœŸä¸ç¬¦ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€ä¸ªè´¦æˆ·ä½™é¢è¿›è¡Œæ“ä½œï¼Œå¦‚æœä¸åŠ é”ï¼Œå¯èƒ½ä¼šå‡ºç°ä½™é¢è¢«é‡å¤æ‰£æ¬¾æˆ–é‡å¤åŠ æ¬¾çš„æƒ…å†µã€‚ ç«æ€æ¡ä»¶ï¼šç«æ€æ¡ä»¶æ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œç”±äºçº¿ç¨‹è°ƒåº¦çš„ä¸ç¡®å®šæ€§ï¼Œå¯¼è‡´ç¨‹åºçš„è¡Œä¸ºä¾èµ–äºä¸å¯é¢„æµ‹çš„æ‰§è¡Œé¡ºåºã€‚å¦‚æœä¸åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºåœ¨æŸäº›æƒ…å†µä¸‹å‡ºç°ä¸å¯é¢„æœŸçš„è¡Œä¸ºï¼Œå¦‚æ­»é”ã€é¥¥é¥¿ç­‰é—®é¢˜ã€‚ çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œè¿™å¾ˆå®¹æ˜“å¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§å’Œç«æ€æ¡ä»¶ã€‚å¦‚æœä¸åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå½±å“ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚ æ­»é”é£é™©ï¼šæ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œã€‚å¦‚æœä¸åŠ é”ï¼Œå¯èƒ½ä¼šå¢åŠ æ­»é”çš„é£é™©ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„å¹¶å‘åœºæ™¯ä¸­ã€‚ éš¾ä»¥è°ƒè¯•ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœä¸åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚ç”±äºçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œé”™è¯¯å¯èƒ½åœ¨æŸäº›ç‰¹å®šçš„æ‰§è¡Œè·¯å¾„ä¸‹æ‰ä¼šå‡ºç°ï¼Œè¿™ä½¿å¾—è°ƒè¯•å˜å¾—éå¸¸å›°éš¾ã€‚ Qï¼šé¡¹ç›®ï¼šæ€ä¹ˆå®ç°ä¼˜æƒ åˆ¸çš„ç§’æ€Aï¼šè¿™ä¸ªåŸºæœ¬ç­”å¾—æ˜¯é‚£ä¹ˆå›äº‹ï¼Œå°±æ˜¯ä¹è§‚é”çš„cas Qï¼šä»€ä¹ˆå«ä¹è§‚é”ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨æ‚²è§‚é”ï¼ŸAï¼šé€‚ç”¨è¯»å¤šå†™å°‘ï¼Œç„¶åè¯´äº†ä¸€ä¸‹casçš„å®ç°ï¼ˆæ„Ÿè§‰éƒ½æ²¡ç­”åˆ°ç‚¹å­ä¸ŠğŸ˜…ğŸ˜…ï¼‰ï¼›ç”¨æ‚²è§‚é”å°±æ˜¯å½±å“æ€§èƒ½ï¼Œå› ä¸ºä¼šé¢‘ç¹çš„æ›´æ–°æ•°æ® Qï¼šselectè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹Aï¼šï¼ˆè¿™ä¸ªç­”å¾—åº”è¯¥å¤§å·®ä¸å·®ï¼Œå”¯ä¸€ç”»è›‡æ·»è¶³çš„ä¸€ç‚¹å°±æ˜¯æŠŠåºŸå¼ƒçš„é‚£ä¸ªç¼“å­˜å™¨ä¹Ÿç­”ä¸Šäº†ï¼Œåˆç»™åé¢åŸ‹é›·äº†ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ï¼‰è¿æ¥å™¨â€”â€”è¯­æ³•å™¨â€”â€”ä¼˜åŒ–å™¨â€”â€”æ‰§è¡Œå™¨ Qï¼šç¼“å­˜çš„ç²’åº¦æ˜¯ä»€ä¹ˆï¼Ÿæˆ–è€…è¯´å®ƒæ˜¯æ€ä¹ˆç¼“å­˜çš„ï¼Œç¼“å­˜çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆAï¼šç›´æ¥è¯´ä¸æ¸…æ¥šï¼Œç¼“å­˜çš„åº”è¯¥æ˜¯è¯­å¥å§ã€‚ç„¶åé—®å¦‚æœç¼“å­˜äº†SELECT A = 1å†æ¥æ‰§è¡ŒSELECT A = 1 AND B = 1èƒ½ç”¨åˆ°ç¼“å­˜å—ï¼ŸçŒœçš„èƒ½ ä»¥ä¸‹æ¥è‡ªgpt å­˜å‚¨å¸¸ç”¨æˆ–æœ€è¿‘ä½¿ç”¨çš„æ•°æ®å’ŒæŸ¥è¯¢ç»“æœï¼Œæé«˜äº†æŸ¥è¯¢æ€§èƒ½ï¼Œå‡å°‘äº†å¯¹åº•å±‚å­˜å‚¨çš„è®¿é—®ã€‚ å­˜å‚¨æŸ¥è¯¢çš„å®Œæ•´ç»“æœé›†ï¼Œä¸‹ä¸€æ¬¡é‡åˆ°ç›¸åŒçš„æŸ¥è¯¢è¯­å¥æ—¶ï¼Œç›´æ¥è¿”å›ç»“æœã€‚ é€‚ç”¨äºç®€å•çš„ SELECT æŸ¥è¯¢ï¼Œå°¤å…¶æ˜¯å°‘æ›´æ–°ã€å¤šè¯»å–çš„åœºæ™¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSELECT A = 1 çš„ç¼“å­˜ä¸èƒ½ç›´æ¥ç”¨äº SELECT A = 1 AND B = 1ï¼Œå› ä¸ºä¸¤è€…æŸ¥è¯¢æ¡ä»¶å’Œç»“æœé›†ä¸åŒã€‚ Qï¼šSELECTè¯­å¥æƒ³åšæŸ¥è¯¢ä¼˜åŒ–ï¼Œä»å“ªäº›æ–¹é¢å»ä¼˜åŒ–ï¼ŸAï¼šç­”äº†ç´¢å¼•ï¼Œé¿å…æŸ¥è¯¢ä¸å¿…è¦çš„åˆ—ï¼Œæ•°æ®é‡è¿‡å¤§æ—¶ä»åˆ†è¡¨ä¸‰ç‚¹ï¼Œé—®è¿˜æœ‰è¡¥å……æ²¡ï¼Œ ä»¥ä¸‹æ¥è‡ªgpt ä¼˜åŒ– SELECT è¯­å¥çš„æ–¹æ³•åŒ…æ‹¬ï¼š ä»è¡¨ç»“æ„è®¾è®¡å…¥æ‰‹ï¼Œå»ºç«‹åˆç†çš„ç´¢å¼•ï¼Œä¼˜åŒ–å­—æ®µç±»å‹ï¼Œå¿…è¦æ—¶åˆ†è¡¨æˆ–åˆ†åŒºã€‚ æ”¹è¿›æŸ¥è¯¢è¯­å¥ï¼Œå‡å°‘ä¸å¿…è¦çš„å­—æ®µã€è¡Œå’Œè¡¨ï¼Œé¿å…å¤æ‚è®¡ç®—ã€‚ æé«˜æ•°æ®è®¿é—®æ•ˆç‡ï¼Œåˆ©ç”¨ç¼“å­˜å’Œåˆ†é¡µä¼˜åŒ–å‡å°‘æŸ¥è¯¢å¼€é”€ã€‚ åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œé€šè¿‡å·¥å…·å‘ç°æ½œåœ¨é—®é¢˜å¹¶è°ƒæ•´æŸ¥è¯¢ç»“æ„å’Œç´¢å¼•ã€‚ Qï¼šç´¢å¼•çš„åº•å±‚ç»“æ„æ˜¯å•¥ï¼ŸAï¼šè¯´äº†B+æ ‘ï¼Œç„¶åé—®åªæœ‰B+æ ‘ä¹ˆï¼Ÿè¿˜æœ‰å…¶å®ƒç»“æ„å—ï¼Œç„¶ååˆå›ç­”äº†è¿˜æœ‰å“ˆå¸Œ Qï¼šä»æ•°æ®ç»“æ„çš„è§’åº¦æ¥è¯´ï¼Œèƒ½å½±å“B+æ ‘çš„æŸ¥è¯¢æ€§èƒ½çš„ï¼Œæ˜¯è¿™ä¸ªæ ‘çš„ä»€ä¹ˆAï¼šæ ‘é«˜ ä»¥ä¸‹æ¥è‡ªgpt Qï¼šæˆ‘ä»¬æ€ä¹ˆå½±å“è¿™ä¸ªæ ‘çš„é«˜åº¦å‘¢ï¼Ÿé€šè¿‡å“ªäº›æ–¹å¼è®©è¿™ä¸ªæ ‘çš„é«˜åº¦æ›´æ‰å¹³ä¸€ç‚¹ï¼ŸAï¼šä¸çŸ¥é“ï¼Œçå‡ æŠŠç­”äº† ä»¥ä¸‹æ¥è‡ªgpt æ ‘é«˜ä¸»è¦å—ä»¥ä¸‹å› ç´ å½±å“ï¼š èŠ‚ç‚¹æ‰‡å‡ºæ•°ï¼ˆç”±èŠ‚ç‚¹å¤§å°å’Œé”®å€¼å¤§å°å†³å®šï¼‰ã€‚ æ•°æ®åˆ†å¸ƒæ˜¯å¦å‡åŒ€ã€‚ æ•°æ®é‡å’Œç£ç›˜å—çš„å¤§å°ã€‚ é”®å€¼çš„å¤§å°å’Œæ’åºã€‚ é—®ç­”18minã€‚æ‰‹æ’•ç¯èŠ‚ã€‚å·®ä¸å¤šä¸‰åˆ†é’Ÿè¯´äº†ä¸€ä¸‹æ€è·¯ã€‚æ’•äº†å·®ä¸å¤š20minæ‰è·‘é€šæµ‹è¯•ç”¨ä¾‹ï¼Œ Qï¼šé¢˜ç›®ï¼šç»™ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼æ€è·¯ï¼š é‡åˆ°æ“ä½œæ•°ï¼ˆæ•°å­—æˆ–å˜é‡ï¼‰ï¼šç›´æ¥è¾“å‡ºåˆ°ç»“æœä¸­ã€‚ é‡åˆ°å·¦æ‹¬å· (ï¼šç›´æ¥å‹å…¥æ“ä½œç¬¦æ ˆã€‚ é‡åˆ°å³æ‹¬å· )ï¼š å¼¹å‡ºæ ˆé¡¶çš„æ“ä½œç¬¦å¹¶åŠ å…¥ç»“æœï¼Œç›´åˆ°é‡åˆ°å·¦æ‹¬å·ï¼ˆå·¦æ‹¬å·æœ¬èº«ä¸åŠ å…¥ç»“æœï¼‰ã€‚ é‡åˆ°è¿ç®—ç¬¦ï¼ˆå¦‚ +, -, *, /ï¼‰ï¼š å°†æ ˆé¡¶ä¼˜å…ˆçº§é«˜äºæˆ–ç­‰äºå½“å‰æ“ä½œç¬¦çš„è¿ç®—ç¬¦å¼¹å‡ºå¹¶åŠ å…¥ç»“æœã€‚ ç„¶åå°†å½“å‰æ“ä½œç¬¦å‹æ ˆã€‚ éå†ç»“æŸåï¼šå°†æ ˆä¸­å‰©ä½™çš„è¿ç®—ç¬¦ä¾æ¬¡å¼¹å‡ºå¹¶åŠ å…¥ç»“æœã€‚ ç®—æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556// å®šä¹‰è¿ç®—ç¬¦ä¼˜å…ˆçº§ private static final Map&lt;Character, Integer&gt; precedence = new HashMap&lt;&gt;(); static &#123; precedence.put(&#x27;+&#x27;, 1); precedence.put(&#x27;-&#x27;, 1); precedence.put(&#x27;*&#x27;, 2); precedence.put(&#x27;/&#x27;, 2); precedence.put(&#x27;(&#x27;, 0); // å·¦æ‹¬å·ä¼˜å…ˆçº§æœ€ä½ &#125; public static String infixToPostfix(String infix) &#123; // æ ˆï¼šå­˜å‚¨æ“ä½œç¬¦ Stack&lt;Character&gt; operatorStack = new Stack&lt;&gt;(); // ç»“æœå­—ç¬¦ä¸² StringBuilder postfix = new StringBuilder(); // éå†è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªå­—ç¬¦ for (int i = 0; i &lt; infix.length(); i++) &#123; char ch = infix.charAt(i); // å¦‚æœæ˜¯æ“ä½œæ•°ï¼ˆå­—æ¯æˆ–æ•°å­—ï¼‰ï¼Œç›´æ¥åŠ å…¥ç»“æœ if (Character.isLetterOrDigit(ch)) &#123; postfix.append(ch); &#125; // å¦‚æœæ˜¯å·¦æ‹¬å·ï¼Œå‹å…¥æ ˆ else if (ch == &#x27;(&#x27;) &#123; operatorStack.push(ch); &#125; // å¦‚æœæ˜¯å³æ‹¬å·ï¼Œå¼¹å‡ºè¿ç®—ç¬¦ç›´åˆ°é‡åˆ°å·¦æ‹¬å· else if (ch == &#x27;)&#x27;) &#123; while (!operatorStack.isEmpty() &amp;&amp; operatorStack.peek() != &#x27;(&#x27;) &#123; postfix.append(operatorStack.pop()); &#125; if (!operatorStack.isEmpty() &amp;&amp; operatorStack.peek() == &#x27;(&#x27;) &#123; operatorStack.pop(); // å¼¹å‡ºå·¦æ‹¬å· &#125; &#125; // å¦‚æœæ˜¯è¿ç®—ç¬¦ else &#123; // å¼¹å‡ºæ ˆé¡¶ä¼˜å…ˆçº§å¤§äºç­‰äºå½“å‰è¿ç®—ç¬¦çš„è¿ç®—ç¬¦ while (!operatorStack.isEmpty() &amp;&amp; precedence.get(operatorStack.peek()) &gt;= precedence.get(ch)) &#123; postfix.append(operatorStack.pop()); &#125; // å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆ operatorStack.push(ch); &#125; &#125; // éå†ç»“æŸåï¼Œå¼¹å‡ºæ ˆä¸­å‰©ä½™çš„è¿ç®—ç¬¦ while (!operatorStack.isEmpty()) &#123; postfix.append(operatorStack.pop()); &#125; // è¿”å›åç¼€è¡¨è¾¾å¼ return postfix.toString(); &#125;","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"æ—¥å¸¸å®ä¹ ","slug":"æ—¥å¸¸å®ä¹ ","permalink":"http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AE%9E%E4%B9%A0/"}]},{"title":"ä¸­ç§‘æ˜Ÿå›¾é¢ç»","slug":"é¢ç»/ä¸­ç§‘æ˜Ÿå›¾é¢ç»","date":"2024-12-14T03:16:45.000Z","updated":"2024-12-14T03:18:32.994Z","comments":true,"path":"2024/12/14/é¢ç»/ä¸­ç§‘æ˜Ÿå›¾é¢ç»/","permalink":"http://example.com/2024/12/14/%E9%9D%A2%E7%BB%8F/%E4%B8%AD%E7%A7%91%E6%98%9F%E5%9B%BE%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"è‡ªæˆ‘ä»‹ç» é—®å®ä¹ ï¼Œåšäº†å•¥ï¼Œé‡åˆ°äº†å•¥é—®é¢˜ï¼Œå½é‡Œå’•å™œæ‰¯äº†ä¸€é€š é—®æˆ‘ç†Ÿæ‚‰ä»€ä¹ˆæ¡†æ¶ï¼Œå¿…é¡»bootå•Šï¼Œç„¶åè®©æˆ‘è®²ä¸€ä¸‹ï¼Œè®²ä¸å¥½ï¼Œæ‰¯åˆ°springè®²è®²iocå’Œaopäº† ç„¶åé—®æˆ‘æ³¨è§£ï¼Œæ˜¯é€šè¿‡åå°„å§å¥½åƒï¼Œå¿˜äº† ç„¶ååé—®ï¼ŒèŠäº†ä¸€ä¸‹å·¥ä½œæ—¶é—´ï¼Œåšä»€ä¹ˆï¼ˆå…¨æ ˆï¼‰ï¼Œã€‚ã€‚","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"æ—¥å¸¸å®ä¹ ","slug":"æ—¥å¸¸å®ä¹ ","permalink":"http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AE%9E%E4%B9%A0/"}]},{"title":"hot100ä¸€å¥è¯æ€è·¯","slug":"hot100ä¸€å¥è¯æ€è·¯","date":"2024-12-13T13:33:20.000Z","updated":"2025-03-06T04:08:52.727Z","comments":true,"path":"2024/12/13/hot100ä¸€å¥è¯æ€è·¯/","permalink":"http://example.com/2024/12/13/hot100%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%80%9D%E8%B7%AF/","excerpt":"è¿™é‡Œæ˜¯æˆ‘æ€»ç»“çš„leetcodeå¹³å°hot100é¢˜å•çš„â€œä¸€å¥è¯æ€è·¯â€åŠä»£ç ï¼Œæ¬¢è¿å‚è€ƒæŒ‡æ­£äº¤æµ~ğŸ’•â˜ºï¸","text":"è¿™é‡Œæ˜¯æˆ‘æ€»ç»“çš„leetcodeå¹³å°hot100é¢˜å•çš„â€œä¸€å¥è¯æ€è·¯â€åŠä»£ç ï¼Œæ¬¢è¿å‚è€ƒæŒ‡æ­£äº¤æµ~ğŸ’•â˜ºï¸ ACMæ¨¡å¼ä¸‹çš„hot100è§£æ³•åœ¨è¿™é‡Œ ä¸€ã€å“ˆå¸Œè¡¨1. ä¸¤æ•°ä¹‹å’Œ æ€è·¯ï¼šmapï¼ˆkeyå­˜å‚¨å…ƒç´ å€¼ï¼Œvalueä¸ºç´¢å¼•ï¼‰ã€‚éå†æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­mapä¸­æ˜¯å¦æœ‰target - å½“å‰å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å°±æŠŠå½“å‰å…ƒç´ æ’å…¥åˆ°mapã€‚ è¯¦ç»†é¢˜è§£ï¼š1.ä¸¤æ•°ä¹‹å’Œ å‚è€ƒä»£ç  1234567891011121314151617class Solution &#123; public int[] twoSum(int[] nums, int target) &#123; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); int[] ans = new int[2]; for (int i = 0; i &lt; nums.length; i++) &#123; if(map.containsKey(target - nums[i]))&#123; ans[0] = map.get(target - nums[i]); ans[1] = i; break; &#125; map.put(nums[i], i); &#125; return ans; &#125;&#125; 49. å­—æ¯å¼‚ä½è¯åˆ†ç»„ æ€è·¯ï¼šå­—æ¯å¼‚ä½è¯è½¬åŒ–ä¸ºå­—ç¬¦æ•°ç»„ï¼Œç»è¿‡æ’åºå†è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæ˜¯ç›¸åŒçš„ã€‚åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨mapï¼Œkeyä¸ºç»è¿‡æ’åºåçš„å­—ç¬¦ä¸²ï¼Œvalueä¸ºå½“å‰å¼‚ä½è¯åˆ—è¡¨ã€‚æœ€ç»ˆå°†valueå€¼è¿”å›åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚ è¯¦ç»†é¢˜è§£ï¼š49. å­—æ¯å¼‚ä½è¯åˆ†ç»„ å‚è€ƒä»£ç  1234567891011121314class Solution &#123; public List&lt;List&lt;String&gt;&gt; groupAnagrams(String[] strs) &#123; HashMap&lt;String , List&lt;String&gt;&gt; map = new HashMap&lt;&gt;(); for (String str : strs) &#123; char[] array = str.toCharArray(); Arrays.sort(array); String key = new String(array); List&lt;String&gt; list = map.getOrDefault(key, new ArrayList&lt;&gt;()); list.add(str); map.put(key, list); &#125; return new ArrayList&lt;&gt;(map.values()); &#125;&#125; 128. æœ€é•¿è¿ç»­åºåˆ— æ€è·¯ï¼šä¸€ä¸ªæ•°å­—èƒ½ä¸èƒ½ä½œä¸ºåºåˆ—çš„å¼€å§‹ï¼Œå–å†³äºå®ƒå‰ä¸€ä¸ªæ•°å­—æ˜¯å¦å­˜åœ¨ï¼›ä¸€ä¸ªæ•°å­—èƒ½ä¸èƒ½ä½œä¸ºåºåˆ—çš„ç»“æŸï¼Œå–å†³äºå®ƒåä¸€ä¸ªæ•°å­—æ˜¯å¦ä¸å­˜åœ¨ã€‚å€ŸåŠ©æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªsetæ¥ç°æŠŠæ‰€æœ‰å…ƒç´ åŠ å…¥ï¼Œç„¶åç›´æ¥éå†seté›†åˆæ¥çœ‹ è¯¦ç»†é¢˜è§£ï¼š128. æœ€é•¿è¿ç»­åºåˆ— å‚è€ƒä»£ç  123456789101112131415161718class Solution &#123; public int longestConsecutive(int[] nums) &#123; HashSet&lt;Integer&gt; set = new HashSet&lt;&gt;(); int ans = 0; for (int num : nums) &#123; set.add(num); &#125; for (int num : set) &#123; if(!set.contains(num - 1))&#123; int len = 1; while (set.contains(++num)) len++; ans = Math.max(ans, len); &#125; &#125; return ans; &#125;&#125; äºŒã€åŒæŒ‡é’ˆ283. ç§»åŠ¨é›¶ æ€è·¯ï¼šå§‹ç»ˆè®©æ…¢æŒ‡é’ˆæŒ‡å‘é›¶å…ƒç´ ï¼ˆå¦‚æœä¸ä¸º0ç›´æ¥è‡ªå¢åè·³å‡ºå½“å‰å¾ªç¯è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼‰ï¼Œå¿«æŒ‡é’ˆå»å¯»æ‰¾ä¸ä¸ºé›¶çš„å…ƒç´ ï¼Œç„¶åæ‰¾åˆ°äº†å°±è®¾ç½®æ…¢æŒ‡é’ˆæ‰€æŒ‡çš„å…ƒç´ ä¸ºå¿«æŒ‡é’ˆæ‰€æŒ‡çš„å…ƒç´ ï¼Œå†è®©æ…¢æŒ‡é’ˆè‡ªå¢ è¡¥å……ï¼ˆ2025&#x2F;2&#x2F;6ï¼‰ ä¸ºä»€ä¹ˆ fast æ— è®ºå¦‚ä½•éƒ½è¦åŠ ä¸€ï¼šæ— è®º fast æŒ‡å‘çš„å…ƒç´ æ˜¯å¦ä¸º 0ï¼Œfast éƒ½éœ€è¦åŠ ä¸€ï¼Œä»¥ç¡®ä¿èƒ½å¤Ÿéå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœ fast æŒ‡å‘çš„å…ƒç´ ä¸º 0ï¼Œé‚£ä¹ˆ fast ç»§ç»­å‘å‰ç§»åŠ¨ï¼Œå¯»æ‰¾ä¸‹ä¸€ä¸ªéé›¶å…ƒç´ ã€‚å¦‚æœ fast æŒ‡å‘çš„å…ƒç´ ä¸ä¸º 0ï¼Œé‚£ä¹ˆå°±å°†è¯¥å…ƒç´ ç§»åŠ¨åˆ° slow çš„ä½ç½®ï¼Œå¹¶å°† fast æŒ‡å‘çš„ä½ç½®ç½®ä¸º 0ï¼Œç„¶å fast ç»§ç»­å‘å‰ç§»åŠ¨ã€‚ è¯¦ç»†é¢˜è§£ï¼š283. ç§»åŠ¨é›¶ å‚è€ƒä»£ç  123456789101112131415class Solution &#123; public void moveZeroes(int[] nums) &#123; int slow = 0, fast = 1; while (fast &lt; nums.length)&#123; if(nums[slow] == 0 &amp;&amp; nums[fast] != 0)&#123; nums[slow] = nums[fast]; nums[fast] = 0; slow++; &#125; if(nums[slow]!= 0) slow++; fast++; &#125; &#125;&#125; 11. ç››æœ€å¤šæ°´çš„å®¹å™¨ æ€è·¯ï¼šä»ä¸¤è¾¹å‘ä¸­é—´é ï¼Œæ¯æ¬¡è®¡ç®—æ­¤æ—¶çš„ä½“ç§¯ï¼ˆé«˜ä¸ºå·¦å³çº¿çš„è¾ƒä½è€…ï¼‰ï¼Œç„¶åè¾ƒä½çš„çº¿é‚£ä¸€è¾¹å‘ä¸­é—´é æ‹¢ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç  123456789101112131415class Solution &#123; public int maxArea(int[] height) &#123; int low = 0; int high = height.length - 1; int ans = Integer.MIN_VALUE; while (low &lt;= high)&#123; ans = Math.max(ans, (high - low) * Math.min(height[low], height[high])); if(height[low] &lt; height[high]) low++; else high--; &#125; return ans; &#125;&#125; 15. ä¸‰æ•°ä¹‹å’Œ æ€è·¯ï¼šé¦–å…ˆå°†æ•°ç»„æ’æˆæœ‰åºã€‚ç„¶åéå†æ•°ç»„ï¼Œæœ‰ä¸¤ä¸ªé€€å‡ºæ¡ä»¶ï¼š1.å½“å‰æ•°å­—å¤§äº0ï¼Œbreakï¼›2.å½“å‰å…ƒç´ å’Œå‰ä¸€ä¸ªå…ƒç´ ä¸€æ ·ï¼Œcontinueï¼ˆç›¸å½“äºå¯¹ç¬¬ä¸€ä¸ªå…ƒç´ çš„å»é‡ï¼‰ï¼Œç„¶ååœ¨å‰©ä¸‹å…ƒç´ ä¸­ï¼Œä»é¦–å°¾å‘ä¸­é—´é æ‹¢ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶äº†ï¼Œå†å¯¹å·¦å³æŒ‡é’ˆæ‰€æŒ‡å…ƒç´ å»é‡ è¯¦ç»†é¢˜è§£ï¼š15. ä¸‰æ•°ä¹‹å’Œ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425262728class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; threeSum(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); Arrays.sort(nums); for (int i = 0; i &lt; nums.length; i++) &#123; if(nums[i] &gt; 0) break; if(i &gt; 0 &amp;&amp; nums[i] == nums[i - 1]) continue; int l = i + 1, r = nums.length - 1; while (l &lt; r)&#123; int temp = nums[i] + nums[l] + nums[r]; if(temp &lt; 0) l++; else if (temp &gt; 0) &#123; r--; &#125;else &#123; ans.add(Arrays.asList(nums[i], nums[l], nums[r])); while (l &lt; r &amp;&amp; nums[l] == nums[l + 1]) l++; while (l &lt; r &amp;&amp; nums[r] == nums[r - 1]) r--; l++; r--; &#125; &#125; &#125; return ans; &#125;&#125; 42. æ¥é›¨æ°´ æ€è·¯ï¼šé¦–å°¾ä½ç½®ä¸è£…é›¨æ°´ï¼Œå…¶ä½™æ¯ä¸ªä½ç½®æ‰€è£…é›¨æ°´ = minï¼ˆå·¦è¾¹æŸ±å­æœ€å¤§å€¼ï¼Œå³è¾¹æŸ±å­æœ€å¤§å€¼ï¼‰- å½“ä¸”æŸ±å­é«˜ã€‚å·¦å³æŒ‡é’ˆçš„æ›´æ–°ç±»ä¼¼11. ç››æœ€å¤šæ°´çš„å®¹å™¨ è¿™ä¸€é¢˜ï¼Œæ¯æ¬¡ç§»åŠ¨è¾ƒä½çš„é‚£æ ¹æŸ±å­ è¡¥å……ï¼ˆæ­¤é¢˜æ­¥éª¤ï¼‰ æ•°ç»„é•¿åº¦&lt;&#x3D;2ï¼Œç›´æ¥è¿”å›0 åˆå§‹åŒ–å·¦å³æœ€å¤§å€¼åˆ†åˆ«ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´  åˆå§‹åŒ–å·¦å³æŒ‡é’ˆåˆ†åˆ«ä¸ºç¬¬äºŒä¸ªå…ƒç´ å’Œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´  åœ¨å¾ªç¯ä¸­å…ˆæ›´æ–°å·¦å³æœ€å¤§å€¼ï¼Œå†æ ¹æ®å·¦å³æœ€å¤§å€¼æ¥å†³å®šæ­¤æ—¶ç»“æœåº”è¯¥åŠ å¤šå°‘ è¯¦ç»†é¢˜è§£ï¼š42. æ¥é›¨æ°´ å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920class Solution &#123; public int trap(int[] height) &#123; if(height.length &lt;= 2) return 0; int maxLeft = height[0]; int maxRight = height[height.length - 1]; int left = 0; int right = height.length - 1; int ans = 0; while (left &lt;= right)&#123; maxLeft = Math.max(maxLeft, height[left]); maxRight = Math.max(maxRight, height[right]); if(maxLeft &lt; maxRight) ans += maxLeft - height[left++]; else ans += maxRight - height[right--]; &#125; return ans; &#125;&#125; ä¸‰ã€æ»‘åŠ¨çª—å£3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² æ€è·¯ï¼šåŒæŒ‡é’ˆä¹‹å¿«æ…¢æŒ‡é’ˆã€‚å°†å¿«æŒ‡é’ˆæ‰€éå†çš„å­—ç¬¦åŠ å…¥setï¼Œå½“æ·»åŠ å¤±è´¥æ—¶ï¼ˆè¯´æ˜æœ‰é‡å¤å­—ç¬¦ï¼‰ï¼Œå°†æ…¢æŒ‡é’ˆå‘å¿«æŒ‡é’ˆæ”¶ç¼©ï¼Œç›´åˆ°æ­¤æ—¶å¿«æŒ‡é’ˆæ‰€æŒ‡å­—ç¬¦å¯ä»¥åŠ å…¥setï¼Œå†ç»§ç»­ç§»åŠ¨å¿«æŒ‡é’ˆ è¯¦ç»†é¢˜è§£ï¼š3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public int lengthOfLongestSubstring(String s) &#123; int l = 0; int ans = 0; HashSet&lt;Character&gt; set = new HashSet&lt;&gt;(); for (int r = l; r &lt; s.length(); r++) &#123; char c = s.charAt(r); while (l &lt; r &amp;&amp; set.contains(c))&#123; set.remove(s.charAt(l)); l++; &#125; set.add(c); ans = Math.max(ans, r - l + 1); &#125; return ans; &#125;&#125; 438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ æ€è·¯ï¼šå¿«æ…¢æŒ‡é’ˆï¼‹å“ˆå¸Œï¼ˆæ•°ç»„ï¼‰ã€‚ç”¨æ•°ç»„å“ˆå¸Œè®°å½•pæ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œå¿«æŒ‡é’ˆéå†sä¸­çš„å­—ç¬¦ï¼Œæ¯æ¬¡è®©æ•°ç»„ä¸­å¯¹åº”å­—ç¬¦çš„å€¼å‡ä¸€ï¼Œå¦‚æœå½“å‰è¿™ä¸ªæ•°ç»„å…ƒç´ å€¼å°äº0ï¼Œè¯´æ˜å‡ºç°äº†pä¸­æ²¡æœ‰çš„å­—ç¬¦ï¼Œæ”¶ç¼©æ…¢æŒ‡é’ˆåŒæ—¶æ¢å¤å­—ç¬¦æ¬¡æ•°çŠ¶æ€ï¼Œç›´åˆ°æ…¢æŒ‡é’ˆèµ¶ä¸Šå¿«æŒ‡é’ˆçš„æ—¶å€™æ‰èƒ½å¡«è¡¥ä¸Šè¿™ä¸ªå·®è·ã€‚å¦‚æœå¿«æ…¢æŒ‡é’ˆçš„é•¿åº¦ç­‰äºpçš„é•¿åº¦ï¼Œå¯ä»¥å°†æ­¤æ—¶æ…¢æŒ‡é’ˆçš„åæ ‡æ·»åŠ åˆ°ç»“æœ è¯¦ç»†é¢˜è§£ï¼š438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122class Solution &#123; public List&lt;Integer&gt; findAnagrams(String s, String p) &#123; List&lt;Integer&gt; ans = new ArrayList&lt;&gt;(); int[] cnt = new int[26]; for (int i = 0; i &lt; p.length(); i++) &#123; cnt[p.charAt(i) - &#x27;a&#x27;]++; &#125; for (int r = 0, l = 0; r &lt; s.length(); r++) &#123; char c = s.charAt(r); cnt[c - &#x27;a&#x27;]--; while (cnt[c - &#x27;a&#x27;] &lt; 0)&#123; //è¿™é‡Œå‰é¢çš„æ¡ä»¶ l &lt;= r &amp;&amp; ä¸€èˆ¬å°±åˆ«å†™äº†ï¼Œæœ‰æ—¶å€™å†™æ˜¯æ­£ç¡®çš„æœ‰æ—¶å€™ä¸å†™æ˜¯æ­£ç¡®çš„ï¼Œä¸€å¾‹ä¸å†™åè€Œå¤§å¤šæ•°éƒ½ä¼šæ­£ç¡® //å·¦æŒ‡é’ˆå³ç§» cnt[s.charAt(l) - &#x27;a&#x27;]++; l++; &#125; if(r - l + 1 == p.length()) ans.add(l); &#125; return ans; &#125;&#125; å››ã€å­—ç¬¦ä¸²560. å’Œä¸º K çš„å­æ•°ç»„ æ€è·¯ï¼šåˆ©ç”¨å‰ç¼€å’ŒåŠ ä¸Šä¸€ä¸ªå“ˆå¸Œè¡¨è®°å½•å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ï¼Œé€šè¿‡æŸ¥æ‰¾å½“å‰å‰ç¼€å’Œå‡å»ç›®æ ‡å’Œkçš„å€¼æ˜¯å¦å·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œå¿«é€Ÿç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ä¸ªæ•°ã€‚ è¯¦ç»†é¢˜è§£ï¼š560. å’Œä¸º K çš„å­æ•°ç»„ å‚è€ƒä»£ç ï¼š 1234567891011121314class Solution &#123; public int subarraySum(int[] nums, int k) &#123; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); map.put(0, 1); int ans = 0; int pre = 0; for (int i = 0; i &lt; nums.length; i++) &#123; pre += nums[i]; ans += map.getOrDefault(sum - k, 0); map.put(pre, map.getOrDefault(pre, 0) + 1); &#125; return ans; &#125;&#125; 239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆéš¾ï¼‰ æ€è·¯ï¼šå€ŸåŠ©å•è°ƒé˜Ÿåˆ—ï¼Œæ¥å­˜å‚¨å¯èƒ½æˆä¸ºæœ€å¤§å€¼çš„å…ƒç´ ã€‚å…·ä½“è€Œè¨€ï¼Œå¦‚æœå½“å‰å…ƒç´ æ¯”é˜Ÿåˆ—æœ«å°¾å…ƒç´ è¦å°ï¼Œå°±ç›´æ¥è¿›å…¥é˜Ÿåˆ—ã€‚è¿™æ ·é˜Ÿå¤´å°±æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚æ³¨æ„ï¼šåœ¨çª—å£ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰é˜Ÿå¤´å…ƒç´ å’Œå³å°†è¢«ï¼ˆçª—å£ï¼‰ç§»é™¤çš„å…ƒç´ ä¸€æ ·å¤§ï¼Œé‚£é˜Ÿå¤´å…ƒç´ ä¹Ÿè¦å‡ºé˜Ÿã€‚ è¯¦ç»†é¢˜è§£ï¼š239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425class Solution &#123; public int[] maxSlidingWindow(int[] nums, int k) &#123; int[] ans = new int[nums.length - k + 1]; LinkedList&lt;Integer&gt; deque = new LinkedList&lt;&gt;(); //æœªå½¢æˆçª—å£æ—¶ for (int i = 0; i &lt; k; i++) &#123; while (!deque.isEmpty() &amp;&amp; deque.peekLast() &lt; nums[i]) deque.removeLast(); deque.addLast(nums[i]); &#125; ans[0] = deque.peekFirst(); //å½¢æˆçª—å£æ—¶ for (int i = k; i &lt; nums.length; i++) &#123; if(nums[i - k] == deque.peekFirst()) deque.removeFirst(); while (!deque.isEmpty() &amp;&amp; deque.peekLast() &lt; nums[i]) deque.removeLast(); deque.addLast(nums[i]); ans[i - k + 1] = deque.peekFirst(); &#125; return ans; &#125;&#125; 76. æœ€å°è¦†ç›–å­ä¸²åœ¨åšè¿™é¢˜ä¹‹å‰ï¼Œå¯ä»¥å…ˆè¯•ä¸€ä¸‹è¿™é¢˜çš„â€œç®€å•ç‰ˆâ€â€”â€”438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ æ€è·¯ï¼šå’Œ438ç±»ä¼¼ï¼Œä¸è¿‡è¿™é¢˜è¦ç»´æŠ¤ä¸€ä¸ªå˜é‡ï¼Œç”¨äºè®°å½•tä¸­å­—ç¬¦æ˜¯å¦åŒ¹é…å®Œäº† è¯¦ç»†é¢˜è§£ï¼šè¿™ä¸ªæ˜¯æˆ‘åœ¨é¢˜è§£ä¸‹é¢çœ‹çš„åˆ«äººçš„ å‚è€ƒä»£ç  12345678910111213141516171819202122232425262728class Solution &#123; public String minWindow(String s, String t) &#123; int[] cnt = new int[128]; int count = 0;//è®°å½•tä¸­éœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸ªæ•° for (int i = 0; i &lt; t.length(); i++) &#123; cnt[t.charAt(i) - &#x27;A&#x27;]++; count++; &#125; int start = -1, end = s.length(); for (int r = 0, l = 0; r &lt; s.length(); r++) &#123; char cur = s.charAt(r); if(--cnt[cur - &#x27;A&#x27;] &gt;= 0)//å¦‚æœå½“å‰æ¶ˆé™¤çš„æ˜¯æœ‰æ•ˆï¼ˆtä¸­çš„ï¼‰å­—ç¬¦ count--; while (l &lt;= r &amp;&amp; count == 0) &#123; //å½“å‰éœ€è¦åŒ¹é…çš„å­—ç¬¦å…¨éƒ¨åŒ¹é…å®Œäº† if(++cnt[s.charAt(l) - &#x27;A&#x27;] &gt; 0)&#123; //è¯´æ˜å½“å‰å·¦æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦æ˜¯æœ‰æ•ˆå­—ç¬¦ if(r - l &lt; end - start)&#123; //æ›´æ–°æœ‰æ•ˆåŒºé—´ end = r; start = l; &#125; count++; &#125; l++; &#125; &#125; return start == -1 ? &quot;&quot; : s.substring(start, end + 1); &#125;&#125; äº”ã€æ™®é€šæ•°ç»„53. æœ€å¤§å­æ•°ç»„å’Œ æ€è·¯ï¼šdpã€‚dp[i]ä»£è¡¨ä»¥ä¸‹æ ‡iç»“å°¾çš„æœ€å¤§å­æ•°ç»„å’Œä¸ºdp[i]ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾çš„æ˜¯ï¼š max (dp[i]), i âˆˆ {0, n - 1} è¿˜è¦æ³¨æ„çš„æ˜¯ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹dp[i] = max(dp[i-1]+nums[i]ï¼Œnums[i]) è¯¦ç»†é¢˜è§£ï¼š53.æœ€å¤§å­æ•°ç»„å’Œ å‚è€ƒä»£ç  1234567891011121314class Solution &#123; public int maxSubArray(int[] nums) &#123; int[] dp = new int[nums.length]; int pre = nums[0]; int ans = pre; for (int i = 1; i &lt; nums.length; i++) &#123; pre += nums[i]; pre = Math.max(nums[i], pre); ans = Math.max(ans, pre); &#125; return ans; &#125;&#125; å› ä¸ºå½“å‰çŠ¶æ€ä»…å’Œä¸Šä¸€ä¸ªçŠ¶æ€æœ‰å…³ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š 12345678910class Solution &#123; public int maxSubArray(int[] nums) &#123; int pre = 0, maxAns = nums[0]; for (int x : nums) &#123; pre = Math.max(pre + x, x); //çŠ¶æ€è½¬ç§» maxAns = Math.max(maxAns, pre); &#125; return maxAns; &#125;&#125; 56. åˆå¹¶åŒºé—´ æ€è·¯ï¼šç”¨ä¸€ä¸ªæ•°ç»„ç±»å‹çš„åˆ—è¡¨æ¥å­˜å‚¨æœ€ç»ˆç»“æœã€‚éå†æ‰€ç»™äºŒç»´æ•°ç»„ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ &lt;&#x3D;åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ pï¼ˆæ•°ç»„ï¼‰çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œé‚£å°±è¦å¯¹pçš„ç¬¬äºŒä¸ªæ•°å­—è¿›è¡Œæ›´æ–°ã€‚ä¾‹å¦‚ï¼š[1,3], [2, 4] &#x3D;&gt; [1, 4] è¯¦ç»†é¢˜è§£ï¼š56.åˆå¹¶åŒºé—´ å‚è€ƒä»£ç ï¼š 1234567891011121314class Solution &#123; public int[][] merge(int[][] intervals) &#123; Arrays.sort(intervals, (p, q) -&gt; p[0] - q[0]); List&lt;int[]&gt; list = new ArrayList&lt;&gt;(); for (int[] interval : intervals) &#123; int m = list.size(); if(m &gt; 0 &amp;&amp; list.get(m - 1)[1] &gt;= interval[0]) list.get(m - 1)[1] = Math.max(interval[1], list.get(m - 1)[1]); else list.add(interval); &#125; return list.toArray(new int[list.size()][]); &#125;&#125; 189. è½®è½¬æ•°ç»„ æ€è·¯ï¼šå…ˆå¯¹æ•´ä¸ªæ•°ç»„é€†ç½®ã€‚å†å¯¹å‰kä¸ªå…ƒç´ é€†ç½®ã€‚å†å¯¹ån - kä¸ªå…ƒç´ é€†ç½®ã€‚æ³¨æ„å…ˆå¯¹kè¿›è¡Œå¤„ç† è¯¦ç»†é¢˜è§£ï¼š189.è½®è½¬æ•°ç»„ å‚è€ƒä»£ç  1234567891011121314151617class Solution &#123; public void rotate(int[] nums, int k) &#123; int n = nums.length; k = k % n; reverse(nums, 0, n - 1); reverse(nums, 0, k - 1); reverse(nums, k, n - 1); &#125; private void reverse(int[] nums, int low, int high) &#123; while (low &lt;= high)&#123; int temp = nums[high]; nums[high--] = nums[low]; nums[low++] = temp; &#125; &#125;&#125; 238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ æ€è·¯ï¼šä¸€ç§ç®€å•çš„æ€è·¯æ˜¯ï¼Œä½¿ç”¨ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ•°ç»„å­˜å‚¨æ¯ä¸ªå…ƒç´ å·¦è¾¹å…ƒç´ çš„ä¹˜ç§¯ï¼Œå¦ä¸€ä¸ªæ•°ç»„å­˜å‚¨æ¯ä¸ªå…ƒç´ å³è¾¹å…ƒç´ çš„ä¹˜ç§¯ã€‚æœ€åç»“æœå°±æ˜¯è¿™ä¸¤ä¸ªæ•°ç»„å¯¹åº”ä½ç½®ç›¸ä¹˜ï¼Œå°±æ˜¯æ¯ä¸ªå…ƒç´ é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ã€‚ä½†æ˜¯å¯ä»¥çœç•¥è®°å½•å³è¾¹å…ƒç´ ä¹˜ç§¯çš„è¿™ä¸ªæ•°ç»„ï¼Œä¹‹é—´å°†å…¶å­˜å‚¨åˆ°ç»“æœæ•°ç»„ä¸­ã€‚è§ä»£ç ã€‚ è¯¦ç»†é¢˜è§£ï¼š238.é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ å‚è€ƒä»£ç  12345678910111213141516class Solution &#123; public int[] productExceptSelf(int[] nums) &#123; int n = nums.length; int[] ans = new int[n]; //è®°å½•å·¦è¾¹å…ƒç´ çš„ä¹˜ç§¯ ans[0] = 1; for (int i = 1; i &lt; n; i++) &#123; ans[i] = ans[i - 1] * nums[i - 1]; &#125; int temp = 1; for (int i = n - 1; i &gt;= 0; i--)&#123; ans[i] = ans[i] * temp; temp *= nums[i]; &#125; return ans; &#125;&#125; 41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•° ï¼ˆâ˜…â˜… æ€è·¯ï¼šæ•°ç»„å†…ç½®å“ˆå¸Œï¼ˆç½®æ¢æ³•ï¼‰â€”â€”æºè‡ªGPT å°†æ­£æ•´æ•°æ”¾åˆ°å¯¹åº”çš„ä½ç½®ä¸Šï¼š å¦‚æœæ•°ç»„ä¸­å­˜åœ¨æ•°å­— xï¼Œä¸” 1â‰¤xâ‰¤nï¼ˆn æ˜¯æ•°ç»„é•¿åº¦ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å°†å®ƒæ”¾åˆ°ç´¢å¼• xâˆ’1 çš„ä½ç½®ä¸Šã€‚ é€šè¿‡ä¸æ–­äº¤æ¢æ•°å­—å’Œå®ƒåº”è¯¥åœ¨çš„ä½ç½®ï¼Œå°†æ‰€æœ‰å¯èƒ½çš„æ­£æ•´æ•°æ”¾åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ éå†æ•°ç»„å¯»æ‰¾ç¼ºå¤±çš„æœ€å°æ­£æ•´æ•°ï¼š ç»è¿‡ä¸Šè¿°å¤„ç†åï¼Œç´¢å¼• i åº”è¯¥å­˜å‚¨ i+1ã€‚ å¦‚æœæŸä¸ªä½ç½® iä¸æ»¡è¶³ nums[i]&#x3D;i+1ï¼Œé‚£ä¹ˆ i+1 å°±æ˜¯ç¼ºå¤±çš„æœ€å°æ­£æ•´æ•°ã€‚ è‹¥æ‰€æœ‰ä½ç½®éƒ½æ­£ç¡®ï¼š å¦‚æœæ•°ç»„ä¸­æ‰€æœ‰ä½ç½®éƒ½æ»¡è¶³ nums[i]&#x3D;i+1ï¼Œåˆ™ç¼ºå¤±çš„æœ€å°æ­£æ•´æ•°æ˜¯ n+1ï¼ˆæ•°ç»„èŒƒå›´ä¹‹å¤–çš„ç¬¬ä¸€ä¸ªæ­£æ•´æ•°ï¼‰ã€‚ è¯¦ç»†é¢˜è§£ï¼š41.ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•° å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021class Solution &#123; public int firstMissingPositive(int[] nums) &#123; int n = nums.length; int x = 0; for (int i = 0; i &lt; n; i++) &#123; x = nums[i]; while (x &gt; 0 &amp;&amp; x &lt;= n &amp;&amp; x != nums[x - 1])&#123; int temp = nums[x - 1]; nums[x - 1] = x; x = temp; &#125; &#125; for (int i = 0; i &lt; n; i++) &#123; if(nums[i] != i + 1) return i + 1; &#125; return n + 1; &#125;&#125; å…­ã€çŸ©é˜µ73. çŸ©é˜µç½®é›¶ æ€è·¯ï¼š1ã€æ‰«æé¦–è¡Œé¦–åˆ—ï¼Œæ ‡è®°é¦–è¡Œé¦–åˆ—æ˜¯å¦è¦ç½®é›¶ï¼›2ã€æ‰«æå‰©ä½™å…ƒç´ ï¼ˆéé¦–è¡Œé¦–åˆ—çš„å…¶ä½™å…ƒç´ ï¼‰ï¼Œå¦‚æœæŸä¸ªå…ƒç´ ä¸º0ï¼Œå°±å°†å…¶é¦–è¡Œå¯¹åº”è¡Œç´¢å¼•ï¼Œé¦–åˆ—å¯¹åº”åˆ—ç´¢å¼•è®¾ç½®ä¸º0ï¼Œæ–¹ä¾¿åç»­å¯¹è¯¥è¡Œè¯¥åˆ—ç½®é›¶ï¼›3ã€æ‰«æé¦–è¡Œé¦–åˆ—ï¼Œå¦‚æœæœ‰å…ƒç´ 0ï¼Œå°±å°†å¯¹åº”åˆ—&#x2F;è¡Œç½®é›¶ã€‚4ã€æœ€åæ ¹æ®ç¬¬ä¸€æ­¥çš„æ ‡è®°ä½ï¼Œå¯¹é¦–è¡Œé¦–åˆ—ç½®é›¶ è¯¦ç»†é¢˜è§£ï¼š73.çŸ©é˜µç½®é›¶ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142class Solution &#123; public void setZeroes(int[][] matrix) &#123; int m = matrix.length; int n = matrix[0].length; boolean b1 = false, b2 = false; //1ã€å…ˆæ‰«æç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—ï¼Œè®°å½•ç¬¬ä¸€è¡Œï¼Œç¬¬ä¸€åˆ—æ˜¯å¦è¦ç½®0 for (int i = 0; i &lt; n; i++) if(matrix[0][i] == 0) b1 = true; for (int i = 0; i &lt; m; i++) if(matrix[i][0] == 0) b2 = true; //2ã€æ‰«æå…¶ä½™ï¼Œå¦‚æœæœ‰å…ƒç´ ä¸º0ï¼Œå°†å®ƒæœ€å·¦æ–¹å’Œæœ€ä¸Šæ–¹çš„å…ƒç´ ç½®é›¶ for (int i = 1; i &lt; m; i++) for (int j = 1; j &lt; n; j++) if(matrix[i][j] == 0)&#123; matrix[0][j] = 0; matrix[i][0] = 0; &#125; //3ã€æŒ‰ç…§é¦–è¡Œé¦–åˆ—æ‰€è®°å½•å…ƒç´ ï¼Œå¦‚æœä¸º0å°†å¯¹åº”è¡Œåˆ—ç½®ä¸º0 for (int i = 1; i &lt; n; i ++) if(matrix[0][i] == 0) for (int j = 1; j &lt; m; j++) matrix[j][i] = 0; for (int i = 1; i &lt; m; i++) if(matrix[i][0] == 0) Arrays.fill(matrix[i], 0); //4ã€æ ¹æ®ç¬¬ä¸€æ­¥å¾—åˆ°çš„ç»“æœå¯¹ç¬¬ä¸€è¡Œåˆ—ç½®é›¶ if(b1) Arrays.fill(matrix[0], 0); if(b2) for (int j = 0; j &lt; m; j++) matrix[j][0] = 0; &#125;&#125; 54. èºæ—‹çŸ©é˜µ æ€è·¯ï¼šè®¾ç½®ä¸Šä¸‹å·¦å³å››ä¸ªæŒ‡é’ˆï¼ŒæŒ‰ç…§â†’â†“â†â†‘çš„æ–¹å‘ï¼Œæ¯æ¬¡åˆ°äº†æœ€è¾¹ç•Œï¼Œå°±ç¼©å‡è¾¹ç•Œã€‚ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344class Solution &#123; public List&lt;Integer&gt; spiralOrder(int[][] matrix) &#123; List&lt;Integer&gt; ans = new ArrayList&lt;&gt;(); int m = matrix.length; int n = matrix[0].length; int l = 0, r = n - 1; int s = 0, x = m - 1; int i = 0; while (i &lt; m * n)&#123; for (int j = l; j &lt;= r; j++)&#123; ans.add(matrix[s][j]); i++; if(i == m * n) return ans; &#125; s++; for (int j = s; j &lt;= x; j++)&#123; ans.add(matrix[j][r]); i++; if(i == m * n) return ans; &#125; r--; for (int j = r; j &gt;= l; j--)&#123; ans.add(matrix[x][j]); i++; if(i == m * n) return ans; &#125; x--; for (int j = x; j &gt;= s; j--)&#123; ans.add(matrix[j][l]); i++; if(i == m * n) return ans; &#125; l++; &#125; return ans; &#125;&#125; 48. æ—‹è½¬å›¾åƒ æ€è·¯ï¼šå…ˆæ²¿ç€ä¸»å¯¹è§’çº¿äº¤æ¢å…ƒç´ ï¼Œç„¶åå†å¯¹æ¯ä¸€è¡Œè¿›è¡Œé€†ç½® è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç  12345678910111213141516171819202122class Solution &#123; public void rotate(int[][] matrix) &#123; int m = matrix.length; int n = matrix[0].length; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; i; j++) &#123; int temp = matrix[i][j]; matrix[i][j] = matrix[j][i]; matrix[j][i] = temp; &#125; &#125; for (int i = 0; i &lt; m; i++) &#123; int l = 0, r = n - 1; while (l &lt;= r)&#123; int temp = matrix[i][l]; matrix[i][l++] = matrix[i][r]; matrix[i][r--] = temp; &#125; &#125; &#125;&#125; 240. æœç´¢äºŒç»´çŸ©é˜µ II æ€è·¯ï¼šä»¥ç¬¬ä¸€è¡Œæœ€åä¸€ä¸ªå…ƒç´ ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¯å°†çŸ©é˜µçœ‹ä½œæ˜¯ä¸€ä¸ªBSTã€‚åœ¨ä¸è¶Šç•Œçš„å‰æä¸‹ï¼Œå¦‚æœå…ƒç´ æ¯”targetå¤§ï¼Œå¾€å·¦æ‰¾ï¼Œå¦åˆ™ï¼Œå¾€ä¸‹æ‰¾ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021class Solution &#123; public boolean searchMatrix(int[][] matrix, int target) &#123; int m = matrix.length; int n = matrix[0].length; int i = 0; int j = n - 1; while (i &lt; m &amp;&amp; j &gt;=0)&#123; int temp = matrix[i][j]; if(target &gt; temp)&#123; //å¾€ä¸‹æ‰¾ i++; &#125; else if (target &lt; temp) &#123; //å¾€å·¦æ‰¾ j--; &#125;else return true; &#125; return false; &#125;&#125; ä¸ƒã€é“¾è¡¨160. ç›¸äº¤é“¾è¡¨ æ€è·¯ï¼šå¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤ï¼Œè®¾ç›¸äº¤éƒ¨åˆ†ä¸ºcï¼Œå¦å¤–ä¸¤ä¸ªé“¾è¡¨å„è‡ªçš„éƒ¨åˆ†åˆ†åˆ«ä¸ºaã€bã€‚æœ‰a + c + b &#x3D; b + c + aï¼Œè¿™å°±æ˜¯è¯´ï¼Œå½“ä¸¤ä¸ªæŒ‡é’ˆä»å„è‡ªé“¾è¡¨å¼€å¤´èµ°ï¼Œèµ°å®Œé“¾è¡¨å†ä»å¯¹æ–¹é“¾è¡¨çš„å¼€å¤´èµ°ï¼Œå®ƒä»¬ä¼šåœ¨ç›¸äº¤éƒ¨åˆ†çš„èµ·ç‚¹ç›¸é‡ã€‚è¿™é‡Œçš„ä»£ç å†™æ³•å¾ˆå¦™ï¼Œå€¼å¾—è®°å¿†ä¸€ä¸‹ã€‚è€Œå¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ ¸å¿ƒæ˜¯m + n &#x3D; n + mï¼Œè¿™å°±æ˜¯è¯´ï¼Œå½“ä¸¤ä¸ªæŒ‡é’ˆå„è‡ªèµ°å®Œè‡ªå·±çš„é“¾è¡¨ï¼Œå†å»èµ°å®Œå¯¹æ–¹çš„é“¾è¡¨ï¼Œæ­¤æ—¶ä¸¤ä¸ªæŒ‡é’ˆå‡æŒ‡å‘ä¸€ä¸ªå…±åŒçš„â€œäº¤ç‚¹â€˜â€”â€”null è¯¦ç»†é¢˜è§£ï¼š160.ç›¸äº¤é“¾è¡¨ å‚è€ƒä»£ç  12345678910111213public class Solution &#123; public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; //ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«èµ°å®Œå„è‡ªçš„é“¾è¡¨ï¼Œå†ä»å¯¹æ–¹çš„é“¾è¡¨èŠ‚ç‚¹å¼€å§‹èµ°ï¼Œç„¶åå®ƒä¿©ç›¸ç­‰çš„æ—¶å€™ï¼Œå°±æ˜¯ç›¸äº¤èŠ‚ç‚¹ ListNode A = headA; ListNode B = headB; while (A != B)&#123; A = A == null ? headB : A.next; B = B == null ? headA : B.next; &#125; return A; &#125;&#125; 206. åè½¬é“¾è¡¨æœ€åŸºç¡€çš„æ“ä½œï¼Œè¿™é¢˜æ˜¯åé¢å¥½å‡ é¢˜è¿›é˜¶é“¾è¡¨åè½¬çš„åŸºç¡€æ ¸å¿ƒ æ€è·¯ï¼šå€Ÿç”¨ä¸‰ä¸ªæŒ‡é’ˆï¼Œpreï¼Œtempï¼Œcurï¼Œè¿™é¢˜å¯ä»¥çœ‹ç€ä»£ç æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹ è¯¦ç»†é¢˜è§£ï¼š206.åè½¬é“¾è¡¨ å‚è€ƒä»£ç ï¼š 1234567891011121314class Solution &#123; public ListNode reverseList(ListNode head) &#123; ListNode pre = null; ListNode temp = pre; while (head != null)&#123; temp = head.next; head.next = pre; pre = head; head = temp; &#125; return pre; &#125;&#125; 234. å›æ–‡é“¾è¡¨ æ€è·¯ï¼šè¡¥å……æœ€ä¼˜æ€è·¯ï¼ˆè¾¾åˆ°O(1)ç©ºé—´å¤æ‚åº¦çš„è§£ï¼‰ã€‚1.ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹ï¼›2.ç¿»è½¬ååŠæ®µé“¾è¡¨ï¼›3.æ¯”è¾ƒå‰åä¸¤æ®µé“¾è¡¨ï¼Œå°±å¯ä»¥å¾—åˆ°ç»“æœäº† è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243class Solution &#123; public boolean isPalindrome(ListNode head) &#123; if (head == null || head.next == null) &#123; return true; &#125; // 1. å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹ ListNode slow = head, fast = head; while (fast != null &amp;&amp; fast.next != null) &#123; slow = slow.next; fast = fast.next.next; &#125; // 2. åè½¬ååŠéƒ¨åˆ†é“¾è¡¨ ListNode reversedHalf = reverseList(slow); // 3. æ¯”è¾ƒå‰åä¸¤éƒ¨åˆ† ListNode p1 = head, p2 = reversedHalf; boolean result = true; while (p2 != null) &#123; // åªéœ€æ¯”è¾ƒååŠéƒ¨åˆ†çš„é•¿åº¦ if (p1.val != p2.val) &#123; result = false; break; &#125; p1 = p1.next; p2 = p2.next; &#125; // 4. æ¢å¤é“¾è¡¨ï¼ˆå¯é€‰ï¼‰ reverseList(reversedHalf); return result; &#125; private ListNode reverseList(ListNode head) &#123; ListNode pre = null, cur = head; while (cur != null) &#123; ListNode next = cur.next; cur.next = pre; pre = cur; cur = next; &#125; return pre; &#125;&#125; 141. ç¯å½¢é“¾è¡¨ æ€è·¯ï¼šå¿«æ…¢æŒ‡é’ˆã€‚å¦‚æœæœ‰ç¯ï¼ŒäºŒè€…è‚¯å®šèƒ½ç›¸é‡ è¯¦ç»†é¢˜è§£ï¼š141.ç¯å½¢é“¾è¡¨ å‚è€ƒä»£ç ï¼š 12345678910111213141516public class Solution &#123; public boolean hasCycle(ListNode head) &#123; if(head == null) return false; ListNode slow = head; ListNode fast = head; while (fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; if(slow == fast) return true; &#125; return false; &#125;&#125; 142. ç¯å½¢é“¾è¡¨ II æ€è·¯ï¼šç›´æ¥ç»™ç»“è®ºï¼Œè¿˜æ˜¯å¿«æ…¢æŒ‡é’ˆï¼Œå½“äºŒè€…ç›¸é‡çš„æ—¶å€™ï¼Œå†åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆä»é“¾è¡¨å¤´èŠ‚ç‚¹å¼€å§‹èµ°ï¼ŒåŒæ—¶æ…¢æŒ‡é’ˆä¹Ÿå¼€å§‹èµ°ï¼Œå½“è¿™ä¿©æŒ‡é’ˆç›¸é‡çš„æ—¶å€™ï¼Œå°±æ˜¯ç¯çš„å…¥å£ã€‚è¯¦ç»†éªŒè¯è¯·çœ‹è¯¦ç»†é¢˜è§£ è¯¦ç»†é¢˜è§£ï¼š142.ç¯å½¢é“¾è¡¨â…¡ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021public class Solution &#123; public ListNode detectCycle(ListNode head) &#123; ListNode slow = head; ListNode fast = head; while (fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; if (slow == fast)&#123; //æ­¤æ—¶ç›¸é‡äº†ï¼Œè®©slowå’Œå¤´æŒ‡é’ˆä¸€èµ·å¾€åèµ° ListNode cur = head; while (cur != slow)&#123; cur = cur.next; slow = slow.next; &#125; return cur; &#125; &#125; return null; &#125;&#125; 21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ æ€è·¯ï¼šåŒæŒ‡é’ˆï¼Œä¸¤ä¸¤æ¯”è¾ƒ è¯¦ç»†é¢˜è§£ï¼š21.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819class Solution &#123; public ListNode mergeTwoLists(ListNode list1, ListNode list2) &#123; ListNode dummy = new ListNode(); ListNode cur = dummy; while (list1 != null &amp;&amp; list2 != null)&#123; if(list1.val &lt; list2.val)&#123; cur.next = list1; list1 = list1.next; &#125;else &#123; cur.next = list2; list2 = list2.next; &#125; cur = cur.next; &#125; cur.next = list1 == null ? list2 : list1; return dummy.next; &#125;&#125; â¤ï¸ç±»ä¼¼é¢˜ç›®ï¼šâ€ä¸¤æ•°ç›¸åŠ â€œç±»å‹ 21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ 67. äºŒè¿›åˆ¶æ±‚å’Œ 2. ä¸¤æ•°ç›¸åŠ  2. ä¸¤æ•°ç›¸åŠ  æ€è·¯ï¼šé€šè¿‡åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦ä¸€ä½æ¥è®°å½•è¿›ä½ã€‚æ–°èŠ‚ç‚¹çš„å€¼è®¾ç½®ä¸º(x + y + temp) % 10ï¼Œè¿›ä½tempæ›´æ–°ä¸º(x + y + temp) / 10ã€‚æ³¨æ„è¿™ä¸ªwhileå¾ªç¯çš„æ¡ä»¶å’Œè·å–å½“å‰ä¸¤ä¸ªèŠ‚ç‚¹å€¼çš„ä¸‰ç›®è¿ç®—ç¬¦å†™æ³•ï¼Œè¿™ä¸ªåœ¨è¿™ç§ç±»å‹çš„é¢˜ç›®ä¸­ç»å¸¸è¿™æ ·ä½¿ç”¨ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425class Solution &#123; public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; ListNode ans = new ListNode(); ListNode dummy = ans; int temp = 0; while (l1 != null || l2 != null)&#123; int x = l1 == null ? 0 : l1.val; int y = l2 == null ? 0 : l2.val; int cur = (x + y + temp) % 10; ans.next = new ListNode(cur); temp = (x + y + temp) / 10; //ä½œä¸ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¦ç´¯åŠ çš„å€¼ if(l1 != null) l1 = l1.next; if(l2 != null) l2 = l2.next; ans = ans.next; &#125; if(temp == 1) ans.next = new ListNode(1); return dummy.next; &#125;&#125; 19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹ æ€è·¯ï¼šè¦åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼Œåªéœ€æ‰¾åˆ°å®ƒå‰é¢çš„ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚å¿«æ…¢æŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆä»å“¨å…µèŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆèµ°n+1æ­¥ï¼Œæ­¤æ—¶å¿«æŒ‡é’ˆåœ¨è¦åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ­¤æ—¶å¿«æ…¢æŒ‡é’ˆåŒæ—¶ç§»åŠ¨ï¼ˆæ…¢æŒ‡é’ˆä¹Ÿæ˜¯ä»å“¨å…µèŠ‚ç‚¹å¼€å§‹çš„ï¼‰ï¼Œå½“å¿«æŒ‡é’ˆæŒ‡å‘nullï¼Œæ­¤æ—¶æ…¢æŒ‡é’ˆå°±æ­£å¥½æŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ è¯¦ç»†é¢˜è§£ï¼š19.åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹ å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public ListNode removeNthFromEnd(ListNode head, int n) &#123; ListNode slow = new ListNode(); slow.next = head; ListNode fast = slow, dummy = slow; for (int i = 0; i &lt;= n; i++) &#123; fast = fast.next; &#125; while (fast != null)&#123; slow = slow.next; fast = fast.next; &#125; slow.next = slow.next.next; return dummy.next; &#125;&#125; 24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ æ€è·¯ï¼šè¿™é¢˜å°±æ˜¯ä¸¤ä¸ªæ•°äº¤æ¢çš„ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ç‰ˆæœ¬ã€‚ç”¨tempæŒ‡å‘è¦äº¤æ¢ä¸¤ä¸ªèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒheadæŒ‡å‘è¦äº¤æ¢ä¸¤ä¸ªèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ è¯¦ç»†é¢˜è§£ï¼š24.ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041//è¿™æ ·å†™æ›´ç›´è§‚class Solution &#123; public ListNode swapPairs(ListNode head) &#123; ListNode dummyHead = new ListNode(0); dummyHead.next = head; ListNode temp = dummyHead; //tempè¦å§‹ç»ˆä½äºè¦äº¤æ¢çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å‰çš„ä¸€ä¸ªèŠ‚ç‚¹ //å¦‚æœæ²¡æœ‰èŠ‚ç‚¹æˆ–åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥è¿”å› while (temp.next != null &amp;&amp; temp.next.next != null)&#123; ListNode node1 = temp.next; ListNode node2 = temp.next.next; //å¼€å§‹äº¤æ¢è¿™ä¸¤ä¸ªèŠ‚ç‚¹ temp.next = node2; //å…ˆè®©tempè¿å‘node2 node1.next = node2.next; //node2åé¢è¿˜è¿æ¥ç€å‰©ä½™çš„é“¾è¡¨ï¼Œè¦å…ˆæŠŠå‰©ä½™çš„æ¥ä¸Šå†è°ƒæ•´node2å’Œnode1çš„å…³ç³» node2.next = node1; //æ­¤æ—¶è®©node2çš„åé¢è¿æ¥node1ï¼Œç°åœ¨çš„å…³ç³»å°±æ˜¯tempâ€”â€”&gt;node2â€”â€”&gt;node1äº† //æ›´æ–°tempï¼Œä¸ç”¨æ›´æ–°node1å’Œnode2ï¼Œä¸‹æ¬¡è¿›å…¥å¾ªç¯ä¼šæ›´æ–°å®ƒä¿© temp = node1; //å‡å¦‚åé¢è¿˜æœ‰ä¸¤ä¸ªèŠ‚ç‚¹è¦æ›´æ¢ï¼Œæ¯”å¦‚node3å’Œnode4ï¼Œé‚£node3çš„å‰é¢èŠ‚ç‚¹æ­¤æ—¶å°±æ˜¯ç°åœ¨çš„node1ï¼Œæ‰€ä»¥è¦è®¾ç½®tempæŒ‡å‘node1 &#125; //è™šæ‹ŸèŠ‚ç‚¹çš„åä¸€ä¸ªæ‰æ˜¯çœŸæ­£çš„å¤´èŠ‚ç‚¹ return dummyHead.next; &#125;&#125;//ç®€å•å†™å°±æ˜¯è¿™æ ·class Solution &#123; public ListNode swapPairs(ListNode head) &#123; ListNode dummy = new ListNode(); dummy.next = head; ListNode temp = dummy; while (head != null &amp;&amp; head.next != null)&#123; temp.next = head.next; head.next = head.next.next; temp.next.next = head; temp = head; head = head.next; &#125; return dummy.next; &#125;&#125; 25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨è¿™é¢˜è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ï¼Œåœ¨åšè¿™é¢˜ä¹‹å‰ï¼Œå¯ä»¥å…ˆç†è§£è¿™å‡ é¢˜ï¼š 206.ç¿»è½¬é“¾è¡¨ 92.ç¿»è½¬é“¾è¡¨â…¡ æ€è·¯ï¼šå…ˆç»Ÿè®¡é“¾è¡¨é•¿åº¦ï¼Œç„¶åæ¯ç¿»è½¬ä¸€ç»„ï¼Œé•¿åº¦-kï¼Œç›´åˆ°ä¸èƒ½ç¿»è½¬ä¸ºæ­¢ã€‚å†ç¿»è½¬æ¯ç»„æ—¶ï¼Œè¦ç»´æŠ¤å¥½è¿™æ®µé“¾è¡¨å’Œå…¶å‰åçš„å…³ç³»ã€‚è¿™é¢˜å’Œä¸Šé¢ä¸¤é¢˜ä¸åŒçš„æ˜¯ï¼Œè¦æ˜¾å¼çš„ä¸ºè¿™kç»„é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¥å£°æ˜ï¼Œä»¥æ­¤æ¥ç»´æŠ¤å‰åå…³ç³»ã€‚è¿™é¢˜æœ€å¥½è¿˜æ˜¯æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸¤è½®å°±çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹äº† è¯¦ç»†é¢˜è§£ï¼š25.Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨ å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132class Solution &#123; public ListNode reverseKGroup(ListNode head, int k) &#123; ListNode dummy = new ListNode(); dummy.next = head; ListNode cur = head; int count = 0; while (cur != null)&#123; cur = cur.next; count++; &#125; cur = head; ListNode node = dummy; ListNode pre = null; ListNode temp = pre; while (k &lt;= count)&#123; for (int i = 0; i &lt; k; i++) &#123; temp = cur.next; cur.next = pre; pre = cur; cur = temp; &#125; ListNode tail = node.next; node.next = pre; tail.next = cur; node = tail; count -= k; &#125; return dummy.next; &#125;&#125; 138. éšæœºé“¾è¡¨çš„å¤åˆ¶è¿˜æœ‰ä¸€ä¸ª133. å…‹éš†å›¾ ï¼Œæœ¬è´¨ä¸Šå’Œè¿™é¢˜ä¸€æ · æ€è·¯ï¼šå“ˆå¸Œè¡¨ï¼Œå…ˆåˆ›å»ºåŸé“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å’Œæ–°é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œç„¶åå†å¯¹æ–°é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹çš„nextå’Œrandomå…³ç³»è¿›è¡Œç»´æŠ¤ è¯¦ç»†é¢˜è§£ï¼š138.éšæœºé“¾è¡¨çš„å¤åˆ¶ å‚è€ƒä»£ç ï¼š 123456789101112131415161718class Solution &#123; public Node copyRandomList(Node head) &#123; HashMap&lt;Node, Node&gt; hashMap = new HashMap&lt;&gt;(); Node cur = head; while (cur != null)&#123; hashMap.put(cur, new Node(cur.val)); cur = cur.next; &#125; cur = head; while (cur != null)&#123; hashMap.get(cur).next = hashMap.get(cur.next); hashMap.get(cur).random = hashMap.get(cur.random); cur = cur.next; &#125; return hashMap.get(head); &#125;&#125; 148. æ’åºé“¾è¡¨åˆ†æ²»+é€’å½’ï¼Œæœ‰ç‚¹åƒå½’å¹¶æ’åºï¼ˆè¿™ä¸ªæˆ‘æš‚æ—¶è¿˜æ²¡å­¦ä¹ ï¼‰ æ€è·¯ï¼šå°†é“¾è¡¨åˆ†æˆä¸¤æ®µï¼Œè¿™ä¸¤æ®µè°ƒç”¨è¿™ä¸ªå‡½æ•°éƒ½æ’æˆæœ‰åºçš„äº†ï¼Œç„¶åå†å¯¹è¿™ä¸¤æ®µé“¾è¡¨åšåˆå¹¶ï¼Œç±»ä¼¼21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ è¯¦ç»†é¢˜è§£ï¼š148.æ’åºé“¾è¡¨ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627282930class Solution &#123; public ListNode sortList(ListNode head) &#123; if(head == null || head.next == null) return head; ListNode slow = head, fast = head.next; while (fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; &#125; ListNode temp = slow.next; slow.next = null; ListNode left = sortList(head); ListNode right = sortList(temp); ListNode dummy = new ListNode(); ListNode cur = dummy; while (left != null &amp;&amp; right != null)&#123; if(left.val &lt; right.val)&#123; cur.next = left; left = left.next; &#125;else &#123; cur.next = right; right = right.next; &#125; cur = cur.next; &#125; cur.next = left == null ? right : left; return dummy.next; &#125;&#125; 23. åˆå¹¶ K ä¸ªå‡åºé“¾è¡¨(éš¾â˜…) æ€è·¯ï¼šåˆ†æ²»ã€å½’å¹¶ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829class Solution &#123; public ListNode mergeKLists(ListNode[] lists) &#123; if(lists == null || lists.length == 0) return null; return merge(lists, 0, lists.length - 1); &#125; private ListNode merge(ListNode[] lists, int begin, int end) &#123; if(begin == end) return lists[begin]; int mid = begin + (end - begin)/2; ListNode left = merge(lists, begin, mid); ListNode right = merge(lists, mid + 1, end); return mergeList(left, right); &#125; //åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ private ListNode mergeList(ListNode a, ListNode b) &#123; if(a == null || b == null) return a == null ? b : a; if(a.val &lt; b.val)&#123; a.next = mergeList(a.next, b); return a; &#125;else &#123; b.next = mergeList(a, b.next); return b; &#125; &#125;&#125; 146. LRU ç¼“å­˜(éš¾)å±äºæ˜¯å®Œå…¨ä¸æƒ³å†™ç¬¬äºŒéçš„é¢˜ç›® æ€è·¯ï¼šæŠ½ä¹¦ åŒå‘å¾ªç¯é“¾è¡¨ï¼ˆå¸¦å“¨å…µèŠ‚ç‚¹ï¼‰è´Ÿè´£æ–¹ä¾¿æ’å…¥åˆ é™¤ å“ˆå¸Œè¡¨è´Ÿè´£O(1)å¤æ‚åº¦æ¥å¯»æ‰¾å…ƒç´  è¦å†™ä¸‰ä¸ªå‡½æ•°ï¼š åœ¨åŒå‘é“¾è¡¨ä¸­ç§»é™¤èŠ‚ç‚¹x åœ¨é“¾è¡¨å¤´éƒ¨æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹x ç¡®å®šå½“å‰é“¾è¡¨ä¸­æ˜¯å¦æœ‰èŠ‚ç‚¹xï¼ˆé€šè¿‡å“ˆå¸Œè¡¨å¯¹å€¼ä¸ºkeyçš„æ˜ å°„æ¥åˆ¤æ–­ å‚è€ƒé¢˜è§£ï¼šçµèŒ¶å±±çš„é¢˜è§£ è¯¦ç»†é¢˜è§£ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576class LRUCache &#123; //åŒå‘å¾ªç¯é“¾è¡¨çš„èŠ‚ç‚¹ç»“æ„ private static class Node&#123; int key,value; Node prev, next; Node(int key, int value)&#123; this.key = key; this.value = value; &#125; &#125; private final int capacity; private final Node dummy = new Node(0,0); //å“¨å…µèŠ‚ç‚¹ //å“ˆå¸Œè¡¨ï¼Œç”¨ä»¥ä¿å­˜å€¼å’ŒèŠ‚ç‚¹çš„å…³ç³»ï¼Œ private final HashMap&lt;Integer, Node&gt; keyToNode = new HashMap&lt;&gt;(); public LRUCache(int capacity) &#123; this.capacity = capacity; dummy.prev = dummy; dummy.next = dummy; &#125; public int get(int key) &#123; //å¦‚æœå“ˆå¸Œè¡¨ä¸å­˜åœ¨ï¼Œè¿”å›-1 Node node = getNode(key); //å¦‚æœå“ˆå¸Œè¡¨å­˜åœ¨ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹çš„å€¼ï¼ŒåŒæ—¶è¯¥èŠ‚ç‚¹ç”¨äº†ï¼Œè¦æŠŠå®ƒç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œæ€ä¹ˆç§»åŠ¨å‘¢ï¼Œç›´æ¥åˆ é™¤å†æ·»åŠ åˆ°å¤´éƒ¨ return node == null ? -1: node.value; &#125; public void put(int key, int value) &#123; //å¦‚æœå“ˆå¸Œè¡¨æœ‰è¿™ä¸ªkeyï¼Œå°±æŠŠå®ƒç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼ŒåŒæ—¶æ›´æ–°value Node node = getNode(key); if(node != null)&#123; //ç§»åŠ¨æ“ä½œåœ¨getNodeé‡Œé¢åšè¿‡äº†ï¼Œç›´æ¥æ›´æ–°è¿”å›å³å¯ node.value = value; return; &#125; //å¦‚æœæ²¡æœ‰è¿™ä¸ªkeyï¼Œå°±æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ’å…¥å¤´éƒ¨ï¼ŒåŒæ—¶æ’å…¥å“ˆå¸Œè¡¨ node = new Node(key, value); pushFront(node); keyToNode.put(key, node); if(keyToNode.size() &gt; capacity)&#123; //å¦‚æœæ’å…¥åå¤§äºå®¹é‡ï¼Œå°±è¦ç§»é™¤é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹,åŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¹Ÿè¦ç§»é™¤ Node backNode = dummy.prev; //å“¨å…µçš„å‰ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯é“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹ remove(backNode); keyToNode.remove(backNode.key); &#125; &#125; //getå’Œputéƒ½éœ€è¦ç¡®å®šå“ˆå¸Œè¡¨ä¸­æ˜¯å¦æœ‰keyæ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå› æ­¤å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªå‡½æ•° private Node getNode(int key)&#123; //ä¸å«è¿™ä¸ªkeyæ‰€å¯¹åº”çš„èŠ‚ç‚¹ if(!keyToNode.containsKey(key))&#123; return null; &#125; //å«çš„è¯ï¼Œä¸ä»…è¦è¿”å›è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿˜è¦æŠŠå®ƒç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œæ€ä¹ˆç§»åŠ¨å‘¢ï¼Œç›´æ¥åˆ é™¤å†æ·»åŠ åˆ°å¤´éƒ¨ Node node = keyToNode.get(key); remove(node); pushFront(node); return node; &#125; //åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ private void remove(Node x)&#123; x.next.prev = x.prev; x.prev.next = x.next; &#125; //åœ¨é“¾è¡¨å¤´éƒ¨æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ private void pushFront(Node x)&#123; dummy.next.prev = x; x.next = dummy.next; x.prev = dummy; dummy.next = x; &#125;&#125; å…«ã€äºŒå‰æ ‘94. äºŒå‰æ ‘çš„ä¸­åºéå† æ€è·¯ï¼šé€’å½’orè¿­ä»£ï¼ˆæ ˆï¼‰ã€‚è¿™ä¸¤ç§éƒ½è¦æŒæ¡ã€‚é€’å½’å°±ä¸è¯´äº†ï¼Œè¯´ä¸€ä¸‹è¿­ä»£çš„å¤§è‡´æ€è·¯ ç»´æŠ¤ä¸€ä¸ªæ ˆï¼Œä¸€ç›´å¾€æœ€å·¦è¾¹èµ°ï¼ŒåŒæ—¶ä¸æ–­æ·»åŠ èŠ‚ç‚¹åˆ°æ ˆï¼Œæ‰¾åˆ°æœ€å·¦èŠ‚ç‚¹ååŠ å…¥ç»“æœï¼Œç„¶åå‘å³éå†ï¼Œè¯¦ç»†è¿‡ç¨‹è§ä»£ç ï¼Œå¯æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹å°±æ¸…æ™°äº† è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š é€’å½’ç‰ˆ 123456789101112131415class Solution &#123; List&lt;Integer&gt; ans = new ArrayList&lt;&gt;(); public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; lnr(root); return ans; &#125; private void lnr(TreeNode root) &#123; if(root == null) return; lnr(root.left); ans.add(root.val); lnr(root.right); &#125;&#125; è¿­ä»£ç‰ˆ 123456789101112131415161718class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; ans = new ArrayList&lt;&gt;(); if(root == null) return ans; ArrayDeque&lt;TreeNode&gt; stack = new ArrayDeque&lt;&gt;(); while (root != null || !stack.isEmpty())&#123; while (root != null)&#123; stack.push(root); root = root.left; &#125; root = stack.pop(); ans.add(root.val); root = root.right; &#125; return ans; &#125;&#125; 104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ æ€è·¯ï¼šäºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ç­‰äºMAX(å·¦å­æ ‘æœ€å¤§æ·±åº¦ï¼Œå³å­æ ‘æœ€å¤§æ·±åº¦)+1 è¯¦ç»†é¢˜è§£ï¼š104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ å‚è€ƒä»£ç ï¼š 123456789class Solution &#123; public int maxDepth(TreeNode root) &#123; if(root == null) return 0; int left = maxDepth(root.left); int right = maxDepth(root.right); return Math.max(left, right) + 1; &#125;&#125; 226. ç¿»è½¬äºŒå‰æ ‘ æ€è·¯ï¼šç±»ä¼¼åœ¨æ•°ç»„ä¸­äº¤æ¢ä¸¤ä¸ªå…ƒç´ ã€‚è¿™é¢˜å…ˆäº¤æ¢ä¸¤ä¸ªå·¦å³å­æ ‘ï¼Œç„¶åå†é€’å½’çš„å¯¹å·¦å­æ ‘å’Œå³å­æ ‘è¿™æ ·æ“ä½œ è¯¦ç»†é¢˜è§£ï¼š226.ç¿»è½¬äºŒå‰æ ‘ å‚è€ƒä»£ç ï¼š 123456789101112class Solution &#123; public TreeNode invertTree(TreeNode root) &#123; if(root == null) return null; TreeNode temp = root.left; root.left = root.right; root.right = temp; invertTree(root.left); invertTree(root.right); return root; &#125;&#125; 101. å¯¹ç§°äºŒå‰æ ‘ æ€è·¯ï¼šå·¦å³å­æ ‘è¦æƒ³å¯¹ç§°ï¼Œå·¦å­æ ‘çš„å³èŠ‚ç‚¹â€”â€”å³å­æ ‘çš„å·¦èŠ‚ç‚¹ï¼›å·¦å­æ ‘çš„å·¦èŠ‚ç‚¹â€”â€”å³å­æ ‘çš„å³èŠ‚ç‚¹ è¯¦ç»†é¢˜è§£ï¼š101.å¯¹ç§°äºŒå‰æ ‘ å‚è€ƒä»£ç ï¼š 123456789101112131415161718class Solution &#123; public boolean isSymmetric(TreeNode root) &#123; return isD(root.left, root.right); &#125; private boolean isD(TreeNode left, TreeNode right) &#123; if(left == null &amp;&amp; right == null) return true; else if (left != null &amp;&amp; right != null) &#123; if(left.val != right.val) return false; &#125;else return false; boolean b1 = isD(left.left, right.right); boolean b2 = isD(left.right, right.left); return b1 &amp;&amp; b2; &#125;&#125; 543. äºŒå‰æ ‘çš„ç›´å¾„è¯¥é¢˜å’Œ124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ ç±»ä¼¼ æ€è·¯ï¼šäºŒå‰æ ‘çš„ç›´å¾„ &#x3D; MAX(ansï¼Œ å·¦å­æ ‘+å³å­æ ‘)ã€‚è¿™é¢˜ç‰¹æ®Šçš„æ˜¯è¿™ä¸ªâ€™é“¾é•¿â€™çš„å†™æ³•ã€‚å¦‚æœä¸ºç©ºèŠ‚ç‚¹äº†ï¼Œè¿”å›-1ï¼Œå·¦å­æ ‘å’Œå³å­æ ‘çš„é“¾é•¿åœ¨é€’å½’çš„åŸºç¡€ä¸Š+1ï¼Œå¯æŠµæ¶ˆè¿™ä¸ª-1ï¼Œç„¶åé€’å½’å‡½æ•°è¿”å›å·¦å³å­æ ‘ä¸­è¾ƒå¤§çš„é‚£ä¸ª è¯¦ç»†é¢˜è§£ï¼š543.äºŒå‰æ ‘çš„ç›´å¾„ å‚è€ƒä»£ç ï¼š 12345678910111213141516class Solution &#123; int ans = 0; public int diameterOfBinaryTree(TreeNode root) &#123; dfs(root); return ans; &#125; private int dfs(TreeNode root) &#123; if(root == null) return -1; int left = dfs(root.left) + 1; int right = dfs(root.right) + 1; ans = Math.max(ans, left + right); return Math.max(left, right); &#125;&#125; 102. äºŒå‰æ ‘çš„å±‚åºéå†BFSï¼Œè¿­ä»£ï¼ˆé˜Ÿåˆ—ï¼‰ã€‚è¿™ä¸ªé¢˜ä¹Ÿæ˜¯åŸºç¡€ï¼Œåç»­å¾ˆå¤šé¢˜éƒ½æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ”¹äº†ä¸€ç‚¹ç‚¹ æ€è·¯ï¼šå…ˆæŠŠå¤´èŠ‚ç‚¹å…¥é˜Ÿåˆ—ï¼Œæ¯æ¬¡å¼¹å‡ºé˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶æŠŠè¯¥èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹å…¥é˜Ÿåˆ— è¯¦ç»†é¢˜è§£ï¼š102.äºŒå‰æ ‘çš„å±‚åºéå† å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); if(root == null) return ans; ArrayDeque&lt;TreeNode&gt; deque = new ArrayDeque&lt;&gt;(); deque.offer(root); while (!deque.isEmpty())&#123; int size = deque.size(); List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; size; i++) &#123; TreeNode remove = deque.remove(); path.add(remove.val); if(remove.left != null) deque.offer(remove.left); if(remove.right != null) deque.offer(remove.right); &#125; ans.add(path); &#125; return ans; &#125; &#125; â¤ï¸äºŒå‰æ ‘BFSï¼ˆé˜Ÿåˆ—ï¼‰ç±»é¢˜ç›® 102. äºŒå‰æ ‘çš„å±‚åºéå† 199. äºŒå‰æ ‘çš„å³è§†å›¾ ä¸‹é¢ä¸º150çš„é¢˜ç›® 117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II 173. äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ 637. äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼ 103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå† 108. å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘ æ€è·¯ï¼šç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾ è¯¦ç»†é¢˜è§£ï¼š108.å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘ å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public TreeNode sortedArrayToBST(int[] nums) &#123; return build(0, nums.length - 1, nums); &#125; private TreeNode build(int low, int high, int[] nums) &#123; if(low &gt; high) return null; int mid = low + (high - low) / 2; TreeNode root = new TreeNode(nums[mid]); root.left = build(low, mid - 1, nums); root.right = build(mid + 1, high, nums); return root; &#125;&#125; â¤ï¸BSTé¢˜ç›®æ±‡æ€»åˆ†æ²»ï¼š 108. å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘ ã€ äºŒå‰æ ‘æ€§è´¨ï¼ˆä¸¥æ ¼é€’å¢ï¼‰ï¼š 98. éªŒè¯äºŒå‰æœç´¢æ ‘ 230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬ K å°çš„å…ƒç´  530. äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·® 98. éªŒè¯äºŒå‰æœç´¢æ ‘ æ€è·¯ï¼šå¦‚æœå½“å‰èŠ‚ç‚¹&lt;&#x3D;å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯´æ˜ä¸æ»¡è¶³BSTæ€§è´¨ã€‚è¿™é¢˜è¦ç‰¹åˆ«æ³¨æ„èŠ‚ç‚¹å€¼çš„èŒƒå›´ï¼Œè¦ç”¨longå‹ è¯¦ç»†é¢˜è§£ï¼š98.éªŒè¯äºŒå‰æœç´¢æ ‘ å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; long pre = Long.MIN_VALUE; public boolean isValidBST(TreeNode root) &#123; if(root == null) return true; if(!isValidBST(root.left)) return false; if(root.val &lt;= pre) return false; pre = root.val; if(!isValidBST(root.right)) return false; return true; &#125;&#125; 230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬ K å°çš„å…ƒç´  æ€è·¯ï¼šä¸­åºéå†ï¼Œåˆå§‹åŒ–index &#x3D; 1 è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718class Solution &#123; int ans = Integer.MAX_VALUE; int index = 1; public int kthSmallest(TreeNode root, int k) &#123; dfs(root, k); return ans; &#125; private void dfs(TreeNode root, int k) &#123; if(root == null) return; dfs(root.left, k); if(index == k) ans = root.val; index++; dfs(root.right, k); &#125;&#125; 199. äºŒå‰æ ‘çš„å³è§†å›¾ æ€è·¯ï¼šå±‚åºéå†ï¼Œåˆ°äº†æœ€åä¸€ä¸ªèŠ‚ç‚¹å°±ä¿å­˜è®°å½•ã€‚ è¯¦ç»†é¢˜è§£ï¼š199.äºŒå‰æ ‘çš„å³è§†å›¾ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122class Solution &#123; public List&lt;Integer&gt; rightSideView(TreeNode root) &#123; List&lt;Integer&gt; ans = new ArrayList&lt;&gt;(); ArrayDeque&lt;TreeNode&gt; deque = new ArrayDeque&lt;&gt;(); if(root == null) return ans; deque.offer(root); while (!deque.isEmpty())&#123; int size = deque.size(); for (int i = 0; i &lt; size; i++) &#123; TreeNode node = deque.remove(); if(i == size - 1) ans.add(node.val); if(node.left != null) deque.offer(node.left); if(node.right != null) deque.offer(node.right); &#125; &#125; return ans; &#125;&#125; 114. äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨ æ€è·¯ï¼šä¸æ–­åœ°å°†å·¦å­æ ‘æ›¿æ¢ä¸ºrootçš„å³å­æ ‘ï¼Œå¹¶å°†ä¹‹å‰çš„å³å­æ ‘æ‹¼åˆ°å…¶æ–°å³å­æ ‘ï¼ˆä¹Ÿå°±æ˜¯ä¹‹å‰çš„å·¦å­æ ‘ï¼‰çš„æœ€å³èŠ‚ç‚¹ä¹‹åï¼Œç„¶åæ›´æ–°root è¯¦ç»†é¢˜è§£ï¼š114.äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨ å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public void flatten(TreeNode root) &#123; while (root != null)&#123; if(root.left != null)&#123; TreeNode temp = root.left; TreeNode cur = temp; while (cur.right != null)&#123; cur = cur.right; &#125; cur.right = root.right; root.left = null; root.right = temp; &#125; root = root.right; &#125; &#125;&#125; 105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘éš¾å€’æ˜¯ä¸éš¾ï¼Œå°±æ˜¯ç¹çï¼Œå¾—æ…¢æ…¢æ¨¡æ‹Ÿé‚£ä¸ªä¼ å…¥çš„å€¼ ç±»ä¼¼çš„è¿˜æœ‰ï¼š106. ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ æ€è·¯ï¼šå€ŸåŠ©å“ˆå¸Œè¡¨å’Œå…¨å±€æ•°ç»„ï¼Œå‰è€…å­˜å‚¨ä¸­åºéå†æ•°ç»„&lt;å€¼ï¼Œç´¢å¼•&gt;ï¼Œåè€…èµ‹å€¼ä¸ºå‰åºéå†æ•°ç»„ã€‚é€šè¿‡å“ˆå¸Œè¡¨å¾—çŸ¥å½“å‰èŠ‚ç‚¹å€¼åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚è¿™é¢˜æœ€å…³é”®çš„æ˜¯å¦‚ä½•ç¡®å®šåœ¨å·¦å³å­æ ‘ä¸­ä¼ é€’çš„å€¼ è¯¦ç»†é¢˜è§£ï¼š105.ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021class Solution &#123; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); int[] p ; public TreeNode buildTree(int[] preorder, int[] inorder) &#123; p = preorder; for (int i = 0; i &lt; inorder.length; i++) &#123; map.put(inorder[i], i); &#125; return build(0, preorder.length - 1, 0, inorder.length - 1); &#125; private TreeNode build(int pb, int pe, int ib, int ie) &#123; if(pb &lt; 0 || ib &lt; 0 || pb &gt; pe || ib &gt; pe) return null; int index = map.get(p[pb]); TreeNode root = new TreeNode(p[pb]); root.left = build(pb + 1, pb + index - ib, ib, index - 1); root.right = build(pb + index + 1 - ib, pe, index + 1, ie); return root; &#125;&#125; åé¢å‡ é¢˜éƒ½æœ‰ç‚¹é‚ªä¹äº†ã€‚ã€‚ 437. è·¯å¾„æ€»å’Œ III ï¼ˆå°éš¾å“ˆå¸Œè¡¨+å‰ç¼€å’Œï¼Œç±»ä¼¼560. å’Œä¸º K çš„å­æ•°ç»„ æ€è·¯ï¼šå“ˆå¸Œè¡¨ä¿å­˜&lt;å½“å‰è·¯å¾„ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„èŠ‚ç‚¹å€¼ä¹‹å’Œï¼Œå‡ºç°æ¬¡æ•°&gt;ï¼Œå¦‚æœæƒ³åœ¨å½“å‰è·¯å¾„æ‰¾åˆ°ä¸€æ®µè·¯å¾„ä¹‹å’Œä¸ºtargetï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨ä¸­å¿…é¡»æœ‰è¿™æ ·çš„å…ƒç´ ï¼Œå³å½“å‰èŠ‚ç‚¹å€¼ä¹‹å’Œ - è¯¥å…ƒç´ çš„key &#x3D; targetã€‚è¿˜æœ‰ä¸€äº›ç»†èŠ‚å‚è€ƒè¯¦ç»†é¢˜è§£ï¼Œè¿™é¢˜æ ¸å¿ƒæ€è·¯å°±æ˜¯è¿™æ ·ï¼Œä½†è¿˜æœ‰ä¸€äº›ç¹ççš„å°ç»†èŠ‚ï¼Œæ¯”å¦‚å“ˆå¸Œè¡¨keyçš„ç±»å‹ï¼ŒçŠ¶æ€æ¢å¤ï¼ˆå› ä¸ºé¢˜ç›®è¦æ±‚åªèƒ½æ˜¯ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼Œä¹Ÿå³æ˜¯ä¸èƒ½è·¨è¶Šçˆ¶èŠ‚ç‚¹æœ‰ä¸¤æ®µå­æ ‘å‚ä¸ï¼‰ è¯¦ç»†é¢˜è§£ï¼š437.è·¯å¾„æ€»å’Œ III å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223class Solution &#123; HashMap&lt;Long, Integer&gt; map = new HashMap&lt;&gt;(); int targrt; public int pathSum(TreeNode root, int targetSum) &#123; targrt =targetSum; map.put(0L, 1); return dfs(root, 0L); &#125; private int dfs(TreeNode root, long curSum) &#123; if(root == null) return 0; curSum += root.val; int ans = 0; ans += map.getOrDefault(curSum - targrt, 0); map.put(curSum, map.getOrDefault(curSum, 0) + 1); int left = dfs(root.left, curSum); int right = dfs(root.right, curSum); ans += left + right; map.put(curSum, map.get(curSum) - 1); return ans; &#125;&#125; 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ ï¼ˆæ€è·¯æœ‰ç‚¹æ‡µæ‡‚ æ€è·¯ï¼šè¿™é¢˜å¯ç›´æ¥å‚è€ƒKrahets çš„é¢˜è§£ï¼Œä»–è¿™ä¸ªæ€è·¯å¾ˆæ¸…æ™°ï¼Œä»£ç æˆ‘æ˜¯å‚è€ƒçš„çµèŒ¶å±±è‰¾åºœçš„ï¼Œè¿™ä¸ªä»£ç æ¯”è¾ƒå¥½å†™ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011class Solution &#123; public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if(root == null || p == root || q == root) return root; TreeNode l = lowestCommonAncestor(root.left, p, q); TreeNode r = lowestCommonAncestor(root.right, p, q); if(l != null &amp;&amp; r != null) return root; return l == null ? r : l; &#125;&#125; 124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ æ€è·¯ï¼šé€’å½’å‡½æ•°è¿”å›å½“å‰èŠ‚ç‚¹åŠå…¶å·¦å³å­æ ‘è¾ƒå¤§å€¼ä¹‹å’Œä¸0çš„æ¯”è¾ƒï¼Œè€Œansè¦å–å½“å‰èŠ‚ç‚¹å’Œå…¶å·¦å³å­æ ‘ä¹‹å’Œä¸andçš„è¾ƒå¤§å€¼ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516class Solution &#123; int ans = Integer.MIN_VALUE; public int maxPathSum(TreeNode root) &#123; dfs(root); return ans; &#125; private int dfs(TreeNode root) &#123; if(root == null) return 0; int left = dfs(root.left); int right = dfs(root.right); ans = Math.max(ans, left + right + root.val); return Math.max(0, Math.max(left, right) + root.val); &#125;&#125; ä¹ã€å›¾è®ºå››ä¸ªé¢˜ç›®åˆ†åˆ«æ¶‰åŠäº†DFSã€BFSã€æ‹“æ‰‘æ’åº 200. å²›å±¿æ•°é‡ æ€è·¯ï¼šéå†æ¯ä¸ªå•å…ƒæ ¼ï¼Œå½“é‡åˆ°é™†åœ°ï¼ˆ&#39;1&#39;ï¼‰æ—¶ï¼Œå°†å…¶æ‰€æœ‰ç›¸è¿çš„é™†åœ°æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œä»è€Œç»Ÿè®¡ä¸ºä¸€ä¸ªå²›å±¿ã€‚ éå†æ•´ä¸ªç½‘æ ¼çš„æ¯ä¸€ä¸ªæ ¼å­ã€‚ å½“é‡åˆ°ä¸€ä¸ªâ€™1â€™æ—¶ï¼Œå²›å±¿æ•°é‡åŠ ä¸€ã€‚ ç„¶åä½¿ç”¨DFSæˆ–BFSå°†è¿™ä¸ªå²›å±¿çš„æ‰€æœ‰ç›¸è¿çš„â€™1â€™éƒ½æ ‡è®°ä¸ºâ€™0â€™ï¼Œé˜²æ­¢é‡å¤è®¡æ•°ã€‚ ç»§ç»­éå†å‰©ä¸‹çš„æ ¼å­ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526class Solution &#123; public int numIslands(char[][] grid) &#123; int m = grid.length; int n = grid[0].length; int ans = 0; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if(grid[i][j] == &#x27;1&#x27;)&#123; dfs(i, j, grid); ans++; &#125; &#125; &#125; return ans; &#125; private void dfs(int i, int j, char[][] grid) &#123; if(i &lt; 0 || j &lt; 0 || i &gt;= grid.length || j &gt;= grid[0].length || grid[i][j] != &#x27;1&#x27;) return; grid[i][j] = &#x27;0&#x27;; dfs(i - 1, j, grid); dfs(i + 1, j, grid); dfs(i, j - 1,grid); dfs(i, j + 1,grid); &#125;&#125; 994. è…çƒ‚çš„æ©˜å­ æ€è·¯ï¼šBFSï¼ˆé˜Ÿåˆ—ï¼‰ã€‚é€å±‚å¤„ç†é˜Ÿåˆ—ä¸­çš„è…çƒ‚æ©˜å­ï¼Œå°†å‘¨å›´çš„æ–°é²œæ©˜å­æ„ŸæŸ“ï¼Œå¹¶åŠ å…¥é˜Ÿåˆ—ã€‚æ¯ä¸€å±‚å¯¹åº”ä¸€åˆ†é’Ÿçš„æ‰©æ•£æ—¶é—´ã€‚ è¯¦ç»†é¢˜è§£ï¼š994.è…çƒ‚çš„æ©˜å­ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243class Solution &#123; public int orangesRotting(int[][] grid) &#123; int m = grid.length; int n = grid[0].length; Queue&lt;int[]&gt; queue = new LinkedList&lt;&gt;(); int fresh = 0; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if(grid[i][j] == 2) //è¯´æ˜æ˜¯è…çƒ‚çš„æ©˜å­ï¼Œå°†åæ ‡åŠ å…¥é˜Ÿåˆ— queue.offer(new int[]&#123;i, j&#125;); else if (grid[i][j] == 1) &#123; fresh++; &#125; &#125; &#125; if(fresh == 0) //è¯´æ˜æ²¡æœ‰æ–°é²œæ©˜å­ return 0; int time = 0; int[][] direction = &#123;&#123;-1, 0&#125;, &#123;1, 0&#125;, &#123;0, -1&#125;, &#123;0, 1&#125;&#125;; while (!queue.isEmpty())&#123; int size = queue.size(); boolean flag = false; //ç”¨äºæ ‡è®°å½“å‰éå†æ˜¯å¦æ„ŸæŸ“äº†æ–°é²œæ©˜å­ for (int i = 0; i &lt; size; i++) &#123; int[] cur = queue.poll(); for (int[] dire : direction) &#123; int x = cur[0] + dire[0]; int y = cur[1] + dire[1]; //å¦‚æœæ²¡è¶Šç•Œä¸”æ˜¯æ–°é²œæ©˜å­ï¼Œå°±ç»™è…çƒ‚ if(x &gt;=0 &amp;&amp; x &lt; m &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; n &amp;&amp; grid[x][y] == 1)&#123; grid[x][y] = 2; queue.offer(new int[]&#123;x, y&#125;); fresh--; flag = true; &#125; &#125; &#125; if(flag) time++; &#125; return fresh == 0 ? time : -1; &#125;&#125; 207. è¯¾ç¨‹è¡¨ æ€è·¯ï¼šæ‹“æ‰‘æ’åºï¼ˆDFSæ£€æµ‹ç¯ï¼‰ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738class Solution &#123; public boolean canFinish(int numCourses, int[][] prerequisites) &#123; List&lt;List&lt;Integer&gt;&gt; graph = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; numCourses; i++) &#123; //é‚»æ¥è¡¨æ„å»ºå›¾ graph.add(new ArrayList&lt;&gt;()); &#125; for (int[] pre : prerequisites) &#123; //(a,b)è¦æƒ³å­¦ä¹ aå¾—å…ˆå­¦ä¹ bï¼Œå› æ­¤æ„å»ºbâ€”â€”&gt;açš„æœ‰å‘è¾¹ graph.get(pre[1]).add(pre[0]); &#125; int[] visited = new int[numCourses]; //çŠ¶æ€æ•°ç»„ï¼Œ0=æœªè®¿é—®ï¼Œ1=æ­£åœ¨è®¿é—®ï¼Œ2=å·²è®¿é—® for (int i = 0; i &lt; numCourses; i++) &#123; //æ£€æµ‹æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ç¯ if(hasCycle(graph, visited, i)) return false; &#125; return true; &#125; private boolean hasCycle(List&lt;List&lt;Integer&gt;&gt; graph, int[] visited, int course) &#123; if(visited[course] == 1) // å¦‚æœè¯¾ç¨‹å·²ç»è®¿é—®è¿‡ä¸”åœ¨å½“å‰è·¯å¾„ä¸Šï¼Œè¯´æ˜å­˜åœ¨ç¯ return true; if(visited[course] == 2) // å¦‚æœè¯¾ç¨‹å·²ç»è®¿é—®è¿‡ä¸”ä¸åœ¨å½“å‰è·¯å¾„ä¸Šï¼Œè¯´æ˜æ²¡æœ‰ç¯ return false; visited[course] = 1; for (int nextCourse : graph.get(course)) &#123; // é€’å½’è®¿é—®å½“å‰è¯¾ç¨‹çš„æ‰€æœ‰ä¾èµ–è¯¾ç¨‹ if(hasCycle(graph, visited, nextCourse)) return true; &#125; visited[course] = 2; return false; &#125;&#125; 208. å®ç° Trie (å‰ç¼€æ ‘)è¿™é‡Œè¦æ„å»ºä¸€ä¸ªå›¾ï¼Œå®ƒçš„èŠ‚ç‚¹ä»£è¡¨çš„æ˜¯ç´¢å¼•å·ï¼Œè€Œè¾¹ä¸Šé¢å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å­—ç¬¦ æ€è·¯ï¼šè‡ªå®šä¹‰å›¾èŠ‚ç‚¹çš„å±æ€§ï¼Œç„¶åæ¨¡æ‹Ÿå›¾çš„åˆ›å»ºå’ŒæŸ¥æ‰¾è¿‡ç¨‹ è¯¦ç»†é¢˜è§£ï¼šå‚è€ƒä»£ç æ³¨é‡Šï¼Œå†™çš„å¾ˆè¯¦ç»† å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class Trie &#123; /* å®šä¹‰èŠ‚ç‚¹ç±»ï¼Œç›¸å½“äºæ¯ä¸ªèŠ‚ç‚¹æœ‰26ä¸ªå­èŠ‚ç‚¹ï¼Œä½†åªæœ‰çœŸæ­£æœ‰å€¼çš„æ‰æœ‰èŠ‚ç‚¹ï¼Œå…¶ä½™éƒ½ä¸ºnullã€‚ å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ ‡å¿—ä½ç”¨æ¥æ ‡è®°å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ */ public class TrieNode&#123; TrieNode[] children; boolean isEnd; TrieNode()&#123; children = new TrieNode[26]; isEnd = false; &#125; &#125; TrieNode root; public Trie() &#123; root = new TrieNode(); &#125; public void insert(String word) &#123; TrieNode node = root; for (char c : word.toCharArray()) &#123; int index = c - &#x27;a&#x27;; //å¾—åˆ°æœ‰å€¼çš„èŠ‚ç‚¹çš„ç´¢å¼• if(node.children[index] == null) node.children[index] = new TrieNode(); node = node.children[index]; //ç›¸å½“äºèŠ‚ç‚¹åç§» &#125; node.isEnd = true; //æ­¤æ—¶è¯¥å­—ç¬¦ä¸²éå†å®Œäº†ï¼Œnodeä¸€å®šæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ &#125; /* æ ¹æ®è¿™ä¸ªå•è¯çš„è·¯å¾„ä¸€ç›´èµ°ï¼Œå¦‚æœä¸­é—´å“ªä¸ªä¸ºnulläº†è¯´æ˜å­—ç¬¦æœªå‡ºç°ç›´æ¥è¿”å›false å¦åˆ™å®‰å…¨éå†å®Œä¹‹åè¿˜è¦ç¡®è®¤å½“å‰å­—ç¬¦æ˜¯å¦ä¸ºæœ€åä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯è¯´æ˜å®ƒåªæ˜¯ä¸€ä¸ªå‰ç¼€ï¼Œè¿˜è¦è¿”å›false */ public boolean search(String word) &#123; // TrieNode node = root; for (char c : word.toCharArray()) &#123; int index = c - &#x27;a&#x27;; if(node.children[index] == null) return false; node = node.children[index]; &#125; return node.isEnd; &#125; /* æ€è·¯åŒä¸Šï¼Œä¸åŒçš„æ˜¯æœ€åä¸éœ€è¦å…³æ³¨å®ƒæ˜¯å¦ä¸ºæœ€åä¸€ä¸ªå­—ç¬¦äº†ï¼Œå› ä¸ºè¿™é‡Œåªæ˜¯æ‰¾å‰ç¼€ */ public boolean startsWith(String prefix) &#123; TrieNode node = root; for (char c : prefix.toCharArray()) &#123; int index = c - &#x27;a&#x27;; if(node.children[index] == null) return false; node = node.children[index]; &#125; return true; &#125;&#125; åã€å›æº¯å›æº¯ï¼Œä¸»è¦å°±æ˜¯å¥—æ¨¡æ¿ã€‚æˆ‘æ„Ÿè§‰æœ€å…³é”®çš„å°±æ˜¯ä¸¤ä¸ªè¦ç´ ï¼š å›æº¯ä¼ é€’çš„å‚æ•° å›æº¯é€€å‡ºçš„æ¡ä»¶ 46. å…¨æ’åˆ— æ€è·¯ï¼šå¯ä»¥ç”¨ä¸€ä¸ªlistæ¥å­˜å‚¨æ¯ç»„çš„å…ƒç´ ã€‚é€€å‡ºæ¡ä»¶å°±æ˜¯list.size() == nums.lengthï¼ŒåŒæ—¶è¦èƒ½åŠ å…¥listçš„å‰ææ˜¯listä¸å«å½“å‰å…ƒç´  è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920class Solution &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) &#123; backTracking(nums); return ans; &#125; private void backTracking(int[] nums) &#123; if(path.size() == nums.length) ans.add(new ArrayList&lt;&gt;(path)); for (int num : nums) &#123; if(!path.contains(num))&#123; path.add(num); backTracking(nums); path.remove(path.size() - 1); &#125; &#125; &#125;&#125; 78. å­é›† æ€è·¯ï¼šè¿™é¢˜æœ‰ç‚¹ç‰¹æ®Šçš„æ˜¯ï¼Œæ¯ä¸ªåˆ†ç»„éƒ½è¦æ·»åŠ åˆ°ç»“æœï¼Œæ‰€ä»¥ä¸ç”¨å†™é€€å‡ºæ¡ä»¶äº† è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums) &#123; backTracking(nums, 0); return ans; &#125; private void backTracking(int[] nums, int begin) &#123; ans.add(new ArrayList&lt;&gt;(path)); for (int i = begin; i &lt; nums.length; i++) &#123; path.add(nums[i]); backTracking(nums, i + 1); path.remove(path.size() - 1); &#125; &#125;&#125; 17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ æ€è·¯ï¼šå€ŸåŠ©å“ˆå¸Œè¡¨å­˜å‚¨ç”µè¯å·ç å’Œå­—ç¬¦ä¸²çš„æ˜ å°„å…³ç³»ï¼Œä¼ å…¥å­—ç¬¦ä¸²å³å¼€å§‹ç´¢å¼•beginï¼Œé€€å‡ºæ¡ä»¶ä¸ºbegin == digits.length() è¯¦ç»†é¢˜è§£ï¼š17.ç”µè¯å·ç çš„å­—æ¯ç»„åˆ å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435class Solution &#123; List&lt;String&gt; ans = new ArrayList&lt;&gt;(); HashMap&lt;Character, String&gt; map = new HashMap&lt;&gt;(); StringBuilder sb = new StringBuilder(); public List&lt;String&gt; letterCombinations(String digits) &#123; if(digits.isEmpty()) return ans; map.put(&#x27;2&#x27;, &quot;abc&quot;); map.put(&#x27;3&#x27;, &quot;def&quot;); map.put(&#x27;4&#x27;, &quot;ghi&quot;); map.put(&#x27;5&#x27;, &quot;jkl&quot;); map.put(&#x27;6&#x27;, &quot;mno&quot;); map.put(&#x27;7&#x27;, &quot;pqrs&quot;); map.put(&#x27;8&#x27;, &quot;tuv&quot;); map.put(&#x27;9&#x27;, &quot;wxyz&quot;); backTracking(digits, 0); return ans; &#125; private void backTracking(String digits, int begin) &#123; if(begin == digits.length())&#123; ans.add(sb.toString()); return; &#125; char c = digits.charAt(begin); String curS = map.get(c); for (int i = 0; i &lt; curS.length(); i++) &#123; sb.append(curS.charAt(i)); backTracking(digits, begin + 1); sb.deleteCharAt(sb.length() - 1); &#125; &#125;&#125; 39. ç»„åˆæ€»å’Œ æ€è·¯ï¼šä¼ å…¥æ•°ç»„å¼€å§‹ç´¢å¼•beginï¼Œå½“å‰å’Œcurï¼Œç›®æ ‡å€¼ï¼Œæ•°ç»„ã€‚ç»“æŸæ¡ä»¶æ˜¯begin == candidates.length || cur == targetï¼Œä¹Ÿæœ‰å¯èƒ½æå‰é€€å‡ºï¼Œé‚£å°±æ˜¯cur &gt; target è¯¦ç»†é¢˜è§£ï¼š39.ç»„åˆæ€»å’Œ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324class Solution &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; combinationSum(int[] candidates, int target) &#123; backTracking(0, 0, target, candidates); return ans; &#125; private void backTracking(int begin, int cur, int target, int[] candidates) &#123; if(cur == target)&#123; ans.add(new ArrayList&lt;&gt;(path)); return; &#125; if(cur &gt; target || begin == candidates.length) return; for (int i = begin; i &lt; candidates.length; i++) &#123; cur += candidates[i]; path.add(candidates[i]); backTracking(i, cur, target, candidates); path.remove(path.size() - 1); cur -= candidates[i]; &#125; &#125;&#125; 22. æ‹¬å·ç”Ÿæˆ æ€è·¯ï¼šä¼ å…¥å½“å‰å·¦æ‹¬å·å‰©ä½™leftå’Œå³æ‹¬å·å‰©ä½™rightä»¥åŠå½“å‰å­—ç¬¦ä¸²curã€‚é€€å‡ºæ¡ä»¶æ˜¯left == 0 &amp;&amp; right == 0ã€‚è¿˜è¦ä¸€ä¸ªæå‰é€€å‡ºæ¡ä»¶ï¼Œå°±æ˜¯left &gt; rightï¼Œæ­¤æ—¶æ— æ³•ç»„æˆåˆæ³•çš„æ‹¬å·ã€‚è¿™é‡Œå›æº¯çš„å†™æ³•å½¢å¼ä¹Ÿä¸å¤ªä¸€æ ·ã€‚ è¯¦ç»†é¢˜è§£ï¼š22.æ‹¬å·ç”Ÿæˆ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021class Solution &#123; List&lt;String&gt; ans = new ArrayList&lt;&gt;(); public List&lt;String&gt; generateParenthesis(int n) &#123; backTracking(n, n, &quot;&quot;); return ans; &#125; private void backTracking(int left, int right, String cur) &#123; if(left == 0 &amp;&amp; right == 0)&#123; ans.add(cur); return; &#125; if(left &gt; right) return; if(left &gt; 0)&#123; backTracking(left-1, right, cur + &quot;(&quot;); &#125; if(right &gt; 0) backTracking(left, right-1, cur + &quot;)&quot;); &#125;&#125; 79. å•è¯æœç´¢ æ€è·¯ï¼šDFSï¼Œä»çŸ©é˜µæ¯ä¸ªå…ƒç´ å¼€å§‹åŒ¹é…ï¼ŒåŒ¹é…äº†ä¿®æ”¹å½“å‰å­—ç¬¦ä¸º&#96;.&#96;&#96;,è¡¨ç¤ºå·²ç»ç”¨è¿‡ï¼Œæœç´¢å®Œä¹‹åå›æº¯ä¸ºä¹‹å‰çš„å­—ç¬¦ è¯¦ç»†é¢˜è§£ï¼š79.å•è¯æœç´¢ å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627public boolean exist(char[][] board, String word) &#123; int m = board.length; int n = board[0].length; int k = 0; for (int i = 0; i &lt; m; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; if(backTracking(i, j, board, word, k)) return true; &#125; &#125; return false; &#125; private boolean backTracking(int i, int j, char[][] board, String word, int k) &#123; if(i &lt; 0 || j &lt; 0 || i &gt;= board.length || j &gt;= board[0].length || word.charAt(k) != board[i][j]) return false; if(k == word.length() - 1) //è¿™ä¸€æ­¥è¦æ³¨æ„ï¼Œå› ä¸ºä¸Šé¢æ²¡æœ‰å¯¹kçš„è¶Šç•Œåˆ¤æ–­ï¼Œæ‰€ä»¥è¿™é‡Œå°±è¦æœ‰ä¸€ä¸ªåˆ¤çœŸçš„é€€å‡º return true; char tem = board[i][j]; board[i][j] = &#x27;.&#x27;; boolean ans = backTracking(i + 1, j, board, word, k + 1) || backTracking(i - 1, j, board, word, k + 1) || backTracking(i, j + 1, board, word, k + 1) || backTracking(i, j - 1, board, word, k + 1); board[i][j] = tem; return ans; &#125; 131. åˆ†å‰²å›æ–‡ä¸² æ€è·¯ï¼šæ¯ä¸ªå­—ç¬¦åœ¨å›æº¯å¾ªç¯ä¸­å¾€ååŒ¹é…ï¼Œéœ€è¦å†™ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦ä¸ºå›æ–‡ä¸²çš„å‡½æ•°ï¼Œå¦‚æœæ˜¯å°±æ·»åŠ è¿›ä¸­é—´ç»“æœé›†ã€‚å›æº¯ä¼ å…¥å­—ç¬¦ä¸²å’Œå¼€å§‹ç´¢å¼•ï¼Œé€€å‡ºæ¡ä»¶ä¸ºå¼€å§‹ç´¢å¼•ç­‰äºå­—ç¬¦ä¸²é•¿åº¦ è¯¦ç»†é¢˜è§£ï¼š131. åˆ†å‰²å›æ–‡ä¸² å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233class Solution &#123; List&lt;List&lt;String&gt;&gt; ans = new ArrayList&lt;&gt;(); List&lt;String&gt; path = new ArrayList&lt;&gt;(); public List&lt;List&lt;String&gt;&gt; partition(String s) &#123; backTracking(s, 0); return ans; &#125; private void backTracking(String s, int begin) &#123; if(begin == s.length())&#123; ans.add(new ArrayList&lt;&gt;(path)); return; &#125; for (int i = begin; i &lt; s.length(); i++) &#123; if(isH(s, begin, i))&#123; String substring = s.substring(begin, i + 1); path.add(substring); backTracking(s, i + 1); path.remove(path.size() - 1); &#125; &#125; &#125; private boolean isH(String s, int l, int r) &#123; while (l &lt;= r)&#123; if(s.charAt(l) != s.charAt(r)) return false; l++; r--; &#125; return true; &#125;&#125; 51. N çš‡å æ€è·¯ï¼šå›æº¯å‡½æ•°ä¼ å…¥æ£‹ç›˜æ•°ç»„å’Œå½“å‰è¡Œç´¢å¼•ï¼Œé€€å‡ºæ¡ä»¶ä¸ºå½“å‰è¡Œç´¢å¼•ç­‰äºæ£‹ç›˜å®½ï¼Œå›æº¯é‡Œé¢çš„å¾ªç¯æ˜¯åˆ—å¾ªç¯ã€‚åŒä¸Šé¢˜ä¸€æ ·ï¼Œéœ€è¦å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œåˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯å¦å¯ä»¥ä½œä¸ºQã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åˆ¤æ–­å½“å‰è¡Œï¼Œåˆ—ï¼Œä¸»å¯¹è§’ï¼Œå‰¯å¯¹è§’æ˜¯å¦æœ‰å…¶å®ƒQã€‚ è¯¦ç»†é¢˜è§£ï¼š51. N çš‡å å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556class Solution &#123; List&lt;List&lt;String&gt;&gt; ans = new ArrayList&lt;&gt;(); List&lt;String&gt; path = new ArrayList&lt;&gt;(); public List&lt;List&lt;String&gt;&gt; solveNQueens(int n) &#123; char[][] chars = new char[n][n]; for (int i = 0; i &lt; n; i++) &#123; for (int j = 0; j &lt; n; j++) &#123; chars[i][j] = &#x27;.&#x27;; &#125; &#125; backTracking(0, chars); return ans; &#125; private void backTracking(int row, char[][] chars) &#123; if(row == chars.length)&#123; ans.add(chars2List(chars)); return; &#125; for (int col = 0; col &lt; chars[0].length; col++) &#123; if(isT(row, col, chars))&#123; chars[row][col] = &#x27;Q&#x27;; backTracking(row + 1, chars); chars[row][col] = &#x27;.&#x27;; &#125; &#125; &#125; private List&lt;String&gt; chars2List(char[][] chars) &#123; List&lt;String&gt; ans = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; chars.length; i++) &#123; ans.add(new String(chars[i])); &#125; return ans; &#125; private boolean isT(int row, int col, char[][] chars) &#123; int m = chars.length; int n = chars[0].length; for (int i = 0; i &lt; m; i++) &#123; if(chars[i][col] == &#x27;Q&#x27;) return false; &#125; for (int i = 0; i &lt; n; i++) &#123; if(chars[row][i] == &#x27;Q&#x27;) return false; &#125; for (int i = row, j = col; i &gt;= 0 &amp;&amp; j &gt;= 0; i--, j--) if(chars[i][j] == &#x27;Q&#x27;) return false; for (int i = row, j = col; i &gt;= 0 &amp;&amp; j &lt; n; i--, j++) if(chars[i][j] == &#x27;Q&#x27;) return false; return true; &#125;&#125; åä¸€ã€äºŒåˆ†æŸ¥æ‰¾35. æœç´¢æ’å…¥ä½ç½® æ€è·¯ï¼šäºŒåˆ†æŸ¥æ‰¾æ‰¾å­˜åœ¨æ—¶çš„å…ƒç´ è¿™æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå½“å…ƒç´ ä¸å­˜åœ¨æ—¶ï¼Œä¸ºä»€ä¹ˆè¿”å›low å°±å¯ä»¥äº†å‘¢ï¼Œè§‚å¯Ÿwhileé€€å‡ºæ¡ä»¶ï¼Œé€€å‡ºæ—¶ï¼Œlow &#x3D; high + 1 è¯¦ç»†é¢˜è§£ï¼š35. æœç´¢æ’å…¥ä½ç½® å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public int searchInsert(int[] nums, int target) &#123; int low = 0, high = nums.length- 1; while (low &lt;= high)&#123; int mid = low + (high - low) / 2; if(nums[mid] == target) return mid; else if (nums[mid] &gt; target) &#123; high = mid - 1; &#125;else low = mid + 1; &#125; return low; &#125;&#125; 74. æœç´¢äºŒç»´çŸ©é˜µ æ€è·¯ï¼šå°†çŸ©é˜µæŒ‰è¡Œå±•å¼€æ‹¼æˆä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå¯ä»¥å‘ç°å°±æ˜¯å¯¹è¿™ä¸ªæ•°ç»„æ¥è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ¯æ¬¡å¾—åˆ°çš„midå’Œè¡Œåˆ—æœ‰ä¸€ä¸ªå¯¹åº”å…³ç³»ï¼Œrow = mid / n, col = mid % n è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516171819class Solution &#123; public boolean searchMatrix(int[][] matrix, int target) &#123; int m = matrix.length; int n = matrix[0].length; int low = 0, high = m * n - 1; while (low &lt;= high)&#123; int mid = low + (high - low) / 2; int row = mid / n; int col = mid % n; if(matrix[row][col] == target) return true; else if (matrix[row][col] &gt; target) &#123; high = mid - 1; &#125;else low = mid + 1; &#125; return false; &#125;&#125; 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½® æ€è·¯ï¼šäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œé‚£å°±æ­£å¸¸å¥—è·¯ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œç›´æ¥ä»å½“å‰ä½ç½®å‘å·¦å³æ‰©æ•£ï¼Œç›´åˆ°æ‰©æ•£çš„å…ƒç´ ä¸ç­‰äºtarget è¯¦ç»†é¢˜è§£ï¼š34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½® å‚è€ƒä»£ç ï¼š 12345678910111213141516171819class Solution &#123; public int[] searchRange(int[] nums, int target) &#123; int low = 0, high = nums.length - 1; while (low &lt;= high)&#123; int mid = low + (high - low) / 2; if(nums[mid] &gt; target) high = mid - 1; else if(nums[mid] &lt; target) low = mid + 1; else &#123; int l = mid, r = mid; while (l &gt;= 0 &amp;&amp; nums[l] == target) l--; while (r &lt; nums.length &amp;&amp; nums[r] == target) r++; return new int[]&#123;l + 1, r - 1&#125;; &#125; &#125; return new int[] &#123;-1, -1&#125;; &#125;&#125; 33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ æ€è·¯ï¼šè¿™ç§æ•°ç»„æ˜¯å±€éƒ¨æœ‰åºï¼Œå…¨å±€æ— åºï¼Œæ¯”å¦‚å‰åŠéƒ¨åˆ†æ˜¯æœ‰åºçš„ï¼ŒååŠéƒ¨åˆ†ä¹Ÿæ˜¯æœ‰åºçš„ã€‚æˆ‘ä»¬åšäºŒåˆ†æŸ¥æ‰¾æ—¶ï¼Œå¦‚æœå½“å‰midå…ƒç´ ä¸ç­‰äºtargetï¼Œé‚£å°±åˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¤„äºå·¦è¾¹æœ‰åºåŒºé—´è¿˜æ˜¯å³è¾¹æœ‰åºåŒºé—´ï¼Œç„¶åå†åˆ†åˆ«åšåŒºé—´ç¼©å‡ è¯¦ç»†é¢˜è§£ï¼š33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122class Solution &#123; public int search(int[] nums, int target) &#123; int low = 0, high = nums.length - 1; while (low &lt;= high)&#123; int mid = low + (high - low) / 2; if(nums[mid] == target) return mid; else if (nums[mid] &lt; nums[high]) &#123; if(nums[mid] &lt; target &amp;&amp; target &lt;= nums[high]) low = mid + 1; else high = mid - 1; &#125;else &#123; if(target &gt;= nums[low] &amp;&amp; target &lt; nums[mid]) high = mid - 1; else low = mid + 1; &#125; &#125; return -1; &#125;&#125; 153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ æ€è·¯ï¼šåŒä¸Šé¢˜ä¸€æ ·ï¼Œè¿™ç§æ—‹è½¬æ•°ç»„è¦åˆ†åŒºé—´ã€‚å¦‚æœæ˜¯åœ¨å·¦è¾¹åŒºé—´ï¼Œå°±å°†æœ€å°å€¼å’Œleftæ¯”è¾ƒï¼Œå¦‚æœæ˜¯åœ¨æœ€å³è¾¹ï¼Œå°±å°†æœ€å°å€¼å’Œmidæ¯”è¾ƒ è¯¦ç»†é¢˜è§£ï¼š153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ å‚è€ƒä»£ç ï¼š 123456789101112131415161718class Solution &#123; public int findMin(int[] nums) &#123; int low = 0, high = nums.length - 1; int ans = Integer.MAX_VALUE; while (low &lt;= high)&#123; int mid = low + (high - low) / 2; int temp = nums[mid]; if(temp &lt; nums[high])&#123; ans = Math.min(ans, temp); high = mid - 1; &#125;else &#123; ans = Math.min(ans, nums[low]); low = mid + 1; &#125; &#125; return ans; &#125;&#125; 4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•° ï¼ˆéš¾ï¼‰ æ€è·¯ï¼š è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1 åäºŒã€æ ˆ20. æœ‰æ•ˆçš„æ‹¬å· æ€è·¯ï¼šå€ŸåŠ©æ ˆï¼Œå¦‚æœæ˜¯å·¦æ‹¬å·ç›´æ¥å…¥æ ˆï¼Œå³æ‹¬å·å°±æ ¹æ®æ ˆé¡¶å…ƒç´ æ¥ç¡®å®šå¯¹å³æ‹¬å·çš„ç­–ç•¥ è¯¦ç»†é¢˜è§£ï¼š20. æœ‰æ•ˆçš„æ‹¬å· å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324class Solution &#123; public boolean isValid(String s) &#123; ArrayDeque&lt;Character&gt; stack = new ArrayDeque&lt;&gt;(); for (int i = 0; i &lt; s.length(); i++) &#123; char c = s.charAt(i); if(c == &#x27;[&#x27; || c == &#x27;(&#x27; || c == &#x27;&#123;&#x27;) stack.push(c); else &#123; if(stack.isEmpty()) return false; else if (c == &#x27;]&#x27; &amp;&amp; stack.peek() == &#x27;[&#x27;) &#123; stack.pop(); &#125;else if (c == &#x27;)&#x27; &amp;&amp; stack.peek() == &#x27;(&#x27;) &#123; stack.pop(); &#125;else if (c == &#x27;&#125;&#x27; &amp;&amp; stack.peek() == &#x27;&#123;&#x27;) &#123; stack.pop(); &#125;else return false; &#125; &#125; if (!stack.isEmpty()) return false; return true; &#125;&#125; 155. æœ€å°æ ˆ æ€è·¯ï¼šå¦å¤–åˆ›å»ºä¸€ä¸ªåªå­˜å‚¨æ ˆä¸­æœ€å°å…ƒç´ çš„è¾…åŠ©æ ˆï¼Œæ¥æ¨¡æ‹Ÿæœ€å°æ ˆçš„æ“ä½œ è¯¦ç»†é¢˜è§£ï¼š155. æœ€å°æ ˆ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425262728class MinStack &#123; ArrayDeque&lt;Integer&gt; nums = new ArrayDeque&lt;&gt;(); ArrayDeque&lt;Integer&gt; minStack = new ArrayDeque&lt;&gt;(); public MinStack() &#123; nums = new ArrayDeque&lt;&gt;(); minStack = new ArrayDeque&lt;&gt;(); minStack.push(Integer.MAX_VALUE); &#125; public void push(int val) &#123; nums.push(val); minStack.push(Math.min(minStack.peek(), val)); &#125; public void pop() &#123; nums.pop(); minStack.pop(); &#125; public int top() &#123; return nums.peek(); &#125; public int getMin() &#123; return minStack.peek(); &#125;&#125; 394. å­—ç¬¦ä¸²è§£ç  æ€è·¯ï¼šåŒæ ˆæ¨¡æ‹Ÿï¼Œä¸€ä¸ªæ ˆä»…å­˜æ•°å­—ï¼Œå¦ä¸€ä¸ªæ ˆä»…å­˜å­—ç¬¦ä¸²ã€‚éå†sçš„å­—ç¬¦ï¼Œæ ¹æ®å­—ç¬¦ä¸ºæ•°å­—ã€å·¦æ‹¬å·ã€å³æ‹¬å·ã€å­—ç¬¦å››ç§æƒ…å†µåˆ†ç±»æ“ä½œã€‚è¯¦ç»†å¯è§ä»£ç åŠè¯¦ç»†é¢˜è§£ è¯¦ç»†é¢˜è§£ï¼š394. å­—ç¬¦ä¸²è§£ç  å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223242526272829class Solution &#123; public String decodeString(String s) &#123; ArrayDeque&lt;Integer&gt; numStack = new ArrayDeque&lt;&gt;(); ArrayDeque&lt;String&gt; strStack = new ArrayDeque&lt;&gt;(); int num = 0; String curStr = &quot;&quot;; for (int i = 0; i &lt; s.length(); i++) &#123; char c = s.charAt(i); if(Character.isDigit(c))&#123; num = num * 10 + c - &#x27;0&#x27;; &#125; else if (c == &#x27;[&#x27;) &#123; numStack.push(num); strStack.push(curStr); num = 0; curStr = &quot;&quot;; &#125; else if (c == &#x27;]&#x27;) &#123; int loop = numStack.pop(); StringBuilder sb = new StringBuilder(strStack.pop()); for (int j = 0; j &lt; loop; j++) &#123; sb.append(curStr); &#125; curStr = sb.toString(); &#125;else curStr += c; &#125; return curStr; &#125;&#125; 739. æ¯æ—¥æ¸©åº¦å•è°ƒæ ˆï¼Œè¿™é¢˜ä»¥åŠ84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ éƒ½æ˜¯å•è°ƒæ ˆï¼Œç•¥å¾®éš¾æƒ³ æ€è·¯ï¼šè¿™é‡Œä¹Ÿåˆ«åœ¨æ„è¿™ä¸ªæ‰€è°“çš„å•è°ƒæ ˆåˆ°åº•æ˜¯æ€ä¹ˆå•è°ƒçš„äº†ï¼Œå°±è¿™é¢˜è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è€ƒè™‘ï¼Œæ¯æ¬¡éå†æ•°ç»„å…ƒç´ çš„æ—¶å€™å°±æŠŠå½“å‰ä¸‹æ ‡åŠ å…¥æ ˆï¼Œä½†æ˜¯åœ¨åŠ å…¥ä¹‹å‰å‘¢ï¼Œå¾—å…ˆçœ‹çœ‹æ ˆæœ€é¡¶çš„ä¸‹æ ‡æ‰€æŒ‡å…ƒç´ æ˜¯å¦æ‰¾åˆ°äº†ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±å¼¹å‡ºç„¶åè®¾ç½®ã€‚åŒæ—¶è¿™ä¸ªæ“ä½œè¿˜å¾—å¾ªç¯è¿›è¡Œï¼Œæ¯”å¦‚å½“å‰éå†çš„å…ƒç´ æ¯”å‰å‡ ä¸ªå…ƒç´ éƒ½å¤§ï¼Œé‚£å°±æ˜¯è¯´å‰å‡ ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ éƒ½æ‰¾åˆ°äº†ã€‚è¯¦ç»†å¯å‚ç…§ä»£ç ç†è§£ è¯¦ç»†é¢˜è§£ï¼š739.æ¯æ—¥æ¸©åº¦ å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public int[] dailyTemperatures(int[] temperatures) &#123; int[] ans = new int[temperatures.length]; ArrayDeque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;(); for (int i = 0; i &lt; temperatures.length; i++) &#123; while (!stack.isEmpty() &amp;&amp; temperatures[i] &gt; temperatures[stack.peek()])&#123; int p = stack.pop(); //å¼¹å‡ºçš„ç´¢å¼•è¯¥å¤„çš„å…ƒç´ ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ‰¾åˆ°äº†ï¼ ans[p] = i - p; &#125; stack.push(i); &#125; return ans; &#125;&#125; 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ æ€è·¯ï¼š å•è°ƒæ ˆï¼šç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å¢çš„æ ˆï¼Œç”¨äºå¿«é€Ÿæ‰¾åˆ°æ¯ä¸ªæŸ±å­å·¦è¾¹å’Œå³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒçŸ®çš„æŸ±å­ã€‚ éå†æ¯ä¸ªæŸ±å­ï¼Œå½“é‡åˆ°æ¯”æ ˆé¡¶æŸ±å­çŸ®çš„æŸ±å­æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶å¹¶è®¡ç®—å…¶é¢ç§¯ï¼Œæ›´æ–°æœ€å¤§é¢ç§¯ã€‚ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021public int largestRectangleArea(int[] heights) &#123; int ans = Integer.MIN_VALUE; ArrayDeque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;(); stack.push(-1); for (int i = 0; i &lt; heights.length; i++) &#123; while (stack.peek() != -1 &amp;&amp; heights[i] &lt;= heights[stack.peek()])&#123; int high = heights[stack.pop()]; int width = i - stack.peek() - 1; ans = Math.max(ans, high * width); &#125; stack.push(i); &#125; while (stack.peek() != -1)&#123; int high = heights[stack.pop()]; int width = heights.length - stack.peek() - 1; ans = Math.max(ans, high * width); &#125; return ans; &#125; åä¸‰ã€å †215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´  æ€è·¯ï¼šå¿«æ’ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; private static final Random rand = new Random(); public int findKthLargest(int[] nums, int k) &#123; quickSort(nums, 0, nums.length - 1); return nums[nums.length - k]; &#125; private void quickSort(int[] nums, int l, int r) &#123; if(l &lt; r)&#123; int pivotIndex = partition(nums, l, r); quickSort(nums, l, pivotIndex - 1); quickSort(nums, pivotIndex + 1, r); &#125; &#125; private int partition(int[] nums, int l, int r) &#123; int random = rand.nextInt(r - l + 1) + l; swap(nums, random, l); int i = l, j = r; int pivot = nums[l]; while (i &lt; j)&#123; while (i &lt; j &amp;&amp; nums[j] &gt;= pivot) j--; while (i &lt; j &amp;&amp; nums[i] &lt;= pivot) i++; if(i &lt; j) swap(nums, i, j); &#125; swap(nums, l, i); return i; &#125; private void swap(int[] nums, int l, int r) &#123; int temp = nums[l]; nums[l] = nums[r]; nums[r] = temp; &#125;&#125; 347. å‰ K ä¸ªé«˜é¢‘å…ƒç´  æ€è·¯ï¼š ç»Ÿè®¡é¢‘ç‡ï¼šä½¿ç”¨HashMapéå†æ•°ç»„ï¼Œè®°å½•æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•°ã€‚ æœ€å°å †ç»´æŠ¤ï¼šä¼˜å…ˆé˜Ÿåˆ—æŒ‰å…ƒç´ é¢‘ç‡å‡åºæ’åˆ—ï¼Œå½“å †çš„å¤§å°è¶…è¿‡kæ—¶ï¼Œç§»é™¤å †é¡¶çš„æœ€å°é¢‘ç‡å…ƒç´ ï¼Œç¡®ä¿å †ä¸­ä¿ç•™å½“å‰æœ€å¤§çš„kä¸ªé¢‘ç‡å…ƒç´ ã€‚ ç»“æœæå–ï¼šå°†å †ä¸­çš„å…ƒç´ ä¾æ¬¡å–å‡ºï¼Œè½¬æ¢ä¸ºæ•°ç»„è¿”å›ã€‚ç”±äºé¢˜ç›®å…è®¸ä»»æ„é¡ºåºï¼Œæ— éœ€é¢å¤–æ’åºã€‚ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425 class Solution &#123; public int[] topKFrequent(int[] nums, int k) &#123; // ç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„é¢‘ç‡ HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); for (int num : nums) &#123; map.put(num, map.getOrDefault(num, 0) + 1); &#125; // åˆ›å»ºæœ€å°å †ï¼ŒæŒ‰é¢‘ç‡å‡åºæ’åˆ— PriorityQueue&lt;Map.Entry&lt;Integer, Integer&gt;&gt; heap = new PriorityQueue&lt;&gt;((a, b) -&gt; a.getValue() - b.getValue()); for (Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet()) &#123; //éå†mapï¼Œè€Œä¸æ˜¯å † heap.offer(entry); if(heap.size() &gt; k) heap.poll(); &#125; int[] ans = new int[k]; int idx = 0; while (!heap.isEmpty())&#123; ans[idx++] = heap.poll().getKey(); &#125; return ans; &#125;&#125; 295. æ•°æ®æµçš„ä¸­ä½æ•° åå››ã€è´ªå¿ƒç®—æ³•121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº æ€è·¯ï¼šè®°å½•ä»Šå¤©åŠä¹‹å‰çš„æœ€å°å€¼ï¼Œç„¶åæ›´æ–°å¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011class Solution &#123; public int maxProfit(int[] prices) &#123; int pre = Integer.MAX_VALUE; int ans = Integer.MIN_VALUE; for (int price : prices) &#123; pre = Math.min(pre, price); ans = Math.max(ans, price - pre); &#125; return ans; &#125;&#125; 55. è·³è·ƒæ¸¸æˆ æ€è·¯ï¼šå¯¹å½“å‰æœ€å¤§å¯è·³è·ƒæ­¥æ•°åšå¾ªç¯ï¼ŒåŒæ—¶ç»´æŠ¤æ›´æ–°æœ€å¤§æ­¥æ•°ï¼Œå¦‚æœè¿™ä¸ªå€¼è¶…è¿‡äº†æ•°ç»„é•¿åº¦ - 1ï¼Œè¯´æ˜å¯ä»¥åˆ°è¾¾æœ€åä¸€ä¸ªå…ƒç´  è¯¦ç»†é¢˜è§£ï¼š55. è·³è·ƒæ¸¸æˆ å‚è€ƒä»£ç ï¼š 1234567891011class Solution &#123; public boolean canJump(int[] nums) &#123; int maxStep = 0; for (int i = 0; i &lt;= maxStep; i++) &#123; maxStep = Math.max(maxStep, i + nums[i]); if(maxStep &gt;= nums.length - 1) return true; &#125; return false; &#125;&#125; 45. è·³è·ƒæ¸¸æˆ II æ€è·¯ï¼šéå†æ•°ç»„å…ƒç´ ï¼Œä¸æ–­ç»´æŠ¤æ›´æ–°å¯åˆ°è¾¾æœ€è¿œä½ç½®ï¼Œå¦‚æœåˆ°äº†æœ€è¾¹ç•Œå°±æ›´æ–°è¾¹ç•ŒåŒæ—¶ans++ã€‚è¿™é¢˜è¦æ³¨æ„çš„æ˜¯ä¸å¿…åˆ°è¾¾æœ€åä¸€ä¸ªå…ƒç´ æ‰åˆ¤æ–­ï¼Œåˆ°è¾¾å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ å°±å¯ä»¥äº†ï¼ˆè¯¦ç»†çœ‹å®˜æ–¹é¢˜è§£ä¸‹å¯¹äºè¿™ç‚¹è¯´æ˜ è¯¦ç»†é¢˜è§£ï¼š45. è·³è·ƒæ¸¸æˆ II å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public int jump(int[] nums) &#123; int ans = 0; int maxPosition = 0; int end = 0; for (int i = 0; i &lt; nums.length - 1; i++) &#123; maxPosition = Math.max(maxPosition, i + nums[i]); if(i == end)&#123; end = maxPosition; ans++; &#125; &#125; return ans; &#125;&#125; 763. åˆ’åˆ†å­—æ¯åŒºé—´ æ€è·¯ï¼šå…ˆè®°å½•æ¯ä¸ªå­—ç¬¦çš„æœ€è¿œç´¢å¼•æ˜¯åœ¨å“ªã€‚ç„¶åå®šä¹‰beginå’Œendæ¥å¤„ç†æ¯ä¸ªåŒºé—´çš„é•¿åº¦ã€‚æ¯æ¬¡éå†ä¸æ–­æ›´æ–°endã€‚å¦‚æœåˆ°äº†endï¼Œåˆ™å°†å½“å‰åŒºé—´é•¿åº¦æ·»åŠ è¿›å…¥ansï¼Œç„¶åæ›´æ–°beginä¸ºendçš„ä¸‹ä¸€ä¸ªä½ç½® è¯¦ç»†é¢˜è§£ï¼š763. åˆ’åˆ†å­—æ¯åŒºé—´ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819class Solution &#123; public List&lt;Integer&gt; partitionLabels(String s) &#123; List&lt;Integer&gt; ans = new ArrayList&lt;&gt;(); int[] maxP = new int[26]; for (int i = 0; i &lt; s.length(); i++) &#123; maxP[s.charAt(i) - &#x27;a&#x27;] = i; &#125; int end = 0, begin = 0; for (int i = 0; i &lt; s.length(); i++) &#123; end = Math.max(end, maxP[s.charAt(i) - &#x27;a&#x27;]); if(i == end)&#123; ans.add(end - begin + 1); begin = end + 1; &#125; &#125; return ans; &#125;&#125; åäº”ã€åŠ¨æ€è§„åˆ’70. çˆ¬æ¥¼æ¢¯ æ€è·¯ï¼šå®šä¹‰dpæ•°ç»„iä¸ºåˆ°è¾¾å½“å‰ä½ç½®çš„æ–¹æ¡ˆï¼Œå½“å‰çŠ¶æ€å¯ç”±dp[i-1]æˆ–è€…dp [i-2]è½¬ç§»è¿‡æ¥ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public int climbStairs(int n) &#123; int[] dp = new int[n + 1]; if(n == 1) return 1; if(n == 2) return 2; dp[1] = 1; dp[2] = 2; for (int i = 3; i &lt;= n; i++) &#123; dp[i] = dp[i - 1] + dp[i - 2]; &#125; return dp[n]; &#125;&#125; 118. æ¨è¾‰ä¸‰è§’ æ€è·¯ï¼šå½“å‰çŠ¶æ€å¯ç”±ä¸Šä¸€è¡Œçš„ä¸¤ä¸ªå…ƒç´ è½¬ç§»è¿‡æ¥ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; generate(int numRows) &#123; List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;(); ans.add(List.of(1)); if(numRows == 1) return ans; for (int i = 1; i &lt; numRows; i++) &#123; List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); path.add(1); if(i &gt; 1)&#123; for (int j = 0; j &lt; i - 1; j++) &#123; path.add(ans.get(i - 1).get(j) + ans.get(i - 1).get(j + 1)); &#125; &#125; path.add(1); ans.add(path); &#125; return ans; &#125;&#125; 198. æ‰“å®¶åŠ«èˆ æ€è·¯ï¼šdp[i]ä¸ºåˆ°å½“å‰iæ‰€èƒ½è·å¾—çš„æœ€é«˜é‡‘é¢ï¼Œè¿™ä¸ªé‡‘é¢å–å†³äºå‰é¢ä¸€å®¶(ä¹Ÿå°±æ˜¯i-1æ˜¯å¦æ‰“åŠ«äº†)ï¼Œdp[i]=max(dp[i-1],dp [i-2]+nums [i]) è¯¦ç»†é¢˜è§£ï¼š198. æ‰“å®¶åŠ«èˆ å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public int rob(int[] nums) &#123; int n = nums.length; int[] dp = new int[n]; if(n == 1) return nums[0]; if(n == 2) return Math.max(nums[0], nums[1]); dp[0] = nums[0]; dp[1] = Math.max(nums[0], nums[1]); for (int i = 2; i &lt; n; i++) &#123; dp[i] = Math.max(dp[i - 1], dp[i - 2] + nums[i]); &#125; return dp[n - 1]; &#125;&#125; 279. å®Œå…¨å¹³æ–¹æ•° æ€è·¯ï¼š åŠ¨æ€è§„åˆ’çš„æ€è·¯é€šå¸¸æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°ç»„dpï¼Œå…¶ä¸­dp[i]è¡¨ç¤ºå’Œä¸ºiçš„å®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘æ•°é‡ã€‚ç„¶åï¼Œæˆ‘éœ€è¦æ‰¾å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ æ¯”å¦‚ï¼Œå¯¹äºæ¯ä¸ªiï¼Œæˆ‘éœ€è¦éå†æ‰€æœ‰å¯èƒ½çš„å¹³æ–¹æ•°jjï¼Œå…¶ä¸­jj &lt;&#x3D;iã€‚ç„¶åï¼Œdp[i]å¯èƒ½ç­‰äºdp[i - jj] +1ï¼Œå› ä¸ºå¦‚æœi-jjå¯ä»¥ç”±dp[i-jj]ä¸ªå¹³æ–¹æ•°ç»„æˆï¼Œé‚£ä¹ˆåŠ ä¸Šå½“å‰çš„jjï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªå¹³æ–¹æ•°ï¼‰ï¼Œæ€»å…±æœ‰dp[i-j*j]+1ä¸ªã€‚è¿™æ—¶å€™æˆ‘éœ€è¦å–æ‰€æœ‰å¯èƒ½çš„jä¸­çš„æœ€å°å€¼ã€‚ è¿™æ ·ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹åº”è¯¥æ˜¯dp[i] &#x3D; min(dp[i], dp[i - j*j] +1)ã€‚åˆå§‹æ¡ä»¶æ˜¯dp[0]&#x3D;0ï¼Œå› ä¸ºå’Œä¸º0ä¸éœ€è¦ä»»ä½•å¹³æ–¹æ•°ã€‚ç„¶åä»1åˆ°nä¾æ¬¡è®¡ç®—æ¯ä¸ªdp[i]ã€‚ é‚£å…·ä½“æ€ä¹ˆå®ç°å‘¢ï¼Ÿæ¯”å¦‚n&#x3D;12çš„æ—¶å€™ï¼Œdpæ•°ç»„çš„å¤§å°åº”è¯¥æ˜¯n+1ï¼Œä¹Ÿå°±æ˜¯13ä¸ªå…ƒç´ ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ‰€æœ‰å…ƒç´ è®¾ä¸ºæœ€å¤§å€¼ï¼Œæ¯”å¦‚n+1ï¼Œå› ä¸ºæœ€å¤§çš„æƒ…å†µæ˜¯å…¨éƒ¨ç”±1ç»„æˆï¼Œä¹Ÿå°±æ˜¯nä¸ª1ï¼Œæ‰€ä»¥åˆå§‹å€¼å¯ä»¥è®¾ä¸ºn+1ï¼Œè¿™æ ·åç»­æ¯”è¾ƒæ—¶å°±èƒ½æ‰¾åˆ°æ›´å°çš„å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œè®¡ç®—dp[12]çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦éå†æ‰€æœ‰å¯èƒ½çš„jï¼Œå…¶ä¸­jçš„å¹³æ–¹ä¸è¶…è¿‡12ã€‚jå¯ä»¥æ˜¯1ã€2ã€3ï¼Œå› ä¸º3çš„å¹³æ–¹æ˜¯9ï¼Œ4çš„å¹³æ–¹æ˜¯16å°±è¶…è¿‡äº†ã€‚å¯¹äºæ¯ä¸ªjï¼Œæˆ‘ä»¬è®¡ç®—dp[12 - j*j] +1çš„å€¼ï¼Œå¹¶å–æœ€å°å€¼ã€‚ æ¯”å¦‚å½“j&#x3D;3æ—¶ï¼Œ12-9&#x3D;3ï¼Œæ‰€ä»¥è¦çœ‹dp[3]çš„å€¼åŠ ä¸Š1ã€‚é‚£dp[3]æ˜¯å¤šå°‘å‘¢ï¼Ÿdp[3]çš„å¯èƒ½åˆ†è§£æ˜¯1+1+1ï¼Œä¹Ÿå°±æ˜¯3ä¸ª1ï¼Œæˆ–è€…1+2çš„å¹³æ–¹ï¼Ÿä½†2çš„å¹³æ–¹æ˜¯4ï¼Œæ¯”3å¤§ï¼Œæ‰€ä»¥åªèƒ½æ˜¯1çš„å¹³æ–¹ç›¸åŠ ã€‚æ‰€ä»¥dp[3]åº”è¯¥æ˜¯3ã€‚é‚£ä¹ˆè¿™æ—¶å€™ï¼Œdp[12]å¯èƒ½ç­‰äº3+1&#x3D;4ï¼Ÿæˆ–è€…å¯èƒ½æœ‰æ›´ä¼˜çš„æƒ…å†µï¼Ÿ æˆ–è€…ï¼Œæ¯”å¦‚å½“j&#x3D;2çš„æ—¶å€™ï¼ŒjÂ²æ˜¯4ã€‚12-4&#x3D;8ã€‚é‚£ä¹ˆè¦çœ‹dp[8]çš„å€¼åŠ ä¸Š1ã€‚å‡è®¾dp[8]çš„æœ€ä¼˜è§£æ˜¯2ï¼ˆæ¯”å¦‚4+4ï¼‰ï¼Œé‚£ä¹ˆåŠ ä¸Šå½“å‰çš„4ï¼Œå°±æ˜¯3æ¬¡ã€‚æ‰€ä»¥è¿™æ—¶å€™ï¼Œdp[12]çš„æœ€å°å€¼å°±æ˜¯3ã€‚è¿™åº”è¯¥å°±æ˜¯ç¤ºä¾‹ä¸­çš„æ­£ç¡®æƒ…å†µã€‚ æ‰€ä»¥åŠ¨æ€è§„åˆ’çš„æ­¥éª¤åº”è¯¥æ˜¯ï¼š åˆå§‹åŒ–dpæ•°ç»„ï¼Œdp[0] &#x3D;0ï¼Œå…¶ä»–åˆå§‹åŒ–ä¸ºè¾ƒå¤§çš„å€¼ï¼Œæ¯”å¦‚nã€‚ éå†æ¯ä¸ªiä»1åˆ°nã€‚ å¯¹äºæ¯ä¸ªiï¼Œéå†æ‰€æœ‰jï¼Œå…¶ä¸­jçš„å¹³æ–¹&lt;&#x3D;iã€‚ æ›´æ–°dp[i]ä¸ºmin(dp[i], dp[i -j*j]+1)ã€‚ æœ€åè¿”å›dp[n]ã€‚ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910public int numSquares(int n) &#123; int[] dp = new int[n + 1]; Arrays.fill(dp, n + 1); dp[0] = 0; for (int i = 1; i * i &lt;= n; i++) &#123; //éå†æ‰€æœ‰å°äºç­‰äº n çš„å®Œå…¨å¹³æ–¹æ•° i * iã€‚ for (int j = i * i; j &lt;= n; j++) //æ ¹æ®å½“å‰çš„å®Œå…¨å¹³æ–¹æ•°ï¼Œæ›´æ–° dp[j]ï¼Œè¡¨ç¤ºæ„æˆ j çš„æœ€å°å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°ã€‚ dp[j] = Math.min(dp[j], dp[j - i * i] + 1); &#125; return dp[n]; &#125; 322. é›¶é’±å…‘æ¢ æ€è·¯ï¼šå®Œå…¨èƒŒåŒ…çš„ç»„åˆé—®é¢˜ï¼Œdp[i]è¡¨ç¤ºç»„æˆé‡‘é¢iæ‰€éœ€çš„æœ€å°‘ç¡¬å¸ä¸ªæ•°ï¼Œæ€ä¹ˆè½¬ç§»è¿‡æ¥çš„å‘¢ï¼Œæ¯”å¦‚å½“å‰iï¼Œå‰ææ˜¯ç¡¬å¸å°äºé‡‘é¢iï¼Œå¦‚æœé€‰å–äº†æ­¤æ—¶çš„ç¡¬å¸ï¼Œé‚£å°±æ˜¯dp[i - ç¡¬å¸é‡‘é¢] + 1ï¼Œè¿™ä¸ª1å°±æ˜¯æ­¤æ—¶é€‰çš„ç¡¬å¸ï¼Œå¦‚æœä¸é€‰çš„è¯ï¼Œé‚£å°±æ˜¯dp[i] è¯¦ç»†é¢˜è§£ï¼š322. é›¶é’±å…‘æ¢ å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public int coinChange(int[] coins, int amount) &#123; int[] dp = new int[amount + 1]; Arrays.fill(dp, amount + 1); dp[0] = 0; for (int i = 0; i &lt;= amount; i++) &#123; for (int j = 0; j &lt; coins.length; j++) &#123; if(i &gt;= coins[j]) dp[i] = Math.min(dp[i], dp[i - coins[j]] + 1); &#125; &#125; return dp[amount] &gt; amount ? -1 : dp[amount]; &#125;&#125; 139. å•è¯æ‹†åˆ† æ€è·¯ï¼šå®Œå…¨èƒŒåŒ…çš„æ’åˆ—é—®é¢˜ï¼Œdp[i]ä»£è¡¨ä»¥å‰iä¸ªå­—ç¬¦æ˜¯å¦èƒ½ç”±æ•°ç»„é‡Œé¢çš„å­—ç¬¦ä¸²ç»„æˆï¼Œå¯ä»¥å…ˆæŠŠæ•°ç»„é‡Œé¢çš„å­—ç¬¦ä¸²å­˜åˆ°seté‡Œé¢ï¼Œå¯¹äºj &lt; iï¼Œå¦‚æœdp[j]ä¸ºtrueï¼Œä¸”ä»jåˆ°içš„å­—ç¬¦ä¸²åœ¨seté‡Œé¢æœ‰ï¼Œé‚£å°±è¯´æ˜dp[i]ä¹Ÿä¸ºtrue è¯¦ç»†é¢˜è§£ï¼š139. å•è¯æ‹†åˆ† å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public boolean wordBreak(String s, List&lt;String&gt; wordDict) &#123; HashSet&lt;String&gt; set = new HashSet&lt;&gt;(); for (String string : wordDict) &#123; set.add(string); &#125; boolean[] dp = new boolean[s.length() + 1]; dp[0] = true; for (int i = 0; i &lt;= s.length(); i++) &#123; for (int j = 0; j &lt; i; j++) &#123; if(dp[j] &amp;&amp; set.contains(s.substring(j, i))) dp[i] = true; &#125; &#125; return dp[s.length()]; &#125;&#125; 300. æœ€é•¿é€’å¢å­åºåˆ— æ€è·¯ï¼šdp[i]ä»£è¡¨ä»¥nums[i]ç»“å°¾çš„å­—ç¬¦çš„æœ€é•¿é€’å¢å­åºåˆ—ï¼Œå¯¹äºï¼ˆj &lt; iï¼‰çš„æ‰€æœ‰dp[j]ï¼Œå¦‚æœæ­¤æ—¶nums[j] &lt; nums[i]ï¼Œé‚£ä¹ˆå°±æœ‰dp[i] = max(dp[i], dp[j] + 1)æ¥æ›´æ–°æ­¤æ—¶çš„dp[i]ï¼Œè€Œæ›´æ ¸å¿ƒçš„åœ¨äºï¼Œæˆ‘ä»¬è¦åœ¨æ‰€æœ‰çš„dp[i]ä¸­é€‰æ‹©æœ€å¤§çš„é‚£ä¸ªï¼Œæ¥ä½œä¸ºç­”æ¡ˆï¼Œæ‰€ä»¥è¦ç”¨ä¸€ä¸ªå˜é‡ansæ¥è®°å½•æœ€å¤§çš„é‚£ä¸ªdp[i] è¯¦ç»†é¢˜è§£ï¼š300. æœ€é•¿é€’å¢å­åºåˆ— å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public int lengthOfLIS(int[] nums) &#123; int ans = Integer.MIN_VALUE; int[] dp = new int[nums.length]; Arrays.fill(dp, 1); for (int i = 0; i &lt; nums.length; i++) &#123; for (int j = 0; j &lt; i; j++) &#123; if(nums[i] &gt; nums[j]) dp[i] = Math.max(dp[i], dp[j] + 1); &#125; ans = Math.max(ans, dp[i]); &#125; return ans; &#125;&#125; 152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„ æ€è·¯ï¼šå› ä¸ºè´Ÿæ•°çš„å­˜åœ¨ï¼Œå®ƒå¯èƒ½ä¼šä½¿å‰é¢æœ€å¤§çš„å­æ•°ç»„ä¹˜ä¸Šè´Ÿæ•°å˜æˆæœ€å°çš„ï¼Œåä¹‹äº¦ç„¶ï¼Œå› æ­¤åœ¨ä¸æ–­è·å–æœ€å¤§å­æ•°ç»„çš„åŒæ—¶ï¼Œä¹Ÿè¦ç»´æŠ¤å½“å‰æœ€å°çš„å­æ•°ç»„ï¼Œå¦‚æœå½“å‰å…ƒç´ æ˜¯å°äº0çš„ï¼Œå°±è¿›è¡Œäº¤æ¢æ¥è·å¾—ç»“æœ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627public int maxProduct(int[] nums) &#123; // åˆå§‹åŒ– int maxPre = nums[0]; // ä»¥å½“å‰å…ƒç´ ç»“å°¾çš„æœ€å¤§ä¹˜ç§¯ int minPre = nums[0]; // ä»¥å½“å‰å…ƒç´ ç»“å°¾çš„æœ€å°ä¹˜ç§¯ int result = nums[0]; // å…¨å±€æœ€å¤§ä¹˜ç§¯ // ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹éå†â€”â€”â€”â€”è¿™ç‚¹æ ¼å¤–æ³¨æ„ï¼ï¼ï¼ï¼ï¼ for (int i = 1; i &lt; nums.length; i++) &#123; // å¦‚æœå½“å‰å…ƒç´ æ˜¯è´Ÿæ•°ï¼Œäº¤æ¢ maxProd å’Œ minProd // å› ä¸ºè´Ÿæ•°ä¼šä½¿æœ€å¤§å˜æœ€å°ï¼Œæœ€å°å˜æœ€å¤§ if (nums[i] &lt; 0) &#123; int temp = maxPre; maxPre = minPre; minPre = temp; &#125; // æ›´æ–° maxProd å’Œ minProd // maxProd å’Œ minProd éƒ½éœ€è¦è€ƒè™‘å½“å‰å…ƒç´ å•ç‹¬ä½œä¸ºä¸€ä¸ªå­æ•°ç»„çš„æƒ…å†µ maxPre = Math.max(nums[i], maxPre * nums[i]); minPre = Math.min(nums[i], minPre * nums[i]); // æ›´æ–°å…¨å±€æœ€å¤§å€¼ result = Math.max(result, maxPre); &#125; return result;&#125; 416. åˆ†å‰²ç­‰å’Œå­é›† æ€è·¯ï¼šè½¬åŒ–ä¸ºæ˜¯å¦å­˜åœ¨è¿™æ ·ä¸€ä¸ªå­æ•°ç»„ï¼šå…ƒç´ ä¹‹å’Œç­‰äºè¾“å…¥æ•°ç»„çš„å…ƒç´ ä¹‹å’Œä¸€åŠã€‚åœ¨æ­¤ä¹‹å‰å…ˆåšåˆ¤æ–­ï¼šå¦‚æœè¾“å…¥æ•°ç»„å…ƒç´ ä¹‹å’Œä¸ºå¥‡æ•°ï¼Œé‚£è‚¯å®šä¸å­˜åœ¨è¿™æ ·çš„å­æ•°ç»„ç›´æ¥è¿”å›ã€‚å‰©ä¸‹çš„å°±æ˜¯ 0-1 èƒŒåŒ…é—®é¢˜ï¼šä»æ•°ç»„ä¸­é€‰æ‹©ä¸€äº›å…ƒç´ ï¼ˆæ¯ä¸ªå…ƒç´ åªèƒ½é€‰ä¸€æ¬¡ï¼‰ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œæ°å¥½ä¸º targetã€‚ å®šä¹‰dp[i]ä¸ºï¼šæ˜¯å¦å­˜åœ¨ä¸€ä¸ªå­é›†ï¼Œå…¶å’Œä¸º iã€‚ dp[0] &#x3D; trueï¼ˆè¡¨ç¤ºå’Œä¸º 0 æ€»æ˜¯å¯è¡Œï¼Œä¸é€‰ä»»ä½•å…ƒç´ å³å¯ï¼‰ çŠ¶æ€è½¬ç§»ï¼š å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´  nums[i]ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° dp æ•°ç»„ã€‚ ä»åå‘å‰éå† jï¼ˆä» target åˆ° nums[i]ï¼‰ï¼Œæ›´æ–°è§„åˆ™å¦‚ä¸‹ï¼š dp[j] = dp[j] || dp[j - nums[i]] å«ä¹‰ï¼šå¦‚æœä¸é€‰å½“å‰å…ƒç´ ï¼Œå’Œä¸º j çš„å¯èƒ½æ€§ä¿æŒä¸å˜ï¼ˆdp[j]ï¼‰ï¼›å¦‚æœé€‰å½“å‰å…ƒç´ ï¼Œåˆ™éœ€è¦çœ‹dp[j - nums[i]]æ˜¯å¦ä¸º trueã€‚ ä»åå‘å‰éå†çš„ç›®çš„æ˜¯é¿å…é‡å¤ä½¿ç”¨åŒä¸€ä¸ªå…ƒç´ ï¼Œç¡®ä¿ç¬¦åˆ 0-1 èƒŒåŒ…çš„è§„åˆ™ã€‚ â€‹ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324252627282930public boolean canPartition(int[] nums) &#123; // è®¡ç®—æ•°ç»„æ€»å’Œ int sum = 0; for (int num : nums) &#123; sum += num; &#125; // å¦‚æœæ€»å’Œæ˜¯å¥‡æ•°ï¼Œæ— æ³•åˆ†å‰²æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„å­é›† if (sum % 2 != 0) &#123; return false; &#125; // ç›®æ ‡å€¼ï¼šæ€»å’Œçš„ä¸€åŠ int target = sum / 2; // åˆå§‹åŒ– dp æ•°ç»„ boolean[] dp = new boolean[target + 1]; dp[0] = true; // å’Œä¸º 0 æ€»æ˜¯å¯è¡Œ // åŠ¨æ€è§„åˆ’è¿‡ç¨‹ for (int num : nums) &#123; // ä»åå‘å‰æ›´æ–° dp æ•°ç»„ for (int j = target; j &gt;= num; j--) &#123; dp[j] = dp[j] || dp[j - num]; &#125; &#125; // è¿”å›ç»“æœ return dp[target];&#125; 32. æœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼ˆéš¾ æ€è·¯ï¼š è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1 åå…­ã€å¤šç»´åŠ¨æ€è§„åˆ’ 62. ä¸åŒè·¯å¾„ æ€è·¯ï¼šå½“å‰çŠ¶æ€ä»…å¯ç”±å·¦è¾¹æˆ–ä¸Šè¾¹è¿™ä¸¤ä¸ªæ¥è½¬ç§» è¯¦ç»†é¢˜è§£ï¼š62. ä¸åŒè·¯å¾„ å‚è€ƒä»£ç ï¼š 12345678910111213141516171819class Solution &#123; public int uniquePaths(int m, int n) &#123; int[][] dp = new int[m][n]; for (int i = 0; i &lt; n; i++) &#123; dp[0][i] = 1; &#125; for (int i = 0; i &lt; m; i++) &#123; dp[i][0] = 1; &#125; for (int i = 1; i &lt; m; i++) &#123; for (int j = 1; j &lt; n; j++) &#123; dp[i][j] = dp[i - 1][j] + dp[i][j - 1]; &#125; &#125; return dp[m - 1][n - 1]; &#125;&#125; 64. æœ€å°è·¯å¾„å’Œ æ€è·¯ï¼šåŒä¸Šé¢˜ï¼Œå½“å‰çŠ¶æ€ä»…å¯ç”±ä¸Šè¾¹å’Œå·¦è¾¹è½¬ç§»è¿‡æ¥ï¼Œå–äºŒè€…è¾ƒå°å€¼åŠ ä¸Šå½“å‰å…ƒç´ å¤§å°ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ¬é¢˜çš„åˆå§‹åŒ– è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 123456789101112131415161718192021222324class Solution &#123; public int minPathSum(int[][] grid) &#123; int m = grid.length; int n = grid[0].length; int[][] dp = new int[m][n]; dp[0][0] = grid[0][0]; for (int i = 1; i &lt; n; i++) &#123; dp[0][i] = dp[0][i - 1] + grid[0][i]; &#125; for (int i = 1; i &lt; m; i++) &#123; dp[i][0] = dp[i - 1][0] + grid[i][0]; &#125; for (int i = 1; i &lt; m; i++) &#123; for (int j = 1; j &lt; n; j++) &#123; dp[i][j] = Math.min(dp[i - 1][j], dp[i][j - 1]) + grid[i][j]; &#125; &#125; return dp[m - 1][n - 1]; &#125;&#125; 5. æœ€é•¿å›æ–‡å­ä¸² æ€è·¯ï¼šä¸­å¿ƒæ‰©å±•æ³•ã€‚æœ¬é¢˜è¦è®°ä½å¾ªç¯ä¸Šé™2 * n - 1ï¼Œä»¥åŠå·¦æŒ‡é’ˆåˆå§‹å€¼i / 2ï¼Œå³æŒ‡é’ˆl + i % 2 è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516171819class Solution &#123; public String longestPalindrome(String s) &#123; int n = s.length(); String ans = &quot;&quot;; for (int i = 0; i &lt; 2 * n - 1; i++) &#123; int l = i / 2; int r = l + i % 2; while (l &gt;= 0 &amp;&amp; r &lt; n &amp;&amp; s.charAt(l) == s.charAt(r))&#123; if(r - l + 1 &gt; ans.length())&#123; ans = s.substring(l, r + 1); &#125; l--; r++; &#125; &#125; return ans; &#125;&#125; 1143. æœ€é•¿å…¬å…±å­åºåˆ— æ€è·¯ï¼šæœ¬é¢˜ä¸»è¦æ˜¯çŠ¶æ€æ–¹ç¨‹çš„å®šä¹‰éƒ½å¾ˆæ–°é¢–ã€‚dp[i][j]è¡¨ç¤ºå­—ç¬¦ä¸²1å‰iä¸ªå­—ç¬¦å’Œå­—ç¬¦ä¸²2çš„å‰jä¸ªå­—ç¬¦çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚ç„¶ååˆ†å½“å‰å­—ç¬¦ç›¸åŒå’Œä¸åŒä¸¤ç§æƒ…å†µæ¥è½¬ç§»çŠ¶æ€ã€‚å¦‚æœç›¸åŒï¼Œdp[i][j] = dp[i - 1][j - 1] + 1 ï¼Œå¦åˆ™ï¼ŒMath.max(dp[i - 1][j], dp[i][j - 1]) ã€‚å¦å¤–éœ€è¦æ³¨æ„å¾ªç¯ä¸Šé™ä»¥åŠä¸‹æ ‡é—®é¢˜ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011121314151617class Solution &#123; public int longestCommonSubsequence(String text1, String text2) &#123; int m = text1.length(); int n = text2.length(); int[][] dp = new int[m + 1][n + 1]; for (int i = 1; i &lt;= m; i++) &#123; for (int j = 1; j &lt;= n; j++) &#123; if(text1.charAt(i- 1) == text2.charAt(j- 1)) dp[i][j] = dp[i - 1][j - 1] + 1; else dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]); &#125; &#125; return dp[m][n]; &#125;&#125; 72. ç¼–è¾‘è·ç¦» æ€è·¯ï¼š æ–¹æ³•æ€è·¯ çŠ¶æ€å®šä¹‰ï¼šå®šä¹‰äºŒç»´æ•°ç»„ dp[i][j]ï¼Œè¡¨ç¤ºå°† word1 çš„å‰ i ä¸ªå­—ç¬¦è½¬æ¢ä¸º word2 çš„å‰ j ä¸ªå­—ç¬¦æ‰€éœ€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚ åˆå§‹çŠ¶æ€ï¼š dp[i][0] = iï¼šåˆ é™¤æ‰€æœ‰ i ä¸ªå­—ç¬¦ã€‚ dp[0][j] = jï¼šæ’å…¥æ‰€æœ‰ j ä¸ªå­—ç¬¦ã€‚ çŠ¶æ€è½¬ç§»ï¼š å­—ç¬¦ç›¸åŒï¼šdp[i][j] = dp[i-1][j-1]ï¼ˆæ— éœ€æ“ä½œï¼‰ã€‚ å­—ç¬¦ä¸åŒï¼šå–ä¸‰ç§æ“ä½œçš„æœ€å°å€¼åŠ 1ï¼š æ›¿æ¢ï¼šdp[i-1][j-1] + 1ã€‚ åˆ é™¤ï¼šdp[i-1][j] + 1ã€‚ æ’å…¥ï¼šdp[i][j-1] + 1ã€‚ è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 12345678910111213141516171819202122232425class Solution &#123; public int minDistance(String word1, String word2) &#123; int m = word1.length(); int n = word2.length(); int[][] dp = new int[m + 1][n + 1]; for (int i = 0; i &lt;= n; i++) &#123; dp[0][i] = i; &#125; for (int i = 0; i &lt;= m; i++) &#123; dp[i][0] = i; &#125; for (int i = 1; i &lt;= m; i++) &#123; for (int j = 1; j &lt;= n; j++) &#123; if(word1.charAt(i - 1) == word2.charAt(j - 1)) dp[i][j] = dp[i - 1][j - 1]; else dp[i][j] = Math.min(dp[i - 1][j - 1], Math.min(dp[i - 1][j], dp[i][j - 1])) + 1; &#125; &#125; return dp[m][n]; &#125;&#125; åä¸ƒã€æŠ€å·§136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— æ€è·¯ï¼šæ•°å­—ä¸ï¼Œ ä»»ä½•æ•°å’Œ 0 åšå¼‚æˆ–è¿ç®—ï¼Œç»“æœä»ç„¶æ˜¯åŸæ¥çš„æ•°ï¼Œå³ aâŠ•0=aã€‚ ä»»ä½•æ•°å’Œå…¶è‡ªèº«åšå¼‚æˆ–è¿ç®—ï¼Œç»“æœæ˜¯ 0ï¼Œå³ aâŠ•a=0ã€‚ å¼‚æˆ–è¿ç®—æ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹ï¼Œå³ aâŠ•bâŠ•a=bâŠ•aâŠ•a=bâŠ•(aâŠ•a)=bâŠ•0=bã€‚ æ ¹æ®ä»¥ä¸Šä¸‰æ¡æ€§è´¨ï¼Œå¯å¯¹æ•°ç»„ä¸­æ‰€æœ‰æ•°å­—è¿›è¡Œä¸è¿ç®—ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœå°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— è¯¦ç»†é¢˜è§£ï¼š å‚è€ƒä»£ç ï¼š 1234567891011class Solution &#123; public int singleNumber(int[] nums) &#123; if(nums.length == 1) return nums[0]; int k = nums[0]; for (int i = 1; i &lt; nums.length; i++) &#123; k = k ^ nums[i]; &#125; return k; &#125;&#125; 169. å¤šæ•°å…ƒç´  æ€è·¯ï¼šæ‘©å°”æŠ•ç¥¨ï¼Œç»´æŠ¤ä¸€ä¸ªvoteä»£è¡¨å½“å‰æŠ•ç¥¨æ•°ï¼Œå…ˆå‡è®¾ä¼—æ•°å°±æ˜¯å½“å‰éå†çš„æ•°å­—ï¼Œç„¶åç»§ç»­éå†ï¼Œå¦‚æœå½“å‰æ•°ä¸ä¼—æ•°ç›¸åŒï¼Œvote+1ï¼Œåä¹‹åˆ™å‡1ï¼Œå¦‚æœvoteä¸º0å°±è®¾ç½®ä¼—æ•°ä¸ºå½“å‰æ•°ï¼Œæœ€ç»ˆè¿”å›ä¼—æ•°å³æ˜¯ç­”æ¡ˆ è¯¦ç»†é¢˜è§£ï¼š169. å¤šæ•°å…ƒç´  å‚è€ƒä»£ç ï¼š 12345678910111213141516class Solution &#123; public int majorityElement(int[] nums) &#123; int ans = 0; int vote = 0; for (int num : nums) &#123; if(vote == 0)&#123; ans = num; &#125; if(num == ans) vote++; else vote--; &#125; return ans; &#125;&#125; 75. é¢œè‰²åˆ†ç±»â€œè·å…°å›½æ——â€é—®é¢˜ï¼Œè¯¦ç»†é¢˜è§£å¯å‚ç…§ æ€è·¯ï¼šä¸‰æŒ‡é’ˆï¼Œå› ä¸ºè¦å°†æ•°æ®åˆ†æˆä¸‰éƒ¨åˆ†ï¼Œæœ‰ä¸€ä¸ªæŒ‡é’ˆcç”¨äºéå†æ•°ç»„ï¼ŒaæŒ‡é’ˆåˆ†éš”0ï¼Œ1ï¼›bæŒ‡é’ˆåˆ†éš”1ï¼Œ2ï¼Œé€€å‡ºæ¡ä»¶ä¸º c &gt; bï¼Œç„¶åæ ¹æ®cå½“å‰å…ƒç´ åšå‡ºä¸åŒçš„æ“ä½œ cå½“å‰å…ƒç´ ä¸º0ï¼Œé‚£ä¹ˆå°±äº¤æ¢aå’Œcæ‰€æŒ‡çš„å…ƒç´ ï¼ŒåŒæ—¶aï¼Œcå³ç§» å½“å‰å…ƒç´ ä¸º1ï¼Œé‚£ä¹ˆaï¼Œbçº¿éƒ½ä¸åŠ¨ï¼Œè®©cå³ç§» å½“å‰å…ƒç´ ä¸º2ï¼Œé‚£äº¤æ¢aå’Œbæ‰€æŒ‡çš„å…ƒç´ ï¼Œä½†cä¸èƒ½å³ç§»ï¼Œå› ä¸ºäº¤æ¢è¿‡æ¥çš„å¯èƒ½æ˜¯0ï¼Œ å¦‚æœå³ç§»äº†ä½†aæ²¡æœ‰åŒæ­¥ç§»åŠ¨ï¼Œå°±ä¼šå‡ºé”™ï¼Œæ‰€ä»¥cè¦åœç•™ï¼Œåˆ°ä¸‹æ¬¡çŸ¥é“è¿™ä¸ªcæ‰€æŒ‡çš„å…ƒç´ æ˜¯ä»€ä¹ˆå†åšåˆ¤æ–­ è¯¦ç»†é¢˜è§£ï¼š75.é¢œè‰²åˆ†ç±» å‚è€ƒä»£ç ï¼š 123456789101112131415161718class Solution &#123; public void sortColors(int[] nums) &#123; int a = 0, c = 0, b = nums.length - 1; while (c &lt;= b)&#123; if(nums[c] == 0)&#123; int temp = nums[c]; nums[c++] = nums[a]; nums[a++] = temp; &#125; else if (nums[c] == 1) &#123; c++; &#125;else &#123; int temp = nums[b]; nums[b--] = nums[c]; nums[c] = temp; &#125; &#125; &#125;&#125; 31. ä¸‹ä¸€ä¸ªæ’åˆ— ï¼ˆæ€è·¯ æ€è·¯ï¼šä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³é€’å¢çš„å…ƒç´ aï¼Œç„¶åä»è¿™ä¸ªå…ƒç´ åé¢æ‰¾åˆ°ä¸€ä¸ªæ¯”å®ƒå¤§ä¸€ç‚¹çš„å…ƒç´ bï¼Œè®©å®ƒä¿©äº¤æ¢ï¼Œæœ€åè®©å…ƒç´ båé¢çš„æ‰€æœ‰å…ƒç´ ç”¨åŒæŒ‡é’ˆä¸¤ä¸¤äº¤æ¢ï¼Œæˆä¸ºä»å‰å¾€åæ˜¯é€’å¢çš„ è¯¦ç»†é¢˜è§£ï¼š31. ä¸‹ä¸€ä¸ªæ’åˆ— å‚è€ƒä»£ç ï¼š 1234567891011121314151617181920212223class Solution &#123; public void nextPermutation(int[] nums) &#123; int i = nums.length - 2; while (i &gt;= 0 &amp;&amp; nums[i] &gt;= nums[i + 1]) i--; if(i &gt;= 0)&#123; int j = nums.length - 1; while (j &gt; i &amp;&amp; nums[j] &lt;= nums[i]) j--; int temp = nums[j]; nums[j] = nums[i]; nums[i] = temp; &#125; int low = i + 1; int high = nums.length - 1; while (low &lt;= high)&#123; int temp = nums[low]; nums[low++] = nums[high]; nums[high--] = temp; &#125; &#125;&#125; 287. å¯»æ‰¾é‡å¤æ•° æ€è·¯ï¼šé¾Ÿå…”èµ›è·‘ç®—æ³•ï¼Œç±»ä¼¼é“¾è¡¨ç¯é—®é¢˜ï¼Œè®©å…ƒç´ æ˜ å°„åˆ°é“¾è¡¨èŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡å¿«æ…¢æŒ‡é’ˆï¼Œç¬¬ä¸€æ­¥å…ˆæ‰¾åˆ°ç¯ï¼Œå½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡åï¼Œå°†å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆç§»å›èµ·ç‚¹ï¼Œå¹¶ä»¥ç›¸åŒé€Ÿåº¦å‰è¿›ï¼Œç›´åˆ°ä¸¤ä¸ªæŒ‡é’ˆå†æ¬¡ç›¸é‡ã€‚å†æ¬¡ç›¸é‡çš„ç‚¹å³ä¸ºç¯çš„èµ·ç‚¹ï¼Œä¹Ÿå°±æ˜¯é‡å¤çš„æ•°å­—ã€‚ è¯¦ç»†é¢˜è§£ï¼šä½¿ç”¨ Floyd çš„å¾ªç¯æ£€æµ‹ç®—æ³• å°†æ•°ç»„æ˜ å°„ä¸ºé“¾è¡¨ï¼š ç”±äº nums ä¸­çš„å€¼èŒƒå›´æ˜¯ [1, n]ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªæ•°å­—è§†ä¸ºé“¾è¡¨çš„ä¸‹æ ‡ã€‚ ä¾‹å¦‚ï¼Œnums[i] æŒ‡å‘ä¸‹æ ‡ nums[nums[i]]ã€‚ é‡å¤çš„æ•°å­—ä¼šå¯¼è‡´å½¢æˆç¯ã€‚ æ£€æµ‹ç¯çš„èµ·ç‚¹ï¼š ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªæ…¢æŒ‡é’ˆï¼ˆslowï¼‰å’Œä¸€ä¸ªå¿«æŒ‡é’ˆï¼ˆfastï¼‰ã€‚ slow æ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œfast æ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ã€‚ å¦‚æœå­˜åœ¨ç¯ï¼Œslow å’Œ fast æœ€ç»ˆä¼šç›¸é‡ã€‚ æ‰¾åˆ°ç¯çš„èµ·ç‚¹ï¼ˆé‡å¤æ•°å­—ï¼‰ï¼š å½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡åï¼Œå°†å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆç§»å›èµ·ç‚¹ï¼Œå¹¶ä»¥ç›¸åŒé€Ÿåº¦å‰è¿›ï¼Œç›´åˆ°ä¸¤ä¸ªæŒ‡é’ˆå†æ¬¡ç›¸é‡ã€‚ å†æ¬¡ç›¸é‡çš„ç‚¹å³ä¸ºç¯çš„èµ·ç‚¹ï¼Œä¹Ÿå°±æ˜¯é‡å¤çš„æ•°å­—ã€‚ å‚è€ƒä»£ç ï¼š 123456789101112131415class Solution &#123; public int findDuplicate(int[] nums) &#123; int slow = nums[0], fast = nums[0]; do &#123; slow = nums[slow]; fast = nums[nums[fast]]; &#125; while (slow != fast); slow = nums[0]; while (slow != fast) &#123; slow = nums[slow]; fast = nums[fast]; &#125; return slow; &#125;&#125;","categories":[{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://example.com/categories/%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/tags/%E5%88%B7%E9%A2%98/"}]},{"title":"å…¶å®ƒ","slug":"å…«è‚¡/å…¶å®ƒ","date":"2024-11-28T12:57:13.000Z","updated":"2025-03-12T07:20:16.060Z","comments":true,"path":"2024/11/28/å…«è‚¡/å…¶å®ƒ/","permalink":"http://example.com/2024/11/28/%E5%85%AB%E8%82%A1/%E5%85%B6%E5%AE%83/","excerpt":"è¿™é‡Œæ˜¯æœ‰å…³è®¾è®¡æ¨¡å¼ï¼ŒLinuxï¼ŒGitçš„ä¸€äº›å…«è‚¡ï¼Œåç»­ä¼šè¡¥å……åœºæ™¯é¢˜","text":"è¿™é‡Œæ˜¯æœ‰å…³è®¾è®¡æ¨¡å¼ï¼ŒLinuxï¼ŒGitçš„ä¸€äº›å…«è‚¡ï¼Œåç»­ä¼šè¡¥å……åœºæ™¯é¢˜ 1.è®¾è®¡æ¨¡å¼åˆ†ç±»ï¼š åˆ›å»ºå‹æ¨¡å¼â€”â€”å•ä¾‹æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼ ç»“æ„å‹æ¨¡å¼ è¡Œä¸ºå‹æ¨¡å¼ ä¸€ã€å•ä¾‹æ¨¡å¼Java ä¸­çš„å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€çš„è®¿é—®ç‚¹ã€‚å•ä¾‹æ¨¡å¼é€šå¸¸ç”¨äºç®¡ç†å…¨å±€å…±äº«èµ„æºï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥æ± ã€æ—¥å¿—å¯¹è±¡ç­‰ã€‚ å¸¸è§å†™æ³•å¦‚ä¸‹ï¼š 1ã€ æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ é¥¿æ±‰å¼åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œå› æ­¤çº¿ç¨‹å®‰å…¨ï¼Œä¸ä¼šå‡ºç°å¤šæ¬¡åˆ›å»ºå®ä¾‹çš„é—®é¢˜ã€‚ç¼ºç‚¹æ˜¯å³ä½¿ä¸éœ€è¦è¯¥å®ä¾‹ï¼Œç±»ä¹Ÿä¼šè¢«åŠ è½½ã€‚ 1234567891011public class Singleton &#123; private static final Singleton instance = new Singleton(); private Singleton() &#123; // é˜²æ­¢å¤–éƒ¨ç›´æ¥å®ä¾‹åŒ– &#125; public static Singleton getInstance() &#123; return instance; &#125;&#125; 2ã€ æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œå•ä¾‹å¯¹è±¡æ˜¯åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶è¢«åˆ›å»ºçš„ã€‚ä½†ç”±äºæ²¡æœ‰åŒæ­¥å¤„ç†ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶å¯èƒ½ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚ 1234567891011121314public class Singleton &#123; private static Singleton instance; private Singleton() &#123; // é˜²æ­¢å¤–éƒ¨ç›´æ¥å®ä¾‹åŒ– &#125; public static Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); // ä¸å®‰å…¨ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¿›å…¥ &#125; return instance; &#125;&#125; 3ã€ æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ é€šè¿‡ synchronized å…³é”®å­—æ¥ä¿è¯å¤šçº¿ç¨‹ä¸‹çš„å®‰å…¨æ€§ï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨ getInstance() æ—¶éƒ½ä¼šè¿›è¡ŒåŒæ­¥ã€‚ 1234567891011121314public class Singleton &#123; private static Singleton instance; private Singleton() &#123; // é˜²æ­¢å¤–éƒ¨ç›´æ¥å®ä¾‹åŒ– &#125; public synchronized static Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; 4ã€åŒé‡é”æ£€æŸ¥ï¼ˆDCLï¼‰ åŒé‡æ£€æŸ¥é”å®šæ˜¯ä¸€ç§ä¼˜åŒ–çš„æ‡’æ±‰å¼å®ç°ï¼Œå®ƒç»“åˆäº†æ‡’åŠ è½½å’Œçº¿ç¨‹å®‰å…¨çš„ä¼˜ç‚¹ï¼Œåªæœ‰åœ¨å®ä¾‹ä¸ºç©ºæ—¶æ‰ä¼šè¿›å…¥åŒæ­¥å—ï¼Œä»è€Œå‡å°‘äº†é”çš„ç«äº‰ã€‚ æ‡’åŠ è½½ ï¼ˆlazy loadingï¼‰ï¼šä½¿â½¤çš„æ—¶å€™å†åˆ›å»ºå¯¹è±¡ 123456789101112131415161718public class Singleton &#123; private static volatile Singleton instance; private Singleton() &#123; // é˜²æ­¢å¤–éƒ¨ç›´æ¥å®ä¾‹åŒ– &#125; public static Singleton getInstance() &#123; if (instance == null) &#123; synchronized (Singleton.class) &#123; if (instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125;&#125; 5ã€æšä¸¾å•ä¾‹ æšä¸¾å•ä¾‹æ˜¯å®ç°å•ä¾‹æ¨¡å¼çš„æœ€ä½³æ–¹å¼ä¹‹ä¸€ã€‚å®ƒç”± JVM ä¿è¯çº¿ç¨‹å®‰å…¨å’Œå•ä¾‹ï¼Œå¹¶ä¸”é˜²æ­¢ååºåˆ—åŒ–åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ 1234567public enum Singleton &#123; INSTANCE; public void someMethod() &#123; // å®ç°æ–¹æ³• &#125;&#125; æ€»ç»“ æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ï¼šé€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½†ä¸å®‰å…¨ã€‚ æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼šé€šè¿‡ synchronized ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä½†æ€§èƒ½è¾ƒå·®ã€‚ é¥¿æ±‰å¼ï¼šç±»åŠ è½½æ—¶å³åˆ›å»ºå®ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†ç¼ºä¹çµæ´»æ€§ã€‚ åŒé‡é”æ£€æŸ¥ï¼šæ€§èƒ½è¾ƒå¥½ï¼Œæ¨èä½¿ç”¨ã€‚ æšä¸¾å•ä¾‹ï¼šæ¨èä½¿ç”¨ï¼Œç®€æ´ä¸”çº¿ç¨‹å®‰å…¨ã€‚ äºŒã€å·¥å‚æ¨¡å¼Java ä¸­çš„ å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨é€šè¿‡å®šä¹‰ä¸€ä¸ªæ¥å£æ¥åˆ›å»ºå¯¹è±¡ï¼Œä½†è®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ¨¡å¼å¯ä»¥å¸®åŠ©å‡å°‘å®¢æˆ·ç«¯ä¸å…·ä½“äº§å“ç±»ä¹‹é—´çš„è€¦åˆï¼Œæé«˜ä»£ç çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚ 1ã€ç®€å•å·¥å‚æ¨¡å¼ ç®€å•å·¥å‚æ¨¡å¼é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥æ ¹æ®æä¾›çš„ä¿¡æ¯ç”Ÿæˆä¸åŒç±»å‹çš„å¯¹è±¡ã€‚å®ƒä¸éœ€è¦æš´éœ²åˆ›å»ºå¯¹è±¡çš„å…·ä½“é€»è¾‘ï¼Œåªæš´éœ²ä¸€ä¸ªå·¥å‚æ–¹æ³•ä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚ ç»“æ„ï¼š å·¥å‚ç±»ï¼šè´Ÿè´£åˆ›å»ºå®ä¾‹ã€‚ äº§å“æ¥å£ï¼šå®šä¹‰äº§å“çš„å…¬å…±æ¥å£ã€‚ å…·ä½“äº§å“ï¼šå®ç°äº§å“æ¥å£çš„å…·ä½“ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243// äº§å“æ¥å£public interface Product &#123; void use();&#125;// å…·ä½“äº§å“Apublic class ConcreteProductA implements Product &#123; @Override public void use() &#123; System.out.println(&quot;ä½¿ç”¨äº§å“A&quot;); &#125;&#125;// å…·ä½“äº§å“Bpublic class ConcreteProductB implements Product &#123; @Override public void use() &#123; System.out.println(&quot;ä½¿ç”¨äº§å“B&quot;); &#125;&#125;// ç®€å•å·¥å‚ç±»public class SimpleFactory &#123; public static Product createProduct(String type) &#123; if (&quot;A&quot;.equals(type)) &#123; return new ConcreteProductA(); &#125; else if (&quot;B&quot;.equals(type)) &#123; return new ConcreteProductB(); &#125; throw new IllegalArgumentException(&quot;æœªçŸ¥äº§å“ç±»å‹&quot;); &#125;&#125;// å®¢æˆ·ç«¯ä»£ç public class Client &#123; public static void main(String[] args) &#123; Product productA = SimpleFactory.createProduct(&quot;A&quot;); productA.use(); // è¾“å‡º: ä½¿ç”¨äº§å“A Product productB = SimpleFactory.createProduct(&quot;B&quot;); productB.use(); // è¾“å‡º: ä½¿ç”¨äº§å“B &#125;&#125; ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šå®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“å·¥å‚ç±»å’Œäº§å“æ¥å£ï¼Œæ— éœ€å…³å¿ƒå…·ä½“å®ç°ã€‚ ç¼ºç‚¹ï¼šå·¥å‚ç±»ä¸€æ—¦å¢åŠ æ–°çš„äº§å“ï¼Œéœ€ä¿®æ”¹å·¥å‚ç±»ä»£ç ï¼Œè¿åå¼€é—­åŸåˆ™ã€‚ 2ã€å·¥å‚æ–¹æ³•æ¨¡å¼ å·¥å‚æ–¹æ³•æ¨¡å¼é€šè¿‡åœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œè®©å­ç±»å»å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œä»è€Œå†³å®šåˆ›å»ºå“ªç§äº§å“ã€‚è¿™ç§æ¨¡å¼é€šè¿‡ç»§æ‰¿å’Œå¤šæ€æ¥è®©å­ç±»å†³å®šåˆ›å»ºçš„äº§å“ç±»å‹ï¼Œé¿å…äº†ä¿®æ”¹å·¥å‚ç±»ã€‚ ç»“æ„ï¼š æŠ½è±¡å·¥å‚ï¼šå£°æ˜å·¥å‚æ–¹æ³•ã€‚ å…·ä½“å·¥å‚ï¼šå®ç°å·¥å‚æ–¹æ³•ï¼Œè´Ÿè´£åˆ›å»ºå…·ä½“äº§å“ã€‚ äº§å“æ¥å£ï¼šå®šä¹‰äº§å“çš„å…¬å…±æ¥å£ã€‚ å…·ä½“äº§å“ï¼šå®ç°äº§å“æ¥å£çš„å…·ä½“ç±». 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// äº§å“æ¥å£public interface Product &#123; void use();&#125;// å…·ä½“äº§å“Apublic class ConcreteProductA implements Product &#123; @Override public void use() &#123; System.out.println(&quot;ä½¿ç”¨äº§å“A&quot;); &#125;&#125;// å…·ä½“äº§å“Bpublic class ConcreteProductB implements Product &#123; @Override public void use() &#123; System.out.println(&quot;ä½¿ç”¨äº§å“B&quot;); &#125;&#125;// æŠ½è±¡å·¥å‚public abstract class Creator &#123; public abstract Product factoryMethod();&#125;// å…·ä½“å·¥å‚Apublic class ConcreteCreatorA extends Creator &#123; @Override public Product factoryMethod() &#123; return new ConcreteProductA(); &#125;&#125;// å…·ä½“å·¥å‚Bpublic class ConcreteCreatorB extends Creator &#123; @Override public Product factoryMethod() &#123; return new ConcreteProductB(); &#125;&#125;// å®¢æˆ·ç«¯ä»£ç public class Client &#123; public static void main(String[] args) &#123; Creator creatorA = new ConcreteCreatorA(); Product productA = creatorA.factoryMethod(); productA.use(); // è¾“å‡º: ä½¿ç”¨äº§å“A Creator creatorB = new ConcreteCreatorB(); Product productB = creatorB.factoryMethod(); productB.use(); // è¾“å‡º: ä½¿ç”¨äº§å“B &#125;&#125; ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šéµå¾ªäº†å¼€é—­åŸåˆ™ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•å­ç±»æ¥å¢åŠ æ–°äº§å“ï¼Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰ä»£ç ã€‚ ç¼ºç‚¹ï¼šéœ€è¦åˆ›å»ºå¤§é‡çš„å…·ä½“å·¥å‚ç±»ï¼Œå¦‚æœäº§å“ç§ç±»è¿‡å¤šï¼Œå·¥å‚ç±»ä¼šæ€¥å‰§å¢åŠ ã€‚ 3ã€æŠ½è±¡å·¥å‚æ¨¡å¼ ä¸‰ã€è§‚å¯Ÿè€…æ¨¡å¼å››ã€è£…é¥°å™¨æ¨¡å¼äº”ã€è´£ä»»é“¾æ¨¡å¼2.Linux1.Linuxæ–‡ä»¶ç³»ç»Ÿåœ¨Linuxä¸­ï¼Œâ€œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ â€ 1.1.inodeç¡¬ç›˜ä»¥æ‰‡åŒºä¸ºæœ€å°å­˜å‚¨å•ä½ï¼Œæ“ä½œç³»ç»Ÿä»¥å—ä¸ºå•ä½è¿›è¡Œè¯»å†™ï¼Œå—ç”±å¤šä¸ªæ‰‡åŒºç»„æˆï¼Œinodeå­˜å‚¨äº†æ–‡ä»¶å…ƒä¿¡æ¯ï¼ˆä¾‹å¦‚æƒé™ã€å¤§å°ã€ä¿®æ”¹æ—¶é—´ä»¥åŠæ•°æ®å—ä½ç½®ï¼‰ ï¼Œinode çš„è®¿é—®é€Ÿåº¦éå¸¸å¿« inodeï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ stat å‘½ä»¤æŸ¥çœ‹ inode ä¿¡æ¯ã€‚ blockï¼šå®é™…æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å¤§äºä¸€ä¸ªå—æ—¶å€™ï¼Œé‚£ä¹ˆå°†å ç”¨å¤šä¸ª blockï¼Œä½†æ˜¯ä¸€ä¸ªå—åªèƒ½å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ã€‚ï¼ˆå› ä¸ºæ•°æ®æ˜¯ç”± inode æŒ‡å‘çš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæ–‡ä»¶çš„æ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ªå—ä¸­ï¼Œå°±ä¼šä¹±å¥—äº†ï¼‰ 1.2.ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥åœ¨ Linux&#x2F;ç±» Unix ç³»ç»Ÿä¸Šï¼Œæ–‡ä»¶é“¾æ¥ï¼ˆFile Linkï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶ã€‚å¸¸è§çš„æ–‡ä»¶é“¾æ¥ç±»å‹æœ‰ä¸¤ç§ï¼š ç¡¬é“¾æ¥æ˜¯å¤šä¸ªç›®å½•é¡¹ä¸­çš„ã€Œç´¢å¼•èŠ‚ç‚¹ã€æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘åŒä¸€ä¸ª inodeï¼Œä½†æ˜¯ inode æ˜¯ä¸å¯èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰å„è‡ªçš„ inode æ•°æ®ç»“æ„å’Œåˆ—è¡¨ï¼Œ æ‰€ä»¥ç¡¬é“¾æ¥æ˜¯ä¸å¯ç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿçš„ã€‚ç”±äºå¤šä¸ªç›®å½•é¡¹éƒ½æ˜¯æŒ‡å‘ä¸€ä¸ª inodeï¼Œ é‚£ä¹ˆåªæœ‰åˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰ç¡¬é“¾æ¥ä»¥åŠæºæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šå½»åº•åˆ é™¤è¯¥æ–‡ä»¶ã€‚ è½¯é“¾æ¥ç›¸å½“äºé‡æ–°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æœ‰ç‹¬ç«‹çš„ inodeï¼Œ ä½†æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥è®¿é—®è½¯é“¾æ¥çš„æ—¶å€™ï¼Œ å®é™…ä¸Šç›¸å½“äºè®¿é—®åˆ°äº†å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è½¯é“¾æ¥æ˜¯å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œ ç”šè‡³ç›®æ ‡æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œé“¾æ¥æ–‡ä»¶è¿˜æ˜¯åœ¨çš„ï¼Œåªä¸è¿‡æŒ‡å‘çš„æ–‡ä»¶æ‰¾ä¸åˆ°äº†è€Œå·²ã€‚ 2.Linuxå¸¸ç”¨å‘½ä»¤2.1.æ–‡ä»¶ç›¸å…³ lsï¼šåˆ—å‡ºç›®å½•å†…å®¹ã€‚ cdï¼šæ›´æ”¹å½“å‰ç›®å½•ã€‚cd ..å›åˆ°ä¸Šçº§ç›®å½•ï¼Œcd ~å›åˆ°ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ rmï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚rm -ré€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ã€‚ mkdirï¼šåˆ›å»ºæ–°ç›®å½•ã€‚ catï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€‚ pwdï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•çš„å®Œæ•´è·¯å¾„ã€‚ cpï¼šå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚ mvï¼šç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚ 2.2.ç³»ç»Ÿç®¡ç†ç›¸å…³ psï¼šæ˜¾ç¤ºå½“å‰è¿è¡Œçš„è¿›ç¨‹ã€‚ topï¼šå®æ—¶æ˜¾ç¤ºè¿›ç¨‹åŠ¨æ€ã€‚ killï¼šç»ˆæ­¢è¿›ç¨‹ã€‚kill -9 PIDå¼ºåˆ¶ç»ˆæ­¢ã€‚ æ…ç”¨ kill -9ï¼šå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œä¼˜å…ˆç”¨ kill -15 æ­£å¸¸ç»ˆæ­¢ã€‚ chmodï¼šæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚ dfï¼šæ˜¾ç¤ºç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚df -hä»¥æ˜“è¯»æ ¼å¼æ˜¾ç¤ºã€‚ duï¼šæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚ 3.é«˜é¢‘é—®é¢˜ å¦‚ä½•æŸ¥çœ‹ Java è¿›ç¨‹ï¼Ÿ ps -ef | grep java å¦‚ä½•å®æ—¶æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Ÿ tail -f filename.log ï¼Œ-fè¡¨ç¤ºå¾ªç¯è¯»å–ï¼Œå¸¸ç”¨äºæŸ¥çœ‹é€’å¢çš„æ—¥å¿—æ–‡ä»¶ å¦‚ä½•æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µï¼Ÿ netstat -tunlp | grep 8080 ï¼Œèµ·ç è®°ä½netstatå’Œgrep å¦‚ä½•æ€æ­»ä¸€ä¸ªè¿›ç¨‹ï¼Ÿ killï¼Œ-9æ˜¯å¼ºåˆ¶æ€æ­»ï¼Œ-15æ˜¯æ­£å¸¸ç»ˆæ­¢ å¦‚ä½•æŸ¥çœ‹æœåŠ¡å™¨å†…å­˜&#x2F;CPUä½¿ç”¨æƒ…å†µï¼Ÿ top å¦‚ä½•æŸ¥æ‰¾æ–‡ä»¶ï¼Ÿ find é«˜çº§é¢˜ç›® CPUé£™å‡æˆ–100%é—®é¢˜æ€ä¹ˆæ’æŸ¥ï¼Ÿ æ‰¾åˆ°å ç”¨ CPU æœ€é«˜çš„ Java è¿›ç¨‹ï¼štop æ‰¾åˆ°å ç”¨ CPU æœ€é«˜çš„çº¿ç¨‹ï¼štop Hp è¿›ç¨‹idï¼ŒHå‚æ•°è¡¨ç¤ºè¦æ˜¾ç¤ºçº¿ç¨‹çº§åˆ«çš„ä¿¡æ¯ï¼Œpåˆ™è¡¨ç¤ºæŒ‡å®šçš„pidï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹idã€‚ ä¿å­˜çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼šjstack ç”¨äºç”Ÿæˆ Java è¿›ç¨‹çš„çº¿ç¨‹å¿«ç…§ï¼ˆthread dumpï¼‰ã€‚çº¿ç¨‹å¿«ç…§æ˜¯ä¸€ä¸ªå…³äº Java è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹å½“å‰çŠ¶æ€çš„å¿«ç…§ï¼ŒåŒ…æ‹¬æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆä¿¡æ¯ã€‚ å°†ç½ªé­ç¥¸é¦–çš„çº¿ç¨‹idè½¬ä¸º16è¿›åˆ¶ï¼Œç„¶ååœ¨jstackè¾“å‡ºçš„æ—¥å¿—ä¸­æŸ¥æ‰¾è¯¥çº¿ç¨‹çš„ä¿¡æ¯ å¯¼è‡´CPUé£™åˆ°100çš„æƒ…å†µå¯èƒ½æœ‰å“ªäº›ï¼Ÿ æ— é™å¾ªç¯ å†…å­˜ä¸è¶³ é«˜æµé‡ å¾ªç¯ç­‰å¾… 3.Git git clone &lt;repository-url&gt;ï¼šå…‹éš†è¿œç¨‹ä»“åº“ã€‚ git statusï¼šæŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„çŠ¶æ€ã€‚ git add &lt;file&gt;ï¼šå°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºã€‚ git commit -m &quot;message&quot;ï¼šæäº¤æš‚å­˜åŒºçš„æ–‡ä»¶åˆ°æœ¬åœ°ä»“åº“ã€‚ git logï¼šæŸ¥çœ‹æäº¤å†å²ã€‚ git merge &lt;branch-name&gt;ï¼šåˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ã€‚ git checkout &lt;branch-name&gt;ï¼šåˆ‡æ¢åˆ†æ”¯ã€‚ git pullï¼šæ‹‰å–è¿œç¨‹ä»“åº“çš„æ›´æ–°ã€‚ åœºæ™¯ä¸€ã€ç§’æ€ç³»ç»Ÿè®¾è®¡ä»€ä¹ˆæ˜¯ç§’æ€ é€šä¿—ä¸€ç‚¹è®²å°±æ˜¯ç½‘ç»œå•†å®¶ä¸ºä¿ƒé”€ç­‰ç›®çš„ç»„ç»‡çš„ç½‘ä¸Šé™æ—¶æŠ¢è´­æ´»åŠ¨ ä¸šåŠ¡ç‰¹ç‚¹ é«˜å¹¶å‘ï¼šç§’æ€çš„ç‰¹ç‚¹å°±æ˜¯è¿™æ ·æ—¶é—´æçŸ­ã€ ç¬é—´ç”¨æˆ·é‡å¤§ã€‚ åº“å­˜é‡å°‘ï¼šä¸€èˆ¬ç§’æ€æ´»åŠ¨å•†å“é‡å¾ˆå°‘ï¼Œè¿™å°±å¯¼è‡´äº†åªæœ‰æå°‘é‡ç”¨æˆ·èƒ½æˆåŠŸè´­ä¹°åˆ°ã€‚ ä¸šåŠ¡ç®€å•ï¼šæµç¨‹æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸‹è®¢å•ã€æ‰£åº“å­˜ã€æ”¯ä»˜è®¢å• æ¶æ„è¯·æ±‚ï¼Œæ•°æ®åº“å‹åŠ›å¤§ è§£å†³æ–¹æ¡ˆ å‰ç«¯ï¼šé¡µé¢èµ„æºé™æ€åŒ–ï¼ŒæŒ‰é’®æ§åˆ¶ï¼Œä½¿ç”¨ç­”é¢˜æ ¡éªŒç å¯ä»¥é˜²æ­¢ç§’æ€å™¨çš„å¹²æ‰°ï¼Œè®©æ›´å¤šç”¨æˆ·æœ‰æœºä¼šæŠ¢åˆ° nginxï¼šæ ¡éªŒæ¶æ„è¯·æ±‚ï¼Œè½¬å‘è¯·æ±‚ï¼Œè´Ÿè½½å‡è¡¡ï¼›åŠ¨é™åˆ†ç¦»ï¼Œä¸èµ°tomcatè·å–é™æ€èµ„æºï¼›gzipå‹ç¼©ï¼Œå‡å°‘é™æ€æ–‡ä»¶ä¼ è¾“çš„ä½“ç§¯ï¼ŒèŠ‚çœå¸¦å®½ï¼Œæé«˜æ¸²æŸ“é€Ÿåº¦ ä¸šåŠ¡å±‚ï¼šé›†ç¾¤ï¼Œå¤šå°æœºå™¨å¤„ç†ï¼Œæé«˜å¹¶å‘èƒ½åŠ› redisï¼šé›†ç¾¤ä¿è¯é«˜å¯ç”¨ï¼ŒæŒä¹…åŒ–æ•°æ®ï¼›åˆ†å¸ƒå¼é”ï¼ˆæ‚²è§‚é”ï¼‰ï¼›ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆåº“å­˜ï¼‰ mqï¼šå‰Šå³°é™æµï¼ŒMQå †ç§¯è®¢å•ï¼Œä¿æŠ¤è®¢å•å¤„ç†å±‚çš„è´Ÿè½½ï¼ŒConsumeræ ¹æ®è‡ªå·±çš„æ¶ˆè´¹èƒ½åŠ›æ¥å–Taskï¼Œå®é™…ä¸Šä¸‹æ¸¸çš„å‹åŠ›å°±å¯æ§äº†ã€‚é‡ç‚¹åšå¥½è·¯ç”±å±‚å’ŒMQçš„å®‰å…¨ æ•°æ®åº“ï¼šè¯»å†™åˆ†ç¦»ï¼Œæ‹†åˆ†äº‹åŠ¡æé«˜å¹¶å‘åº¦ ç§’æ€ç³»ç»Ÿè®¾è®¡å°ç»“ ç§’æ€ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªâ€œä¸‰é«˜â€ç³»ç»Ÿï¼Œå³é«˜å¹¶å‘ã€é«˜æ€§èƒ½å’Œé«˜å¯ç”¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿ ç§’æ€è®¾è®¡åŸåˆ™ï¼šå‰å°è¯·æ±‚å°½é‡å°‘ï¼Œåå°æ•°æ®å°½é‡å°‘ï¼Œè°ƒç”¨é“¾è·¯å°½é‡çŸ­ï¼Œå°½é‡ä¸è¦æœ‰å•ç‚¹ ç§’æ€é«˜å¹¶å‘æ–¹æ³•ï¼šè®¿é—®æ‹¦æˆªã€åˆ†æµã€åŠ¨é™åˆ†ç¦» ç§’æ€æ•°æ®æ–¹æ³•ï¼šå‡åº“å­˜ç­–ç•¥ã€çƒ­ç‚¹ã€å¼‚æ­¥ã€é™æµé™çº§ è®¿é—®æ‹¦æˆªä¸»è¦æ€è·¯ï¼šé€šè¿‡CDNå’Œç¼“å­˜æŠ€æœ¯ï¼Œå°½é‡æŠŠè®¿é—®æ‹¦æˆªåœ¨ç¦»ç”¨æˆ·æ›´è¿‘çš„å±‚ï¼Œå°½å¯èƒ½åœ°è¿‡æ»¤æ‰æ— æ•ˆè¯·æ±‚ã€‚ åˆ†æµä¸»è¦æ€è·¯ï¼šé€šè¿‡åˆ†å¸ƒå¼é›†ç¾¤æŠ€æœ¯ï¼Œå¤šå°æœºå™¨å¤„ç†ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ã€‚","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Linux","slug":"Linux","permalink":"http://example.com/tags/Linux/"},{"name":"Git","slug":"Git","permalink":"http://example.com/tags/Git/"}]},{"title":"é›†åˆ","slug":"å…«è‚¡/é›†åˆ","date":"2024-11-24T09:11:53.000Z","updated":"2025-03-12T07:20:00.463Z","comments":true,"path":"2024/11/24/å…«è‚¡/é›†åˆ/","permalink":"http://example.com/2024/11/24/%E5%85%AB%E8%82%A1/%E9%9B%86%E5%90%88/","excerpt":"ä¸»è¦æ˜¯Javaå¸¸ç”¨é›†åˆä»‹ç»","text":"ä¸»è¦æ˜¯Javaå¸¸ç”¨é›†åˆä»‹ç» 0. æ¦‚è¿° Java é›†åˆï¼Œä¹Ÿå«ä½œå®¹å™¨ï¼Œä¸»è¦æ˜¯ç”±ä¸¤å¤§æ¥å£æ´¾ç”Ÿè€Œæ¥ï¼šä¸€ä¸ªæ˜¯ Collectionæ¥å£ï¼Œä¸»è¦ç”¨äºå­˜æ”¾å•ä¸€å…ƒç´ ï¼›å¦ä¸€ä¸ªæ˜¯ Map æ¥å£ï¼Œä¸»è¦ç”¨äºå­˜æ”¾é”®å€¼å¯¹ã€‚ å¯¹äºCollection æ¥å£ï¼Œä¸‹é¢åˆæœ‰ä¸‰ä¸ªä¸»è¦çš„å­æ¥å£ï¼šListã€Set ã€ Queueã€‚ åœ¨ java.util åŒ…ä¸­çš„çº¿ç¨‹å®‰å…¨çš„ç±»ä¸»è¦ 2 ä¸ªï¼Œå…¶ä»–éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ Vector Hashtable æ­¤å¤–ï¼Œjava.util.concurrent åŒ…æä¾›çš„éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼š 1.List1.ArrayListå’ŒLinkedListçš„åŒºåˆ« åº•å±‚æ•°æ®ç»“æ„ï¼šArrayList æ˜¯åŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„å®ç°ï¼Œè€Œ LinkedList æ˜¯åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å®ç°ã€‚ æ“ä½œæ•ˆç‡ä¸åŒï¼šå¤šæ•°æƒ…å†µä¸‹ï¼ŒArrayListæ›´åˆ©äºæŸ¥æ‰¾ï¼ŒLinkedListæ›´åˆ©äºå¢åˆ  å ç”¨ç©ºé—´ï¼šLinkedList æ¯” ArrayList æ›´å å†…å­˜ï¼Œå› ä¸º LinkedList çš„èŠ‚ç‚¹é™¤äº†å­˜å‚¨æ•°æ®ï¼Œè¿˜å­˜å‚¨äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæŒ‡å‘åä¸€ä¸ªå…ƒç´ ã€‚ æ˜¯å¦æ”¯æŒéšæœºè®¿é—® 2.ArrayListçš„æ‰©å®¹æœºåˆ¶ArrayListåº•å±‚é‡‡ç”¨çš„æ˜¯Object[] åŠ¨æ€æ•°ç»„å®ç° æ’å…¥æ—¶å€™ï¼Œä¼šå…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå¦‚æœå½“å‰å®¹é‡+1è¶…è¿‡æ•°ç»„é•¿åº¦ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚ ArrayListçš„æ‰©å®¹æ˜¯åˆ›å»ºä¸€ä¸ª1.5å€çš„æ–°æ•°ç»„ï¼Œç„¶åæŠŠåŸæ•°ç»„çš„å€¼æ‹·è´è¿‡å»ã€‚ æ‰©å®¹å®Œæˆåæ›´æ–°å¼•ç”¨åˆ°æ–°çš„æ•°ç»„ä¸Š ä¹‹æ‰€ä»¥æ‰©å®¹æ˜¯ 1.5 å€ï¼Œæ˜¯å› ä¸º 1.5 å¯ä»¥å……åˆ†åˆ©ç”¨ç§»ä½æ“ä½œï¼Œå‡å°‘æµ®ç‚¹æ•°æˆ–è€…è¿ç®—æ—¶é—´å’Œè¿ç®—æ¬¡æ•°ã€‚ 3. ä¸ºä»€ä¹ˆArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„åœ¨é«˜å¹¶å‘æ·»åŠ æ•°æ®ä¸‹ï¼ŒArrayListä¼šæš´éœ²ä¸‰ä¸ªé—®é¢˜; ï¼ˆä¸»è¦ç†è§£å‰ä¸¤ä¸ªå³å¯ï¼‰ éƒ¨åˆ†å€¼ä¸ºnullï¼ˆæˆ‘ä»¬å¹¶æ²¡æœ‰add nullè¿›å»ï¼‰ ç´¢å¼•è¶Šç•Œå¼‚å¸¸ sizeä¸æˆ‘ä»¬addçš„æ•°é‡ä¸ç¬¦ å¦‚ä½•äº§ç”Ÿçš„ï¼š éƒ¨åˆ†å€¼ä¸ºnull:å½“çº¿ç¨‹1èµ°åˆ°äº†æ‰©å®¹é‚£é‡Œå‘ç°å½“å‰sizeæ˜¯9ï¼Œè€Œæ•°ç»„å®¹é‡æ˜¯10ï¼Œæ‰€ä»¥ä¸ç”¨æ‰©å®¹ï¼Œè¿™æ—¶å€™cpuè®©å‡ºæ‰§è¡Œæƒï¼Œçº¿ç¨‹2ä¹Ÿè¿›æ¥äº†ï¼Œå‘ç°sizeæ˜¯9ï¼Œè€Œæ•°ç»„å®¹é‡æ˜¯10ï¼Œæ‰€ä»¥ä¸ç”¨æ‰©å®¹ï¼Œè¿™æ—¶å€™çº¿ç¨‹1ç»§ç»­æ‰§è¡Œï¼Œå°†æ•°ç»„ä¸‹æ ‡ç´¢å¼•ä¸º9çš„ä½ç½®setå€¼äº†ï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠæ‰§è¡Œsize++ï¼Œè¿™æ—¶å€™çº¿ç¨‹2ä¹Ÿæ¥æ‰§è¡Œäº†ï¼ŒåˆæŠŠæ•°ç»„ä¸‹æ ‡ç´¢å¼•ä¸º9çš„ä½ç½®setäº†ä¸€éï¼Œè¿™æ—¶å€™ä¸¤ä¸ªå…ˆåè¿›è¡Œsize++ï¼Œå¯¼è‡´ä¸‹æ ‡ç´¢å¼•10çš„åœ°æ–¹å°±ä¸ºnulläº†ã€‚ ç´¢å¼•è¶Šç•Œå¼‚å¸¸:çº¿ç¨‹1èµ°åˆ°æ‰©å®¹é‚£é‡Œå‘ç°å½“å‰sizeæ˜¯9ï¼Œæ•°ç»„å®¹é‡æ˜¯10ä¸ç”¨æ‰©å®¹ï¼Œcpuè®©å‡ºæ‰§è¡Œæƒï¼Œçº¿ç¨‹2ä¹Ÿå‘ç°ä¸ç”¨æ‰©å®¹ï¼Œè¿™æ—¶å€™æ•°ç»„çš„å®¹é‡å°±æ˜¯10ï¼Œè€Œçº¿ç¨‹1setå®Œä¹‹åsize++ï¼Œè¿™æ—¶å€™çº¿ç¨‹2å†è¿›æ¥sizeå°±æ˜¯10ï¼Œæ•°ç»„çš„å¤§å°åªæœ‰10ï¼Œè€Œä½ è¦è®¾ç½®ä¸‹æ ‡ç´¢å¼•ä¸º10çš„å°±ä¼šè¶Šç•Œ(æ•°ç»„çš„ä¸‹æ ‡ç´¢å¼•ä»0å¼€å§‹); sizeä¸æˆ‘ä»¬addçš„æ•°é‡ä¸ç¬¦:è¿™ä¸ªåŸºæœ¬ä¸Šæ¯æ¬¡éƒ½ä¼šå‘ç”Ÿï¼Œè¿™ä¸ªç†è§£èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºsize++æœ¬èº«å°±ä¸æ˜¯åŸå­æ“ä½œï¼Œå¯ä»¥åˆ†ä¸ºä¸‰æ­¥:è·å–sizeçš„å€¼ï¼Œå°†sizeçš„å€¼åŠ 1ï¼Œå°†æ–°çš„sizeå€¼è¦†ç›–æ‰åŸæ¥çš„ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2æ‹¿åˆ°ä¸€æ ·çš„sizeå€¼åŠ å®Œäº†åŒæ—¶è¦†ç›–ï¼Œå°±ä¼šå¯¼è‡´ä¸€æ¬¡æ²¡æœ‰åŠ ä¸Šï¼Œæ‰€ä»¥è‚¯å®šä¸ä¼šä¸æˆ‘ä»¬addçš„æ•°é‡ä¿æŒä¸€è‡´çš„; 4.CopyOnWriteArrayListä¸ºä»€ä¹ˆçº¿ç¨‹å®‰å…¨CopyOnWriteArrayListå°±æ˜¯çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬çš„ArrayListã€‚ CopyOnWriteArrayListåº•å±‚ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªæ•°ç»„ä¿å­˜æ•°æ®ï¼Œ ä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°æ•°ç»„ï¼Œä¿è¯å½“å‰çº¿ç¨‹å¯¹æ•°ç»„å¯¹è±¡é‡æ–°èµ‹å€¼åï¼Œ å…¶ä»–çº¿ç¨‹å¯ä»¥åŠæ—¶æ„ŸçŸ¥åˆ°ã€‚ åœ¨å†™å…¥æ“ä½œæ—¶ï¼ŒåŠ äº†ä¸€æŠŠäº’æ–¥é”ReentrantLockä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ CopyOnWriteArrayListé‡‡ç”¨äº†ä¸€ç§è¯»å†™åˆ†ç¦»çš„å¹¶å‘ç­–ç•¥ã€‚CopyOnWriteArrayListå®¹å™¨å…è®¸å¹¶å‘è¯»ï¼Œè¯»æ“ä½œæ˜¯æ— é”çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚è‡³äºå†™æ“ä½œï¼Œæ¯”å¦‚å‘å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™é¦–å…ˆå°†å½“å‰å®¹å™¨å¤åˆ¶ä¸€ä»½ï¼Œç„¶ååœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œç»“æŸä¹‹åå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°å®¹å™¨ã€‚ 2.Set1.Listå’ŒSetçš„åŒºåˆ«ï¼Ÿ Listï¼šä¸€ä¸ªæœ‰åºï¼ˆå…ƒç´ å­˜å…¥é›†åˆçš„é¡ºåºå’Œå–å‡ºçš„é¡ºåºä¸€è‡´ï¼‰å®¹å™¨ï¼Œå…ƒç´ å¯ä»¥é‡å¤ï¼Œå¯ä»¥æ’å…¥å¤šä¸ªnullå…ƒç´ ï¼Œå…ƒç´ éƒ½æœ‰ç´¢å¼•ã€‚ List æ”¯æŒforå¾ªç¯ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸‹æ ‡æ¥éå†ï¼Œä¹Ÿå¯ä»¥ç”¨è¿­ä»£å™¨ Setï¼šä¸€ä¸ªæ— åºï¼ˆå­˜å…¥å’Œå–å‡ºé¡ºåºæœ‰å¯èƒ½ä¸ä¸€è‡´ï¼‰å®¹å™¨ï¼Œä¸å¯ä»¥å­˜å‚¨é‡å¤å…ƒç´ ï¼Œåªå…è®¸å­˜å…¥ä¸€ä¸ªnullå…ƒç´ ï¼Œå¿…é¡»ä¿è¯å…ƒç´ å”¯ä¸€æ€§ ã€‚setåªèƒ½ç”¨è¿­ä»£å™¨ï¼Œå› ä¸ºä»–æ— åºï¼Œæ— æ³•ç”¨ä¸‹æ ‡æ¥å–å¾—æƒ³è¦çš„å€¼ã€‚ 3.Map1.HashMapæ€ä¹ˆå¤„ç†Hashå†²çª é“¾æ¥æ³•ï¼šä½¿ç”¨é“¾è¡¨æˆ–å…¶ä»–æ•°æ®ç»“æ„æ¥å­˜å‚¨å†²çªçš„é”®å€¼å¯¹ï¼Œå°†å®ƒä»¬é“¾æ¥åœ¨åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚ å¼€æ”¾å¯»å€æ³•ï¼šåœ¨å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°å¦ä¸€ä¸ªå¯ç”¨çš„ä½ç½®æ¥å­˜å‚¨å†²çªçš„é”®å€¼å¯¹ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨é“¾è¡¨ä¸­ã€‚å¸¸è§çš„å¼€æ”¾å¯»å€æ–¹æ³•åŒ…æ‹¬çº¿æ€§æ¢æµ‹ã€äºŒæ¬¡æ¢æµ‹å’ŒåŒé‡æ•£åˆ—ã€‚ å†å“ˆå¸Œæ³•(Rehashing)ï¼šå½“å‘ç”Ÿå†²çªæ—¶ï¼Œä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°å†æ¬¡è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºä½æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚ 2.HasMapçš„åº•å±‚æ•°æ®ç»“æ„åŠå®ç°åŸç† æ•°ç»„ï¼ˆNode[] tableï¼‰ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¢«ç§°ä¸ºâ€œæ¡¶â€ï¼ˆBucketï¼‰ï¼Œæ¯ä¸ªæ¡¶çš„ç´¢å¼•é€šè¿‡å¯¹é”®keyçš„å“ˆå¸Œå€¼è¿›è¡Œ hash() å¤„ç†å¾—åˆ°ã€‚ æ‰°åŠ¨å‡½æ•°hash() çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘å“ˆå¸Œå†²çªï¼Œä¿è¯å…ƒç´ èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å¸ƒåœ¨æ•°ç»„çš„æ¯ä¸ªä½ç½®ä¸Šã€‚ 1234static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; å­˜å‚¨æ—¶ï¼Œå¦‚æœå‡ºç°hashå€¼ç›¸åŒçš„keyï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µã€‚(1)å¦‚æœkeyç›¸åŒï¼Œåˆ™è¦†ç›–åŸå§‹å€¼ï¼›(2)å¦‚æœkeyä¸åŒï¼ˆå‡ºç°å†²çªï¼‰ï¼Œåˆ™å°†å½“å‰çš„æ”¾å…¥é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­ ä¸è¿‡ï¼Œé“¾è¡¨è¿‡é•¿æ—¶ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œäºæ˜¯å½“é“¾è¡¨çš„é•¿åº¦è¶…è¿‡ 8 æ—¶ï¼ˆä¸”æ•°ç»„çš„é•¿åº¦å¤§äº 64ï¼‰ï¼Œé“¾è¡¨å°±ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ˜¯ O(logn)ï¼Œæ¯”é“¾è¡¨çš„ O(n) è¦å¿«ã€‚ å½“ä» HashMap ä¸­è·å–å…ƒç´ æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨ hash() è®¡ç®—é”®çš„ä½ç½®ã€HashMap é€šè¿‡ key çš„ hashcode ç»è¿‡æ‰°åŠ¨å‡½æ•°å¤„ç†è¿‡åå¾—åˆ° hash å€¼ï¼Œç„¶åé€šè¿‡ (n - 1) &amp; hash åˆ¤æ–­å½“å‰å…ƒç´ å­˜æ”¾çš„ä½ç½®ï¼ˆè¿™é‡Œçš„ n æŒ‡çš„æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ã€‘ï¼Œç„¶åæ ¹æ®ä½ç½®åœ¨æ•°ç»„æŸ¥æ‰¾å…ƒç´ ã€‚ HashMap çš„åˆå§‹å®¹é‡æ˜¯ 16ï¼Œéšç€å…ƒç´ çš„ä¸æ–­æ·»åŠ ï¼ŒHashMap çš„å®¹é‡å¯èƒ½ä¸è¶³ï¼Œäºæ˜¯å°±éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œé˜ˆå€¼æ˜¯capacity * loadFactorï¼Œcapacity ä¸ºå®¹é‡ï¼ŒloadFactor ä¸ºè´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º 0.75ã€‚ 3.HashMapçš„putæµç¨‹ æ ¹æ®keyçš„å“ˆå¸Œç è®¡ç®—å®ƒè¦æ’å…¥çš„ç´¢å¼•ï¼ˆè°ƒç”¨äº†hashæ–¹æ³•ï¼‰ åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0ï¼Œå¦‚æœæ˜¯åˆ™è¿›è¡Œæ‰©å®¹æ“ä½œã€‚ å¦åˆ™å°±åˆ¤æ–­è¯¥ç´¢å¼•å¤„æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±ç›´æ¥æ’å…¥ å¦‚æœä¸ä¸ºç©ºï¼Œåˆ¤æ–­keyæ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–value å¦åˆ™ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºæ ‘èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯æ ‘èŠ‚ç‚¹å°±ç›´æ¥æ’å…¥çº¢é»‘æ ‘ å¦åˆ™ï¼Œè¯´æ˜å°±æ˜¯é“¾è¡¨ï¼Œéå†é“¾è¡¨æ˜¯å¦å­˜åœ¨keyï¼Œå¦‚æœå­˜åœ¨å°±è¦†ç›–ï¼Œå¦åˆ™å°±æ’å…¥é“¾è¡¨ï¼ŒåŒæ—¶è¿˜è¦æ³¨æ„é“¾è¡¨é•¿åº¦ï¼Œè¶…è¿‡8ä¸”æ•°ç»„é•¿åº¦è¶…è¿‡64å°±å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­æ­¤æ—¶æ•°ç»„é”®å€¼å¯¹æ•°é‡æ˜¯å¦è¶…è¿‡äº†é˜ˆå€¼threshold(æ•°ç»„é•¿åº¦*0.75ã€è´Ÿè½½å› å­ã€‘)ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ 4.HashMapçš„æ‰©å®¹æœºåˆ¶ ç¬¬1æ­¥æ˜¯å¯¹å“ˆå¸Œè¡¨é•¿åº¦çš„æ‰©å±•ï¼ˆ2å€ï¼‰ ç¬¬2æ­¥æ˜¯å°†æ—§å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®æ”¾åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚ å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½® ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚ æˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—hashï¼Œ åªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œ æ˜¯1çš„è¯ç´¢å¼•å˜æˆ â€œåŸç´¢å¼•+æ—§å®¹é‡ï¼ˆoldCapacityï¼‰â€ ã€‚æ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå¯ä»¥å‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº† ä¸ºä»€ä¹ˆè´Ÿè½½å› å­è®¾ä¸º0.75ï¼Ÿ ç­”ï¼šè¿™æ˜¯ä»æ—¶é—´æˆæœ¬å’Œç©ºé—´æˆæœ¬ç»¼åˆè€ƒè™‘çš„ç»“æœ è´Ÿè½½å› å­å†³å®šå…ƒç´ ä¸ªæ•°è¾¾åˆ°å¤šå°‘æ—¶å€™æ‰©å®¹ å¦‚æœè®¾çš„å¤ªå¤§ï¼Œç­‰è¦æ‰©å®¹çš„æ—¶å€™åŸºæœ¬æ²¡å¤šå°‘ç©ºä½äº†ï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªçš„æ¦‚ç‡éå¸¸å¤§ï¼Œä¼šå¢åŠ æˆ‘ä»¬æŸ¥æ‰¾çš„æ—¶é—´æˆæœ¬ å¦‚æœè®¾çš„å¤ªå°ï¼Œæœ‰ç‚¹æµªè´¹ï¼Œæˆ‘ä»¬å°±éœ€è¦æ›´å¤šçš„ç©ºé—´å»å­˜å‚¨å…ƒç´ ï¼Œå¢åŠ äº†ç©ºé—´æˆæœ¬ 5.HashMapçš„å¯»å€ç®—æ³•è¿™ä¸ªé—®é¢˜å’Œ3.5ï¼Œ3.6ç»“åˆç€ç†è§£ ä¼ å…¥keyçš„å“ˆå¸Œç æ˜¯ç»è¿‡ä¸¤æ¬¡å“ˆå¸Œè®¡ç®—çš„ï¼ˆhashç®—æ³•é‡Œé¢åˆæœ‰ä¸€ä¸ªhashCodeï¼ˆï¼‰ï¼‰,ç›®çš„æ˜¯å‡å°‘ç¢°æ’ (n - 1) &amp; hash ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ï¼ˆæ•°ç»„èŠ‚ç‚¹ï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ç´¢å¼•ï¼Œnæ˜¯æ•°ç»„å¤§å° 12345static final int hash(Object key) &#123; int h; // ä¼ å…¥keyçš„hashcodeçš„é«˜16ä½å’Œä½16ä½è¿›è¡Œå¼‚æˆ–æ“ä½œ return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; 6.HashMapä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨hashCode()å¤„ç†åçš„å“ˆå¸Œå€¼ç›´æ¥ä½œä¸ºtableçš„ä¸‹æ ‡ å“ˆå¸Œå€¼ä¸æ•°ç»„å¤§å°èŒƒå›´ä¸åŒ¹é…ï¼›hashCode()æ–¹æ³•è¿”å›çš„æ˜¯intæ•´æ•°ç±»å‹ï¼Œint çš„èŒƒå›´æ˜¯ -2147483648~2147483647ï¼ŒåŠ èµ·æ¥å¤§æ¦‚ 40 äº¿ä¸Šä¸‹çš„æµ®åŠ¨ã€‚ èŒƒå›´è¿œè¶…HashMapçš„å®¹é‡èŒƒå›´ è§£å†³æ–¹æ³•ï¼š HashMap çš„é•¿åº¦ï¼ˆå®¹é‡capacityï¼‰ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Ÿï¼ˆTODO äº†è§£ï¼‰ ä¸ç”¨é‡æ–°è®¡ç®—hashï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½® ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚ åªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œ æ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+æ—§å®¹é‡ï¼ˆoldCapacityï¼‰â€ï¼Œçœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ ç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå¯ä»¥å‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº† 7.HashMapåœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ é—®é¢˜ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰©å®¹æ“ä½œå¯èƒ½å­˜åœ¨æ­»å¾ªç¯é—®é¢˜ï¼Œè¿™æ˜¯ç”±äºå½“ä¸€ä¸ªæ¡¶ä½ä¸­æœ‰å¤šä¸ªå…ƒç´ éœ€è¦è¿›è¡Œæ‰©å®¹æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹é“¾è¡¨è¿›è¡Œæ“ä½œï¼Œå¤´æ’æ³•å¯èƒ½ä¼šå¯¼è‡´é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‡å‘é”™è¯¯çš„ä½ç½®ï¼Œä»è€Œå½¢æˆä¸€ä¸ªç¯å½¢é“¾è¡¨ï¼Œè¿›è€Œä½¿å¾—æŸ¥è¯¢å…ƒç´ çš„æ“ä½œé™·å…¥æ­»å¾ªç¯æ— æ³•ç»“æŸã€‚ è§£å†³ï¼šä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJDK1.8 ç‰ˆæœ¬çš„ HashMap é‡‡ç”¨äº†å°¾æ’æ³•è€Œä¸æ˜¯å¤´æ’æ³•æ¥é¿å…é“¾è¡¨å€’ç½®ï¼Œä½¿å¾—æ’å…¥çš„èŠ‚ç‚¹æ°¸è¿œéƒ½æ˜¯æ”¾åœ¨é“¾è¡¨çš„æœ«å°¾ï¼Œé¿å…äº†é“¾è¡¨ä¸­çš„ç¯å½¢ç»“æ„ã€‚ä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMapï¼Œå› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap è¿˜æ˜¯ä¼šå­˜åœ¨æ•°æ®è¦†ç›–çš„é—®é¢˜ï¼Œå¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œ put æ“ä½œï¼Œå¦‚æœè®¡ç®—å‡ºæ¥çš„ç´¢å¼•ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œ é‚£ä¼šé€ æˆå‰ä¸€ä¸ª key è¢«åä¸€ä¸ª key è¦†ç›–ï¼Œä»è€Œå¯¼è‡´å…ƒç´ çš„ä¸¢å¤±ã€‚å¹¶å‘ç¯å¢ƒä¸‹ï¼Œæ¨èä½¿ç”¨concurrentHashMap 8.ConcurrentHashMapçš„åº•å±‚åŸç† jdk1.7 åº•å±‚æ•°æ®ç»“æ„ï¼šæ•°ç»„ï¼‹é“¾è¡¨ã€‚ä¸€ä¸ªConcurrentHashMapæœ‰ä¸€ä¸ªSegmentçš„æ•°ç»„ï¼Œæ¯ä¸ªSegmentåˆæœ‰ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œç„¶åæ¯ä¸ªHashEntryåˆæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„ï¼ŒHashEntry åˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚Segmentï¼ˆåˆ†æ®µé”ï¼‰ æ˜¯ä¸€ç§å¯é‡å…¥çš„é” ReentrantLock å°†æ•°æ®åˆ†æ®µï¼Œå¯¹æ¯ä¸ªSegmentåˆ†é…ä¸€æŠŠé”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚ åŒä¸€Segmentå¯ä»¥å¹¶å‘è¯»ï¼Œä¸èƒ½å¹¶å‘å†™ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªå†™å…¶å®ƒçš„è¯»ï¼›ä¸åŒSegmentå¯ä»¥å¹¶å‘è¯»å†™ï¼Œå‰ææ˜¯è·å¾—é” getï¼š é€šè¿‡ hash(key) å®šä½åˆ° segment å†éå†é“¾è¡¨å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ value æ˜¯ volatile çš„ï¼Œæ‰€ä»¥ get æ˜¯ä¸éœ€è¦åŠ é”çš„ã€‚ putï¼š è®¡ç®— hashï¼Œå®šä½åˆ° segmentï¼Œsegment å¦‚æœæ˜¯ç©ºå°±å…ˆåˆå§‹åŒ–ï¼› ä½¿ç”¨ ReentrantLock åŠ é”ï¼Œå¦‚æœè·å–é”å¤±è´¥åˆ™å°è¯•è‡ªæ—‹ï¼Œè‡ªæ—‹è¶…è¿‡æ¬¡æ•°å°±é˜»å¡è·å–ï¼Œä¿è¯ä¸€å®šèƒ½è·å–åˆ°é”ï¼› éå† HashEntryï¼Œkey ç›¸åŒå°±ç›´æ¥æ›¿æ¢ï¼Œä¸å­˜åœ¨å°±æ’å…¥ã€‚ é‡Šæ”¾é”ã€‚ jdk1.8 å’Œ1.7çš„å˜åŒ–ï¼š æ•°æ®ç»“æ„æ”¹ä¸ºNodeèŠ‚ç‚¹æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ŒNodeå­˜å‚¨é”®å€¼å¯¹ å’ŒHash Mapä¸€æ ·ï¼Œé“¾è¡¨é•¿åº¦è¾¾åˆ°8çš„æ—¶å€™ä¼šè½¬åŒ–æˆçº¢é»‘æ ‘ æ”¾å¼ƒäº†Segmentåˆ†æ®µé”æ¥ä¿è¯å®‰å…¨ï¼Œæ”¹ä¸ºä½¿ç”¨volatile + CAS æˆ–è€… synchronized åªå¯¹ï¼ˆé“¾è¡¨æˆ–çº¢é»‘æ ‘çš„ï¼‰å¤´èŠ‚ç‚¹æ¥åŠ é”ï¼Œä»è€Œå®ç°çš„çº¿ç¨‹å®‰å…¨çš„ã€‚ getï¼š é€šè¿‡è®¡ç®—å“ˆå¸Œå€¼å¿«é€Ÿå®šä½æ¡¶ï¼Œåœ¨æ¡¶ä¸­æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹ï¼Œå¤šä¸ª key å€¼æ—¶é“¾è¡¨éå†å’Œçº¢é»‘æ ‘æŸ¥æ‰¾ã€‚è¯»æ“ä½œæ˜¯æ— é”çš„ï¼Œä¾èµ– volatile ä¿è¯çº¿ç¨‹å¯è§æ€§ã€‚ putæµç¨‹ï¼š æ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—è¯¥ä½ç½®æ˜¯å¦ä¸ºç©ºã€‚ å¦‚æœæ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—ç»“æœä¸ºç©ºï¼Œåˆ™åˆ©ç”¨ CAS è®¾ç½®è¯¥èŠ‚ç‚¹ï¼Œå†™å…¥æ•°æ®ï¼› å¦‚æœæ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—ç»“æœä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ synchronized ï¼Œç„¶åï¼Œéå†æ¡¶ä¸­çš„æ•°æ®ï¼Œå¹¶æ›¿æ¢æˆ–æ–°å¢èŠ‚ç‚¹åˆ°æ¡¶ä¸­ï¼Œ æœ€åå†åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¸ºçº¢é»‘æ ‘ æ€»çš„æ¥è¯´ï¼Œç›¸æ¯”å‰ä»£ï¼Œèˆå¼ƒäº†Segmentåˆ†æ®µé”è‡ƒè‚¿çš„è®¾è®¡ï¼Œæ”¹ä¸ºåªç”¨é”å¤´èŠ‚ç‚¹çš„æ–¹å¼ï¼Œé”ç²’åº¦æ›´ç»†ï¼Œå‘ç”Ÿå†²çªå’ŒåŠ é”çš„é¢‘ç‡é™ä½ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚ å¦ä¸€æ–¹é¢ï¼Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘çš„æ“ä½œä¹Ÿä¼šä½¿å¢åŠ æŸ¥æ‰¾æ•ˆç‡ 9.HashTableçš„åº•å±‚åŸç†Hashtableçš„åº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨ HashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒé‡‡ç”¨çš„æ˜¯å…¨è¡¨é”ã€‚å®ƒä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚ 10.ConcurrentHashMap å’Œ Hashtable çš„åŒºåˆ« åº•å±‚æ•°æ®ç»“æ„ jdk7ä¹‹å‰çš„ConcurrentHashMapåº•å±‚é‡‡ç”¨çš„æ˜¯åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨å®ç°ï¼Œjdk8ä¹‹åé‡‡ç”¨çš„æ˜¯æ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘æ ‘; HashTableé‡‡ç”¨çš„æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œæ•°ç»„æ˜¯ä¸»ä½“ï¼Œé“¾è¡¨æ˜¯è§£å†³hashå†²çªå­˜åœ¨çš„ã€‚ å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ idk8ä»¥å‰ï¼ŒConcurrentHashMapé‡‡ç”¨åˆ†æ®µé”ï¼Œå¯¹æ•´ä¸ªæ•°ç»„è¿›è¡Œäº†åˆ†æ®µåˆ†å‰²ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨é‡Œçš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®ä¸åŒæ•°æ®æ®µé‡Œçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜äº†å¹¶å‘è®¿é—®;idk8ä»¥åï¼Œç›´æ¥é‡‡ç”¨æ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘æ ‘ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨CASå’Œsynchronizedæ“ä½œï¼Œæ›´åŠ æé«˜äº†é€Ÿåº¦ã€‚ HashTable:ä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè®¿é—®çš„æ—¶å€™ï¼Œå°±ä¼šé™·å…¥é˜»å¡æˆ–è€…è½®è¯¢çš„çŠ¶æ€ã€‚","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"JavaSE","slug":"JavaSE","permalink":"http://example.com/tags/JavaSE/"}]},{"title":"ä¸­é—´ä»¶","slug":"å…«è‚¡/ä¸­é—´ä»¶","date":"2024-11-24T05:10:08.000Z","updated":"2025-03-13T04:58:25.170Z","comments":true,"path":"2024/11/24/å…«è‚¡/ä¸­é—´ä»¶/","permalink":"http://example.com/2024/11/24/%E5%85%AB%E8%82%A1/%E4%B8%AD%E9%97%B4%E4%BB%B6/","excerpt":"è¿™é‡Œæ˜¯æœ‰å…³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€äº›å…«è‚¡","text":"è¿™é‡Œæ˜¯æœ‰å…³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€äº›å…«è‚¡ 1.MQçš„ä½œç”¨ å¼‚æ­¥å¤„ç†ï¼šç³»ç»Ÿå¯ä»¥å°†é‚£äº›è€—æ—¶çš„ä»»åŠ¡æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¼‚æ­¥å¤„ç†ï¼Œä»è€Œå¿«é€Ÿå“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚æ¯”å¦‚è¯´ï¼Œç”¨æˆ·ä¸‹å•åï¼Œç³»ç»Ÿå¯ä»¥å…ˆè¿”å›ä¸€ä¸ªä¸‹å•æˆåŠŸçš„æ¶ˆæ¯ï¼Œç„¶åå°†è®¢å•ä¿¡æ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œåå°ç³»ç»Ÿå†å»å¤„ç†è®¢å•ä¿¡æ¯ã€‚ å‰Šå³°&#x2F;é™æµï¼šç”¨äºåº”å¯¹ç³»ç»Ÿé«˜å¹¶å‘è¯·æ±‚çš„ç¬æ—¶æµé‡é«˜å³°ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥å°†ç¬æ—¶çš„é«˜å³°æµé‡è½¬åŒ–ä¸ºæŒç»­çš„ä½æµé‡ï¼Œä»è€Œä¿æŠ¤ç³»ç»Ÿä¸ä¼šå› ä¸ºç¬æ—¶çš„é«˜æµé‡è€Œå´©æºƒã€‚å…ˆå°†çŸ­æ—¶é—´é«˜å¹¶å‘äº§ç”Ÿçš„äº‹åŠ¡æ¶ˆæ¯å­˜å‚¨åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶ååç«¯æœåŠ¡å†æ…¢æ…¢æ ¹æ®è‡ªå·±çš„èƒ½åŠ›å»æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œè¿™æ ·å°±é¿å…ç›´æ¥æŠŠåç«¯æœåŠ¡æ‰“å®æ‰ã€‚ é™ä½è€¦åˆï¼šç”Ÿäº§è€…å°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´å°±ä¸éœ€è¦ç›´æ¥é€šä¿¡ï¼Œç”Ÿäº§è€…åªç®¡ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªç®¡æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¿™æ ·å°±å®ç°äº†è§£è€¦ã€‚ 2.å‡ ç§MQçš„å¯¹æ¯”(æŠ€æœ¯é€‰å‹) RabbitMQ Kafka RocketMQ å…¬å¸ Rabbit Apache é˜¿é‡Œ æ¶æ„ ä¼ ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„ åŸºäºä¸»é¢˜ï¼ˆTopicï¼‰çš„å‘å¸ƒ-è®¢é˜…æ¨¡å‹ é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ æ¶ˆæ¯å¯é æ€§ é«˜ é«˜ ä¸€èˆ¬ ååé‡ é«˜ è¶…é«˜ è¶…é«˜ RabbitMQï¼šå¼ºè°ƒæ¶ˆæ¯çš„å¯é ä¼ é€’å’Œçµæ´»è·¯ç”±ï¼Œé€‚åˆä¸­å°è§„æ¨¡çš„ä¼ä¸šåº”ç”¨å’Œå¾®æœåŠ¡æ¶æ„ã€‚ RocketMQï¼šä¸“æ³¨äºé«˜æ€§èƒ½ã€é«˜å¯é æ€§å’Œå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æŒï¼Œé€‚åˆå¤æ‚ä¸šåŠ¡åœºæ™¯ã€‚ Kafkaï¼šä¸“ä¸ºé«˜ååé‡çš„æµæ•°æ®å¤„ç†è®¾è®¡ï¼Œé€‚åˆå®æ—¶æ•°æ®ç®¡é“å’Œå¤§æ•°æ®åˆ†æã€‚ 3.RabbitMQçš„å·¥ä½œæ¨¡å¼ ç®€å•æ¨¡å¼ï¼šä¸€å¯¹ä¸€æ¨¡å¼ï¼Œä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼šä¸€å¯¹å¤šæ¨¡å¼ï¼Œä¸€ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–å”¯ä¸€çš„æ¶ˆæ¯ã€‚é€‚ç”¨äºèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œ å•ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸è¿‡æ¥ï¼Œéœ€è¦å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†çš„åœºæ™¯ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼š å¤šäº†ä¸€ä¸ª Exchange è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š ç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰ æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ äº¤æ¢æœºä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeä¸æ¶ˆæ¯é˜Ÿåˆ—çš„ç»‘å®šæ¨¡å¼ï¼š Fanoutï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰ï¼šå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—ï¼Œå½“å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°fanoutäº¤æ¢å™¨ä¸Šæ—¶ï¼Œå®ƒä¼šæŠŠæ¶ˆæ¯æŠ•æ”¾åˆ°æ‰€æœ‰é™„åŠ åœ¨æ­¤äº¤æ¢å™¨ä¸Šçš„é˜Ÿåˆ— Directï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ï¼šæ¶ˆæ¯å‘é€è€…é€šè¿‡æŒ‡å®šä¸åŒçš„è·¯ç”±é”®å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ ¹æ®è·¯ç”±é”®å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ Topicï¼ˆä¸»é¢˜æ¨¡å¼ï¼‰ï¼šæ¶ˆæ¯å‘é€è€…é€šè¿‡æŒ‡å®šä¸»é¢˜(å¯ä»¥ä½¿ç”¨é€šé…ç¬¦)å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ ¹æ®ä¸»é¢˜å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ 4.AMQPåè®®æ¨¡å‹ Brokerï¼šä»£è¡¨ç€ä¸€ä¸ªä¸­é—´ä»¶åº”ç”¨ï¼Œè´Ÿè´£æ¥æ”¶æ¶ˆæ¯ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åå°†æ¶ˆæ¯å‘é€è‡³æ¶ˆæ¯æ¥å—è€…æˆ–è€…å…¶ä»–çš„brokerã€‚ä¸€ä¸ª RabbitMQ Broker å¯ä»¥ç®€å•åœ°çœ‹ä½œä¸€ä¸ª RabbitMQ æœåŠ¡èŠ‚ç‚¹ï¼Œæˆ–è€… RabbitMQ æœåŠ¡å®ä¾‹ã€‚ Channelï¼šä»£è¡¨ç€producerã€consumerå’Œbrokerä¹‹é—´çš„é€»è¾‘è¿æ¥ï¼Œä¸€ä¸ªConnectionå¯ä»¥åŒ…å«å¤šä¸ªChannelã€‚Channelä½¿å¾—åŸºäºåŒä¸€è¿æ¥çš„ä¸åŒè¿›ç¨‹ä¹‹é—´ä¸brokerä¹‹é—´çš„äº¤äº’ç›¸äº’éš”ç¦»ï¼Œä¸å¹²æ‰°ã€‚è€Œä¸éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œchannelåœ¨å‘ç”Ÿåè®®é”™è¯¯çš„æ—¶å€™ä¼šè¢«å…³é—­ã€‚ Exchangeï¼šè¿™æ˜¯æ‰€æœ‰è¢«å‘é€çš„æ¶ˆæ¯é¦–å…ˆåˆ°è¾¾çš„ç›®çš„åœ°ï¼ŒExchangeè´Ÿè´£æ ¹æ®è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚è·¯ç”±è§„åˆ™åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼šdirectï¼ˆpoint-to-pointï¼‰ã€topicï¼ˆpublish-subscribeï¼‰å’Œfanoutï¼ˆmulticastï¼‰ã€‚ Queueï¼šè¿™æ˜¯æ¶ˆæ¯åˆ°è¾¾çš„æœ€ç»ˆç›®çš„åœ°ï¼Œåˆ°è¾¾queueçš„æ¶ˆæ¯æ˜¯å·²ç»å‡†å¤‡å¥½è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«exchange copyå‘é€è‡³å¤šä¸ªqueueã€‚ Bindingï¼šè¿™æ˜¯queueå’Œexchangeä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œä½¿å¾—æ¶ˆæ¯ä»å“ªä¸ªexchangeè·¯ç”±åˆ°Queueã€‚routing keyå¯ä»¥é€šè¿‡bindingå’Œexchange routingè§„åˆ™å…³è”ã€‚ 5.å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿrabbitmqæ€ä¹ˆå®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿå»¶è¿Ÿé˜Ÿåˆ—æŒ‡çš„æ˜¯å­˜å‚¨å¯¹åº”çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œæ¶ˆæ¯è¢«å‘é€ä»¥åï¼Œå¹¶ä¸æƒ³è®©æ¶ˆè´¹è€…ç«‹åˆ»æ‹¿åˆ°æ¶ˆæ¯ï¼Œè€Œæ˜¯ç­‰å¾…ç‰¹å®šæ—¶é—´åï¼Œæ¶ˆè´¹è€…æ‰èƒ½æ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚ RabbitMQ æœ¬èº«æ˜¯æ²¡æœ‰å»¶è¿Ÿé˜Ÿåˆ—çš„ï¼Œè¦å®ç°å»¶è¿Ÿæ¶ˆæ¯ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š é€šè¿‡ RabbitMQ æœ¬èº«é˜Ÿåˆ—çš„ç‰¹æ€§æ¥å®ç°ï¼Œéœ€è¦ä½¿ç”¨ RabbitMQ çš„æ­»ä¿¡äº¤æ¢æœºï¼ˆExchangeï¼‰å’Œæ¶ˆæ¯çš„å­˜æ´»æ—¶é—´ TTLï¼ˆTime To Liveï¼‰ã€‚ç”Ÿäº§è€…å‘é€å¸¦TTLçš„æ¶ˆæ¯åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¶ˆæ¯è¿‡æœŸåè·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ç„¶åæ¶ˆè´¹è€…è®¢é˜…æ­»ä¿¡é˜Ÿåˆ— åœ¨ RabbitMQ 3.5.7 åŠä»¥ä¸Šçš„ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªæ’ä»¶ï¼ˆrabbitmq-delayed-message-exchangeï¼‰æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ã€‚åŒæ—¶ï¼Œæ’ä»¶ä¾èµ– Erlang&#x2F;OPT 18.0 åŠä»¥ä¸Šã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒAMQP åè®®ä»¥åŠ RabbitMQ æœ¬èº«æ²¡æœ‰ç›´æ¥æ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ TTL å’Œ DLX æ¨¡æ‹Ÿå‡ºå»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ã€‚ 6.æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ (dead message) ä¹‹åï¼Œå®ƒèƒ½è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢å™¨ä¸­ï¼Œè¿™ä¸ªäº¤æ¢å™¨å°±æ˜¯ DLXï¼ˆDead-Letter-Exchangeï¼‰ï¼Œç»‘å®š DLX çš„é˜Ÿåˆ—å°±ç§°ä¹‹ä¸ºæ­»ä¿¡é˜Ÿåˆ—ã€‚æ­»ä¿¡é˜Ÿåˆ—æ˜¯ç”¨æ¥å¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹æˆ–å¤„ç†çš„æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—ã€‚ å¯¼è‡´çš„æ­»ä¿¡çš„å‡ ç§åŸå› ï¼š 1.æ¶ˆæ¯è¢«æ‹’ç»(Rejected):å½“æ¶ˆè´¹è€…æ‹’ç»æ¶ˆè´¹æ¶ˆæ¯æˆ–è€…æ¶ˆæ¯è¶…è¿‡æ¶ˆè´¹è€…çš„æœ€å¤§é‡è¯•æ¬¡æ•°æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚2.æ¶ˆæ¯è¿‡æœŸ(Expired):å¦‚æœæ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹è€…å¤„ç†ï¼Œå³è¶…è¿‡äº†æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œè¯¥æ¶ˆæ¯ä¹Ÿä¼šè¢«å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚3.é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(Queue Length Limit):å½“é˜Ÿåˆ—è¾¾åˆ°äº†å®šä¹‰çš„æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œæ–°çš„æ¶ˆæ¯æ— æ³•è¿›å…¥é˜Ÿåˆ—ï¼Œä¼šå°†æ—§çš„æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ 7.å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰ï¼Ÿä¸¢å¤±çš„æƒ…å†µï¼šæ¶ˆæ¯åˆ° MQ çš„è¿‡ç¨‹ä¸­æä¸¢ï¼ŒMQ è‡ªå·±æä¸¢ï¼ŒMQ åˆ°æ¶ˆè´¹è¿‡ç¨‹ä¸­æä¸¢ã€‚ ç”Ÿäº§è€…åˆ° RabbitMQï¼šäº‹åŠ¡æœºåˆ¶å’Œ Confirm æœºåˆ¶ï¼Œæ¨èï¼šå¯ä»¥é€šè¿‡ç”Ÿäº§è€…å¯ç”¨Confirm æœºåˆ¶ï¼Œåœ¨æ¶ˆæ¯æˆåŠŸå‘é€ç»™RabbitMQåæ¥æ”¶ç¡®è®¤å›æ‰§ï¼Œç¡®ä¿æ¶ˆæ¯å·²è¢«æ­£ç¡®æ¥æ”¶ã€‚ æ³¨æ„ï¼šäº‹åŠ¡æœºåˆ¶å’Œ Confirm æœºåˆ¶æ˜¯äº’æ–¥çš„ï¼Œä¸¤è€…ä¸èƒ½å…±å­˜ï¼Œä¼šå¯¼è‡´ RabbitMQ æŠ¥é”™ã€‚ RabbitMQ è‡ªèº«ï¼šæŒä¹…åŒ–ã€é›†ç¾¤ã€æ™®é€šæ¨¡å¼ã€é•œåƒæ¨¡å¼ã€‚ æŒä¹…åŒ–ï¼š Exchange è®¾ç½®ä¸ºæŒä¹…åŒ– ã€‚ Queue è®¾ç½®ä¸ºæŒä¹…åŒ– ã€‚ æ¶ˆæ¯åœ¨å‘é€æ—¶è®¾ç½®ä¸ºæŒä¹…åŒ–æ¨¡å¼ï¼Œå³ deliveryMode=2 RabbitMQ åˆ°æ¶ˆè´¹è€…ï¼šæ‰‹åŠ¨æ¶ˆæ¯ç¡®è®¤ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åï¼Œéœ€è¦æ˜¾å¼åœ°å‘é€ä¸€ä¸ª ACK ç¡®è®¤ä¿¡å·ç»™ RabbitMQï¼ŒRabbitMQ æ‰ä¼šä»å†…å­˜ï¼ˆå’Œç£ç›˜ï¼Œå¦‚æœæ˜¯æŒä¹…åŒ–æ¶ˆæ¯çš„è¯ï¼‰ä¸­ç§»é™¤æ¶ˆæ¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¶ˆæ¯åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¸ä¼šå› ä¸ºæ¶ˆè´¹è€…è¿›ç¨‹æŒ‚æ‰è€Œä¸¢å¤± 8.å¦‚ä½•é¿å…æ¶ˆæ¯å †ç§¯ï¼Ÿ ä¼˜åŒ–æ¶ˆè´¹è€…ä»£ç ï¼Œæé«˜æ¶ˆè´¹èƒ½åŠ›ã€‚å‡å°‘æ¶ˆè´¹æ—¶é—´ æ¶ˆæ¯TTLï¼šå¯ä»¥ä¸ºæ¶ˆæ¯è®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼Œå³æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­åœç•™çš„æœ€å¤§æ—¶é—´ã€‚è¶…è¿‡TTLçš„æ¶ˆæ¯å°†è¢«è‡ªåŠ¨ä¸¢å¼ƒæˆ–æ­»ä¿¡ é˜Ÿåˆ—é•¿åº¦é™åˆ¶ï¼šå¯ä»¥é€šè¿‡ç­–ç•¥æˆ–é˜Ÿåˆ—å‚æ•°è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚å½“é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶ï¼ŒRabbitMQä¼šæ ¹æ®ç­–ç•¥ä¸¢å¼ƒæˆ–æ­»ä¿¡é˜Ÿåˆ—çš„å‰ç«¯æ¶ˆæ¯ å¢åŠ æ¶ˆè´¹è€…æ•°é‡ï¼ˆHorizontal Scalingï¼‰ï¼šå½“æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦æ—¶ï¼Œå¯ä»¥é€šè¿‡å¢åŠ æ›´å¤šçš„æ¶ˆè´¹è€…å®ä¾‹æ¥å¹¶è¡Œå¤„ç†æ¶ˆæ¯ï¼Œä»è€Œæå‡æ€»ä½“å¤„ç†èƒ½åŠ› ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead Letter Queue, DLQï¼‰ï¼šå¯¹äºæ— æ³•ç«‹å³å¤„ç†æˆ–å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯ä»¥é…ç½®æ­»ä¿¡äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå½“æ¶ˆæ¯è¾¾åˆ°ä¸€å®šé‡è¯•æ¬¡æ•°æˆ–è€…è¶…è¿‡ä¸€å®šæœŸé™æœªè¢«æˆåŠŸACKæ—¶ï¼Œæ¶ˆæ¯å°†è¢«è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œåç»­å¯ä»¥å•ç‹¬å¤„ç†è¿™éƒ¨åˆ†æ¶ˆæ¯ï¼Œé¿å…é˜»å¡æ­£å¸¸çš„æ¶ˆæ¯æµ 9.å¦‚ä½•é˜²æ­¢æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼ˆä¿è¯æ¶ˆè´¹å¹‚ç­‰æ€§ï¼‰?RabbitMQæ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜é€šå¸¸æ˜¯ç”±ä»¥ä¸‹åŸå› å¯¼è‡´çš„:1.ç”Ÿäº§è€…ç”¨äºå‘é€æ¶ˆæ¯å¤±è´¥åçš„é‡è¯•ï¼Œå¯¼è‡´åˆå‘é€äº†ä¸€æ¬¡é‡å¤çš„æ¶ˆæ¯2.æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºåœ¨å¤„ç†æ¶ˆæ¯æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œå¯¼è‡´æ¶ˆæ¯ç¡®è®¤(ack)æ²¡æœ‰å‘é€ç»™RabbitMQï¼Œä»è€Œå¯¼è‡´RabbitMQå°†æ¶ˆæ¯é‡æ–°åˆ†å‘ç»™å…¶ä»–æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚3.ç½‘ç»œé—®é¢˜æˆ–æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºé‡å¯æ—¶ï¼ŒRabbitMQæ— æ³•æ”¶åˆ°æ¶ˆæ¯ç¡®è®¤ï¼Œä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯é‡æ–°åˆ†å‘ã€‚ ä¸ºäº†è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜(ä¿è¯æ¶ˆè´¹å¹‚ç­‰æ€§)ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½: ä½¿ç”¨æ¶ˆæ¯å”¯ä¸€IDï¼ˆå¹‚ç­‰æ€§ï¼‰ï¼šç¡®ä¿æ¶ˆæ¯çš„å¤„ç†æ˜¯å¹‚ç­‰çš„ï¼Œå³æ— è®ºåŒä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªæ¶ˆæ¯ç”¨ä¸€ä¸ªå”¯ä¸€æ ‡è¯†æ¥åŒºåˆ†ï¼Œæ¶ˆè´¹å‰å…ˆåˆ¤æ–­æ ‡è¯†æœ‰æ²¡æœ‰è¢«æ¶ˆè´¹è¿‡ï¼Œè‹¥å·²æ¶ˆè´¹è¿‡ï¼Œåˆ™ç›´æ¥ACK æ¶ˆæ¯ç¡®è®¤:æ¶ˆè´¹è€…åº”åŠæ—¶åœ°å‘é€æ¶ˆæ¯ç¡®è®¤(ack)ç»™RabbitMQï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸå¤„ç†äº†æ¶ˆæ¯ã€‚è¿™æ ·RabbitMQå°±ä¸ä¼šå°†æ¶ˆæ¯é‡æ–°åˆ†å‘ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚ åŠ é”ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯ä¹‹å‰ï¼Œç”¨Rediså¯¹å½“å‰æ¶ˆæ¯è®¾ç½®åˆ†å¸ƒå¼é”ï¼Œkeyä¸ºæ¶ˆæ¯idï¼Œå¦‚æœè®¾ç½®å¤±è´¥ï¼Œå°±æ‹’ç»å¤„ç† 10.å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼ŸRabbitMQçš„queueæœ¬èº«å°±æ˜¯é˜Ÿåˆ—ï¼Œæ˜¯å¯ä»¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºæŠ•é€’çš„ã€‚ ä½†æ˜¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹åˆ™æ˜¯å¦ä¸€å›äº‹äº†ï¼Œæ‰€è°“çš„â€œé¡ºåºæ¶ˆè´¹â€æ„å‘³ç€æ˜¯å¦é¡ºåºè¾¾åˆ°ç›®çš„åœ°ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“ã€‚ çœ‹çœ‹ä»¥ä¸‹åœºæ™¯ï¼š ä¸€ä¸ª queueï¼Œå¤šä¸ª consumerã€‚æ¯”å¦‚ï¼Œç”Ÿäº§è€…å‘ RabbitMQ é‡Œå‘é€äº†ä¸‰æ¡æ•°æ®ï¼Œé¡ºåºä¾æ¬¡æ˜¯ data1&#x2F;data2&#x2F;data3ï¼Œå‹å…¥çš„æ˜¯ RabbitMQ çš„ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ã€‚æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…åˆ†åˆ«ä» MQ ä¸­æ¶ˆè´¹è¿™ä¸‰æ¡æ•°æ®ä¸­çš„ä¸€æ¡ï¼Œç»“æœæ¶ˆè´¹è€…2å…ˆæ‰§è¡Œå®Œæ“ä½œï¼ŒæŠŠ data2 å­˜å…¥æ•°æ®åº“ï¼Œç„¶åæ˜¯ data1&#x2F;data3ã€‚è¿™ä¸æ˜æ˜¾ä¹±äº†ã€‚ äº§ç”Ÿå¤šä¸ªconsumerå»æ¶ˆè´¹ä¸€ä¸ªqueueï¼Œææœ‰å¯èƒ½æ˜¯å› ä¸ºï¼šæ¶ˆæ¯æ¶ˆè´¹å¤ªæ…¢ï¼Œæ‰€ä»¥ç›²ç›®è®©å¤šä¸ªconsumeråŒæ—¶æ¥æ¶ˆè´¹ï¼Œè€Œå¿½ç•¥äº†æ¶ˆæ¯æ¶ˆè´¹é¡ºåºæ€§ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ˜¯éœ€è¦ä¿è¯é¡ºåºæ€§çš„ï¼Œå¦‚æœä¸Šå›¾ä¸­çš„data1, data2, data3 åˆ†åˆ«æ„å‘³ç€å¯¹æŸæ¡æ•°æ®çš„å¢æ”¹åˆ ï¼Œä½†æ˜¯å¦‚æœä¹±åºä»¥åå°±å˜æˆäº†ï¼šåˆ æ”¹å¢ã€‚ å°†åŸæ¥çš„ä¸€ä¸ªqueueæ‹†åˆ†æˆå¤šä¸ªqueueï¼Œæ¯ä¸ªqueueéƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„consumerã€‚è¿™ç§æ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯ç”Ÿäº§è€…åœ¨æŠ•é€’æ¶ˆæ¯çš„æ—¶å€™æ ¹æ®ä¸šåŠ¡æ•°æ®å…³é”®å€¼å°†éœ€è¦ä¿è¯é¡ºåºçš„åŒä¸€ç±»æ•°æ®å‘é€åˆ°ä¸€ä¸ªqueueä¸­ã€‚ å¤šä¸ªqueueä¿è¯äº†æ¶ˆæ¯æ¶ˆè´¹çš„æ•ˆç‡ï¼Œæ¯ä¸ªqueueå¯¹åº”å•ä¸ªæ¶ˆè´¹è€…ä¿è¯äº†æ¶ˆæ¯æ¶ˆè´¹çš„æœ‰åºæ€§ã€‚","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://example.com/tags/RabbitMQ/"}]},{"title":"å®ä¹ æ—¥è®°","slug":"å®ä¹ æ—¥è®°","date":"2024-11-06T12:32:56.000Z","updated":"2024-11-06T12:38:46.389Z","comments":true,"path":"2024/11/06/å®ä¹ æ—¥è®°/","permalink":"http://example.com/2024/11/06/%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/","excerpt":"","text":"ä»Šå¤©2024-11-06æ˜¯æˆ‘å®ä¹ çš„ç¬¬å››ä¸ªæ˜ŸæœŸï¼Œç»ˆäºç®—æ˜¯æœ‰ç‚¹äº§å‡ºäº†ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­æ¿€åŠ¨çš„å¿ƒï¼Œé¢¤æŠ–çš„æ‰‹ï¼Œå­å­å“§å“§ç»ˆäºç»™åšå‡ºæ¥äº†ï¼Œè™½ç„¶åªæ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªé¡µé¢å’ŒæŸ¥è¯¢æ¥å£ï¼Œæˆ‘è®°å¾—ç ”å‘äº‘å¥½åƒæ˜¯10.29æ‰ç™»ä¸Šå»çš„ï¼Œå“ï¼Œä¹‹å‰è¿å‰ç«¯ä¸‰ä»¶å¥—éƒ½æ²¡ç³»ç»Ÿå­¦è¿‡çš„æˆ‘ï¼Œæ›´åˆ«ævueäº†ï¼Œç°åœ¨å¿«é€Ÿç”¨vueåšå‡ºæ¥ç•Œé¢ï¼Œä¹Ÿæ…¢æ…¢ç†Ÿæ‚‰äº†ä¸­é—´æ˜¯æ€ä¹ˆäº¤äº’çš„ï¼Œæœ€éš¾çš„ç¯èŠ‚æ„Ÿè§‰å°±æ˜¯å‰åç«¯è”è°ƒäº†ï¼Œä¸»è¦è¿˜æ˜¯å‰ç«¯vueä¸å¤ªç†Ÿæ‚‰ 11.4ï¼šå®Œæˆå‰ç«¯é¡µé¢çš„ä¿®æ”¹ç¾åŒ–ï¼ŒåŸºæœ¬ç¬¦åˆè®¾è®¡åŸå‹ 11.5ï¼šæƒ³ç€æ€ä¹ˆæµ‹è¯•æ¥å£çš„ï¼Œä¸Šåˆä¸€ç›´åœ¨æswaggerï¼Œå‘ç°ç›´æ¥å‰åç«¯è”è°ƒå³å¯ï¼Œä¸‹åˆå°±ä¸€ç›´åœ¨æï¼Œä¹Ÿæ²¡æå¥½ 11.6ï¼šå‰åç«¯è”è°ƒå¤±è´¥ï¼Œæœ‰å¾ˆå¤šå°é”™è¯¯ï¼Œæ¯”å¦‚è‡ªåŠ¨è£…é…çš„æ³¨è§£å¿˜äº†åŠ ï¼Œä¸‹åˆè”é€šäº†ä½†æŸ¥è¯¢ä¸åˆ°æ•°æ®ï¼Œè·Ÿstateè¿™ä¸ªå­—æ®µæœ‰å…³å¥½åƒï¼Œæ¶‰åŠåˆ°å­—ç¬¦ä¸²æŸ¥è¯¢çš„æ—¶å€™ç”¨å•å¼•å·ï¼Œæ€»ä¹‹æ„Ÿè§‰è«åå…¶å¦™çš„é”™è¯¯ä½†åˆè«åå…¶å¦™çš„å¥½äº†ï¼›ç„¶ååˆæ˜¯æ—¶é—´çš„é—®é¢˜ï¼ŒCause: java.lang.IllegalArgumentException: invalid comparison: java.util.Date and java.lang.Stringã€‚å‘ç°mybatisçš„ifå¯¹æ—¶é—´åˆ¤æ–­æ—¶åªè¦åˆ¤æ–­nullå°±è¡Œäº†ï¼Œä¸ç”¨åˆ¤æ–­ç©ºã€‚ç„¶ååˆå‘ç°åç«¯æŸ¥åˆ°çš„æ•°æ®ä¸èƒ½æ˜¾ç¤ºåœ¨å‰ç«¯çš„è¡¨æ ¼ä¸Šï¼Œå‘ç°æ˜¯è¡¨æ ¼çš„åˆ—åè¦å’Œè¿”å›çš„æ•°æ®VOå­—æ®µå¯¹åº”ã€‚ã€‚","categories":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"http://example.com/categories/%E7%94%9F%E6%B4%BB/"}],"tags":[{"name":"å®ä¹ ","slug":"å®ä¹ ","permalink":"http://example.com/tags/%E5%AE%9E%E4%B9%A0/"}]},{"title":"wiresharkæŠ“åŒ…å­¦ä¹ ","slug":"æŠ€æœ¯ç±»/wiresharkæŠ“åŒ…å­¦ä¹ ","date":"2024-10-30T12:40:35.000Z","updated":"2024-10-30T13:13:26.804Z","comments":true,"path":"2024/10/30/æŠ€æœ¯ç±»/wiresharkæŠ“åŒ…å­¦ä¹ /","permalink":"http://example.com/2024/10/30/%E6%8A%80%E6%9C%AF%E7%B1%BB/wireshark%E6%8A%93%E5%8C%85%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"è¿‡æ»¤è§„åˆ™æŒ‰IPè¿‡æ»¤ æƒ³çœ‹æºipä¸ºxxçš„åŒ…ï¼šip.src == xx æƒ³çœ‹ç›®æ ‡ipä¸ºxxçš„åŒ…ï¼šip.dst == xx æƒ³çœ‹æºæˆ–è€…ç›®æ ‡ipä¸ºxxçš„åŒ…ï¼šip.addr == xx æŒ‰MACåœ°å€è¿‡æ»¤ æƒ³çœ‹æºmacä¸ºxxçš„åŒ…ï¼šeth.src == xx æƒ³çœ‹ç›®æ ‡macä¸ºxxçš„åŒ…ï¼šeth.dst == xx æƒ³çœ‹æºæˆ–è€…ç›®æ ‡macä¸ºxxçš„åŒ…ï¼šeth.addr == xx æŒ‰ç«¯å£è¿‡æ»¤ æƒ³çœ‹æºç«¯å£ä¸º4694çš„åŒ…ï¼štcp.srcport == 4694 æƒ³çœ‹ç›®æ ‡ç«¯å£ä¸º4694çš„åŒ…ï¼šeth.dstport == 4694 è¿‡æ»¤tcpç«¯å£ä¸º4694çš„åŒ…ï¼štcp.port == 4694 æŒ‰åè®®ç±»å‹è¿‡æ»¤ arp dhcp https è§„åˆ™ç»„ä¼š and æƒ³çœ‹dhcpåŒ…ä¸”åªæƒ³çœ‹æŸå°ç”µè„‘çš„dhcpåŒ… or ï¼é","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"OS","slug":"å…«è‚¡/OS","date":"2024-10-28T12:30:49.000Z","updated":"2025-03-14T08:08:22.227Z","comments":true,"path":"2024/10/28/å…«è‚¡/OS/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/OS/","excerpt":"æœ¬æ–‡ä¸»è¦æ˜¯æ‰¾å·¥ä½œæ—¶é’ˆå¯¹æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šç¢°åˆ°çš„ä¸€äº›é—®é¢˜","text":"æœ¬æ–‡ä¸»è¦æ˜¯æ‰¾å·¥ä½œæ—¶é’ˆå¯¹æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šç¢°åˆ°çš„ä¸€äº›é—®é¢˜ 0.æ“ä½œç³»ç»ŸåŸºç¡€1.ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿæ“ä½œç³»ç»Ÿï¼ˆOperating System, OSï¼‰æ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­ç®¡ç†ç¡¬ä»¶å’Œè½¯ä»¶èµ„æºçš„ä¸­é—´å±‚ç³»ç»Ÿï¼Œå±è”½äº†ç¡¬ä»¶çš„å¤æ‚æ€§ï¼Œå¹¶ä¸”ä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·çš„äº¤äº’æ–¹å¼ï¼Œæ¯”å¦‚è¯´ Windowsã€Linuxã€MacOS ç­‰ã€‚ 2.æ“ä½œç³»ç»Ÿæœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ è¿›ç¨‹å’Œçº¿ç¨‹çš„ç®¡ç†ï¼šè¿›ç¨‹çš„åˆ›å»ºã€æ’¤é”€ã€é˜»å¡ã€å”¤é†’ï¼Œè¿›ç¨‹é—´çš„é€šä¿¡ç­‰ã€‚ å­˜å‚¨ç®¡ç†ï¼šå†…å­˜çš„åˆ†é…å’Œç®¡ç†ã€å¤–å­˜ï¼ˆç£ç›˜ç­‰ï¼‰çš„åˆ†é…å’Œç®¡ç†ç­‰ã€‚ æ–‡ä»¶ç®¡ç†ï¼šæ–‡ä»¶çš„è¯»ã€å†™ã€åˆ›å»ºåŠåˆ é™¤ç­‰ã€‚ è®¾å¤‡ç®¡ç†ï¼šå®Œæˆè®¾å¤‡ï¼ˆè¾“å…¥è¾“å‡ºè®¾å¤‡å’Œå¤–éƒ¨å­˜å‚¨è®¾å¤‡ç­‰ï¼‰çš„è¯·æ±‚æˆ–é‡Šæ”¾ï¼Œä»¥åŠè®¾å¤‡å¯åŠ¨ç­‰åŠŸèƒ½ã€‚ ç½‘ç»œç®¡ç†ï¼šæ“ä½œç³»ç»Ÿè´Ÿè´£ç®¡ç†è®¡ç®—æœºç½‘ç»œçš„ä½¿ç”¨ã€‚ç½‘ç»œæ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­è¿æ¥ä¸åŒè®¡ç®—æœºçš„æ–¹å¼ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†è®¡ç®—æœºç½‘ç»œçš„é…ç½®ã€è¿æ¥ã€é€šä¿¡å’Œå®‰å…¨ç­‰ï¼Œä»¥æä¾›é«˜æ•ˆå¯é çš„ç½‘ç»œæœåŠ¡ã€‚ 3.ç”¨æˆ·æ€å’Œå†…æ ¸æ€ ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Ÿ ç”¨æˆ·æ€(User Mode) : ç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹å¯ä»¥ç›´æ¥è¯»å–ç”¨æˆ·ç¨‹åºçš„æ•°æ®ï¼Œæ‹¥æœ‰è¾ƒä½çš„æƒé™ã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡ŒæŸäº›éœ€è¦ç‰¹æ®Šæƒé™çš„æ“ä½œï¼Œä¾‹å¦‚è¯»å†™ç£ç›˜ã€ç½‘ç»œé€šä¿¡ç­‰ï¼Œå°±éœ€è¦å‘æ“ä½œç³»ç»Ÿå‘èµ·ç³»ç»Ÿè°ƒç”¨è¯·æ±‚ï¼Œè¿›å…¥å†…æ ¸æ€ã€‚ **å†…æ ¸æ€(Kernel Mode)**ï¼šå†…æ ¸æ€è¿è¡Œçš„è¿›ç¨‹å‡ ä¹å¯ä»¥è®¿é—®è®¡ç®—æœºçš„ä»»ä½•èµ„æºåŒ…æ‹¬ç³»ç»Ÿçš„å†…å­˜ç©ºé—´ã€è®¾å¤‡ã€é©±åŠ¨ç¨‹åºç­‰ï¼Œä¸å—é™åˆ¶ï¼Œæ‹¥æœ‰éå¸¸é«˜çš„æƒé™ã€‚ ç®€å•è¯´ï¼šäºŒè€…çš„æƒé™çº§åˆ«ä¸åŒï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†å®‰å…¨æ€§ã€ç¨³å®šæ€§ã€æ€§èƒ½è€ƒè™‘ã€‚ ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ˜¯å¦‚ä½•åˆ‡æ¢çš„ï¼Ÿ ç³»ç»Ÿè°ƒç”¨ï¼ˆTrapï¼‰ï¼šç”¨æˆ·æ€è¿›ç¨‹ ä¸»åŠ¨ è¦æ±‚åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸€ç§æ–¹å¼ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä½¿ç”¨å†…æ ¸æ€æ‰èƒ½åšçš„äº‹æƒ…æ¯”å¦‚è¯»å–ç£ç›˜èµ„æºã€‚ç³»ç»Ÿè°ƒç”¨çš„æœºåˆ¶å…¶æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®ç°ã€‚ ä¸­æ–­ï¼ˆInterruptï¼‰ï¼šå½“å¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œåï¼Œä¼šå‘ CPU å‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶ CPU ä¼šæš‚åœæ‰§è¡Œä¸‹ä¸€æ¡å³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤è½¬è€Œå»æ‰§è¡Œä¸ä¸­æ–­ä¿¡å·å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œå¦‚æœå…ˆå‰æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹è‡ªç„¶ä¹Ÿå°±å‘ç”Ÿäº†ç”±ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ã€‚æ¯”å¦‚ç¡¬ç›˜è¯»å†™æ“ä½œå®Œæˆï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°ç¡¬ç›˜è¯»å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡Œåç»­æ“ä½œç­‰ã€‚ å¼‚å¸¸ï¼ˆExceptionï¼‰ï¼šå½“ CPU åœ¨æ‰§è¡Œè¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºæ—¶ï¼Œå‘ç”Ÿäº†æŸäº›äº‹å…ˆä¸å¯çŸ¥çš„å¼‚å¸¸ï¼Œè¿™æ—¶ä¼šè§¦å‘ç”±å½“å‰è¿è¡Œè¿›ç¨‹åˆ‡æ¢åˆ°å¤„ç†æ­¤å¼‚å¸¸çš„å†…æ ¸ç›¸å…³ç¨‹åºä¸­ï¼Œä¹Ÿå°±è½¬åˆ°äº†å†…æ ¸æ€ï¼Œæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸ã€‚ åœ¨ç³»ç»Ÿçš„å¤„ç†ä¸Šï¼Œä¸­æ–­å’Œå¼‚å¸¸ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ä¸­æ–­å‘é‡è¡¨æ¥æ‰¾åˆ°ç›¸åº”çš„å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ã€‚åŒºåˆ«åœ¨äºï¼Œä¸­æ–­æ¥è‡ªå¤„ç†å™¨å¤–éƒ¨ï¼Œä¸æ˜¯ç”±ä»»ä½•ä¸€æ¡ä¸“é—¨çš„æŒ‡ä»¤é€ æˆï¼Œè€Œå¼‚å¸¸æ˜¯æ‰§è¡Œå½“å‰æŒ‡ä»¤çš„ç»“æœã€‚ 4.ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ˜¯åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´è¿›è¡Œäº¤äº’çš„ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®æ“ä½œç³»ç»Ÿåº•å±‚èµ„æºä¾‹å¦‚æ–‡ä»¶ã€è®¾å¤‡ã€ç½‘ç»œç­‰ã€‚ ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ ç”¨æˆ·æ€çš„ç¨‹åºå‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨ä¸­æ¶‰åŠä¸€äº›ç‰¹æƒæŒ‡ä»¤ï¼ˆåªèƒ½ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ€æ‰§è¡Œçš„æŒ‡ä»¤ï¼‰ï¼Œç”¨æˆ·æ€ç¨‹åºæƒé™ä¸è¶³ï¼Œå› æ­¤ä¼šä¸­æ–­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ Trapï¼ˆTrap æ˜¯ä¸€ç§ä¸­æ–­ï¼‰ã€‚ å‘ç”Ÿä¸­æ–­åï¼Œå½“å‰ CPU æ‰§è¡Œçš„ç¨‹åºä¼šä¸­æ–­ï¼Œè·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åºã€‚å†…æ ¸ç¨‹åºå¼€å§‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å¼€å§‹å¤„ç†ç³»ç»Ÿè°ƒç”¨ã€‚ å†…æ ¸å¤„ç†å®Œæˆåï¼Œä¸»åŠ¨è§¦å‘ Trapï¼Œè¿™æ ·ä¼šå†æ¬¡å‘ç”Ÿä¸­æ–­ï¼Œåˆ‡æ¢å›ç”¨æˆ·æ€å·¥ä½œã€‚ 1.è¿›ç¨‹ç®¡ç†è¿™é‡Œé™„ä¸€ä¸ªå°æ’æ›²ï¼š ç«æ€æ¡ä»¶ï¼šæ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œæ“ä½œåŒä¸€å—æ•°æ®æ—¶ï¼Œæœ€ç»ˆç»“æœä¾èµ–äºçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œ è¿™å¯èƒ½å¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ 1.å¹¶å‘å’Œå¹¶è¡Œ å¹¶å‘ï¼ˆConcurrencyï¼‰ å¹¶å‘å°±æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå¤šä¸ªä»»åŠ¡éƒ½ä¼šè¢«å¤„ç†ï¼›ä½†åœ¨æŸä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œã€‚å•æ ¸å¤„ç†å™¨åšåˆ°çš„å¹¶å‘ï¼Œå…¶å®æ˜¯åˆ©ç”¨æ—¶é—´ç‰‡çš„è½®è½¬ å¹¶è¡Œï¼ˆParallelismï¼‰ å¹¶è¡Œå°±æ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šä¸ªä»»åŠ¡åœ¨æ‰§è¡Œã€‚è¿™ä¸ªéœ€è¦å¤šæ ¸å¤„ç†å™¨æ‰èƒ½å®Œæˆ ï¼Œå› ä¸ºæ¯ä¸ªä»»åŠ¡åœ¨ä¸åŒçš„æ ¸å¿ƒæˆ–å¤„ç†å™¨ä¸Šç‹¬ç«‹æ‰§è¡Œã€‚ å¹¶å‘æ›´å¤šçš„æ˜¯å¤„ç†â€œä»»åŠ¡ç®¡ç†â€ï¼Œæ¯”å¦‚å¤šä»»åŠ¡çš„åˆ‡æ¢ä¸è°ƒåº¦ã€‚å¹¶è¡Œæ›´å¤šçš„æ˜¯éœ€è¦ç¡¬ä»¶çš„æ”¯æŒ 2.è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æ“ä½œç³»ç»Ÿåœ¨å¤šä»»åŠ¡å¤„ç†ç¯å¢ƒä¸­ï¼Œå°† CPU ä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„è¿‡ç¨‹ã€‚é€šè¿‡è®©å¤šä¸ªè¿›ç¨‹å…±äº« CPU èµ„æºï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿå¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ è¿›ç¨‹æ˜¯ç”±å†…æ ¸ç®¡ç†å’Œè°ƒåº¦çš„ï¼Œæ‰€ä»¥è¿›ç¨‹çš„åˆ‡æ¢åªèƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ã€‚ æ‰€ä»¥ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä»…åŒ…å«äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œ è¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚ é€šå¸¸ï¼Œä¼šæŠŠäº¤æ¢çš„ä¿¡æ¯ä¿å­˜åœ¨è¿›ç¨‹çš„ PCBï¼Œå½“è¦è¿è¡Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œ æˆ‘ä»¬éœ€è¦ä»è¿™ä¸ªè¿›ç¨‹çš„ PCB å–å‡ºä¸Šä¸‹æ–‡ï¼Œç„¶åæ¢å¤åˆ° CPU ä¸­ 3.è¿›ç¨‹çš„çŠ¶æ€ **åˆ›å»ºçŠ¶æ€(new)**ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªåˆ°å°±ç»ªçŠ¶æ€ã€‚ **å°±ç»ªçŠ¶æ€(ready)**ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡ŒçŠ¶æ€ï¼Œå³è¿›ç¨‹è·å¾—äº†é™¤äº†å¤„ç†å™¨ä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æºï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†å™¨èµ„æº(å¤„ç†å™¨åˆ†é…çš„æ—¶é—´ç‰‡)å³å¯è¿è¡Œã€‚ **è¿è¡ŒçŠ¶æ€(running)**ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œ(å•æ ¸ CPU ä¸‹ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€)ã€‚ **é˜»å¡çŠ¶æ€(waiting)**ï¼šåˆç§°ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨æˆ–ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å³ä½¿å¤„ç†å™¨ç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œã€‚ **ç»“æŸçŠ¶æ€(terminated)**ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œ 4.ä»€ä¹ˆæ˜¯PCBï¼ŸPCBï¼ˆProcess Control Blockï¼‰ å³è¿›ç¨‹æ§åˆ¶å—ï¼Œæ˜¯æ“ä½œç³»ç»Ÿä¸­ç”¨æ¥ç®¡ç†å’Œè·Ÿè¸ªè¿›ç¨‹çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å¯¹åº”ç€ä¸€ä¸ªç‹¬ç«‹çš„ PCBã€‚ PCB æ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡è¯† ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š è¿›ç¨‹æè¿°ä¿¡æ¯ï¼š è¿›ç¨‹æ ‡è¯†ç¬¦ï¼šæ ‡è¯†å„ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå¹¶ä¸”å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼› è¿›ç¨‹æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯ï¼š è¿›ç¨‹å½“å‰çŠ¶æ€ï¼Œå¦‚ newã€readyã€runningã€waiting æˆ– blocked ç­‰ï¼› è¿›ç¨‹ä¼˜å…ˆçº§ï¼šè¿›ç¨‹æŠ¢å  CPU æ—¶çš„ä¼˜å…ˆçº§ï¼› èµ„æºåˆ†é…æ¸…å•ï¼š æœ‰å…³å†…å­˜åœ°å€ç©ºé—´æˆ–è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¿¡æ¯ï¼Œæ‰€æ‰“å¼€æ–‡ä»¶çš„åˆ—è¡¨å’Œæ‰€ä½¿ç”¨çš„ I&#x2F;O è®¾å¤‡ä¿¡æ¯ã€‚ CPU ç›¸å…³ä¿¡æ¯ï¼š CPU ä¸­å„ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå½“è¿›ç¨‹è¢«åˆ‡æ¢æ—¶ï¼ŒCPU çš„çŠ¶æ€ä¿¡æ¯éƒ½ä¼šè¢«ä¿å­˜åœ¨ç›¸åº”çš„ PCB ä¸­ï¼Œ ä»¥ä¾¿è¿›ç¨‹é‡æ–°æ‰§è¡Œæ—¶ï¼Œèƒ½ä»æ–­ç‚¹å¤„ç»§ç»­æ‰§è¡Œã€‚ 5.åƒµå°¸è¿›ç¨‹&#x2F;å­¤å„¿è¿›ç¨‹ åƒµå°¸è¿›ç¨‹ å­è¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œä½†æ˜¯å…¶çˆ¶è¿›ç¨‹ä»åœ¨è¿è¡Œï¼Œä¸”çˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨ wait()æˆ– waitpid()ç­‰ç³»ç»Ÿè°ƒç”¨æ¥è·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‡Šæ”¾å­è¿›ç¨‹å ç”¨çš„èµ„æºï¼Œå¯¼è‡´å­è¿›ç¨‹çš„ PCB ä¾ç„¶å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œ ä½†æ— æ³•è¢«è¿›ä¸€æ­¥ä½¿ç”¨ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹è¢«ç§°ä¸ºâ€œåƒµå°¸è¿›ç¨‹â€ã€‚é¿å…åƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿï¼Œçˆ¶è¿›ç¨‹éœ€è¦åŠæ—¶è°ƒç”¨ wait()æˆ– waitpid()ç³»ç»Ÿè°ƒç”¨æ¥å›æ”¶å­è¿›ç¨‹ã€‚ å­¤å„¿è¿›ç¨‹ ä¸€ä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·²ç»ç»ˆæ­¢æˆ–è€…ä¸å­˜åœ¨ï¼Œä½†æ˜¯è¯¥è¿›ç¨‹ä»åœ¨è¿è¡Œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥è¿›ç¨‹å°±æ˜¯å­¤å„¿è¿›ç¨‹ã€‚ å­¤å„¿è¿›ç¨‹é€šå¸¸æ˜¯ç”±äºçˆ¶è¿›ç¨‹æ„å¤–ç»ˆæ­¢æˆ–æœªåŠæ—¶è°ƒç”¨ wait()æˆ– waitpid()ç­‰ç³»ç»Ÿè°ƒç”¨æ¥å›æ”¶å­è¿›ç¨‹å¯¼è‡´çš„ã€‚ ä¸ºäº†é¿å…å­¤å„¿è¿›ç¨‹å ç”¨ç³»ç»Ÿèµ„æºï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å­¤å„¿è¿›ç¨‹çš„çˆ¶è¿›ç¨‹è®¾ç½®ä¸º init è¿›ç¨‹ï¼ˆè¿›ç¨‹å·ä¸º 1ï¼‰ï¼Œç”± init è¿›ç¨‹æ¥å›æ”¶å­¤å„¿è¿›ç¨‹çš„èµ„æºã€‚ 6.è¿›ç¨‹è°ƒåº¦ç®—æ³• 1.å…ˆæ¥å…ˆæœåŠ¡ ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æº ç„¶åä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¿›ç¨‹é€€å‡ºæˆ–è¢«é˜»å¡ï¼Œæ‰ä¼šç»§ç»­ä»é˜Ÿåˆ—ä¸­é€‰æ‹©ç¬¬ä¸€ä¸ªè¿›ç¨‹æ¥ç€è¿è¡Œã€‚ å½“ä¸€ä¸ªé•¿ä½œä¸šå…ˆè¿è¡Œäº†ï¼Œé‚£ä¹ˆåé¢çš„çŸ­ä½œä¸šç­‰å¾…çš„æ—¶é—´å°±ä¼šå¾ˆé•¿ï¼Œä¸åˆ©äºçŸ­ä½œä¸šã€‚ å¯èƒ½ä¼šå¯¼è‡´è¾ƒçŸ­çš„è¿›ç¨‹ç­‰å¾…è¾ƒé•¿è¿›ç¨‹æ‰§è¡Œå®Œæˆï¼Œä»è€Œäº§ç”Ÿâ€œé¥¥é¥¿â€ç°è±¡ 2.çŸ­ä½œä¸šä¼˜å…ˆ ä¼˜å…ˆé€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹æ¥è¿è¡Œï¼Œè¿™æœ‰åŠ©äºæé«˜ç³»ç»Ÿçš„ååé‡ã€‚ å¯¹é•¿ä½œä¸šä¸åˆ©ï¼Œå¾ˆå®¹æ˜“é€ æˆä¸€ç§æç«¯ç°è±¡ã€‚ 3.æ—¶é—´ç‰‡è½®è½¬ æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼ˆQuantumï¼‰ï¼Œå³å…è®¸è¯¥è¿›ç¨‹åœ¨è¯¥æ—¶é—´æ®µä¸­è¿è¡Œã€‚ å¦‚æœè¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿˜æ²¡æœ‰å®Œæˆï¼Œå®ƒå°†è¢«æ”¾å›é˜Ÿåˆ—çš„æœ«å°¾ã€‚ å…¬å¹³çš„ 4.ä¼˜å…ˆçº§è°ƒåº¦ è¿™ç§è°ƒåº¦æ–¹å¼ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è¢«åˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ã€‚CPU é¦–å…ˆåˆ†é…ç»™ä¼˜å…ˆçº§æœ€é«˜çš„è¿›ç¨‹ã€‚ è¯¥ç®—æ³•ä¹Ÿæœ‰ä¸¤ç§å¤„ç†ä¼˜å…ˆçº§é«˜çš„æ–¹æ³•ï¼ŒéæŠ¢å å¼å’ŒæŠ¢å å¼ï¼š éæŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œè¿è¡Œå®Œå½“å‰è¿›ç¨‹ï¼Œå†é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ã€‚ æŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹æŒ‚èµ·ï¼Œè°ƒåº¦ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹è¿è¡Œã€‚ å¯èƒ½ä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ°¸è¿œä¸ä¼šè¿è¡Œã€‚ 5.å¤šçº§åé¦ˆé˜Ÿåˆ— æ—¢èƒ½ä½¿é«˜ä¼˜å…ˆçº§çš„ä½œä¸šå¾—åˆ°å“åº”åˆèƒ½ä½¿çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰è¿…é€Ÿå®Œæˆ ã€Œå¤šçº§ã€è¡¨ç¤ºæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­ã€‚ ã€Œåé¦ˆã€è¡¨ç¤ºå¦‚æœæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—æ—¶ï¼Œç«‹åˆ»åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œ è½¬è€Œå»è¿è¡Œä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ï¼› å·¥ä½œæµç¨‹ï¼š è®¾ç½®äº†å¤šä¸ªé˜Ÿåˆ—ï¼Œèµ‹äºˆæ¯ä¸ªé˜Ÿåˆ—ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­ï¼ˆæ„æ€æ˜¯å…è®¸å®ƒæ‰§è¡Œçš„æ—¶é—´è¶ŠçŸ­ï¼‰ï¼› æ–°çš„è¿›ç¨‹ä¼šè¢«æ”¾å…¥åˆ°ç¬¬ä¸€çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™æ’é˜Ÿç­‰å¾…è¢«è°ƒåº¦ï¼Œå¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—è§„å®šçš„æ—¶é—´ç‰‡æ²¡è¿è¡Œå®Œæˆï¼Œåˆ™å°†å…¶è½¬å…¥åˆ°ç¬¬äºŒçº§é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´è‡³å®Œæˆï¼› å½“è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰è°ƒåº¦è¾ƒä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œã€‚å¦‚æœè¿›ç¨‹è¿è¡Œæ—¶ï¼Œæœ‰æ–°è¿›ç¨‹è¿›å…¥è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œåˆ™åœæ­¢å½“å‰è¿è¡Œçš„è¿›ç¨‹å¹¶å°†å…¶ç§»å…¥åˆ°åŸé˜Ÿåˆ—æœ«å°¾ï¼Œæ¥ç€è®©è¾ƒé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹è¿è¡Œï¼› å¯ä»¥å‘ç°ï¼Œå¯¹äºçŸ­ä½œä¸šå¯èƒ½å¯ä»¥åœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—å¾ˆå¿«è¢«å¤„ç†å®Œã€‚å¯¹äºé•¿ä½œä¸šï¼Œå¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—å¤„ç†ä¸å®Œï¼Œ å¯ä»¥ç§»å…¥ä¸‹æ¬¡é˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œï¼Œè™½ç„¶ç­‰å¾…çš„æ—¶é—´å˜é•¿äº†ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´ä¹Ÿä¼šæ›´é•¿äº†ï¼Œ æ‰€ä»¥è¯¥ç®—æ³•å¾ˆå¥½çš„å…¼é¡¾äº†é•¿çŸ­ä½œä¸šï¼ŒåŒæ—¶æœ‰è¾ƒå¥½çš„å“åº”æ—¶é—´ã€‚ 7.è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ ç®¡é“ï¼ˆåŒ¿åç®¡é“ï¼‰ï¼šç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„çˆ¶å­è¿›ç¨‹é—´æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ å‘½åç®¡é“ï¼šå…è®¸æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦åœ¨æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º p çš„è®¾å¤‡æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¯«æ— å…³ç³»çš„è¿›ç¨‹å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè®¾å¤‡æ–‡ä»¶è¿›è¡Œé€šä¿¡ã€‚ ç¼ºç‚¹ï¼šç®¡é“çš„æ•ˆç‡ä½ï¼Œè€Œä¸”åªèƒ½å•å‘é€šä¿¡ï¼Œä¸é€‚åˆè¿›ç¨‹é—´é¢‘ç¹åœ°äº¤æ¢æ•°æ®ã€‚ ä¿¡å·ï¼šç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿï¼› æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¿å­˜åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼ŒæŒ‰ç…§æ¶ˆæ¯çš„ç±»å‹è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œå…·æœ‰è¾ƒé«˜çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚ ç¼ºç‚¹ï¼šæ¶ˆæ¯ä½“æœ‰ä¸€ä¸ªæœ€å¤§é•¿åº¦çš„é™åˆ¶ï¼Œä¸é€‚åˆæ¯”è¾ƒå¤§çš„æ•°æ®ä¼ è¾“ï¼›å­˜åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„æ•°æ®æ‹·è´å¼€é”€ã€‚ å…±äº«å†…å­˜ï¼šå…è®¸ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªç»™å®šçš„å†…å­˜åŒºï¼Œä¸€ä¸ªè¿›ç¨‹å†™â¼Šçš„ä¸œè¥¿ï¼Œå…¶ä»–è¿›ç¨‹â»¢ä¸Šå°±èƒ½çœ‹åˆ°ã€‚ å…±äº«å†…å­˜æ˜¯æœ€å¿«çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œå®ƒæ˜¯é’ˆå¯¹å…¶ä»–è¿›ç¨‹é—´é€šä¿¡æ–¹å¼è¿è¡Œæ•ˆç‡ä½è€Œä¸“é—¨è®¾è®¡çš„ã€‚ç¼ºç‚¹ï¼šå½“å¤šè¿›ç¨‹ç«äº‰åŒä¸€ä¸ªå…±äº«èµ„æºæ—¶ï¼Œä¼šé€ æˆæ•°æ®é”™ä¹±çš„é—®é¢˜ã€‚ ä¿¡å·é‡ï¼šå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¡¨ç¤ºçš„æ˜¯èµ„æºä¸ªæ•°ï¼Œå…¶å€¼å¯ä»¥é€šè¿‡ä¸¤ä¸ªåŸå­æ“ä½œæ¥æ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯ P æ“ä½œå’Œ V æ“ä½œã€‚ ç”¨æ¥æ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®æ•°é‡ã€‚å®ƒå¸¸ä½œä¸ºä¸€ç§é”æœºåˆ¶ï¼Œé˜²æ­¢æŸè¿›ç¨‹æ­£åœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿè®¿é—®è¯¥èµ„æºã€‚ ä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºå¤šè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œä¿¡å·é‡çš„æ„å›¾åœ¨äºè¿›ç¨‹é—´åŒæ­¥ã€‚è¿™ç§é€šä¿¡æ–¹å¼ä¸»è¦ç”¨äºè§£å†³ä¸åŒæ­¥ç›¸å…³çš„é—®é¢˜å¹¶é¿å…ç«äº‰æ¡ä»¶ã€‚ å¥—æ¥å­—socketï¼šä¸ä»…ç”¨äºä¸åŒçš„ä¸»æœºè¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜å¯ä»¥ç”¨äºæœ¬åœ°ä¸»æœºè¿›ç¨‹é—´é€šä¿¡ï¼Œ å¯æ ¹æ®åˆ›å»º Socket çš„ç±»å‹ä¸åŒï¼Œåˆ†ä¸ºä¸‰ç§å¸¸è§çš„é€šä¿¡æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯åŸºäº TCP åè®®çš„é€šä¿¡æ–¹å¼ï¼Œ ä¸€ä¸ªæ˜¯åŸºäº UDP åè®®çš„é€šä¿¡æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚ 8.è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡Œå®ä¾‹ï¼Œæ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ã€æ•°æ®æ®µã€å †æ ˆã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼Œè¿›ç¨‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œé€šå¸¸ä¸èƒ½ç›´æ¥å…±äº«å†…å­˜ã€‚ ç‰¹ç‚¹ï¼š è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰å„è‡ªçš„èµ„æºå’Œå†…å­˜ç©ºé—´ã€‚ è¿›ç¨‹åˆ›å»ºã€é”€æ¯çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å¼€é”€è¾ƒå¤§ã€‚ çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œå®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œ å®ƒä»¬å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´å’Œèµ„æº(å¦‚å †ï¼Œå…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ï¼Œæ–‡ä»¶ç­‰å…¬å…±èµ„æº)ï¼Œä½†æ‹¥æœ‰ç‹¬ç«‹çš„æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ ç‰¹ç‚¹ï¼š çº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´å’Œèµ„æºï¼Œå› æ­¤åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€è¾ƒå°ã€‚ çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€æ¯”è¿›ç¨‹å° ç”±äºå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ï¼Œå› æ­¤å­˜åœ¨æ•°æ®ç«äº‰å’Œçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œéœ€è¦é€šè¿‡åŒæ­¥å’Œäº’æ–¥æœºåˆ¶æ¥è§£å†³ã€‚ åç¨‹ï¼šåç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ï¼Œç”±ç¨‹åºå‘˜åœ¨ä»£ç ä¸­æ˜¾å¼æ§åˆ¶è°ƒåº¦ï¼Œè€Œéæ“ä½œç³»ç»Ÿã€‚ ç‰¹ç‚¹ï¼š åç¨‹åˆ‡æ¢çš„å¼€é”€æå°ï¼Œæ¯”çº¿ç¨‹æ›´è½»é‡ï¼Œå› ä¸ºä¸éœ€è¦æ“ä½œç³»ç»Ÿçš„å¹²é¢„ã€‚ åç¨‹é€šå¸¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå› æ­¤å®ƒä»¬å…±äº«çº¿ç¨‹çš„æ‰€æœ‰èµ„æºã€‚ åç¨‹æ˜¯éæŠ¢å å¼çš„è°ƒåº¦ï¼ˆå³åç¨‹å¿…é¡»æ˜¾å¼è®©å‡ºæ§åˆ¶æƒï¼‰ï¼Œé¿å…äº†çº¿ç¨‹çš„åˆ‡æ¢å’ŒåŒæ­¥çš„å¤æ‚æ€§ã€‚ é€‚ç”¨åœºæ™¯ é«˜éš”ç¦»æ€§ä»»åŠ¡â€”â€”è¿›ç¨‹ é«˜å¹¶å‘å…±äº«æ•°æ®ä»»åŠ¡â€”â€”çº¿ç¨‹ é«˜å¹¶å‘ I&#x2F;O å¯†é›†å‹ä»»åŠ¡â€”â€”åç¨‹ 9.çº¿ç¨‹é—´çš„é€šä¿¡æ–¹å¼(TODO)ä¹Ÿå³çº¿ç¨‹é—´çš„åŒæ­¥æ–¹å¼ï¼Œå› ä¸ºçº¿ç¨‹å…±äº«åŒä¸€è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œé€šä¿¡ç›¸å¯¹å®¹æ˜“ï¼Œä½†ä¹Ÿéœ€è¦åŒæ­¥æœºåˆ¶æ¥é¿å…ç«äº‰æ¡ä»¶ã€‚ äº’æ–¥é”ï¼šåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚æ¯”å¦‚ Java ä¸­çš„ synchronized å…³é”®è¯å’Œå„ç§ Lock éƒ½æ˜¯è¿™ç§æœºåˆ¶ã€‚ è¯»å†™é”ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹å…±äº«èµ„æºè¿›è¡Œå†™æ“ä½œã€‚ è¯»å†™é”çš„å·¥ä½œåŸç†æ˜¯ï¼šå½“ã€Œå†™é”ã€æ²¡æœ‰è¢«çº¿ç¨‹æŒæœ‰æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹ èƒ½å¤Ÿå¹¶å‘åœ°æŒæœ‰è¯»é”ï¼Œè¿™å¤§å¤§æé«˜äº†å…±äº«èµ„æºçš„è®¿é—®æ•ˆç‡ï¼Œå› ä¸ºã€Œè¯»é”ã€æ˜¯ç”¨äºè¯»å–å…±äº«èµ„æºçš„åœºæ™¯ï¼Œ æ‰€ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰è¯»é”ä¹Ÿä¸ä¼šç ´åå…±äº«èµ„æºçš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦ã€Œå†™é”ã€è¢«çº¿ç¨‹æŒæœ‰åï¼Œè¯»çº¿ç¨‹çš„ è·å–è¯»é”çš„æ“ä½œä¼šè¢«é˜»å¡ï¼Œè€Œä¸”å…¶ä»–å†™çº¿ç¨‹çš„è·å–å†™é”çš„æ“ä½œä¹Ÿä¼šè¢«é˜»å¡ã€‚æ‰€ä»¥è¯´ï¼Œå†™é”æ˜¯ç‹¬å é”ï¼Œå›  ä¸ºä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”ï¼Œç±»ä¼¼äº’æ–¥é”å’Œè‡ªæ—‹é”ï¼Œè€Œè¯»é”æ˜¯å…±äº«é”ï¼Œå› ä¸ºè¯»é”å¯ä»¥è¢«å¤šä¸ªçº¿ ç¨‹åŒæ—¶æŒæœ‰ã€‚çŸ¥é“äº†è¯»å†™é”çš„å·¥ä½œåŸç†åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯»å†™é”åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œèƒ½å‘æŒ¥å‡ºä¼˜åŠ¿ã€‚ ä¿¡å·é‡ï¼šå®ƒå…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚ é€šå¸¸ä¿¡å·é‡è¡¨ç¤ºèµ„æºçš„æ•°é‡ å¯¹åº”çš„å˜é‡æ˜¯ä¸€ä¸ªæ•´å‹ï¼ˆsemï¼‰å˜é‡ã€‚ è¿˜æœ‰ä¸¤ä¸ªåŸå­æ“ä½œçš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥æ§åˆ¶ä¿¡å·é‡çš„ã€‚åˆ†åˆ«æ˜¯ï¼šP æ“ä½œï¼šå°† sem å‡ 1ï¼Œç›¸å‡ åï¼Œå¦‚æœ sem &lt; 0ï¼Œåˆ™è¿›ç¨‹&#x2F;çº¿ç¨‹è¿›å…¥é˜»å¡ç­‰å¾…ï¼Œå¦åˆ™ç»§ç»­ï¼Œè¡¨æ˜ P æ“ä½œå¯èƒ½ä¼šé˜»å¡ï¼› V æ“ä½œï¼šå°† sem åŠ  1ï¼Œç›¸åŠ åï¼Œå¦‚æœ sem &lt;&#x3D; 0ï¼Œå”¤é†’ä¸€ä¸ªç­‰å¾…ä¸­çš„è¿›ç¨‹&#x2F;çº¿ç¨‹ï¼Œè¡¨æ˜ V æ“ä½œä¸ä¼šé˜»å¡ï¼› 10.çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¾—çœ‹çº¿ç¨‹æ˜¯ä¸æ˜¯å±äºåŒâ¼€ä¸ªè¿›ç¨‹ï¼š å½“ä¸¤ä¸ªçº¿ç¨‹ä¸æ˜¯å±äºåŒâ¼€ä¸ªè¿›ç¨‹ï¼Œåˆ™åˆ‡æ¢çš„è¿‡ç¨‹å°±è·Ÿè¿›ç¨‹ä¸Šä¸‹â½‚åˆ‡æ¢â¼€æ ·ï¼› å½“ä¸¤ä¸ªçº¿ç¨‹æ˜¯å±äºåŒâ¼€ä¸ªè¿›ç¨‹ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ï¼› æ‰€ä»¥ï¼Œçº¿ç¨‹çš„ä¸Šä¸‹â½‚åˆ‡æ¢ç›¸â½è¿›ç¨‹ï¼Œå¼€é”€è¦â¼©å¾ˆå¤šã€‚ 11.æ­»é” ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ æ­»é”ï¼ˆDeadlockï¼‰ æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºè€Œå¯¼è‡´çš„ç›¸äº’ç­‰å¾…çš„çŠ¶æ€ï¼Œæœ€ç»ˆä½¿å¾—å®ƒä»¬éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œé€ æˆç³»ç»Ÿæ— æ³•æ¢å¤çš„æƒ…å†µã€‚ç®€å•æ¥è¯´ï¼Œæ­»é”å‘ç”Ÿæ—¶ï¼Œçº¿ç¨‹æ°¸è¿œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¸ä¼šé‡Šæ”¾å®ƒä»¬æŒæœ‰çš„èµ„æºï¼Œå› æ­¤å…¶ä»–çº¿ç¨‹ä¹Ÿæ— æ³•ç»§ç»­æ‰§è¡Œ æ­»é”äº§ç”Ÿæœ‰å“ªäº›æ¡ä»¶ï¼Ÿ äº§ç”Ÿæ­»é”éœ€è¦åŒæ—¶æ»¡è¶³å››ä¸ªå¿…è¦æ¡ä»¶ï¼š äº’æ–¥ï¼šèµ„æºä¸èƒ½è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œå³èµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªèµ„æºå·²ç»è¢«åˆ†é…ç»™äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶ä»–è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°è¯¥èµ„æºè¢«é‡Šæ”¾ã€‚ æŒæœ‰å¹¶ç­‰å¾…ï¼šä¸€ä¸ªè¿›ç¨‹å·²ç»æŒæœ‰äº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼ŒåŒæ—¶è¿˜åœ¨ç­‰å¾…è·å–å…¶ä»–è¢«å ç”¨çš„èµ„æºã€‚åœ¨æ­¤æœŸé—´ï¼Œè¯¥è¿›ç¨‹ä¸ä¼šé‡Šæ”¾å·²ç»æŒæœ‰çš„èµ„æºã€‚ ä¸å¯å‰¥å¤ºï¼šå·²åˆ†é…ç»™è¿›ç¨‹çš„èµ„æºä¸èƒ½è¢«å¼ºåˆ¶å‰¥å¤ºï¼Œåªæœ‰æŒæœ‰è¯¥èµ„æºçš„è¿›ç¨‹å¯ä»¥ä¸»åŠ¨é‡Šæ”¾èµ„æºã€‚ å¾ªç¯ç­‰å¾…ï¼šæœ‰ä¸¤ä¸ªåŠä»¥ä¸Šçš„è¿›ç¨‹è·å–èµ„æºçš„é¡ºåºå½¢æˆäº†ç¯ å¦‚ä½•é¿å…æ­»é”ï¼Ÿ ç ´åäº§ç”Ÿæ­»é”çš„æ¡ä»¶ä¹‹ä¸€å°±å¯ä»¥äº† æ¶ˆé™¤æŒæœ‰å¹¶ç­‰å¾…ï¼šåœ¨çº¿ç¨‹å¼€å§‹æ—¶ï¼Œç¡®ä¿å®ƒä¸€æ¬¡æ€§è¯·æ±‚å¹¶æŒæœ‰æ‰€æœ‰èµ„æºã€‚å¦‚æœä¸èƒ½ä¸€æ¬¡æ€§è·å–æ‰€æœ‰èµ„æºï¼Œçº¿ç¨‹å°±ä¸ä¼šè·å¾—ä»»ä½•èµ„æºï¼Œè€Œæ˜¯ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾èµ„æºã€‚ æ¶ˆé™¤ä¸å¯å‰¥å¤ºï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æº æ¶ˆé™¤å¾ªç¯ç­‰å¾…ï¼šåœ¨ç³»ç»Ÿä¸­å¯¹æ‰€æœ‰çš„èµ„æºè¿›è¡Œæ’åºï¼Œçº¿ç¨‹åœ¨è·å–èµ„æºæ—¶ï¼Œå¿…é¡»æŒ‰é¡ºåºè¯·æ±‚èµ„æºã€‚è¿™æ ·å³ä½¿å¤šä¸ªçº¿ç¨‹ç«äº‰èµ„æºï¼Œä¹Ÿä¸ä¼šå½¢æˆå¾ªç¯ç­‰å¾…ã€‚ æ´»é”&#x2F;é¥¥é¥¿é” é¥¥é¥¿é”ï¼Œè¿™ä¸ªé¥¥é¥¿æŒ‡çš„æ˜¯èµ„æºé¥¥é¥¿ï¼ŒæŸä¸ªçº¿ç¨‹ä¸€ç›´ç­‰ä¸åˆ°å®ƒæ‰€éœ€è¦çš„èµ„æºï¼Œä»è€Œæ— æ³•å‘å‰æ¨è¿›ï¼Œå°±åƒä¸€ä¸ªäººå› ä¸ºé¥¥é¥¿æ— æ³•æˆé•¿ã€‚ æ´»é”ï¼šæ˜¯æŒ‡çº¿ç¨‹æˆ–è¿›ç¨‹è™½ç„¶å¤„äºâ€œæ´»åŠ¨â€çŠ¶æ€ï¼Œä½†å®ƒä»¬åœ¨ä¸æ–­åœ°äº’ç›¸å¹²æ‰°ï¼Œå¯¼è‡´æ— æ³•æœ‰æ•ˆå®Œæˆä»»åŠ¡ï¼Œç³»ç»Ÿå§‹ç»ˆå¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œä½†æ²¡æœ‰ä»»ä½•å®è´¨æ€§çš„è¿›å±•ã€‚æ´»é”é€šå¸¸æ˜¯å› ä¸ºçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸åœåœ°å°è¯•é‡æ–°è¿›å…¥æŸä¸ªæ“ä½œï¼Œä½†ç”±äºä¸æ–­è°ƒæ•´æˆ–é‡è¯•ï¼Œå¯¼è‡´æ— æ³•æœ‰æ•ˆæ‰§è¡Œå·¥ä½œã€‚ 2.å†…å­˜ç®¡ç†æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†éå¸¸é‡è¦ï¼Œä¸»è¦è´Ÿè´£ä¸‹é¢è¿™äº›äº‹æƒ…ï¼š å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼šå¯¹è¿›ç¨‹æ‰€éœ€çš„å†…å­˜è¿›è¡Œåˆ†é…å’Œé‡Šæ”¾ï¼Œmalloc å‡½æ•°ï¼šç”³è¯·å†…å­˜ï¼Œfree å‡½æ•°ï¼šé‡Šæ”¾å†…å­˜ã€‚ åœ°å€è½¬æ¢ï¼šå°†ç¨‹åºä¸­çš„è™šæ‹Ÿåœ°å€è½¬æ¢æˆå†…å­˜ä¸­çš„ç‰©ç†åœ°å€ã€‚ å†…å­˜æ‰©å……ï¼šå½“ç³»ç»Ÿæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ—¶ï¼Œåˆ©ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯æˆ–è‡ªåŠ¨è¦†ç›–æŠ€æœ¯ï¼Œä»é€»è¾‘ä¸Šæ‰©å……å†…å­˜ã€‚ å†…å­˜æ˜ å°„ï¼šå°†ä¸€ä¸ªæ–‡ä»¶ç›´æ¥æ˜ å°„åˆ°è¿›ç¨‹çš„è¿›ç¨‹ç©ºé—´ä¸­ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡å†…å­˜æŒ‡é’ˆç”¨è¯»å†™å†…å­˜çš„åŠæ³•ç›´æ¥å­˜å–æ–‡ä»¶å†…å®¹ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ å†…å­˜ä¼˜åŒ–ï¼šé€šè¿‡è°ƒæ•´å†…å­˜åˆ†é…ç­–ç•¥å’Œå›æ”¶ç®—æ³•æ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚ å†…å­˜å®‰å…¨ï¼šä¿è¯è¿›ç¨‹ä¹‹é—´ä½¿ç”¨å†…å­˜äº’ä¸å¹²æ‰°ï¼Œé¿å…ä¸€äº›æ¶æ„ç¨‹åºé€šè¿‡ä¿®æ”¹å†…å­˜æ¥ç ´åç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ 1.ä»€ä¹ˆæ˜¯å†…å­˜ç¢ç‰‡?é€šå¸¸åˆ†ä¸ºä¸¤ç§ å†…éƒ¨å†…å­˜ç¢ç‰‡ï¼šç®€å•è¯´å°±æ˜¯å·²ç»åˆ†é…çš„å†…å­˜ä½†æ²¡æœ‰ç”¨å®Œï¼Œæœªç”¨å®Œçš„éƒ¨åˆ†å°±æ˜¯å†…å­˜ç¢ç‰‡ å¤–éƒ¨å†…å­˜ç¢ç‰‡ï¼š ç®€å•è¯´å°±æ˜¯æœªåˆ†é…çš„è¿ç»­å†…å­˜å¤ªå°äº†ï¼Œä¸èƒ½å†ç”¨äº†ï¼Œæ‰€ä»¥å°±æ˜¯å¤–éƒ¨å†…å­˜ç¢ç‰‡ 2.å±€éƒ¨æ€§åŸç†ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œå€¾å‘äºé¢‘ç¹è®¿é—®ç‰¹å®šçš„æ•°æ®å’ŒæŒ‡ä»¤ã€‚å±€éƒ¨æ€§åŸç†çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç¨‹åºé€šå¸¸ä¸ä¼šéšæœºåœ°è®¿é—®å†…å­˜ä¸­çš„ä»»ä½•ä½ç½®ï¼Œè€Œæ˜¯æœ‰è§„å¾‹åœ°é›†ä¸­è®¿é—®æŸäº›åŒºåŸŸã€‚ æ—¶é—´å±€éƒ¨æ€§ï¼šå¦‚æœç¨‹åºè®¿é—®äº†æŸä¸ªå†…å­˜ä½ç½®ï¼Œé‚£ä¹ˆå®ƒåœ¨ä¸ä¹…çš„å°†æ¥å¯èƒ½ä¼šå†æ¬¡è®¿é—®è¯¥ä½ç½®ã€‚æ¢å¥è¯è¯´ï¼Œç¨‹åºå€¾å‘äºé‡å¤è®¿é—®æœ€è¿‘ä½¿ç”¨è¿‡çš„æ•°æ®æˆ–æŒ‡ä»¤ã€‚ ä¼˜åŒ–æ–¹æ³•ï¼šä¸ºäº†åˆ©ç”¨æ—¶é—´å±€éƒ¨æ€§ï¼Œç¼“å­˜ç³»ç»Ÿä¼šå°†æœ€è¿‘ä½¿ç”¨çš„æ•°æ®å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜ï¼ˆå¦‚CPUç¼“å­˜ï¼‰ä¸­ï¼Œè¿™æ ·å½“æ•°æ®å†æ¬¡éœ€è¦æ—¶ï¼Œå¯ä»¥å¿«é€Ÿä»ç¼“å­˜ä¸­è·å–ï¼Œè€Œä¸éœ€è¦ä»è¾ƒæ…¢çš„å†…å­˜æˆ–ç£ç›˜ä¸­è¯»å–ã€‚ ç©ºé—´å±€éƒ¨æ€§ï¼šå¦‚æœç¨‹åºè®¿é—®äº†å†…å­˜ä¸­çš„æŸä¸ªä½ç½®ï¼Œå®ƒå¾ˆå¯èƒ½ä¼šåœ¨ä¸ä¹…çš„å°†æ¥è®¿é—®è¯¥ä½ç½®é™„è¿‘çš„å†…å­˜åœ°å€ã€‚å³ï¼Œç¨‹åºå€¾å‘äºé›†ä¸­è®¿é—®å†…å­˜ä¸­çš„ç›¸é‚»ä½ç½®ã€‚ ä¼˜åŒ–æ–¹æ³•ï¼šä¸ºäº†åˆ©ç”¨ç©ºé—´å±€éƒ¨æ€§ï¼Œæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä¼šå°½é‡å°†æ•°æ®æŒ‰ç…§åœ°å€çš„é¡ºåºåŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæˆ–è€…å°†è¿ç»­çš„å†…å­˜å—å­˜å‚¨åœ¨ä¸€èµ·ã€‚ 3.è™šæ‹Ÿå†…å­˜æ“ä½œç³»ç»Ÿè®¾è®¡äº†è™šæ‹Ÿå†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜ï¼Œæˆ‘ä»¬æ‰€å†™çš„ç¨‹åºä¸ä¼šç›´æ¥ä¸ç‰©ç†å†…æ‰“äº¤é“ã€‚ æœ¬è´¨ä¸Šæ¥è¯´å®ƒåªæ˜¯é€»è¾‘å­˜åœ¨çš„ï¼Œæ˜¯ä¸€ä¸ªå‡æƒ³å‡ºæ¥çš„å†…å­˜ç©ºé—´ï¼Œä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºè¿›ç¨‹è®¿é—®ä¸»å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰çš„æ¡¥æ¢å¹¶ç®€åŒ–å†…å­˜ç®¡ç†ã€‚ è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ è™šæ‹Ÿåœ°å€ï¼šæ˜¯ç”±ç¨‹åºä½¿ç”¨çš„åœ°å€ï¼Œç¨‹åºé€šè¿‡è™šæ‹Ÿåœ°å€è®¿é—®å†…å­˜ã€‚ ç‰©ç†åœ°å€ï¼šæ˜¯è®¡ç®—æœºç¡¬ä»¶ï¼ˆå¦‚RAMï¼‰ä¸­çš„å®é™…å†…å­˜åœ°å€ã€‚ ä¼˜ç‚¹ï¼š æ‰©å±•å†…å­˜å®¹é‡ï¼šè™šæ‹Ÿå†…å­˜å…è®¸ç¨‹åºä½¿ç”¨çš„å†…å­˜ç©ºé—´è¶…è¿‡ç‰©ç†å†…å­˜çš„å¤§å°ã€‚æ“ä½œç³»ç»Ÿé€šè¿‡å°†ä¸å¸¸ç”¨çš„é¡µé¢å­˜å‚¨åˆ°ç¡¬ç›˜ä¸­ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥â€œè®¤ä¸ºâ€å®ƒæœ‰æ›´å¤§çš„å†…å­˜ã€‚ å†…å­˜éš”ç¦»å’Œä¿æŠ¤ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿›ç¨‹é—´çš„å†…å­˜æ˜¯éš”ç¦»çš„ï¼Œè¿™æä¾›äº†æ›´å¥½çš„å†…å­˜ä¿æŠ¤å’Œå®‰å…¨æ€§ã€‚è¿›ç¨‹ä¹‹é—´å½¼æ­¤éš”ç¦»ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä»£ç æ— æ³•æ›´æ”¹æ­£åœ¨ç”±å¦ä¸€è¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚ ç®€åŒ–ç¨‹åºè®¾è®¡ï¼šç¨‹åºå‘˜ä¸éœ€è¦å…³å¿ƒç‰©ç†å†…å­˜çš„å…·ä½“åˆ†é…ï¼Œè™šæ‹Ÿå†…å­˜ä½¿å¾—æ¯ä¸ªç¨‹åºå¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæå¤§åœ°ç®€åŒ–äº†å†…å­˜ç®¡ç†ã€‚ è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„æ–¹å¼ä¸»è¦æœ‰ åˆ†é¡µï¼Œåˆ†æ®µï¼Œæ®µé¡µ 4.åˆ†é¡µæœºåˆ¶åˆ†é¡µæœºåˆ¶ï¼ˆPagingï¼‰ æŠŠä¸»å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰åˆ†ä¸ºè¿ç»­ç­‰é•¿çš„ç‰©ç†é¡µï¼Œåº”ç”¨ç¨‹åºçš„è™šæ‹Ÿåœ°å€ç©ºé—´åˆ’ä¹Ÿè¢«åˆ†ä¸ºè¿ç»­ç­‰é•¿çš„è™šæ‹Ÿé¡µã€‚ åˆ†é¡µç®¡ç†é€šè¿‡ é¡µè¡¨ï¼ˆPage Tableï¼‰ æ˜ å°„è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ã€‚ åœ¨åˆ†é¡µæœºåˆ¶ä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„é¡µè¡¨ã€‚ åˆ†é¡µæœºåˆ¶ä¸‹çš„è™šæ‹Ÿåœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š é¡µå·ï¼šé€šè¿‡è™šæ‹Ÿé¡µå·å¯ä»¥ä»é¡µè¡¨ä¸­å–å‡ºå¯¹åº”çš„ç‰©ç†é¡µå·ï¼› é¡µå†…åç§»é‡ï¼šç‰©ç†é¡µèµ·å§‹åœ°å€+é¡µå†…åç§»é‡&#x3D;ç‰©ç†å†…å­˜åœ°å€ã€‚ ä¸ºäº†å‡å°‘é¡µè¡¨çš„å¼€é”€ï¼Œæ“ä½œç³»ç»Ÿå¼•å…¥äº† å¤šçº§é¡µè¡¨ ï¼Œå¤šçº§é¡µè¡¨å¯¹åº”å¤šä¸ªé¡µè¡¨ï¼Œæ¯ä¸ªé¡µè¡¨ä¸å‰ä¸€ä¸ªé¡µè¡¨ç›¸å…³è”ã€‚ ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿå¾—åˆ°ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œåˆå¼•å…¥äº†å¿«è¡¨ï¼ˆTLBï¼‰ï¼Œåˆ©ç”¨äº†å±€éƒ¨æ€§åŸç†ã€‚è¿™æ ·å°±æ˜¯å…ˆè®¿é—®å¿«è¡¨ï¼Œå†è®¿é—®é¡µè¡¨äº†ã€‚ 5.åˆ†æ®µæœºåˆ¶ç¨‹åºæ˜¯ç”±è‹¥â¼²ä¸ªé€»è¾‘åˆ†æ®µç»„æˆçš„ï¼Œå¦‚å¯ç”±ä»£ç åˆ†æ®µã€æ•°æ®åˆ†æ®µã€æ ˆæ®µã€å †æ®µç»„æˆã€‚ä¸åŒçš„æ®µæ˜¯æœ‰ä¸åŒçš„å±æ€§çš„ï¼Œæ‰€ä»¥å°±â½¤åˆ†æ®µï¼ˆSegmentationï¼‰çš„å½¢å¼æŠŠè¿™äº›æ®µåˆ†ç¦»å‡ºæ¥ã€‚ åˆ†æ®µæœºåˆ¶ä¸‹çš„è™šæ‹Ÿåœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæ®µå·å’Œæ®µå†…åç§»é‡ã€‚ è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€é€šè¿‡æ®µè¡¨æ˜ å°„ï¼Œæ®µè¡¨ä¸»è¦åŒ…æ‹¬æ®µå·ã€æ®µçš„ç•Œé™ã€‚ 6.åˆ†é¡µå’Œåˆ†æ®µçš„åŒºåˆ« æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œå®ƒæ˜¯æ ¹æ®ç”¨æˆ·çš„éœ€è¦åˆ’åˆ†çš„ï¼Œå› æ­¤æ®µå¯¹ç”¨æˆ·æ˜¯å¯è§çš„ ï¼›é¡µæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼Œæ˜¯ä¸ºäº†ç®¡ç†ä¸»å­˜çš„æ–¹ä¾¿è€Œåˆ’åˆ†çš„ï¼Œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚ æ®µçš„å¤§å°ä¸å›ºå®šï¼Œæœ‰å®ƒæ‰€å®Œæˆçš„åŠŸèƒ½å†³å®šï¼›é¡µçš„å¤§å°å›ºå®šï¼Œç”±ç³»ç»Ÿå†³å®š 7.é¡µé¢ç½®æ¢ç®—æ³•å½“ CPU è®¿é—®çš„é¡µé¢ä¸åœ¨ç‰©ç†å†…å­˜æ—¶ï¼Œä¾¿ä¼šäº§ç”Ÿä¸€ä¸ªç¼ºé¡µä¸­æ–­ï¼Œ è¯·æ±‚æ“ä½œç³»ç»Ÿå°†æ‰€ç¼ºé¡µä»ç£ç›˜è°ƒå…¥åˆ°ç‰©ç†å†…å­˜ã€‚ å¦‚æœç‰©ç†å†…å­˜ä¸­æ²¡æœ‰ç©ºé—²çš„ç‰©ç†é¡µé¢å¯ç”¨çš„è¯ã€‚æ“ä½œç³»ç»Ÿå°±å¿…é¡»å°†ç‰©ç†å†…å­˜ä¸­çš„ä¸€ä¸ªç‰©ç†é¡µæ·˜æ±°å‡ºå»ï¼Œè¿™æ ·å°±å¯ä»¥è…¾å‡ºç©ºé—´æ¥åŠ è½½æ–°çš„é¡µé¢äº†ã€‚ ç”¨æ¥é€‰æ‹©æ·˜æ±°å“ªä¸€ä¸ªç‰©ç†é¡µçš„è§„åˆ™å«åš é¡µé¢ç½®æ¢ç®—æ³• ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¡µé¢ç½®æ¢ç®—æ³•çœ‹æˆæ˜¯æ·˜æ±°ç‰©ç‰©ç†é¡µçš„è§„åˆ™ã€‚ å½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ä¸€éƒ¨åˆ†ä¸å¸¸ç”¨çš„é¡µé¢ä»å†…å­˜ä¸­æ¢å‡ºï¼ˆæ¢å‡ºï¼‰ï¼Œå¹¶å°†éœ€è¦çš„é¡µé¢åŠ è½½åˆ°å†…å­˜ä¸­ï¼ˆæ¢å…¥ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ç§°ä¸ºé¡µé¢ç½®æ¢ã€‚ é¡µé¢ç½®æ¢ç®—æ³•çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„é¡µé¢è¿›è¡Œç½®æ¢ï¼Œé¿å…é¢‘ç¹çš„é¡µé¢äº¤æ¢ï¼ˆä¹Ÿç§°ä¸ºâ€œé¡µé¢æŠ–åŠ¨â€ï¼‰ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•ˆç‡ã€‚ æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ï¼šé€‰æ‹©åœ¨æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸ä¼šè¢«è®¿é—®çš„é¡µé¢è¿›è¡Œç½®æ¢ ç¼ºç‚¹ï¼šéœ€è¦æå‰çŸ¥é“æœªæ¥çš„é¡µé¢è®¿é—®æ¨¡å¼ï¼Œè¿™åœ¨å®é™…åº”ç”¨ä¸­æ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œå› æ­¤å®ƒé€šå¸¸ä½œä¸ºæ€§èƒ½å¯¹æ¯”çš„åŸºå‡†ï¼Œæˆ–è€…ç”¨æ¥è¯„ä¼°å…¶ä»–ç®—æ³•çš„æ•ˆæœã€‚ å…ˆè¿›å…ˆå‡ºç®—æ³•ï¼šé€‰æ‹©å†…å­˜ä¸­æœ€æ—©è¿›å…¥çš„é¡µé¢è¿›è¡Œç½®æ¢ ç¼ºç‚¹ï¼šFIFOå¹¶ä¸è€ƒè™‘é¡µé¢çš„å®é™…ä½¿ç”¨é¢‘ç‡å’Œæœ€è¿‘ä½¿ç”¨æƒ…å†µï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›â€œåç›´è§‰â€çš„æ•ˆæœï¼ˆå³ç½®æ¢æ‰ä¸€äº›æœªæ¥ä¼šé¢‘ç¹ä½¿ç”¨çš„é¡µé¢ï¼‰ã€‚è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„Beladyå¼‚å¸¸ï¼ˆå³å¢åŠ ç‰©ç†å†…å­˜æ—¶ï¼Œé¡µé¢é”™è¯¯åè€Œå¢å¤šï¼‰ã€‚ æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„ç½®æ¢ç®—æ³•(LRU)ï¼šé€‰æ‹©æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢è¿›è¡Œç½®æ¢ã€‚ è¯¥ç®—æ³•å‡è®¾å·²ç»å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„é¡µé¢å¾ˆæœ‰å¯èƒ½åœ¨æœªæ¥è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´å†…ä»ç„¶ä¸ä¼šè¢«ä½¿ç”¨ã€‚ æœ€ä¸å¸¸ç”¨ç®—æ³•ï¼ˆLFUï¼‰ï¼šé€‰æ‹©ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é¡µé¢è¿›è¡Œç½®æ¢ã€‚ LFUéœ€è¦ç»´æŠ¤æ¯ä¸ªé¡µé¢çš„è®¿é—®è®¡æ•°ã€‚å½“ä¸€ä¸ªé¡µé¢è¢«è®¿é—®æ—¶ï¼Œå®ƒçš„è®¡æ•°å™¨ä¼šå¢åŠ ï¼›å½“å†…å­˜éœ€è¦ç½®æ¢æ—¶ï¼Œé€‰æ‹©è®¿é—®æ¬¡æ•°æœ€å°‘çš„é¡µé¢è¿›è¡Œæ¢å‡ºã€‚ æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•ï¼šé€šè¿‡ä½¿ç”¨ä¸€ä¸ªåœ†å½¢é“¾è¡¨å’Œä¸€ä¸ªæŒ‡é’ˆæ¥æ¨¡æ‹Ÿæ—¶é’Ÿçš„èµ°åŠ¨ï¼Œå†³å®šå“ªä¸ªé¡µé¢åº”å½“è¢«ç½®æ¢ã€‚ å®ç°ï¼šæ¯ä¸ªé¡µé¢éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨ä½ï¼ˆreference bitï¼‰ï¼Œåœ¨æ¯æ¬¡è®¿é—®é¡µé¢æ—¶ï¼Œå¼•ç”¨ä½è¢«è®¾ç½®ä¸º1ã€‚å½“å‘ç”Ÿé¡µé¢ç½®æ¢æ—¶ï¼Œç®—æ³•ä»æŒ‡é’ˆæŒ‡å‘çš„é¡µé¢å¼€å§‹ï¼Œå¦‚æœè¯¥é¡µé¢çš„å¼•ç”¨ä½ä¸º0ï¼Œåˆ™ç½®æ¢è¯¥é¡µé¢ï¼›å¦‚æœå¼•ç”¨ä½ä¸º1ï¼Œåˆ™å°†å¼•ç”¨ä½æ¸…é›¶ï¼Œå¹¶å°†æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªé¡µé¢ã€‚è¿™æ ·ï¼ŒClockç®—æ³•å¯ä»¥åœ¨è¿‘ä¼¼LRUçš„åŒæ—¶å‡å°‘å¼€é”€ã€‚ 3.æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸»è¦è´Ÿè´£ç®¡ç†å’Œç»„ç»‡è®¡ç®—æœºå­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå…¶åŠŸèƒ½åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š å­˜å‚¨ç®¡ç†ï¼šå°†æ–‡ä»¶æ•°æ®å­˜å‚¨åˆ°ç‰©ç†å­˜å‚¨ä»‹è´¨ä¸­ï¼Œå¹¶ä¸”ç®¡ç†ç©ºé—´åˆ†é…ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜å‚¨ï¼Œå¹¶é¿å…æ–‡ä»¶ä¹‹é—´å‘ç”Ÿå†²çªã€‚ æ–‡ä»¶ç®¡ç†ï¼šæ–‡ä»¶çš„åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€é‡å‘½åã€å‹ç¼©ã€åŠ å¯†ã€å…±äº«ç­‰ç­‰ã€‚ ç›®å½•ç®¡ç†ï¼šç›®å½•çš„åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€é‡å‘½åç­‰ç­‰ã€‚ æ–‡ä»¶è®¿é—®æ§åˆ¶ï¼šç®¡ç†ä¸åŒç”¨æˆ·æˆ–è¿›ç¨‹å¯¹æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œä»¥ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®å…¶è¢«æˆæƒè®¿é—®çš„æ–‡ä»¶ï¼Œä»¥ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§å’Œä¿å¯†æ€§ã€‚ 1.ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥çš„åŒºåˆ«åœ¨ Linux&#x2F;ç±» Unix ç³»ç»Ÿä¸Šï¼Œæ–‡ä»¶é“¾æ¥ï¼ˆFile Linkï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶ã€‚å¸¸è§çš„æ–‡ä»¶é“¾æ¥ç±»å‹æœ‰ä¸¤ç§ï¼š ç¡¬é“¾æ¥æ˜¯å¤šä¸ªç›®å½•é¡¹ä¸­çš„ã€Œç´¢å¼•èŠ‚ç‚¹ã€æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘åŒä¸€ä¸ª inodeï¼Œä½†æ˜¯ inode æ˜¯ä¸å¯èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰å„è‡ªçš„ inode æ•°æ®ç»“æ„å’Œåˆ—è¡¨ï¼Œ æ‰€ä»¥ç¡¬é“¾æ¥æ˜¯ä¸å¯ç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿçš„ã€‚ç”±äºå¤šä¸ªç›®å½•é¡¹éƒ½æ˜¯æŒ‡å‘ä¸€ä¸ª inodeï¼Œ é‚£ä¹ˆåªæœ‰åˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰ç¡¬é“¾æ¥ä»¥åŠæºæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šå½»åº•åˆ é™¤è¯¥æ–‡ä»¶ã€‚ è½¯é“¾æ¥ç›¸å½“äºé‡æ–°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æœ‰ç‹¬ç«‹çš„ inodeï¼Œ ä½†æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥è®¿é—®è½¯é“¾æ¥çš„æ—¶å€™ï¼Œ å®é™…ä¸Šç›¸å½“äºè®¿é—®åˆ°äº†å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è½¯é“¾æ¥æ˜¯å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œ ç”šè‡³ç›®æ ‡æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œé“¾æ¥æ–‡ä»¶è¿˜æ˜¯åœ¨çš„ï¼Œåªä¸è¿‡æŒ‡å‘çš„æ–‡ä»¶æ‰¾ä¸åˆ°äº†è€Œå·²ã€‚ 2.å¸¸è§çš„ç£ç›˜è°ƒåº¦ç®—æ³•ç£ç›˜è°ƒåº¦ç®—æ³•çš„ç›®çš„å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºäº†æé«˜ç£ç›˜çš„è®¿é—®æ€§èƒ½ï¼Œ ä¸€èˆ¬æ˜¯é€šè¿‡ä¼˜åŒ–ç£ç›˜çš„è®¿é—®è¯·æ±‚é¡ºåºæ¥åšåˆ°çš„ã€‚ å…ˆæ¥å…ˆæœåŠ¡ï¼šæŒ‰ç…§è¯·æ±‚åˆ°è¾¾ç£ç›˜è°ƒåº¦å™¨çš„é¡ºåºè¿›è¡Œå¤„ç†ï¼Œå…ˆåˆ°è¾¾çš„è¯·æ±‚çš„å…ˆè¢«æœåŠ¡ã€‚ 4.I&#x2F;O1.é›¶æ‹·è´é›¶æ‹·è´ï¼ˆZero-copyï¼‰æ˜¯ä¸€ç§ä¼˜åŒ–æ•°æ®ä¼ è¾“çš„æŠ€æœ¯ï¼Œæ—¨åœ¨å‡å°‘æˆ–æ¶ˆé™¤æ•°æ®åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´æ“ä½œï¼Œä»è€Œæé«˜I&#x2F;Oæ€§èƒ½ã€‚åœ¨ä¼ ç»Ÿçš„I&#x2F;Oæ“ä½œä¸­ï¼Œæ•°æ®é€šå¸¸éœ€è¦ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œæˆ–è€…ä»ç”¨æˆ·ç¼“å†²åŒºæ‹·è´å›å†…æ ¸ç¼“å†²åŒºï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„CPUå’Œå†…å­˜å¼€é”€ã€‚é›¶æ‹·è´æŠ€æœ¯é€šè¿‡é¿å…è¿™äº›ä¸å¿…è¦çš„æ‹·è´ï¼Œæ˜¾è‘—æå‡æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘ã€å¤§æ•°æ®é‡çš„åœºæ™¯ä¸‹æ•ˆæœå°¤ä¸ºæ˜æ˜¾ã€‚ é›¶æ‹·è´çš„åŸç† åœ¨æ“ä½œç³»ç»Ÿï¼ˆå¦‚Linuxï¼‰ä¸­ï¼Œä¼ ç»Ÿçš„I&#x2F;Oæ“ä½œé€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š æ•°æ®ä»å¤–éƒ¨è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ã€ç½‘ç»œï¼‰è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºã€‚ å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹çš„ç¼“å†²åŒºã€‚ ç”¨æˆ·è¿›ç¨‹å¤„ç†æ•°æ®åï¼Œå†å°†æ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºæ‹·è´å›å†…æ ¸ç¼“å†²åŒºã€‚ å†…æ ¸å°†æ•°æ®å‘é€åˆ°ç›®æ ‡è®¾å¤‡ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´è¿›è¡Œäº†å¤šæ¬¡æ‹·è´ï¼Œå¯¼è‡´æ€§èƒ½å¼€é”€ã€‚é›¶æ‹·è´æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºä¼˜åŒ–è¿™äº›æ­¥éª¤ï¼Œå‡å°‘æˆ–å®Œå…¨æ¶ˆé™¤ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚ ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„é›¶æ‹·è´æŠ€æœ¯åŠå…¶åŸç†ï¼š mmapï¼ˆå†…å­˜æ˜ å°„ï¼‰ åŸç†ï¼šé€šè¿‡mmapç³»ç»Ÿè°ƒç”¨ï¼Œæ–‡ä»¶æˆ–è®¾å¤‡çš„æ•°æ®è¢«ç›´æ¥æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚è¿›ç¨‹å¯ä»¥åƒè®¿é—®å†…å­˜ä¸€æ ·è®¿é—®è¿™äº›æ•°æ®ï¼Œè€Œæ— éœ€å°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºã€‚ ä¼˜ç‚¹ï¼šå‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œé€‚åˆé¢‘ç¹è¯»å†™æ–‡ä»¶çš„åœºæ™¯ã€‚ åº”ç”¨åœºæ™¯ï¼šæ•°æ®åº“ç³»ç»Ÿã€å†…å­˜æ˜ å°„æ–‡ä»¶ç­‰ã€‚ æ€»ç»“ é›¶æ‹·è´æ˜¯ä¸€ç§é€šè¿‡ä¼˜åŒ–æ•°æ®ä¼ è¾“è·¯å¾„ï¼Œå‡å°‘æˆ–æ¶ˆé™¤ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´æ•°æ®æ‹·è´çš„æŠ€æœ¯ã€‚å®ƒåœ¨I&#x2F;Oå¯†é›†å‹åº”ç”¨ä¸­ï¼ˆå¦‚æ–‡ä»¶ä¼ è¾“ã€ç½‘ç»œé€šä¿¡ã€æ•°æ®åº“ç­‰ï¼‰å…·æœ‰é‡è¦æ„ä¹‰ã€‚å¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬mmapã€sendfileã€spliceã€DMAå’Œé¡µç¼“å­˜å…±äº«ç­‰ï¼Œè¿™äº›æŠ€æœ¯æ˜¾è‘—æå‡äº†ç³»ç»Ÿæ€§èƒ½ï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘å’Œå¤§æµé‡åœºæ™¯ä¸‹ã€‚ 2.I&#x2F;Oæ¨¡å‹ é˜»å¡I&#x2F;Oâ€”â€”BIO åº”ç”¨ç¨‹åºå‘èµ·I&#x2F;Oæ“ä½œåä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆæ‰è¿”å›ç»“æœã€‚é€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚ éé˜»å¡I&#x2F;Oâ€”â€”NIO åº”ç”¨ç¨‹åºå‘èµ·I&#x2F;Oæ“ä½œåç«‹å³è¿”å›ï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œä½†éœ€è¦ä¸æ–­è½®è¯¢æˆ–è€…ä½¿ç”¨ã€‚ ç‰¹ç‚¹ï¼šç”¨æˆ·è¿›ç¨‹éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ å½“ç”¨æˆ·è¿›ç¨‹å‘å‡º read æ“ä½œæ—¶ï¼Œå¦‚æœ kernel ä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼š block ç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ª error ã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ª read æ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ª error æ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€ read æ“ä½œã€‚ä¸€æ—¦ kernel ä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„ system call ï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚ I&#x2F;Oå¤šè·¯å¤ç”¨ ç‰¹ç‚¹ï¼šä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselect()å‡½æ•°å°±å¯ä»¥è¿”å›ã€‚ å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯selectï¼Œpollï¼Œepollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚ å¼‚æ­¥I&#x2F;Oâ€”â€”AIO ç”¨æˆ·è¿›ç¨‹å‘èµ· read æ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä» kernel çš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ª asynchronous read ä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½• block ã€‚ç„¶åï¼Œkernel ä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernel ä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ª signal ï¼Œå‘Šè¯‰å®ƒ read æ“ä½œå®Œæˆäº†ã€‚ æœ€åï¼Œå†ä¸¾å‡ ä¸ªä¸æ˜¯å¾ˆæ°å½“çš„ä¾‹å­æ¥è¯´æ˜è¿™å››ä¸ªIO Model:æœ‰Aï¼ŒBï¼ŒCï¼ŒDå››ä¸ªäººåœ¨é’“é±¼ï¼šAç”¨çš„æ˜¯æœ€è€å¼çš„é±¼ç«¿ï¼Œæ‰€ä»¥å‘¢ï¼Œå¾—ä¸€ç›´å®ˆç€ï¼Œç­‰åˆ°é±¼ä¸Šé’©äº†å†æ‹‰æ†ï¼›Bçš„é±¼ç«¿æœ‰ä¸ªåŠŸèƒ½ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºæ˜¯å¦æœ‰é±¼ä¸Šé’©ï¼Œæ‰€ä»¥å‘¢ï¼ŒBå°±å’Œæ—è¾¹çš„MMèŠå¤©ï¼Œéš”ä¼šå†çœ‹çœ‹æœ‰æ²¡æœ‰é±¼ä¸Šé’©ï¼Œæœ‰çš„è¯å°±è¿…é€Ÿæ‹‰æ†ï¼›Cç”¨çš„é±¼ç«¿å’ŒBå·®ä¸å¤šï¼Œä½†ä»–æƒ³äº†ä¸€ä¸ªå¥½åŠæ³•ï¼Œå°±æ˜¯åŒæ—¶æ”¾å¥½å‡ æ ¹é±¼ç«¿ï¼Œç„¶åå®ˆåœ¨æ—è¾¹ï¼Œä¸€æ—¦æœ‰æ˜¾ç¤ºè¯´é±¼ä¸Šé’©äº†ï¼Œå®ƒå°±å°†å¯¹åº”çš„é±¼ç«¿æ‹‰èµ·æ¥ï¼›Dæ˜¯ä¸ªæœ‰é’±äººï¼Œå¹²è„†é›‡äº†ä¸€ä¸ªäººå¸®ä»–é’“é±¼ï¼Œä¸€æ—¦é‚£ä¸ªäººæŠŠé±¼é’“ä¸Šæ¥äº†ï¼Œå°±ç»™Då‘ä¸ªçŸ­ä¿¡ã€‚ 3.I&#x2F;Oå¤šè·¯å¤ç”¨ä¼ ç»Ÿçš„ I&#x2F;O æ¨¡å‹ä¸­ï¼Œå¦‚æœæœåŠ¡ç«¯éœ€è¦æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯èƒ½è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªè¿›ç¨‹&#x2F;çº¿ç¨‹ã€‚ å¼•å…¥å¤šè·¯å¤ç”¨ä¹‹åï¼Œä¸€ä¸ªè¿›ç¨‹&#x2F;çº¿ç¨‹ç»´æŠ¤å¤šä¸ª Socketï¼Œè¿™ä¸ªå¤šè·¯å¤ç”¨å°±æ˜¯å¤šä¸ªè¿æ¥å¤ç”¨ä¸€ä¸ªè¿›ç¨‹&#x2F;çº¿ç¨‹ã€‚ å®ƒä»¬å…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç›‘æ§å¤šä¸ª I&#x2F;O æ“ä½œï¼Œæ˜¯é«˜å¹¶å‘æœåŠ¡å™¨ï¼ˆå¦‚ Nginxã€Redisï¼‰çš„æ ¸å¿ƒæŠ€æœ¯ã€‚ I&#x2F;O å¤šè·¯å¤ç”¨ä¸‰ç§å®ç°æœºåˆ¶ select&#x2F;poll ç”¨æˆ·å°†éœ€è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼ˆåˆ†ä¸ºè¯»ã€å†™ã€å¼‚å¸¸ä¸‰ç±»ï¼‰ä¼ é€’ç»™ select å‡½æ•°ã€‚select å‡½æ•°ä¼šé˜»å¡è¿›ç¨‹ï¼Œç›´åˆ°æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼ˆå³å¯è¯»ã€å¯å†™æˆ–å‘ç”Ÿå¼‚å¸¸ï¼‰æˆ–è¾¾åˆ°æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ã€‚å½“æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œselect è¿”å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œç”¨æˆ·éœ€è¦éå†æ•´ä¸ªé›†åˆï¼Œæ£€æŸ¥å“ªäº›fdå¤„äºå°±ç»ªçŠ¶æ€ã€‚ ç¼ºç‚¹ï¼š æ€§èƒ½å¼€é”€å¤§ï¼šæ¯æ¬¡è°ƒç”¨ select æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦é›†åˆéœ€è¦ä»ç”¨æˆ·æ€å¤åˆ¶åˆ°å†…æ ¸æ€ï¼Œå¼€é”€éšç€fdæ•°é‡å¢åŠ è€Œæ˜¾è‘—å¢å¤§ã€‚ fdæ•°é‡é™åˆ¶ï¼šselect ä½¿ç”¨ä½å›¾è¡¨ç¤ºfdé›†åˆï¼Œé»˜è®¤æœ€å¤§æ”¯æŒ1024ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆæŸäº›ç³»ç»Ÿå¯è°ƒæ•´ï¼Œä½†ä»æœ‰é™åˆ¶ï¼‰ã€‚ æ•ˆç‡ä½ä¸‹ï¼šè¿”å›åï¼Œç”¨æˆ·å¿…é¡»éå†æ•´ä¸ªfdé›†åˆæ‰èƒ½ç¡®å®šå“ªäº›fdå°±ç»ªï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚ pollå’Œselectç±»ä¼¼ï¼Œæœ€å¤§çš„æ”¹è¿›æ˜¯æ— fdæ•°é‡ç¡¬æ€§é™åˆ¶ ï¼Œä¸è¿‡ä»ç„¶éœ€è¦éå†æ‰èƒ½çŸ¥é“å°±ç»ªçš„fdï¼Œè¿˜æœ‰å°±æ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„å¼€é”€ selectå’Œpollè¿™ç§ä¾èµ–éå†å’Œæ‹·è´çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼éšç€å¹¶å‘æ•°ä¸Šæ¥ï¼Œæ€§èƒ½çš„æŸè€—ä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚ epoll ä¸ select() å’Œ poll() ä¸åŒï¼Œepoll() å¹¶ä¸æ¯æ¬¡éƒ½éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚epoll() ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼šä¸éœ€è¦æ¯æ¬¡è°ƒç”¨éƒ½ä¼ é€’æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯é€šè¿‡epoll_ctlæ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œä¹‹åé€šè¿‡epoll_waitè·å–å°±ç»ªçš„äº‹ä»¶ã€‚è¿™ç§æ–¹å¼åœ¨å¤„ç†å¤§é‡æ–‡ä»¶æè¿°ç¬¦æ—¶æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºåªéœ€è¦å¤„ç†å®é™…å°±ç»ªçš„äº‹ä»¶ï¼Œè€Œä¸æ˜¯éå†æ‰€æœ‰æè¿°ç¬¦ã€‚ epollçš„ç”¨æ³•å¦‚ä¸‹ï¼š è°ƒç”¨ epoll_create åˆ›å»ºä¸€ä¸ªepollå®ä¾‹ï¼Œè¿”å›ä¸€ä¸ªepollæ–‡ä»¶æè¿°ç¬¦ã€‚ ä½¿ç”¨ epoll_ctl å‘epollå®ä¾‹ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤éœ€è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åŠå…¶äº‹ä»¶ã€‚ è°ƒç”¨ epoll_wait é˜»å¡è¿›ç¨‹ï¼Œç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚è¿”å›æ—¶ï¼Œç›´æ¥æä¾›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨ï¼Œç”¨æˆ·æ— éœ€éå†ã€‚ ä¼˜ç‚¹ï¼šé«˜æ€§èƒ½ï¼šäº‹ä»¶é©±åŠ¨æœºåˆ¶ä»…è¿”å›å°±ç»ªçš„fdï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œæ— éœ€è½®è¯¢æ•´ä¸ªé›†åˆã€‚ æ”¯æŒå¤§é‡fdï¼šç†è®ºä¸Šåªå—ç³»ç»Ÿèµ„æºé™åˆ¶ï¼Œé€‚åˆå¤§è§„æ¨¡å¹¶å‘ã€‚ epoll é€šè¿‡ä¸¤ä¸ªæ–¹é¢ï¼Œå¾ˆå¥½è§£å†³äº† select&#x2F;poll çš„é—®é¢˜ã€‚ epoll åœ¨å†…æ ¸é‡Œä½¿ç”¨çº¢é»‘æ ‘æ¥è·Ÿè¸ªè¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„æ–‡ä»¶æè¿°å­—ï¼ŒæŠŠéœ€è¦ç›‘æ§çš„ socket é€šè¿‡epoll_ctl() å‡½æ•°åŠ å…¥å†…æ ¸ä¸­çš„çº¢é»‘æ ‘é‡Œ epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ï¼Œå†…æ ¸é‡Œç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨æ¥è®°å½•å°±ç»ªäº‹ä»¶ï¼Œå½“æŸä¸ª socket æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°†å…¶åŠ å…¥åˆ°è¿™ä¸ªå°±ç»ªäº‹ä»¶é“¾è¡¨ä¸­ï¼Œ å½“ç”¨æˆ·è°ƒç”¨ epoll_wait() å‡½æ•°æ—¶ï¼Œ åªä¼šè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œ ä¸éœ€è¦åƒ select&#x2F;poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ª socket é›†åˆï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ã€‚ æ€§èƒ½å·®å¼‚çš„åŸå›  select&#x2F;pollï¼šæ¯æ¬¡è°ƒç”¨æ¶‰åŠå…¨é‡æ•°æ®æ‹·è´å’Œçº¿æ€§æ‰«æï¼Œé€‚åˆå°‘é‡æ´»è·ƒè¿æ¥ã€‚ epollï¼šé€šè¿‡äº‹ä»¶é©±åŠ¨å’Œå›è°ƒæœºåˆ¶ï¼Œä»…å¤„ç†æ´»è·ƒè¿æ¥ï¼Œé€‚åˆæµ·é‡è¿æ¥ä¸­åªæœ‰å°‘æ•°æ´»è·ƒçš„åœºæ™¯ï¼ˆå¦‚ Web æœåŠ¡å™¨ï¼‰ã€‚ 4.epollçš„è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘epoll æ”¯æŒä¸¤ç§äº‹ä»¶è§¦å‘æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯è¾¹ç¼˜è§¦å‘(edge-triggeredï¼ŒET)å’Œæ°´å¹³è§¦å‘(level-triggered, LT) selectå’Œpollä»…æ”¯æŒæ°´å¹³è§¦å‘ã€‚ETæ¨¡å¼å¯ä»¥å‡å°‘epoll_waitçš„è°ƒç”¨æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡ï¼Œä½†éœ€è¦åº”ç”¨ç¨‹åºæ­£ç¡®å¤„ç†æ‰€æœ‰å¯ç”¨æ•°æ®ï¼Œå¦åˆ™å¯èƒ½ä¼šä¸¢å¤±äº‹ä»¶ã€‚ åœ¨è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰æ¨¡å¼ä¸‹ï¼Œå¿…é¡»ä¸€æ¬¡æ€§è¯»å–æˆ–å†™å…¥æ‰€æœ‰æ•°æ®ï¼Œå¦åˆ™å¯èƒ½ä¸¢å¤±äº‹ä»¶ è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰ï¼šä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket æè¿°ç¬¦ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨ç«¯åªä¼šä» epoll_wait ä¸­è‹é†’ä¸€æ¬¡ï¼Œå³ä½¿è¿›ç¨‹æ²¡æœ‰è°ƒç”¨read å‡½æ•°ä»å†…æ ¸è¯»å–æ•°æ®ï¼Œä¹Ÿä¾ç„¶åªè‹é†’ä¸€æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬ç¨‹åºè¦ä¿è¯æ¬¡æ€§å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®è¯»å–å®Œ; æ°´å¹³è§¦å‘ï¼ˆLTï¼‰ï¼šä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¸æ–­åœ°ä» epoll_wait ä¸­è‹é†’ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ•°æ®è¢« read å‡½æ•°è¯»å®Œæ‰ç»“æŸï¼Œç›®çš„æ˜¯å‘Šè¯‰æˆ‘ä»¬æœ‰æ•°æ®éœ€è¦è¯»å–; æ°´å¹³è§¦å‘ï¼ˆLTï¼‰ï¼šé»˜è®¤æ¨¡å¼ï¼Œåªè¦fdä¸Šæœ‰æ•°æ®æœªå¤„ç†å®Œï¼Œå°±ä¼šæŒç»­é€šçŸ¥ã€‚ è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰ï¼šä»…åœ¨fdçŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ä¸€æ¬¡ï¼Œå¯å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œè¿›ä¸€æ­¥æå‡æ•ˆç‡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä½ çš„å¿«é€’è¢«æ”¾åˆ°äº†ä¸€ä¸ªå¿«é€’ç®±é‡Œï¼Œå¦‚æœå¿«é€’ç®±åªä¼šé€šè¿‡çŸ­ä¿¡é€šçŸ¥ä½ ä¸€æ¬¡ï¼Œå³ä½¿ä½ ä¸€ç›´æ²¡æœ‰å»å–ï¼Œå®ƒä¹Ÿä¸ä¼šå†å‘é€ç¬¬äºŒæ¡çŸ­ä¿¡æé†’ä½ ï¼Œè¿™ä¸ªæ–¹å¼å°±æ˜¯è¾¹ç¼˜è§¦å‘;å¦‚æœå¿«é€’ç®±å‘ç°ä½ çš„å¿«é€’æ²¡æœ‰è¢«å–å‡ºå®ƒå°±ä¼šä¸åœåœ°å‘çŸ­ä¿¡é€šçŸ¥ä½ ï¼Œç›´åˆ°ä½ å–å‡ºäº†å¿«é€’ï¼Œå®ƒæ‰æ¶ˆåœï¼Œè¿™ä¸ªå°±æ˜¯æ°´å¹³è§¦å‘çš„æ–¹å¼ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè¾¹ç¼˜è§¦å‘çš„æ•ˆç‡æ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡è¦é«˜ï¼Œ å› ä¸ºè¾¹ç¼˜è§¦å‘å¯ä»¥å‡å°‘ epoll_wait çš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œ ç³»ç»Ÿè°ƒç”¨ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„å¼€é”€çš„çš„ï¼Œæ¯•ç«Ÿä¹Ÿå­˜åœ¨ä¸Šä¸‹æ–‡çš„åˆ‡æ¢","categories":[],"tags":[]},{"title":"è®¡ç®—æœºç½‘ç»œ","slug":"å…«è‚¡/è®¡ç®—æœºç½‘ç»œ","date":"2024-10-28T12:30:41.000Z","updated":"2025-03-15T03:20:33.572Z","comments":true,"path":"2024/10/28/å…«è‚¡/è®¡ç®—æœºç½‘ç»œ/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","excerpt":"è¿™é‡Œæ˜¯è®¡ç®—æœºç½‘ç»œçš„ä¸€äº›å…«è‚¡","text":"è¿™é‡Œæ˜¯è®¡ç®—æœºç½‘ç»œçš„ä¸€äº›å…«è‚¡ è®¡ç®—æœºç½‘è·¯å±‚æ¬¡ç»“æ„ OSIå‚è€ƒæ¨¡å‹ åº”ç”¨å±‚ï¼Œè´Ÿè´£ç»™åº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„æ¥å£; è¡¨ç¤ºå±‚ï¼Œè´Ÿè´£æŠŠæ•°æ®è½¬æ¢æˆå…¼å®¹å¦ä¸€ä¸ªç³»ç»Ÿèƒ½è¯†åˆ«çš„æ ¼å¼ ä¼šè¯å±‚ï¼Œè´Ÿè´£å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢è¡¨ç¤ºå±‚å®ä½“ä¹‹é—´çš„é€šä¿¡ä¼šè¯ï¼Œ ä¼ è¾“å±‚ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ ç½‘ç»œå±‚ï¼Œè´Ÿè´£æ•°æ®çš„è·¯ç”±ã€è½¬å‘ã€åˆ†ç‰‡; æ•°æ®é“¾è·¯å±‚ï¼Œè´Ÿè´£æ•°æ®çš„å°å¸§å’Œå·®é”™æ£€æµ‹ï¼Œä»¥åŠ MAC å¯»å€; ç‰©ç†å±‚ï¼Œè´Ÿè´£åœ¨ç‰©ç†ç½‘ç»œä¸­ä¼ è¾“æ•°æ®å¸§; TCP&#x2F;IPæ¨¡å‹ åº”ç”¨å±‚ ä¸»è¦æä¾›ä¸¤ä¸ªç»ˆç«¯è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºä¹‹é—´ä¿¡æ¯äº¤æ¢çš„æœåŠ¡ï¼Œå®ƒå®šä¹‰äº†ä¿¡æ¯äº¤æ¢çš„æ ¼å¼ï¼Œæ¶ˆæ¯ä¼šäº¤ç»™ä¸‹ä¸€å±‚ä¼ è¾“å±‚æ¥ä¼ è¾“ åè®®ï¼šHTTP ã€DNS ã€SMTP ã€FTP ä¼ è¾“å±‚ å¤„ç†ä¸»æœºåˆ°ä¸»æœºçš„é€šä¿¡ åè®®ï¼šTCPã€UDP ç½‘ç»œå±‚ å¯»å€å’Œè·¯ç”±æ•°æ®åŒ…(IP åè®®)â€”â€”ï¼ˆè½¬å‘ä¸è·¯ç”± ï¼‰ åè®®ï¼šIPã€ARPã€ICMP ã€NATã€OSPFã€RIPã€BGP é“¾è·¯å±‚ é€šè¿‡ç½‘ç»œçš„ç‰©ç†ç”µçº¿ã€ç”µç¼†æˆ–æ— çº¿ä¿¡é“ç§»åŠ¨æ¯”ç‰¹ ä¸€ã€HTTPHTTPã€HTTPSã€DNSã€FTP(æ–‡ä»¶ä¼ è¾“åè®® ) éƒ½æ˜¯åº”ç”¨å±‚åè®® http æ˜¯ 80ï¼Œhttps é»˜è®¤æ˜¯ 443ã€‚ DNSé»˜è®¤ç«¯å£å·ï¼š53 1.HTTPå¸¸ç”¨çš„çŠ¶æ€ç  1xx ç±»çŠ¶æ€ç å±äºæç¤ºä¿¡æ¯ï¼Œæ˜¯åè®®å¤„ç†ä¸­çš„ä¸€ç§ä¸­é—´çŠ¶æ€ï¼Œå®é™…ç”¨åˆ°çš„æ¯”è¾ƒå°‘ã€‚ 2xx ç±»çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨æˆåŠŸå¤„ç†äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€æ„¿æ„çœ‹åˆ°çš„çŠ¶æ€ã€‚ 3xx ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå‘ç”Ÿäº†å˜åŠ¨ï¼Œéœ€è¦å®¢æˆ·ç«¯ç”¨æ–°çš„ URL é‡æ–°å‘é€è¯·æ±‚è·å–èµ„æºï¼Œä¹Ÿå°±æ˜¯é‡å®šå‘ã€‚ ã€Œ301 Moved Permanentlyã€è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œè¯´æ˜è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨äº†ï¼Œéœ€æ”¹ç”¨æ–°çš„ URLå†æ¬¡è®¿é—®ã€‚ ã€Œ302 Foundã€è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œè¯´æ˜è¯·æ±‚çš„èµ„æºè¿˜åœ¨ï¼Œä½†æš‚æ—¶éœ€è¦ç”¨å¦ä¸€ä¸ª URL æ¥è®¿é—®ã€‚ 4xx ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„æŠ¥æ–‡æœ‰è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œä¹Ÿå°±æ˜¯é”™è¯¯ç çš„å«ä¹‰ã€‚ 400 Bad Requestï¼šå‘é€çš„ HTTP è¯·æ±‚å­˜åœ¨é—®é¢˜ã€‚æ¯”å¦‚è¯·æ±‚å‚æ•°ä¸åˆæ³•ã€è¯·æ±‚æ–¹æ³•é”™è¯¯ã€‚ 404 Not Foundï¼šä½ è¯·æ±‚çš„èµ„æºæœªåœ¨æœåŠ¡ç«¯æ‰¾åˆ°ã€‚æ¯”å¦‚ä½ è¯·æ±‚æŸä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯å¹¶æ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„ç”¨æˆ·ã€‚ 5xx ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡æ­£ç¡®ï¼Œä½†æ˜¯æœåŠ¡å™¨å¤„ç†æ—¶å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯ï¼Œå±äºæœåŠ¡å™¨ç«¯çš„é”™è¯¯ç ã€‚ 500ï¼ˆInternal Server Errorï¼‰è¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œé€šå¸¸ç”±æœåŠ¡å™¨ç«¯ä»£ç é—®é¢˜å¼•èµ·ã€‚ [502 Bad Gatewayã€è¡¨ç¤ºç½‘å…³æˆ–ä»£ç†æœåŠ¡å™¨ä»ä¸Šæ¸¸æœåŠ¡å™¨(æœåŠ¡ç«¯)æ”¶åˆ°äº†æ— æ•ˆå“åº”ï¼Œé€šå¸¸ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é—®é¢˜æœ‰å…³ã€‚ 504 Gateway Time-out:è¡¨ç¤ºç½‘å…³æˆ–ä»£ç†æœåŠ¡å™¨åœ¨ç­‰å¾…ä¸Šæ¸¸æœåŠ¡å™¨çš„å“åº”æ—¶è¶…æ—¶ï¼Œé€šå¸¸æ˜¯ç”±äºä¸Šæ¸¸æœåŠ¡å™¨å¤„ç†æ—¶é—´è¿‡é•¿æˆ–æ— æ³•è®¿é—®ã€‚ ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ nginx æ˜¯ä»£ç†æœåŠ¡å™¨ï¼Œæ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œå°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨(tomcat ç­‰)ã€‚ å½“nginxæ”¶åˆ°äº†æ— æ•ˆçš„å“åº”æ—¶ï¼Œå°±è¿”å›502ã€‚ å½“nginxè¶…è¿‡è‡ªå·±é…ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå°±è¿”å›504é”™è¯¯ã€‚ 2.HTTPå¤´éƒ¨å¸¸è§å­—æ®µHTTPæŠ¥æ–‡ç»„æˆå¦‚ä¸‹ï¼š è¯·æ±‚æŠ¥æ–‡ å“åº”æŠ¥æ–‡ è¯·æ±‚è¡Œ çŠ¶æ€è¡Œ è¯·æ±‚å¤´éƒ¨ å“åº”å¤´éƒ¨ ç©ºè¡Œ ç©ºè¡Œ è¯·æ±‚ä½“ å“åº”ä½“ å…¶ä¸­å¤´éƒ¨å­—æ®µä¸»è¦æœ‰ï¼› Host å­—æ®µ ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œç”¨æ¥æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåã€‚ Host: www.A.comã€‚æœ‰äº† Host å­—æ®µï¼Œå°±å¯ä»¥å°†è¯·æ±‚å‘å¾€ã€ŒåŒä¸€å°ã€æœåŠ¡å™¨ä¸Šçš„ä¸åŒç½‘ç«™ã€‚ Content-Length å­—æ®µ ï¼šæœåŠ¡å™¨åœ¨è¿”å›æ•°æ®æ—¶ï¼Œä¼šæœ‰ Content-Length å­—æ®µï¼Œè¡¨æ˜æœ¬æ¬¡å›åº”çš„æ•°æ®é•¿åº¦ã€‚ HTTP æ˜¯åŸºäº TCP ä¼ è¾“åè®®è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œä½¿ç”¨äº† TCP ä¼ è¾“åè®®ï¼Œ å°±ä¼šå­˜åœ¨ä¸€ä¸ªâ€œç²˜åŒ…â€çš„é—®é¢˜ï¼ŒHTTP åè®®é€šè¿‡è®¾ç½®å›è½¦ç¬¦ã€ æ¢è¡Œç¬¦ä½œä¸º HTTP header çš„è¾¹ç•Œï¼Œé€šè¿‡ Content-Length å­—æ®µä½œä¸º HTTP body çš„è¾¹ç•Œï¼Œè¿™ä¸¤ä¸ªæ–¹å¼éƒ½æ˜¯ä¸ºäº†è§£å†³â€œç²˜åŒ…â€çš„é—®é¢˜ã€‚ Connection å­—æ®µ ï¼šConnection å­—æ®µæœ€å¸¸ç”¨äºå®¢æˆ·ç«¯è¦æ±‚æœåŠ¡å™¨ä½¿ç”¨ã€ŒHTTP é•¿è¿æ¥ã€æœºåˆ¶ï¼Œä»¥ä¾¿å…¶ä»–è¯·æ±‚å¤ç”¨ï¼ŒConnection: Keep-Aliveã€‚ HTTP é•¿è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚ Content-Type å­—æ®µ ï¼šContent-Type å­—æ®µç”¨äºæœåŠ¡å™¨å›åº”æ—¶ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæœ¬æ¬¡æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼ã€‚ å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ Accept å­—æ®µå£°æ˜è‡ªå·±å¯ä»¥æ¥å—å“ªäº›æ•°æ®æ ¼å¼ã€‚ Content-Encoding å­—æ®µ ï¼šContent-Encoding å­—æ®µè¯´æ˜æ•°æ®çš„å‹ç¼©æ–¹æ³•ã€‚è¡¨ç¤ºæœåŠ¡å™¨è¿”å›çš„æ•°æ®ä½¿ç”¨äº†ä»€ä¹ˆå‹ç¼©æ ¼å¼ã€‚å®¢æˆ·ç«¯åœ¨è¯·æ±‚æ—¶ï¼Œç”¨ Accept-Encoding å­—æ®µè¯´æ˜è‡ªå·±å¯ä»¥æ¥å—å“ªäº›å‹ç¼©æ–¹æ³•ã€‚ 3.HTTPå’ŒHTTPSçš„åŒºåˆ«â­åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹äº”ç‚¹: å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—ï¼š HTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå­˜åœ¨å®‰å…¨é£é™©çš„é—®é¢˜ã€‚HTTPS æ˜¯è¿è¡Œåœ¨ SSL&#x2F;TLS ä¹‹ä¸Šçš„ HTTP åè®®ï¼ŒSSL&#x2F;TLS è¿è¡Œåœ¨ TCP ä¹‹ä¸Šã€‚æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚ æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPS é«˜ï¼Œä½†æ˜¯ HTTPS æ¯” HTTP è€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚ è¿æ¥è¿‡ç¨‹ï¼šHTTP è¿æ¥å»ºç«‹ç›¸å¯¹ç®€å•ï¼Œ TCP ä¸‰æ¬¡æ¡æ‰‹ä¹‹åä¾¿å¯è¿›è¡Œ HTTP çš„æŠ¥æ–‡ä¼ è¾“ã€‚è€Œ HTTPS åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œè¿˜éœ€è¿›è¡Œ SSL&#x2F;TLS çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œæ‰å¯è¿›å…¥åŠ å¯†æŠ¥æ–‡ä¼ è¾“ã€‚ ç«¯å£å·ï¼ŒHTTP é»˜è®¤ç«¯å£å·æ˜¯ 80ï¼ŒHTTPS é»˜è®¤ç«¯å£å·æ˜¯ 443ã€‚ SEOï¼ˆæœç´¢å¼•æ“ä¼˜åŒ–ï¼‰ï¼šæœç´¢å¼•æ“é€šå¸¸ä¼šæ›´é’çä½¿ç”¨ HTTPS åè®®çš„ç½‘ç«™ï¼Œå› ä¸º HTTPS èƒ½å¤Ÿæä¾›æ›´é«˜çš„ å®‰å…¨æ€§å’Œç”¨æˆ·éšç§ä¿æŠ¤ã€‚ä½¿ç”¨ HTTPS åè®®çš„ç½‘ç«™åœ¨æœç´¢ç»“æœä¸­å¯èƒ½ä¼šè¢«ä¼˜å…ˆæ˜¾ç¤ºï¼Œä»è€Œå¯¹ SEO äº§ç”Ÿå½±å“ã€‚ 4. 1.0å’Œ1.1çš„åŒºåˆ«ä¸»è¦æ˜¯å‰ä¸‰ä¸ª è¿æ¥æ–¹å¼ : HTTP&#x2F;1.0 é»˜è®¤æƒ…å†µä¸‹ä¸ºçŸ­è¿æ¥ï¼ŒHTTP&#x2F;1.1 æ”¯æŒé•¿è¿æ¥ã€‚HTTP åè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯ TCP åè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚ ç®¡é“åŒ–ï¼ˆPipeliningï¼‰ï¼š HTTP&#x2F;1.0ï¼šä¸æ”¯æŒç®¡é“åŒ–ï¼Œå®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚çš„å“åº”åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ HTTP&#x2F;1.1ï¼šæ”¯æŒç®¡é“åŒ–ï¼Œå…è®¸å®¢æˆ·ç«¯å‘é€å¤šä¸ªè¯·æ±‚è€Œä¸å¿…ç­‰å¾…æ¯ä¸ªå“åº”ï¼Œè¿™å¯ä»¥è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚ 1.1å…è®¸è¯·æ±‚éƒ¨åˆ†èµ„æºï¼šHTTP&#x2F;1.0 ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP&#x2F;1.1 åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº† range å¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚ èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯ 206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨ å¸¦å®½å’Œè¿æ¥ã€‚ çŠ¶æ€å“åº”ç  : HTTP&#x2F;1.1 å¼•å…¥äº†æ›´å¤šçš„çŠ¶æ€ç å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæä¾›äº†æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚ Host å¤´ï¼ˆHost Headerï¼‰å¤„ç† :HTTP&#x2F;1.1 å¼•å…¥äº† Host å¤´å­—æ®µï¼Œå…è®¸åœ¨åŒä¸€ IP åœ°å€ä¸Šæ‰˜ç®¡å¤šä¸ªåŸŸåï¼Œ ä»è€Œæ”¯æŒè™šæ‹Ÿä¸»æœºçš„åŠŸèƒ½ã€‚è€Œ HTTP&#x2F;1.0 æ²¡æœ‰ Host å¤´å­—æ®µï¼Œæ— æ³•å®ç°è™šæ‹Ÿä¸»æœºã€‚ 5. 1.1å’Œ2.0çš„åŒºåˆ« å¤´éƒ¨å‹ç¼©ï¼ˆHeader Compressionï¼‰ï¼š HTTP&#x2F;2 ä¼šå‹ç¼©å¤´ï¼ˆHeaderï¼‰å¦‚æœä½ åŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œ ä»–ä»¬çš„å¤´æ˜¯ä¸€æ ·çš„æˆ–æ˜¯ç›¸ä¼¼çš„ï¼Œé‚£ä¹ˆï¼Œåè®®ä¼šå¸®ä½ æ¶ˆé™¤é‡å¤çš„éƒ¨åˆ†ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„ HPACK ç®—æ³•ï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œ æ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±æé«˜é€Ÿåº¦äº†ã€‚ å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰ï¼šHTTP&#x2F;1.1æ¯ä¸ªè¯·æ±‚å’Œå“åº”éœ€è¦ç‹¬ç«‹çš„ TCP è¿æ¥ï¼Œæˆ–è€…é€šè¿‡ Keep-Alive åœ¨åŒä¸€è¿æ¥ä¸Šä¸²è¡Œå¤„ç†è¯·æ±‚ã€‚ç”±äºæ˜¯ä¸²è¡Œä¼ è¾“ï¼Œå­˜åœ¨â€œé˜Ÿå¤´é˜»å¡â€é—®é¢˜ï¼Œå³ä¸€ä¸ªè¯·æ±‚çš„å»¶è¿Ÿä¼šé˜»å¡åç»­è¯·æ±‚ã€‚HTTP&#x2F;2.0æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œå…è®¸åœ¨å•ä¸ª TCP è¿æ¥ä¸Šå¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚æ¶ˆæ¯è¢«åˆ†è§£ä¸ºç‹¬ç«‹çš„å¸§ï¼Œäº¤é”™ä¼ è¾“å¹¶åœ¨å¦ä¸€ç«¯é‡æ–°ç»„è£…ï¼Œæœ‰æ•ˆæ¶ˆé™¤äº†é˜Ÿå¤´é˜»å¡ã€‚ äºŒè¿›åˆ¶å¸§ï¼ˆBinary Framesï¼‰ï¼šHTTP&#x2F;2.0 ä½¿ç”¨äºŒè¿›åˆ¶å¸§è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè€Œ HTTP&#x2F;1.1 åˆ™ä½¿ç”¨æ–‡æœ¬æ ¼å¼çš„æŠ¥æ–‡ã€‚äºŒè¿›åˆ¶å¸§æ›´åŠ ç´§å‡‘å’Œé«˜æ•ˆï¼Œå‡å°‘äº†ä¼ è¾“çš„æ•°æ®é‡å’Œå¸¦å®½æ¶ˆè€—ã€‚ æœåŠ¡å™¨æ¨é€ï¼ˆServer Pushï¼‰ï¼šHTTP&#x2F;2.0 æ”¯æŒæœåŠ¡å™¨æ¨é€ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€èµ„æºï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯æ˜ç¡®è¯·æ±‚ã€‚ 6.2.0å’Œ3.0çš„åŒºåˆ«å‰é¢æˆ‘ä»¬çŸ¥é“äº† HTTP&#x2F;1.1 å’Œ HTTP&#x2F;2 éƒ½æœ‰é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼š HTTP&#x2F;1.1 ä¸­çš„ç®¡é“ï¼ˆ pipelineï¼‰è™½ç„¶è§£å†³äº†è¯·æ±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œ ä½†æ˜¯æ²¡æœ‰è§£å†³å“åº”çš„é˜Ÿå¤´é˜»å¡ï¼Œå› ä¸ºæœåŠ¡ç«¯éœ€è¦æŒ‰é¡ºåºå“åº”æ”¶åˆ°çš„è¯·æ±‚ï¼Œå¦‚æœæœåŠ¡ç«¯å¤„ç†æŸä¸ªè¯·æ±‚æ¶ˆè€—çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œ é‚£ä¹ˆåªèƒ½ç­‰å“åº”å®Œè¿™ä¸ªè¯·æ±‚åï¼Œ æ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œ è¿™å±äº HTTP å±‚é˜Ÿå¤´é˜»å¡ã€‚ HTTP&#x2F;2 è™½ç„¶é€šè¿‡å¤šä¸ªè¯·æ±‚å¤ç”¨ä¸€ä¸ª TCP è¿æ¥è§£å†³äº† HTTP çš„é˜Ÿå¤´é˜»å¡ ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿä¸¢åŒ…ï¼Œå°±ä¼šé˜»å¡ä½æ‰€æœ‰çš„ HTTP è¯·æ±‚ï¼Œè¿™å±äº TCP å±‚é˜Ÿå¤´é˜»å¡ã€‚ HTTP&#x2F;2 é˜Ÿå¤´é˜»å¡çš„é—®é¢˜æ˜¯å› ä¸º TCPï¼Œæ‰€ä»¥ HTTP&#x2F;3 æŠŠ HTTP ä¸‹å±‚çš„ TCP åè®®æ”¹æˆäº† UDP ä¼ è¾“åè®®ï¼šHTTP&#x2F;2.0 æ˜¯åŸºäº TCP åè®®å®ç°çš„ï¼ŒHTTP&#x2F;3.0 æ–°å¢äº† QUICï¼ˆQuick UDP Internet Connectionsï¼‰ åè®®æ¥å®ç°å¯é çš„ä¼ è¾“ï¼Œæä¾›ä¸ TLS&#x2F;SSL ç›¸å½“çš„å®‰å…¨æ€§ï¼Œå…·æœ‰è¾ƒä½çš„è¿æ¥å’Œä¼ è¾“å»¶è¿Ÿã€‚ ä½ å¯ä»¥å°† QUIC çœ‹ä½œæ˜¯ UDP çš„å‡çº§ç‰ˆæœ¬ï¼Œåœ¨å…¶åŸºç¡€ä¸Šæ–°å¢äº†å¾ˆå¤šåŠŸèƒ½æ¯”å¦‚åŠ å¯†ã€é‡ä¼ ç­‰ç­‰ã€‚ é˜Ÿå¤´é˜»å¡ï¼šè™½ç„¶æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œä½†åœ¨ TCP å±‚é¢ä»å­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚TCP è¦æ±‚æ•°æ®åŒ…æŒ‰åºåˆ°è¾¾ï¼Œè‹¥ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œæ•´ä¸ªè¿æ¥çš„ä¼ è¾“ä¼šæš‚åœï¼Œç­‰å¾…é‡ä¼ ã€‚è€ŒåŸºäºQUICåè®®çš„3.0ä¸€ä¸ªè¿æ¥å»ºç«‹å¤šä¸ªä¸åŒçš„æ•°æ®æµï¼Œè¿™äº›æ•°æ®æµä¹‹é—´ç‹¬ç«‹äº’ä¸å½±å“ï¼ŒæŸä¸ªæ•°æ®æµå‘ç”Ÿä¸¢åŒ…äº†ï¼Œå…¶æ•°æ®æµä¸å—å½±å“ æ›´å¿«çš„è¿æ¥å»ºç«‹ï¼šHTTP&#x2F;2.0 éœ€è¦ç»è¿‡ç»å…¸çš„ TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼ˆç”±äºå®‰å…¨çš„ HTTPS è¿æ¥å»ºç«‹è¿˜éœ€è¦ TLS æ¡æ‰‹ï¼Œå…±éœ€è¦å¤§çº¦ 3 ä¸ª RTTï¼‰ã€‚ ç”±äº QUIC åè®®çš„ç‰¹æ€§ï¼ˆTLS 1.3ï¼ŒTLS 1.3 é™¤äº†æ”¯æŒ 1 ä¸ª RTT çš„æ¡æ‰‹ï¼Œè¿˜æ”¯æŒ 0 ä¸ª RTT çš„æ¡æ‰‹ï¼‰è¿æ¥å»ºç«‹ä»…éœ€ 0-RTT æˆ–è€… 1-RTTã€‚ è¿™æ„å‘³ç€ QUIC åœ¨æœ€ä½³æƒ…å†µä¸‹ä¸éœ€è¦ä»»ä½•çš„é¢å¤–å¾€è¿”æ—¶é—´å°±å¯ä»¥å»ºç«‹æ–°è¿æ¥ã€‚ è¿æ¥è¿ç§»ï¼šåŸºäº TCP ä¼ è¾“åè®®çš„ HTTP åè®®ï¼Œç”±äºæ˜¯é€šè¿‡å››å…ƒç»„ï¼ˆæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ï¼‰ç¡®å®šä¸€æ¡ TCP è¿æ¥ã€‚ è¿™ä¸ªå››å…ƒç»„ä¸­ä¸€æ—¦æœ‰ä¸€é¡¹å€¼å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªè¿æ¥ä¹Ÿå°±ä¸èƒ½ç”¨äº†ã€‚ è€Œ QUIC åè®®æ²¡æœ‰ç”¨å››å…ƒç»„çš„æ–¹å¼æ¥â€œç»‘å®šâ€è¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡è¿æ¥ ID æ¥æ ‡è®°é€šä¿¡çš„ä¸¤ä¸ªç«¯ç‚¹ï¼Œåªè¦ ID ä¸å˜å°±ä¸ä¼šä¸­æ–­ï¼Œç½‘ç»œç¯å¢ƒæ”¹å˜æ—¶ï¼ˆå¦‚ä» Wi-Fi åˆ‡æ¢åˆ°ç§»åŠ¨æ•°æ®ï¼‰ä¹Ÿèƒ½ä¿æŒè¿æ¥ã€‚ 7.HTTPå¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼ŸHTTP æ˜¯æ— çŠ¶æ€çš„åè®®ï¼ˆå¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼šè¯å®Œæˆæ—¶ï¼ŒæœåŠ¡ç«¯ä¸ä¼šä¿å­˜ä»»ä½•ä¼šè¯ä¿¡æ¯ï¼‰ï¼šæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼ŒæœåŠ¡ç«¯æ— æ³•ç¡®è®¤å½“å‰è®¿é—®è€…çš„èº«ä»½ä¿¡æ¯ï¼Œæ— æ³•åˆ†è¾¨ä¸Šä¸€æ¬¡çš„è¯·æ±‚å‘é€è€…å’Œè¿™ä¸€æ¬¡çš„å‘é€è€…æ˜¯ä¸æ˜¯åŒä¸€ä¸ªäººã€‚æ‰€ä»¥æœåŠ¡å™¨ä¸æµè§ˆå™¨ä¸ºäº†è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼ˆçŸ¥é“æ˜¯è°åœ¨è®¿é—®æˆ‘ï¼‰ï¼Œå°±å¿…é¡»ä¸»åŠ¨çš„å»ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯å‰åä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚è€Œè¿™ä¸ªçŠ¶æ€éœ€è¦é€šè¿‡ cookie æˆ–è€… session å»å®ç°ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€å‘¢ï¼ŸSession æœºåˆ¶çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSession çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ã€‚ Session å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç° Session è·Ÿè¸ªå‘¢ï¼Ÿå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡åœ¨ Cookie ä¸­é™„åŠ ä¸€ä¸ª Session ID æ¥æ–¹å¼æ¥è·Ÿè¸ªã€‚ Cookie è¢«ç¦ç”¨æ€ä¹ˆåŠ? æœ€å¸¸ç”¨çš„å°±æ˜¯åˆ©ç”¨ URL é‡å†™æŠŠ Session ID ç›´æ¥é™„åŠ åœ¨ URL è·¯å¾„çš„åé¢ã€‚ 8.URIå’ŒURLçš„åŒºåˆ« URI(Uniform Resource Identifier) æ˜¯ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚ URL(Uniform Resource Locator) æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œå¯ä»¥æä¾›è¯¥èµ„æºçš„è·¯å¾„ã€‚ URI çš„ä½œç”¨åƒèº«ä»½è¯å·ä¸€æ ·ï¼ŒURL çš„ä½œç”¨æ›´åƒå®¶åº­ä½å€ä¸€æ ·ã€‚URL æ˜¯ä¸€ç§å…·ä½“çš„ URIï¼Œå®ƒä¸ä»…å”¯ä¸€æ ‡è¯†èµ„æºï¼Œè€Œä¸”è¿˜æä¾›äº†å®šä½è¯¥èµ„æºçš„ä¿¡æ¯ 9.GETå’ŒPOSTçš„åŒºåˆ«â­ è¯­ä¹‰ï¼ˆä¸»è¦åŒºåˆ«ï¼‰ï¼šGET é€šå¸¸ç”¨äºè·å–æˆ–æŸ¥è¯¢èµ„æºï¼Œè€Œ POST é€šå¸¸ç”¨äºåˆ›å»ºæˆ–ä¿®æ”¹èµ„æºã€‚ å¹‚ç­‰ï¼šGET è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œå³å¤šæ¬¡é‡å¤æ‰§è¡Œä¸ä¼šæ”¹å˜èµ„æºçš„çŠ¶æ€ï¼Œè€Œ POST è¯·æ±‚æ˜¯ä¸å¹‚ç­‰çš„ï¼Œå³æ¯æ¬¡æ‰§è¡Œå¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœæˆ–å½±å“èµ„æºçš„çŠ¶æ€ã€‚ æ ¼å¼ï¼šGET è¯·æ±‚çš„å‚æ•°é€šå¸¸æ”¾åœ¨ URL ä¸­ï¼Œå½¢æˆæŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquerystringï¼‰ï¼Œè€Œ POST è¯·æ±‚çš„å‚æ•°é€šå¸¸æ”¾åœ¨è¯·æ±‚ä½“ï¼ˆbodyï¼‰ä¸­ï¼Œå¯ä»¥æœ‰å¤šç§ç¼–ç æ ¼å¼ï¼Œå¦‚ application&#x2F;x-www-form-urlencodedã€multipart&#x2F;form-dataã€application&#x2F;json ç­‰ã€‚GET è¯·æ±‚çš„ URL é•¿åº¦å—åˆ°æµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„é™åˆ¶ï¼Œè€Œ POST è¯·æ±‚çš„ body å¤§å°åˆ™æ²¡æœ‰æ˜ç¡®çš„é™åˆ¶ã€‚ä¸è¿‡ï¼Œå®é™…ä¸Š GET è¯·æ±‚ä¹Ÿå¯ä»¥ç”¨ body ä¼ è¾“æ•°æ®ï¼Œåªæ˜¯å¹¶ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å…¼å®¹æ€§æˆ–è€…è¯­ä¹‰ä¸Šçš„é—®é¢˜ã€‚ ç¼“å­˜ï¼šç”±äº GET è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œå®ƒå¯ä»¥è¢«æµè§ˆå™¨æˆ–å…¶ä»–ä¸­é—´èŠ‚ç‚¹ï¼ˆå¦‚ä»£ç†ã€ç½‘å…³ï¼‰ç¼“å­˜èµ·æ¥ï¼Œä»¥æé«˜æ€§èƒ½å’Œæ•ˆç‡ã€‚è€Œ POST è¯·æ±‚åˆ™ä¸é€‚åˆè¢«ç¼“å­˜ï¼Œå› ä¸ºå®ƒå¯èƒ½æœ‰å‰¯ä½œç”¨ï¼Œæ¯æ¬¡æ‰§è¡Œå¯èƒ½éœ€è¦å®æ—¶çš„å“åº”ã€‚ å®‰å…¨æ€§ï¼šGET è¯·æ±‚å’Œ POST è¯·æ±‚å¦‚æœä½¿ç”¨ HTTP åè®®çš„è¯ï¼Œé‚£éƒ½ä¸å®‰å…¨ï¼Œå› ä¸º HTTP åè®®æœ¬èº«æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œå¿…é¡»ä½¿ç”¨ HTTPS åè®®æ¥åŠ å¯†ä¼ è¾“æ•°æ®ã€‚å¦å¤–ï¼ŒGET è¯·æ±‚ç›¸æ¯” POST è¯·æ±‚æ›´å®¹æ˜“æ³„éœ²æ•æ„Ÿæ•°æ®ï¼Œå› ä¸º GET è¯·æ±‚çš„å‚æ•°é€šå¸¸æ”¾åœ¨ URL ä¸­ã€‚ 10ã€é”®å…¥ç½‘å€åˆ°æµè§ˆå™¨æ˜¾ç¤ºæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿâ­åœ¨ç‰›å®¢çœ‹åˆ°ä¸€ä¸ªç®€ç­”ï¼š é¦–å…ˆæ ¹æ®dnsåè®®è§£æurlè·å–æœåŠ¡å™¨çš„ipï¼Œç„¶åå¯¹æœåŠ¡å™¨è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹tcpé“¾æ¥ï¼Œç„¶åå®¢æˆ·ç«¯è¿™è¾¹ä¼šå‘èµ·httpè¯·æ±‚æ¥è·å–èµ„æºï¼Œç„¶åæœåŠ¡ç«¯ä¼šå“åº”è¯·æ±‚ï¼Œä¼šè¿”å›èµ„æºï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°èµ„æºåå¯¹å‰ç«¯è¿›è¡Œæ¸²æŸ“åï¼Œæ‰§è¡Œtcpå››æ¬¡æŒ¥æ‰‹æ–­å¼€é“¾æ¥ DNS è§£æï¼š æµè§ˆå™¨é€šè¿‡ DNS åè®®ï¼Œè·å–åŸŸåå¯¹åº”çš„ IP åœ°å€ã€‚ TCP è¿æ¥ï¼š æµè§ˆå™¨æ ¹æ® IP å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª TCP è¿æ¥è¯·æ±‚ã€‚è¿™ä¸€æ­¥æ¶‰åŠåˆ° TCP çš„ä¸‰æ¬¡æ¡æ‰‹ å‘é€ HTTP è¯·æ±‚ï¼š æµè§ˆå™¨åœ¨ TCP è¿æ¥ä¸Šï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚è·å–ç½‘é¡µçš„å†…å®¹ã€‚ æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼š æœåŠ¡å™¨æ”¶åˆ° HTTP è¯·æ±‚æŠ¥æ–‡åï¼Œå¤„ç†è¯·æ±‚ï¼Œå¹¶è¿”å› HTTP å“åº”æŠ¥æ–‡ç»™æµè§ˆå™¨ã€‚ æµè§ˆå™¨æ¥æ”¶ HTTP å“åº”ï¼š æµè§ˆå™¨æ”¶åˆ° HTTP å“åº”æŠ¥æ–‡åï¼Œè§£æå“åº”ä½“ä¸­çš„ HTML ä»£ç ï¼Œæ¸²æŸ“ç½‘é¡µçš„ç»“æ„å’Œæ ·å¼ï¼ŒåŒæ—¶æ ¹æ® HTML ä¸­çš„å…¶ä»–èµ„æºçš„ URLï¼ˆå¦‚å›¾ç‰‡ã€CSSã€JS ç­‰ï¼‰ï¼Œå†æ¬¡å‘èµ· HTTP è¯·æ±‚ï¼Œè·å–è¿™äº›èµ„æºçš„å†…å®¹ï¼Œç›´åˆ°ç½‘é¡µå®Œå…¨åŠ è½½æ˜¾ç¤ºã€‚ æ–­å¼€è¿æ¥ï¼šTCP å››æ¬¡æŒ¥æ‰‹ï¼Œè¿æ¥ç»“æŸã€‚ è§£æURLï¼šç¡®å®šè¦è®¿é—®Web æœåŠ¡å™¨å’Œæ–‡ä»¶å DNSè§£æï¼šæŸ¥è¯¢æœåŠ¡å™¨åŸŸåå¯¹åº”çš„ IP åœ°å€ï¼ˆè¿™é‡Œå¯ä»¥æœ‰ä¸ªé—®é¢˜ï¼šåŸŸåè§£æçš„å·¥ä½œæµç¨‹ï¼‰ è·å–MACåœ°å€ï¼šå½“æµè§ˆå™¨å¾—åˆ° IP åœ°å€åï¼Œæ•°æ®ä¼ è¾“è¿˜éœ€è¦çŸ¥é“ç›®çš„ä¸»æœº MAC åœ°å€ï¼Œï¼ˆä¼ è¾“å±‚TCPï¼‰å› ä¸ºåº”ç”¨å±‚ä¸‹å‘æ•°æ®ç»™ä¼ è¾“å±‚ï¼ŒTCP åè®®ä¼šæŒ‡å®šæºç«¯å£å·å’Œç›®çš„ç«¯å£å·ï¼Œç„¶åä¸‹å‘ç»™ç½‘ç»œå±‚ã€‚ï¼ˆç½‘ç»œå±‚IPï¼‰ç½‘ç»œå±‚ä¼šå°†æœ¬æœºåœ°å€ä½œä¸ºæºåœ°å€ï¼Œè·å–çš„IP åœ°å€ä½œä¸ºç›®çš„åœ°å€ã€‚ç„¶åå°†ä¸‹å‘ç»™æ•°æ®é“¾è·¯å±‚ï¼Œæ•°æ®é“¾è·¯å±‚çš„å‘é€éœ€è¦åŠ å…¥é€šä¿¡åŒæ–¹çš„ MAC åœ°å€ï¼Œæœ¬æœºçš„ MAC åœ°å€ä½œä¸ºæº MAC åœ°å€ï¼Œç›®çš„ MAC åœ°å€éœ€è¦åˆ†æƒ…å†µå¤„ç†ã€‚é€šè¿‡å°† IP åœ°å€ä¸æœ¬æœºçš„å­ç½‘æ©ç ç›¸ç»“åˆï¼Œå¯ä»¥åˆ¤æ–­æ˜¯å¦ä¸è¯·æ±‚ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘é‡Œï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå­ç½‘é‡Œï¼Œå¯ä»¥ä½¿ç”¨ APR åè®®è·å–åˆ°ç›®çš„ä¸»æœºçš„ MACåœ°å€ï¼Œå¦‚æœä¸åœ¨ä¸€ä¸ªå­ç½‘é‡Œï¼Œé‚£ä¹ˆè¯·æ±‚åº”è¯¥è½¬å‘ç»™ç½‘å…³ï¼Œç”±å®ƒä»£ä¸ºè½¬å‘ï¼Œæ­¤æ—¶åŒæ ·å¯ä»¥é€šè¿‡ ARP åè®®æ¥è·å–ç½‘å…³çš„ MAC åœ°å€ï¼Œæ­¤æ—¶ç›®çš„ä¸»æœºçš„ MAC åœ°å€åº”è¯¥ä¸ºç½‘å…³çš„åœ°å€ã€‚ å»ºç«‹TCPè¿æ¥ï¼šä¸»æœºå°†ä½¿ç”¨ç›®æ ‡IPåœ°å€å’Œç›®æ ‡MACåœ°å€å‘é€ä¸€ä¸ªTCP SYNåŒ…ï¼Œè¯·æ±‚å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ç„¶åäº¤ç»™è·¯ç”±å™¨è½¬å‘ï¼Œç­‰è·¯ç”±å™¨è½¬åˆ°ç›®æ ‡æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨å›å¤ä¸€ä¸ªSYN-ACKåŒ…ï¼Œç¡®è®¤è¿æ¥è¯·æ±‚ã€‚ç„¶åï¼Œä¸»æœºå‘é€ä¸€ä¸ªACKåŒ…ï¼Œç¡®è®¤å·²æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤ï¼Œç„¶åTCPè¿æ¥å»ºç«‹å®Œæˆã€‚ HTTPS çš„ TLS å››æ¬¡æ¡æ‰‹:å¦‚æœä½¿ç”¨çš„æ˜¯ HTTPS åè®®ï¼Œåœ¨é€šä¿¡å‰è¿˜å­˜åœ¨ TLS çš„å››æ¬¡æ¡æ‰‹ã€‚ å‘é€HTTPè¯·æ±‚:è¿æ¥å»ºç«‹åï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ã€‚è¯·æ±‚ä¸­åŒ…å«äº†ç”¨æˆ·éœ€è¦è·å–çš„èµ„æºçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç½‘é¡µçš„URLã€è¯·æ±‚æ–¹æ³•(GETã€POSTç­‰)ç­‰ã€‚ æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”:æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ ¹æ®è¯·æ±‚çš„å†…å®¹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ˜¯è¯·æ±‚ç½‘é¡µï¼ŒæœåŠ¡å™¨ä¼šè¯»å–ç›¸åº”çš„ç½‘é¡µæ–‡ä»¶ï¼Œå¹¶ç”ŸæˆHTTPå“åº”ã€‚ 11.Cookieå’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«åœ¨ Web å¼€å‘ä¸­ï¼ŒCookieã€Sessionã€Tokenã€JWT æ˜¯ç”¨äºèº«ä»½éªŒè¯å’ŒçŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒæ¦‚å¿µ 1.cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨è¿”å›ç”¨æˆ·åç»™å‰ç«¯ï¼Œå‰ç«¯æŠŠç”¨æˆ·åä¿å­˜åˆ°æµè§ˆå™¨çš„cookieã€‚è¿™æ ·åç»­æµè§ˆå™¨å†è®¿é—®åç«¯éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Šcookieï¼Œä»è€Œç»´æŒçŠ¶æ€ä¿¡æ¯ã€‚ å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼š ç”¨æˆ·å¯ä»¥è‡ªå·±ä¿®æ”¹cookieé‡Œé¢å­˜å‚¨çš„ç”¨æˆ·åï¼Œä¸å®‰å…¨ cookieçš„å¤§å°æœ‰é™åˆ¶ è¿˜å¯èƒ½ä¼šè¢«ç”¨æˆ·ç¦ç”¨cookie å®‰å…¨æ€§ï¼šå®¹æ˜“è¢«çªƒå–ï¼ˆXSS æ”»å‡»ï¼‰æˆ–ä¼ªé€ ï¼ˆCSRF æ”»å‡»ï¼‰ï¼Œéœ€è®¾ç½® HttpOnlyã€Secureã€SameSite ç­‰å±æ€§å¢å¼ºå®‰å…¨æ€§ã€‚ 2.session å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼ˆé€šå¸¸é…åˆcookieä½¿ç”¨ï¼‰ session æ˜¯åŸºäº cookie å®ç°çš„ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒsessionId ä¼šè¢«å­˜å‚¨åˆ°å®¢æˆ·ç«¯çš„cookie ä¸­ ç™»å½•ä¿¡æ¯ä¼ åˆ°æœåŠ¡ç«¯ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šåœ¨sessionä¸­å­˜å‚¨å½“å‰ç™»å½•ä¿¡æ¯ï¼Œå¹¶åœ¨å“åº”å¤´ä¸­æŠŠè¿™ä¸ªå”¯ä¸€çš„sessionIdè¿”å›ç»™å‰ç«¯ï¼ˆç”¨çš„set-cookieï¼‰ï¼Œå‰ç«¯æ”¶åˆ°set-cookieåå°±ä¼šæŠŠè¿™ä¸ªå”¯ä¸€çš„sessionIdå­˜åˆ°cookieä¸­ï¼Œä»¥åçš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæŠŠè¿™ä¸ªcookieå‘ç»™åç«¯ å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼š å ç”¨æœåŠ¡å™¨èµ„æº ä¾ç„¶éœ€è¦ä¾èµ–cookie æœåŠ¡å™¨éœ€ç»´æŠ¤ Session å­˜å‚¨ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éœ€å…±äº« Session å­˜å‚¨ï¼ˆå¦‚ Redis é›†ç¾¤ï¼‰ã€‚ï¼ˆé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå‰ç«¯çš„æ¯æ¬¡è¯·æ±‚é€šè¿‡è´Ÿè½½å‡è¡¡å¯èƒ½ä¼šå‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡å‘åˆ°AæœåŠ¡å™¨ä¸Šç™»å½•æˆåŠŸåï¼Œç¬¬äºŒæ¬¡å‘åˆ°BæœåŠ¡å™¨ä¸Šä¼šåˆ¤å®šä½ æœªç™»å½•ï¼‰ é—®ï¼šå¦‚æœå®¢æˆ·ç«¯ç¦ç”¨äº†cookieï¼Œsessionè¿˜èƒ½ç”¨å—ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ Cookie åï¼ŒSession æ˜¯æ— æ³•æ­£å¸¸ä½¿ç”¨çš„ï¼Œ å› ä¸ºå¤§å¤šæ•° Web æœåŠ¡å™¨éƒ½æ˜¯ä¾èµ–äº Cookie æ¥ä¼ é€’ Session çš„ä¼šè¯ ID çš„ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡å°†Session IDé™„åŠ åˆ°URLä¸­ä½œä¸ºå‚æ•°æ¥ç»§ç»­ä½¿ç”¨ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦ç›¸åº”åœ°è§£æ URL æ¥è·å– Session IDï¼Œå¹¶ç»´æŠ¤ç”¨æˆ·çš„ä¼šè¯çŠ¶æ€ã€‚å¦‚æœç”¨æˆ·é€šè¿‡ç”µå­é‚®ä»¶æˆ–å…¶ä»–æ–¹å¼åˆ†äº«äº†è¿™æ ·çš„é“¾æ¥ï¼Œ å¯èƒ½å¯¼è‡´Session IDçš„æ„å¤–æ³„éœ² 12.Tokenå’ŒJWT1. Token æ¯ä¸€æ¬¡è¯·æ±‚éƒ½éœ€è¦æºå¸¦ tokenï¼Œéœ€è¦æŠŠ token æ”¾åˆ° HTTP çš„ Header é‡Œ åŸºäº token çš„ç”¨æˆ·è®¤è¯æ˜¯ä¸€ç§æœåŠ¡ç«¯æ— çŠ¶æ€çš„è®¤è¯æ–¹å¼ï¼ŒæœåŠ¡ç«¯ä¸ç”¨å­˜æ”¾ token æ•°æ®ã€‚ç”¨è§£æ token çš„è®¡ç®—æ—¶é—´æ¢å– session çš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œå‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå‡å°‘é¢‘ç¹çš„æŸ¥è¯¢æ•°æ®åº“ Token æ˜¯ä¸€ç§æˆæƒå‡­è¯ï¼Œé€šå¸¸ç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œç”¨äºå®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­æ ‡è¯†èº«ä»½å’Œæƒé™ã€‚ ç‰¹ç‚¹ï¼š å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ LocalStorage æˆ–ç§»åŠ¨ç«¯æœ¬åœ°å­˜å‚¨ï¼‰ã€‚ ç”¨é€”ï¼šæ— çŠ¶æ€èº«ä»½éªŒè¯ï¼ˆå¦‚ API è°ƒç”¨ï¼‰ã€‚ å®‰å…¨æ€§ï¼šéœ€é€šè¿‡ HTTPS ä¼ è¾“é˜²æ­¢çªƒå¬ï¼›è‹¥ä½¿ç”¨ JWT æ ¼å¼ï¼Œéœ€ç­¾åé˜²ç¯¡æ”¹ã€‚ æ— çŠ¶æ€æ€§ï¼šæœåŠ¡å™¨ä¸å­˜å‚¨ Tokenï¼Œä»…é€šè¿‡ç­¾åéªŒè¯æœ‰æ•ˆæ€§ã€‚ å·¥ä½œæµç¨‹ï¼š ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆ Token å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯åç»­è¯·æ±‚åœ¨ Authorization å¤´ä¸­æºå¸¦ Tokenï¼ˆå¦‚ Bearer &lt;token&gt;ï¼‰ã€‚ æœåŠ¡å™¨éªŒè¯ Token æœ‰æ•ˆæ€§åå¤„ç†è¯·æ±‚ã€‚ 2.JWTï¼ˆJSON Web Tokenï¼‰ æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆã€‚ JWT æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç»„å­—ç¬¦ä¸²ï¼Œé€šè¿‡ï¼ˆ.ï¼‰åˆ‡åˆ†æˆä¸‰ä¸ªä¸º Base64 ç¼–ç çš„éƒ¨åˆ† Headerï¼ˆå¤´éƒ¨ï¼‰ : æè¿° JWT çš„å…ƒæ•°æ®ï¼Œå®šä¹‰äº†ç”Ÿæˆç­¾åçš„ç®—æ³•ä»¥åŠ Token çš„ç±»å‹ Payloadï¼ˆè½½è·ï¼‰ : ç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ® Signatureï¼ˆç­¾åï¼‰ï¼šæœåŠ¡å™¨é€šè¿‡ Payloadã€Header å’Œä¸€ä¸ªå¯†é’¥(Secret)ä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ç”Ÿæˆã€‚ Header å’Œ Payload éƒ½æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼ŒSignature ç”± Payloadã€Header å’Œ Secret(å¯†é’¥)é€šè¿‡ç‰¹å®šçš„è®¡ç®—å…¬å¼å’ŒåŠ å¯†ç®—æ³•å¾—åˆ°ã€‚ Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œä½œç”¨æ˜¯é˜²æ­¢ JWTï¼ˆä¸»è¦æ˜¯ payloadï¼‰ è¢«ç¯¡æ”¹ è¿™ä¸ªç­¾åçš„ç”Ÿæˆéœ€è¦ç”¨åˆ°ï¼š Header + Payloadã€‚ å­˜æ”¾åœ¨æœåŠ¡ç«¯çš„å¯†é’¥(ä¸€å®šä¸è¦æ³„éœ²å‡ºå»)ã€‚ åŠ å¯†ç®—æ³•ã€‚ ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨â€ç‚¹â€ï¼ˆ.ï¼‰åˆ†éš”ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ JWT å¦‚ä½•åŸºäºJWTè¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ åœ¨åŸºäºJWT è¿›è¡Œèº«ä»½éªŒè¯çš„çš„åº”ç”¨ç¨‹åºä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡ Payloadã€Headerå’Œ Secret(å¯†é’¥)åˆ›å»º JWT å¹¶å°†JWT å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°JWTä¹‹åï¼Œä¼šå°†å…¶ä¿å­˜åœ¨ Cookie æˆ–è€…localStorage é‡Œé¢ï¼Œä»¥åå®¢æˆ·ç«¯å‘å‡ºçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæºå¸¦è¿™ä¸ªä»¤ç‰Œã€‚ å»ºè®®å°† JWT å­˜æ”¾åœ¨ localStorage ä¸­ï¼Œæ”¾åœ¨ Cookie ä¸­ä¼šæœ‰ CSRF é£é™©ã€‚ å¦‚ä½•é˜²æ­¢JWTè¢«ç¯¡æ”¹ æœ‰äº†ç­¾åä¹‹åï¼Œå³ä½¿ JWT è¢«æ³„éœ²æˆ–è€…æˆªè·ï¼Œé»‘å®¢ä¹Ÿæ²¡åŠæ³•åŒæ—¶ç¯¡æ”¹ Signatureã€Headerã€Payloadã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæœåŠ¡ç«¯æ‹¿åˆ° JWT ä¹‹åï¼Œä¼šè§£æå‡ºå…¶ä¸­åŒ…å«çš„ Headerã€Payload ä»¥åŠ Signature ã€‚æœåŠ¡ç«¯ä¼šæ ¹æ® Headerã€Payloadã€å¯†é’¥å†æ¬¡ç”Ÿæˆä¸€ä¸ª Signatureã€‚æ‹¿æ–°ç”Ÿæˆçš„ Signature å’Œ JWT ä¸­çš„ Signature ä½œå¯¹æ¯”ï¼Œå¦‚æœä¸€æ ·å°±è¯´æ˜ Header å’Œ Payload æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ ä¸è¿‡ï¼Œå¦‚æœæœåŠ¡ç«¯çš„ç§˜é’¥ä¹Ÿè¢«æ³„éœ²çš„è¯ï¼Œé»‘å®¢å°±å¯ä»¥åŒæ—¶ç¯¡æ”¹ Signatureã€Headerã€Payload äº†ã€‚é»‘å®¢ç›´æ¥ä¿®æ”¹äº† Header å’Œ Payload ä¹‹åï¼Œå†é‡æ–°ç”Ÿæˆä¸€ä¸ª Signature å°±å¯ä»¥äº†ã€‚ å¯†é’¥ä¸€å®šä¿ç®¡å¥½ï¼Œä¸€å®šä¸è¦æ³„éœ²å‡ºå»ã€‚JWT å®‰å…¨çš„æ ¸å¿ƒåœ¨äºç­¾åï¼Œç­¾åå®‰å…¨çš„æ ¸å¿ƒåœ¨å¯†é’¥ã€‚ 13.HTTPä¸ºä»€ä¹ˆä¸å®‰å…¨HTTP ç”±äºæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œæ‰€ä»¥å®‰å…¨ä¸Šå­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªé£é™©: çªƒå¬é£é™©ï¼Œæ¯”å¦‚é€šä¿¡é“¾è·¯ä¸Šå¯ä»¥è·å–é€šä¿¡å†…å®¹ï¼Œç”¨æˆ·å·å®¹æ˜“æ²¡ã€‚ ç¯¡æ”¹é£é™©ï¼Œæ¯”å¦‚å¼ºåˆ¶æ¤å…¥åƒåœ¾å¹¿å‘Šï¼Œè§†è§‰æ±¡æŸ“ï¼Œç”¨æˆ·çœ¼å®¹æ˜“çã€‚ å†’å……é£é™©ï¼Œæ¯”å¦‚å†’å……æ·˜å®ç½‘ç«™ï¼Œç”¨æˆ·é’±å®¹æ˜“æ²¡ã€‚ HTTPS åœ¨ HTTP ä¸ TCP å±‚ä¹‹é—´åŠ å…¥äº† SSL&#x2F;TLS åè®®ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³äº†ä¸Šè¿°çš„é£é™©: ä¿¡æ¯åŠ å¯†:äº¤äº’ä¿¡æ¯æ— æ³•è¢«çªƒå–ï¼Œä½†ä½ çš„å·ä¼šå› ä¸ºã€Œè‡ªèº«å¿˜è®°ã€è´¦å·è€Œæ²¡ã€‚ æ ¡éªŒæœºåˆ¶:æ— æ³•ç¯¡æ”¹é€šä¿¡å†…å®¹ï¼Œç¯¡æ”¹äº†å°±ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä½†ç™¾åº¦ã€Œç«ä»·æ’åã€ä¾ç„¶å¯ä»¥æœç´¢åƒåœ¾å¹¿å‘Šã€‚ èº«ä»½è¯ä¹¦:è¯æ˜æ·˜å®æ˜¯çœŸçš„æ·˜å®ç½‘ï¼Œä½†ä½ çš„é’±è¿˜æ˜¯ä¼šå› ä¸ºã€Œå‰æ‰‹ã€è€Œæ²¡ã€‚ 14.HTTPSå»ºç«‹è¿æ¥çš„è¿‡ç¨‹ å‰ç½®çŸ¥è¯† åŠ å¯†&#x2F;è§£å¯† å¦‚æœç”¨çš„æ˜¯åŒä¸€å¥—è§„åˆ™ï¼Œå°±æ˜¯å¯¹ç§°åŠ å¯†ï¼Œå¦åˆ™å°±æ˜¯éå¯¹ç§°åŠ å¯† éå¯¹ç§°çš„åŠ å¯†è§„åˆ™å«å…¬é’¥ï¼Œè§£å¯†è§„åˆ™å«ç§é’¥ é€šè¿‡å…¬é’¥åŠ å¯†åçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ç§é’¥è¿›è¡Œè§£å¯†ï¼Œåä¹‹äº¦ç„¶ æ¥ä¸‹æ¥çœ‹çœ‹HTTPSçš„è¿æ¥è¿‡ç¨‹ï¼ˆä¸»è¦æ˜¯TLS&#x2F;SSLå››æ¬¡æ¡æ‰‹ï¼‰ TCPè¿æ¥ TLS&#x2F;SLLå››æ¬¡æ¡æ‰‹è¿æ¥ ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯TLSç‰ˆæœ¬ä»¥åŠåŠ å¯†ç®—æ³•å’Œå®¢æˆ·ç«¯éšæœºæ•° ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯ç¡®è®¤ä½¿ç”¨çš„TLSç‰ˆæœ¬ä»¥åŠåŠ å¯†ç®—æ³•ï¼Œä»¥åŠç»™å®¢æˆ·ç«¯ä¸€ä¸ªæœåŠ¡ç«¯éšæœºæ•°å’ŒæœåŠ¡å™¨è¯ä¹¦ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯é¦–å…ˆä¼šéªŒè¯æ•°å­—è¯ä¹¦çš„çœŸå®æ€§ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡å™¨è¯ä¹¦ä¸­å–å‡ºæœåŠ¡å™¨å…¬é’¥ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ˆpre-master keyï¼‰ï¼Œç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†åå‘é€ç»™æœåŠ¡ç«¯ï¼Œç„¶åç”¨æ­¤æ—¶è¿™è¾¹çš„ä¸‰ä¸ªéšæœºæ•°ï¼ˆå®¢æˆ·ç«¯éšæœºæ•°ï¼ŒæœåŠ¡ç«¯éšæœºæ•°ï¼Œpre-master-keyï¼‰ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼Œç„¶åæŠŠè¿„ä»Šä¸ºæ­¢çš„é€šä¿¡æ•°æ®ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼Œä¹Ÿå«finishedæŠ¥æ–‡ï¼Œç”¨ä¼šè¯å¯†é’¥åŠ å¯†åå‘é€ç»™æœåŠ¡ç«¯ï¼Œä¾›æœåŠ¡ç«¯æ ¡éªŒ ç¬¬å››æ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„éšæœºæ•°pre-master-keyè§£å¯†ï¼ˆç”¨çš„æ˜¯æœåŠ¡å™¨ç§é’¥ï¼‰ï¼Œç„¶åç”¨è¿™è¾¹çš„ä¸‰ä¸ªéšæœºæ•°ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼ŒåŒæ ·ç”Ÿæˆä¸€ä¸ªfinishedæŠ¥æ–‡ï¼Œå‘é€ç»™å®¢æˆ·ç«¯åšæ ¡éªŒ åŠ å¯†é€šä¿¡ æ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å°±ä¼šç”¨è¿™ä¸ªç”Ÿæˆçš„ä¼šè¯å¯†é’¥åšåŠ å¯†é€šä¿¡ HTTPSæ˜¯å¯¹ç§°åŠ å¯†è¿˜æ˜¯éå¯¹ç§°åŠ å¯†ï¼Ÿ éƒ½ç”¨åˆ°äº†ï¼Œå››æ¬¡æ¡æ‰‹æœ¬è´¨æ˜¯åˆ©ç”¨äº†éå¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹æ¥ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œåé¢å°±æ˜¯åˆ©ç”¨ä¼šè¯å¯†é’¥æ¥è¿›è¡Œå¯¹ç§°åŠ å¯†çš„åŠ å¯†é€šä¿¡ ä¸ºä»€ä¹ˆä¸éƒ½ç”¨éå¯¹ç§°åŠ å¯†å‘¢ï¼Ÿ éå¯¹ç§°åŠ å¯†æ…¢ ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸­çš„æœåŠ¡å™¨è¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆä»é‡Œé¢å–å‡ºå…¬é’¥ï¼Ÿ æœåŠ¡å™¨è¯ä¹¦æ˜¯è¢«CA(è¯ä¹¦æƒå¨æœºæ„) çš„ç§é’¥å¯¹æœåŠ¡å™¨å…¬é’¥åŠ å¯†åçš„ä¸œè¥¿ï¼Œå³CAç§é’¥+æœåŠ¡å™¨å…¬é’¥â€”â€”&gt;æœåŠ¡å™¨è¯ä¹¦ æ‰€ä»¥å¯ä»¥ç”¨CAå…¬é’¥å¯¹æœåŠ¡å™¨è¯ä¹¦è§£å¯†â€”â€”&gt;æœåŠ¡å™¨å…¬é’¥ ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ä¼ å…¬é’¥ï¼Ÿè¿˜è¦æ‹¿CAç§é’¥åŠ å¯†åå†ä¼ è¿‡å» ç›´æ¥ä¼ å…¬é’¥çš„è¯å¦‚æœè¢«é»‘å®¢æ›¿æ¢æˆè‡ªå·±çš„å…¬é’¥ï¼Œé‚£å®¢æˆ·ç«¯æ‹¿ç€å‡å…¬é’¥åŠ å¯†pre-master-keyï¼Œé»‘å®¢ç»è¿‡è§£å¯†å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªpre-master-keyï¼Œåˆå› ä¸ºå¦å¤–ä¸¤ä¸ªéšæœºæ•°æ˜¯æ˜æ–‡ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºä¼šè¯å¯†é’¥ï¼Œç„¶åå°±å¯ä»¥ç ´è§£é€šä¿¡å†…å®¹äº† 15.HTTPå’ŒRPCçš„åŒºåˆ«16.HTTPå»ºç«‹è¿æ¥çš„è¿‡ç¨‹æœåŠ¡å™¨åœ¨ 80 ç«¯å£ç­‰å¾…å®¢æˆ·çš„è¯·æ±‚ã€‚ æµè§ˆå™¨å‘èµ·åˆ°æœåŠ¡å™¨çš„ TCP è¿æ¥ï¼ˆåˆ›å»ºå¥—æ¥å­— Socketï¼‰ã€‚ æœåŠ¡å™¨æ¥æ”¶æ¥è‡ªæµè§ˆå™¨çš„ TCP è¿æ¥ã€‚ æµè§ˆå™¨ï¼ˆHTTP å®¢æˆ·ç«¯ï¼‰ä¸ Web æœåŠ¡å™¨ï¼ˆHTTP æœåŠ¡å™¨ï¼‰äº¤æ¢ HTTP æ¶ˆæ¯ã€‚ å…³é—­ TCP è¿æ¥ã€‚ 17.HTTPSä¸­é—´äººæ”»å‡»ä»¥åŠå¦‚ä½•é˜²èŒƒæ”»å‡»åŸç† åœ¨HTTPSé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨æä¾›çš„æ•°å­—è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ã€‚è¯ä¹¦ç”±å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘ï¼Œå®¢æˆ·ç«¯ä¼šæ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæ€§ä»¥ç¡®ä¿é€šä¿¡å®‰å…¨ã€‚ç„¶è€Œï¼Œåœ¨ä¸­é—´äººæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ä¼šä¼ªé€ è¯ä¹¦ï¼Œå†’å……æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š æ‹¦æˆªé€šä¿¡ï¼šæ”»å‡»è€…æ‹¦æˆªå®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨çš„è¯·æ±‚ã€‚ ä¼ªè£…èº«ä»½ï¼šæ”»å‡»è€…ä¼ªè£…æˆæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼ŒåŒæ—¶ä¸çœŸæ­£çš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå……å½“ä¸­é—´äººçš„è§’è‰²ã€‚ ä¼ªé€ è¯ä¹¦ï¼šæ”»å‡»è€…å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªä¼ªé€ çš„è¯ä¹¦ï¼Œä½¿å®¢æˆ·ç«¯è¯¯ä»¥ä¸ºä¸çœŸæ­£çš„æœåŠ¡å™¨å»ºç«‹äº†å®‰å…¨è¿æ¥ã€‚ çªƒå¬æˆ–ç¯¡æ”¹ï¼šæ”»å‡»è€…å¯ä»¥çªƒå¬å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å†…å®¹ï¼Œç”šè‡³ç¯¡æ”¹æ•°æ®ã€‚ é˜²èŒƒ åŠ å¯†ï¼šhttps æ¡æ‰‹æœŸé—´ä¼šé€šè¿‡éå¯¹ç§°åŠ å¯†çš„æ–¹å¼æ¥åå•†å‡ºå¯¹ç§°åŠ å¯†å¯†é’¥ã€‚ èº«ä»½æ ¡éªŒï¼šå®¢æˆ·ç«¯ä¼šéªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼ŒåŒ…æ‹¬æ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæœŸã€é¢å‘æœºæ„çš„ä¿¡ä»»ç­‰ã€‚ äºŒã€DNS1ã€ä½œç”¨DNSï¼ˆDomain Name Systemï¼‰åŸŸåç®¡ç†ç³»ç»Ÿï¼Œæ˜¯å½“ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨è®¿é—®ç½‘å€ä¹‹åï¼Œä½¿ç”¨çš„ç¬¬ä¸€ä¸ªé‡è¦åè®®ã€‚DNS è¦è§£å†³çš„æ˜¯åŸŸåå’Œ IP åœ°å€çš„æ˜ å°„é—®é¢˜ã€‚ DNSæ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œä½¿å¾—äººä»¬å¯ä»¥é€šè¿‡æ˜“è®°çš„åŸŸåè®¿é—®äº’è”ç½‘èµ„æºï¼Œè€Œæ— éœ€è®°ä½å¤æ‚çš„IPåœ°å€ã€‚ åœ¨ä¸€å°ç”µè„‘ä¸Šï¼Œå¯èƒ½å­˜åœ¨æµè§ˆå™¨ DNS ç¼“å­˜ï¼Œæ“ä½œç³»ç»Ÿ DNS ç¼“å­˜ï¼Œè·¯ç”±å™¨ DNS ç¼“å­˜ã€‚å¦‚æœä»¥ä¸Šç¼“å­˜éƒ½æŸ¥è¯¢ä¸åˆ°ï¼Œé‚£ä¹ˆ DNS å°±é—ªäº®ç™»åœºäº†ã€‚ 2ã€åŸŸåè§£æçš„æµç¨‹ å®¢æˆ·ç«¯å…ˆè®¿é—®æœ¬åœ°DNSæœåŠ¡å™¨ï¼ˆå‡å¦‚ç½‘å€æ˜¯www.server.com æ²¡æ‰¾åˆ°å°±ï¼ˆç”±æœ¬åœ°DNSæœåŠ¡å™¨ï¼‰è®¿é—®æ ¹DNSæœåŠ¡å™¨ï¼ˆ.ï¼‰ï¼Œæ ¹DNSè¿”å›ç»™æœ¬åœ°DNSæœåŠ¡å™¨è¦æ‰¾çš„ç½‘å€çš„é¡¶çº§åŸŸDNSæœåŠ¡å™¨ï¼ˆcom) ï¼ˆæœ¬åœ°DNSæœåŠ¡å™¨ï¼‰è®¿é—®é¡¶çº§åŸŸæœåŠ¡å™¨ï¼ˆcomï¼‰ï¼Œé¡¶çº§åŸŸæœåŠ¡å™¨è¿”å›ç»™æœ¬åœ°DNSæœåŠ¡å™¨è¦æ‰¾çš„ç½‘å€çš„æƒå¨DNSæœåŠ¡å™¨ï¼ˆserver.comï¼‰ ï¼ˆæœ¬åœ°DNSæœåŠ¡å™¨ï¼‰è®¿é—®æƒå¨DNSæœåŠ¡å™¨ï¼ˆserver.comï¼‰ï¼Œæƒå¨DNSæœåŠ¡å™¨è¿”å›ç»™æœ¬åœ°DNSæœåŠ¡å™¨è¦æ‰¾IPåœ°å€ æ˜¯ä¸æ˜¯æ¯æ¬¡è§£æåŸŸåéƒ½è¦ç»è¿‡é‚£ä¹ˆå¤šçš„æ­¥éª¤å‘¢ï¼Ÿ ï¼ˆäº†è§£ï¼Œåæ­£å°±æ˜¯çŸ¥é“ä¼šå…ˆçœ‹ç¼“å­˜æœ‰æ²¡æœ‰å°±è¡Œ æµè§ˆå™¨ä¼šå…ˆçœ‹è‡ªèº«æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªåŸŸåçš„ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å»é—®æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šå»çœ‹è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†å» hosts æ–‡ä»¶çœ‹ï¼Œä¹Ÿæ²¡æœ‰ï¼Œæ‰ä¼šå»é—®ã€Œæœ¬åœ°DNS æœåŠ¡å™¨ã€ã€‚ 3.DNSåŠ«æŒäº†è§£å—DNS åŠ«æŒæ˜¯ä¸€ç§ç½‘ç»œæ”»å‡»ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ DNS æœåŠ¡å™¨çš„è§£æç»“æœï¼Œä½¿ç”¨æˆ·è®¿é—®çš„åŸŸåæŒ‡å‘é”™è¯¯çš„ IP åœ°å€ï¼Œ ä»è€Œå¯¼è‡´ç”¨æˆ·æ— æ³•è®¿é—®æ­£å¸¸çš„ç½‘ç«™ï¼Œæˆ–è€…è¢«å¼•å¯¼åˆ°æ¶æ„çš„ç½‘ç«™ã€‚DNS åŠ«æŒæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º DNS é‡å®šå‘ã€DNS æ¬ºéª—æˆ– DNS æ±¡æŸ“ã€‚ ä¸‰ã€WebSocket1.ä»€ä¹ˆæ˜¯WebSocketWebSocket æ˜¯ä¸€ç§åŸºäº TCP è¿æ¥çš„å…¨åŒå·¥é€šä¿¡åè®®ï¼Œå³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚ WebSocket åè®®æœ¬è´¨ä¸Šæ˜¯åº”ç”¨å±‚çš„åè®®ï¼Œç”¨äºå¼¥è¡¥ HTTP åè®®åœ¨æŒä¹…é€šä¿¡èƒ½åŠ›ä¸Šçš„ä¸è¶³ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»…éœ€ä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚ è¿™æ„å‘³ç€è¿æ¥æ˜¯æŒä¹…çš„ï¼Œå®ƒä¸€ç›´ä¿æŒæ‰“å¼€ï¼Œç›´åˆ°æœ‰ä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥ã€‚è¿™ä½¿å¾—WebSocket éå¸¸é€‚åˆç”¨äºå®æ—¶åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä¸æ–­åœ°å»ºç«‹å’Œå…³é—­è¿æ¥ã€‚ WebSocket çš„å¸¸è§åº”ç”¨åœºæ™¯ï¼š è§†é¢‘å¼¹å¹• å®æ—¶æ¶ˆæ¯æ¨é€ å®æ—¶æ¸¸æˆå¯¹æˆ˜ å¤šç”¨æˆ·ååŒç¼–è¾‘ ç¤¾äº¤èŠå¤© ã€‚ã€‚ã€‚ 2.ä¸ºä»€ä¹ˆæœ‰äº†HTTPè¿˜éœ€è¦WebSocketï¼Ÿæˆ–è€…è¯´ï¼šWebSocketå’ŒHTTPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ HTTPæ˜¯åŸºäºTCPåè®®çš„ï¼ŒåŒä¸€æ—¶é—´é‡Œï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åªèƒ½æœ‰ä¸€æ–¹ä¸»åŠ¨å‘æ•°æ®ï¼Œæ˜¯åŠåŒå·¥é€šä¿¡ã€‚ é€šå¸¸ï¼Œæ‰“å¼€æŸä¸ªç½‘é¡µï¼Œæˆ‘ä»¬æ¯ç‚¹å‡»ä¸€æ¬¡ç½‘é¡µä¸Šçš„æŸä¸ªé€‰é¡¹å‰ç«¯å°±ä¼šå‘é€ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œç½‘ç«™è¿”å›ä¸€æ¬¡HTTPå“åº”ã€‚è¿™ç§ç”±å®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨å“åº”çš„æ–¹å¼æ»¡è¶³å¤§éƒ¨åˆ†ç½‘é¡µçš„åŠŸèƒ½åœºæ™¯ã€‚ä½†è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨ç»™å®¢æˆ·ç«¯å‘æ¶ˆæ¯ã€‚è€Œç±»ä¼¼ç½‘é¡µæ¸¸æˆè¿™æ ·çš„åœºæ™¯ï¼Œæ˜¯éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº’ç›¸ä¸»åŠ¨å‘å¤§é‡æ•°æ®çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸºäºTCPçš„æ–°åè®®ï¼Œå³æ–°çš„åº”ç”¨å±‚åè®®WebSocket. 3.WebSocketçš„å·¥ä½œè¿‡ç¨‹WebSocket è¿æ¥é€šå¸¸åœ¨å®¢æˆ·ç«¯(ä¾‹å¦‚æµè§ˆå™¨)å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ã€‚å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚æ¥å»ºç«‹è¿æ¥ï¼Œç„¶åæœåŠ¡å™¨è¿”å›ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ï¼Œè¡¨ç¤ºå·²å»ºç«‹è¿æ¥ã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥è¿›è¡ŒåŒå‘é€šä¿¡ã€‚å®¢æˆ·ç«¯å¯ä»¥å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚ å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘é€ä¸€ä¸ªå…³é—­å¸§ï¼Œè¡¨ç¤ºè¦æ–­å¼€è¿æ¥ã€‚å¦ä¸€æ–¹æ”¶åˆ°åï¼Œä¹Ÿä¼šå›å¤ä¸€ä¸ªå…³é—­å¸§ï¼Œç„¶ååŒæ–¹å…³é—­ TCP è¿æ¥ã€‚ å››ã€TCPä¸UDPTCP æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ 1.TCPå’ŒUDPçš„åŒºåˆ« è¿æ¥ï¼šTCP æ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œä¼ è¾“æ•°æ®å‰å…ˆè¦å»ºç«‹è¿æ¥ï¼›UDP æ˜¯ä¸éœ€è¦è¿æ¥ï¼Œå³åˆ»ä¼ è¾“æ•°æ®ã€‚ æœåŠ¡å¯¹è±¡ï¼šTCP æ˜¯ä¸€å¯¹ä¸€çš„ä¸¤ç‚¹æœåŠ¡ï¼Œå³ä¸€æ¡è¿æ¥åªæœ‰ä¸¤ä¸ªç«¯ç‚¹ã€‚ UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ å¯é æ€§ï¼šTCP æ˜¯å¯é äº¤ä»˜æ•°æ®çš„ï¼Œæ•°æ®å¯ä»¥æ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€æŒ‰åºåˆ°è¾¾ã€‚ UDP æ˜¯å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œä¸ä¿è¯å¯é äº¤ä»˜æ•°æ®ã€‚ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åŸºäº UDP ä¼ è¾“åè®®å®ç°ä¸€ä¸ªå¯é çš„ä¼ è¾“åè®®ï¼Œæ¯”å¦‚ QUIC åè®® é¦–éƒ¨å¼€é”€ï¼šTCP é¦–éƒ¨å¼€é”€ï¼ˆ20 ï½ 60 å­—èŠ‚ï¼‰æ¯” UDP é¦–éƒ¨å¼€é”€ï¼ˆ8 å­—èŠ‚ï¼‰è¦å¤§ã€‚ ä¼ è¾“æ–¹å¼ï¼šTCP é¢å‘å­—èŠ‚æµä¼ è¾“ï¼Œæ²¡æœ‰è¾¹ç•Œï¼Œä½†ä¿è¯é¡ºåºå’Œå¯é ã€‚ UDP æ˜¯ä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„å‘é€ï¼Œæ˜¯æœ‰è¾¹ç•Œçš„ï¼Œä½†å¯èƒ½ä¼šä¸¢åŒ…å’Œä¹±åºã€‚ 2.ä»€ä¹ˆæ—¶å€™é€‰æ‹©TCPï¼Œä»€ä¹ˆæ—¶å€™é€‰æ‹©UDPï¼Ÿ UDP ä¸€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼Œæ¯”å¦‚ï¼šè¯­éŸ³ã€ è§†é¢‘ã€ç›´æ’­ç­‰ç­‰ã€‚è¿™äº›åœºæ™¯å¯¹ä¼ è¾“æ•°æ®çš„å‡†ç¡®æ€§è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œæ¯”å¦‚ä½ çœ‹è§†é¢‘å³ä½¿å°‘ä¸ªä¸€ä¸¤å¸§ï¼Œå®é™…ç»™äººçš„æ„Ÿè§‰åŒºåˆ«ä¹Ÿä¸å¤§ã€‚ TCP ç”¨äºå¯¹ä¼ è¾“å‡†ç¡®æ€§è¦æ±‚ç‰¹åˆ«é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ–‡ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰ç­‰ 3.TCPä¸‰æ¬¡æ¡æ‰‹ ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆSYNï¼‰ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª SYN æŠ¥æ–‡ï¼ˆSYN=1ï¼‰ï¼Œå¹¶æºå¸¦å®¢æˆ·ç«¯çš„åˆå§‹åºåˆ—å· seq=xï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ã€‚ç„¶åå®¢æˆ·ç«¯è¿›å…¥SYN_SENDçŠ¶æ€ç›®çš„ï¼šå®¢æˆ·ç«¯å‘ŠçŸ¥æœåŠ¡å™¨â€œæˆ‘æƒ³å»ºç«‹è¿æ¥ï¼Œæˆ‘çš„åˆå§‹åºåˆ—å·æ˜¯ xâ€ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆSYN-ACKï¼‰ï¼šæœåŠ¡å™¨æ”¶åˆ° SYN åï¼Œå›å¤ä¸€ä¸ª SYN-ACK æŠ¥æ–‡ï¼ˆSYN=1, ACK=1ï¼‰ï¼Œæºå¸¦æœåŠ¡å™¨çš„åˆå§‹åºåˆ—å· seq=yï¼Œä»¥åŠå¯¹å®¢æˆ·ç«¯ SYN çš„ç¡®è®¤å· ack=x+1ã€‚ç„¶åæœåŠ¡ç«¯è¿›å…¥SYN_RCVDçŠ¶æ€ç›®çš„ï¼šæœåŠ¡å™¨å‘ŠçŸ¥å®¢æˆ·ç«¯â€œæˆ‘æ”¶åˆ°äº†ä½ çš„è¯·æ±‚ï¼ŒåŒæ„å»ºç«‹è¿æ¥ï¼Œæˆ‘çš„åˆå§‹åºåˆ—å·æ˜¯ yâ€ã€‚ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆACKï¼‰ï¼šå®¢æˆ·ç«¯æ”¶åˆ° SYN-ACK åï¼Œå›å¤ä¸€ä¸ª ACK æŠ¥æ–‡ï¼ˆACK=1ï¼‰ï¼Œç¡®è®¤å·ä¸º ack=y+1ã€‚ç›®çš„ï¼šå®¢æˆ·ç«¯å‘ŠçŸ¥æœåŠ¡å™¨â€œæˆ‘æ”¶åˆ°äº†ä½ çš„ç¡®è®¤ï¼Œè¿æ¥å·²å»ºç«‹â€ã€‚ç„¶åå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDçŠ¶æ€ ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ï¼ˆå¦‚æœæºå¸¦æ•°æ®å°±æ¶ˆè€—ä¸€ä¸ªåºå·ï¼Œä¸æºå¸¦çš„è¯å°±ä¸æ¶ˆè€—ï¼‰ï¼Œå‰ä¸¤æ¬¡æ¡æ‰‹æ˜¯ä¸å¯ä»¥æºå¸¦æ•°æ®çš„ 4.TCPè¿æ¥ä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–å››æ¬¡TCP é‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„æ ¸å¿ƒç›®çš„æ˜¯ç¡®ä¿é€šä¿¡åŒæ–¹éƒ½èƒ½å¯é åœ°ç¡®è®¤å½¼æ­¤çš„å‘é€å’Œæ¥æ”¶èƒ½åŠ›ï¼Œå¹¶åŒæ­¥åˆå§‹åºåˆ—å·ï¼Œä»è€Œä¸ºåç»­çš„å¯é æ•°æ®ä¼ è¾“å¥ å®šåŸºç¡€ã€‚ (1) é˜²æ­¢æ—§çš„é‡å¤è¿æ¥åˆå§‹åŒ–ï¼ˆæ ¸å¿ƒåŸå› ï¼‰ å‡è®¾ç½‘ç»œä¸­å­˜åœ¨å»¶è¿Ÿçš„æ—§ SYN æŠ¥æ–‡ï¼ˆä¾‹å¦‚å®¢æˆ·ç«¯å¤šæ¬¡é‡è¯•åå»ºç«‹çš„è¿æ¥ï¼‰ï¼š ä¸¤æ¬¡æ¡æ‰‹çš„ç¼ºé™·ï¼šå¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯å‘ SYNï¼ŒæœåŠ¡å™¨å›å¤ SYN-ACKï¼‰ï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ° SYN åç›´æ¥å»ºç«‹è¿æ¥ã€‚è‹¥æ—§çš„ SYN æŠ¥æ–‡å»¶è¿Ÿåˆ°è¾¾æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šè¯¯è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°è¿æ¥å¹¶åˆ†é…èµ„æºï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚ ä¸‰æ¬¡æ¡æ‰‹çš„è§£å†³ï¼šå®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡å™¨çš„ SYN-ACK åï¼Œä¼šæ£€æŸ¥ç¡®è®¤å· ack æ˜¯å¦åŒ¹é…è‡ªå·±çš„åˆå§‹åºåˆ—å·ã€‚è‹¥ä¸åŒ¹é…ï¼ˆä¾‹å¦‚æ—§è¿æ¥çš„ SYN è¢«æœåŠ¡å™¨å“åº”ï¼‰ï¼Œå®¢æˆ·ç«¯ä¼šå‘é€ RST æŠ¥æ–‡ç»ˆæ­¢è¿æ¥ï¼Œé¿å…æ— æ•ˆè¿æ¥å ç”¨èµ„æºã€‚ (2) ç¡®ä¿åŒæ–¹æ”¶å‘èƒ½åŠ›æ­£å¸¸ ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ SYN â†’ éªŒè¯å®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨å‘é€ SYN-ACK â†’ éªŒè¯æœåŠ¡å™¨çš„å‘é€èƒ½åŠ›å’Œå®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›ã€‚ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ ACK â†’ éªŒè¯å®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›å’ŒæœåŠ¡å™¨çš„æ¥æ”¶èƒ½åŠ›ã€‚åªæœ‰ä¸‰æ¬¡æ¡æ‰‹èƒ½åŒå‘ç¡®è®¤åŒæ–¹çš„æ”¶å‘èƒ½åŠ›ã€‚ (3) åŒæ­¥åˆå§‹åºåˆ—å·ï¼ˆISNï¼‰ TCP ä¾èµ–åºåˆ—å·å®ç°å¯é ä¼ è¾“ã€‚ä¸‰æ¬¡æ¡æ‰‹ç¡®ä¿åŒæ–¹äº¤æ¢å¹¶ç¡®è®¤äº†åˆå§‹åºåˆ—å·ï¼š å®¢æˆ·ç«¯é€šè¿‡ SYN å‘é€ seq=xï¼ŒæœåŠ¡å™¨é€šè¿‡ ACK ç¡®è®¤ x+1ã€‚ æœåŠ¡å™¨é€šè¿‡ SYN å‘é€ seq=yï¼Œå®¢æˆ·ç«¯é€šè¿‡ ACK ç¡®è®¤ y+1ã€‚è‹¥åªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨æ— æ³•ç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦å·²æ­£ç¡®æ¥æ”¶è‡ªå·±çš„åºåˆ—å·ã€‚ 3. ä¸¤æ¬¡æˆ–å››æ¬¡æ¡æ‰‹çš„é—®é¢˜ ä¸¤æ¬¡æ¡æ‰‹ï¼šæ— æ³•è§£å†³æ—§ SYN æŠ¥æ–‡çš„é‡å¤è¿æ¥é—®é¢˜ï¼Œä¸”æœåŠ¡å™¨æ— æ³•ç¡®è®¤å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›ã€‚ å››æ¬¡æ¡æ‰‹ï¼šåœ¨ä¸‰æ¬¡æ¡æ‰‹çš„åŸºç¡€ä¸Šï¼Œè‹¥å¢åŠ ç¬¬å››æ¬¡ç¡®è®¤ï¼ˆä¾‹å¦‚æœåŠ¡å™¨å†å›å¤ä¸€ä¸ª ACKï¼‰ï¼Œä¼šå¯¼è‡´å†—ä½™ï¼Œä¸‰æ¬¡å·²è¶³å¤Ÿå¯é ã€‚ 5.TCPå››æ¬¡æŒ¥æ‰‹ å‡è®¾å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥ï¼š ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼ˆFINï¼‰ï¼šå®¢æˆ·ç«¯å‘é€ FIN æŠ¥æ–‡ï¼ˆFIN=1ï¼‰ï¼Œåºåˆ—å·ä¸º seq=uï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯ä¸å†å‘é€æ•°æ®ï¼Œä½†ä»å¯æ¥æ”¶æ•°æ®ã€‚å®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1çŠ¶æ€ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼ˆACKï¼‰ï¼šæœåŠ¡å™¨æ”¶åˆ° FIN åï¼Œå›å¤ ACK æŠ¥æ–‡ï¼ˆACK=1ï¼‰ï¼Œç¡®è®¤å·ä¸º ack=u+1ï¼Œè¡¨ç¤ºå·²æ”¶åˆ°å®¢æˆ·ç«¯çš„å…³é—­è¯·æ±‚ã€‚æ­¤æ—¶æœåŠ¡å™¨å¯èƒ½è¿˜æœ‰æœªå‘é€å®Œçš„æ•°æ®ã€‚æœåŠ¡ç«¯è¿›å…¥CLOSE-WAITçŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-2çŠ¶æ€ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆFINï¼‰ï¼šæœåŠ¡å™¨å®Œæˆæ•°æ®å‘é€åï¼Œå‘é€è‡ªå·±çš„ FIN æŠ¥æ–‡ï¼ˆFIN=1ï¼‰ï¼Œåºåˆ—å·ä¸º seq=vï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¹Ÿå‡†å¤‡å…³é—­è¿æ¥ã€‚æœåŠ¡ç«¯è¿›å…¥LAST-ACKçŠ¶æ€ ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼ˆACKï¼‰ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ FIN åï¼Œå›å¤ ACK æŠ¥æ–‡ï¼ˆACK=1ï¼‰ï¼Œç¡®è®¤å·ä¸º ack=v+1ã€‚å®¢æˆ·ç«¯è¿›å…¥TIME-WAITçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¿˜è¦å†é¥å¸¦2MSLæ‰èƒ½è¿›å…¥å…³é—­çŠ¶æ€ã€‚è€ŒæœåŠ¡å™¨æ”¶åˆ°æ­¤ ACK åï¼Œè¿æ¥æ­£å¼å…³é—­ï¼Œè¿›å…¥å…³é—­çŠ¶æ€ 6.ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼ŸTCP æ˜¯å…¨åŒå·¥é€šä¿¡ï¼Œå¯ä»¥åŒå‘ä¼ è¾“æ•°æ®ã€‚ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æ•°æ®ä¼ é€ç»“æŸåå‘å‡ºè¿æ¥é‡Šæ”¾çš„é€šçŸ¥ï¼Œå¾…å¯¹æ–¹ç¡®è®¤åè¿›å…¥åŠå…³é—­çŠ¶æ€ã€‚å½“å¦ä¸€æ–¹ä¹Ÿæ²¡æœ‰æ•°æ®å†å‘é€çš„æ—¶å€™ï¼Œåˆ™å‘å‡ºè¿æ¥é‡Šæ”¾é€šçŸ¥ï¼Œå¯¹æ–¹ç¡®è®¤åå°±å®Œå…¨å…³é—­äº† TCP è¿æ¥ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šA å’Œ B æ‰“ç”µè¯ï¼Œé€šè¯å³å°†ç»“æŸåã€‚ ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šA è¯´â€œæˆ‘æ²¡å•¥è¦è¯´çš„äº†â€ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šB å›ç­”â€œæˆ‘çŸ¥é“äº†â€ï¼Œä½†æ˜¯ B å¯èƒ½è¿˜ä¼šæœ‰è¦è¯´çš„è¯ï¼ŒA ä¸èƒ½è¦æ±‚ B è·Ÿç€è‡ªå·±çš„èŠ‚å¥ç»“æŸé€šè¯ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šäºæ˜¯ B å¯èƒ½åˆå·´æ‹‰å·´æ‹‰è¯´äº†ä¸€é€šï¼Œæœ€å B è¯´â€œæˆ‘è¯´å®Œäº†â€ ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šA å›ç­”â€œçŸ¥é“äº†â€ï¼Œè¿™æ ·é€šè¯æ‰ç®—ç»“æŸã€‚ ç¡®ä¿æ•°æ®å®Œå…¨ä¼ è¾“ ç¬¬äºŒæ¬¡æŒ¥æ‰‹çš„ ACKï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ FIN åï¼Œå…ˆç¡®è®¤æ”¶åˆ°è¯·æ±‚ï¼Œä½†å¯èƒ½ä»æœ‰æ•°æ®éœ€è¦å‘é€ã€‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„ FINï¼šæœåŠ¡å™¨å‘é€å®Œå‰©ä½™æ•°æ®åï¼Œæ‰é€šçŸ¥å®¢æˆ·ç«¯è‡ªå·±ä¹Ÿè¦å…³é—­ã€‚è‹¥åˆå¹¶ç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼ˆå³æœåŠ¡å™¨ç›´æ¥å›å¤ FIN+ACKï¼‰ï¼Œå¯èƒ½å› æ•°æ®æœªå‘é€å®Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ ä¸ºä»€ä¹ˆå››æ¬¡æŒ¥æ‰‹ä¹‹åè¦ç­‰2MSL? è‹¥ç¬¬å››æ¬¡æŒ¥æ‰‹çš„ACKä¸¢å¤±ï¼ŒæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°æ–­å¼€è¿æ¥çš„æœ€åçš„ ACK æŠ¥æ–‡ï¼Œå°±ä¼šè§¦å‘è¶…æ—¶é‡å‘ FIN æŠ¥æ–‡ ï¼Œè€Œå®¢æˆ·ç«¯è¿›å…¥äº†å…³é—­çŠ¶æ€ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡å™¨æ— æ³•è¿›å…¥å…³é—­çŠ¶æ€ 7.TCPä¸ºä»€ä¹ˆå¯é ä¼ è¾“ï¼Ÿ è¿æ¥ç®¡ç†ï¼šå³ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ã€‚è¿æ¥ç®¡ç†æœºåˆ¶èƒ½å¤Ÿå»ºç«‹èµ·å¯é çš„è¿æ¥ï¼Œè¿™æ˜¯ä¿è¯ä¼ è¾“å¯é æ€§çš„å‰æã€‚ åºåˆ—å·&#x2F;ç¡®è®¤åº”ç­”ï¼šTCP å°†æ•°æ®åˆ†æˆå¤šä¸ªå°æ®µï¼Œæ¯æ®µæ•°æ®éƒ½æœ‰å”¯ä¸€çš„åºåˆ—å· ã€‚ æ—¢èƒ½é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œåˆèƒ½é¿å…æ•°æ®é‡å¤ã€‚ åŒæ—¶ï¼Œæ¥æ”¶æ–¹æ¥æ”¶åˆ°å‘é€æ–¹çš„æ•°æ®ï¼Œä¼šå›å¤ä¸€ä¸ªACKæ¥ç¡®è®¤æ”¶åˆ°äº† æ ¡éªŒå’Œï¼šTCP æŠ¥æ–‡æ®µåŒ…æ‹¬ä¸€ä¸ªæ ¡éªŒå’Œå­—æ®µï¼Œç”¨äºæ£€æµ‹æŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å˜åŒ–ã€‚å¦‚æœæ¥æ”¶æ–¹æ£€æµ‹åˆ°æ ¡éªŒå’Œé”™è¯¯ï¼Œå°±ä¼šä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µã€‚ é‡ä¼ æœºåˆ¶ : åœ¨æ•°æ®åŒ…ä¸¢å¤±æˆ–å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œé‡æ–°å‘é€æ•°æ®åŒ…ï¼Œç›´åˆ°æ”¶åˆ°å¯¹æ–¹çš„ç¡®è®¤åº”ç­”ï¼ˆACKï¼‰ã€‚ æµé‡æ§åˆ¶ï¼šæ¥æ”¶ç«¯å¤„ç†æ•°æ®çš„é€Ÿåº¦æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå‘é€æ–¹å‘é€æ•°æ®çš„é€Ÿåº¦è¿‡å¿«ï¼Œå°±ä¼šå¯¼è‡´æ¥æ”¶ç«¯çš„ç¼“å†²åŒºæº¢å‡ºï¼Œè¿›è€Œå¯¼è‡´ä¸¢åŒ…ã€‚ä¸ºäº†é¿å…ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿï¼ŒTCPæ”¯æŒæ ¹æ®æ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›ï¼Œæ¥å†³å®šå‘é€ç«¯çš„å‘é€é€Ÿåº¦ã€‚è¿™å°±æ˜¯æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ˜¯é€šè¿‡åœ¨TCPæŠ¥æ–‡æ®µé¦–éƒ¨ç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£æ¥å®ç°çš„ã€‚ æ‹¥å¡æ§åˆ¶ï¼šTCP ä¼šé‡‡ç”¨æ…¢å¯åŠ¨çš„ç­–ç•¥ï¼Œä¸€å¼€å§‹å‘çš„å°‘ï¼Œç„¶åé€æ­¥å¢åŠ ï¼Œå½“æ£€æµ‹åˆ°ç½‘ç»œæ‹¥å¡æ—¶ï¼Œä¼šé™ä½å‘é€é€Ÿç‡ã€‚åœ¨ç½‘ç»œæ‹¥å¡ç¼“è§£åï¼Œä¼ è¾“é€Ÿç‡ä¹Ÿä¼šè‡ªåŠ¨æ¢å¤ã€‚ 8.æ»‘åŠ¨çª—å£æœ¬æ¥TCPæ˜¯åªèƒ½ç­‰åˆ°ä¸Šæ¬¡è¯·æ±‚å¾—åˆ°ç¡®è®¤ï¼Œæ‰èƒ½ç»§ç»­å‘ä¸‹æ¬¡è¯·æ±‚çš„ï¼Œä½†è¿™æ ·é€šä¿¡æ•ˆç‡ä½å‘€ï¼ æ‰€ä»¥å¼•å…¥äº†çª—å£çš„æ¦‚å¿µï¼Œå•¥æ„æ€å‘¢ï¼Œå°±æ˜¯è¿™ä¸ªçª—å£å†…å¯ä»¥è¿ç»­å‘å¤šæ¡è¯·æ±‚ï¼Œè€Œä¸å¿…ç­‰ä¸€ä¸ªè¯·æ±‚å¾—åˆ°åº”ç­”äº†å†å‘ä¸‹ä¸€æ¡ï¼Œè¿™æ ·å°±æå¤§æé«˜äº†æ•ˆç‡ã€‚è€Œä¸”æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯ç´¯è®¡ç¡®è®¤ æ¯”å¦‚å›¾ä¸­ACK600è¿™æ¡ç¡®è®¤ä¸¢å¤±äº†ï¼Œæ²¡äº‹å‘€ï¼Œæˆ‘ACK700éƒ½æ¥æ”¶åˆ°äº†ï¼Œå°±ä»£è¡¨ä¹‹å‰çš„æˆ‘éƒ½æ”¶åˆ°äº†ï¼ çª—å£å¤§å°ç”±å“ªä¸€æ–¹å†³å®šï¼Ÿ å½“ç„¶æ˜¯æ¥æ”¶æ–¹å•¦ å‘é€æ–¹çš„æ»‘åŠ¨çª—å£ç¤ºæ„å›¾ åˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼š å·²å‘é€å¹¶æ”¶åˆ°ACKç¡®è®¤ å·²å‘é€ä½†æœªæ”¶åˆ°ACKç¡®è®¤ æœªå‘é€ä½†æ€»å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…ï¼Œä¹Ÿå°±æ˜¯è¿˜å¯ç”¨çš„çª—å£ æœªå‘é€ä½†æ€»å¤§å°è¶…è¿‡æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†… ç¨‹åºå¯ä»¥é€šè¿‡ä¸‰ä¸ªæŒ‡é’ˆæ¥è¡¨ç¤ºå„ä¸ªéƒ¨åˆ† SND.WNDï¼šè¡¨ç¤ºå‘é€çª—å£çš„å¤§å° SND.UNA ï¼šæ˜¯ä¸€ä¸ªç»å¯¹æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æ˜¯å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å· SND.NXTï¼šä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æœªå‘é€ä½†å¯å‘é€èŒƒå›´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å· å¯ç”¨çª—å£å¤§å° &#x3D; SND.WND -ï¼ˆSND.NXT - SND.UNAï¼‰ ä¹Ÿå°±æ˜¯æ€»çª—å£ - å·²ç”¨çª—å£ æ¥æ”¶æ–¹çš„çª—å£ç¤ºæ„ åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š å·²æ¥æ”¶å¹¶ç¡®è®¤çš„æ•°æ® æœªæ”¶åˆ°ä½†å¯ä»¥æ¥æ”¶çš„æ•°æ® æœªæ”¶åˆ°å¹¶ä¸”ä¸å¯ä»¥æ¥æ”¶çš„æ•°æ® 9.æµé‡æ§åˆ¶TCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ˜¯ä¸ºäº†æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚ æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œä»è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚ ä¸ºä»€ä¹ˆéœ€è¦æµé‡æ§åˆ¶? è¿™æ˜¯å› ä¸ºåŒæ–¹åœ¨é€šä¿¡çš„æ—¶å€™ï¼Œå‘é€æ–¹çš„é€Ÿç‡ä¸æ¥æ”¶æ–¹çš„é€Ÿç‡æ˜¯ä¸ä¸€å®šç›¸ç­‰ï¼Œå¦‚æœå‘é€æ–¹çš„å‘é€é€Ÿç‡å¤ªå¿«ï¼Œä¼šå¯¼è‡´æ¥æ”¶æ–¹å¤„ç†ä¸è¿‡æ¥ã€‚å¦‚æœæ¥æ”¶æ–¹å¤„ç†ä¸è¿‡æ¥çš„è¯ï¼Œå°±åªèƒ½æŠŠå¤„ç†ä¸è¿‡æ¥çš„æ•°æ®å­˜åœ¨ æ¥æ”¶ç¼“å†²åŒº(Receiving Buffers) é‡Œï¼ˆå¤±åºçš„æ•°æ®åŒ…ä¹Ÿä¼šè¢«å­˜æ”¾åœ¨ç¼“å­˜åŒºé‡Œï¼‰ã€‚ å¦‚æœç¼“å­˜åŒºæ»¡äº†å‘é€æ–¹è¿˜åœ¨ç‹‚å‘æ•°æ®çš„è¯ï¼Œæ¥æ”¶æ–¹åªèƒ½æŠŠæ”¶åˆ°çš„æ•°æ®åŒ…ä¸¢æ‰ã€‚å‡ºç°ä¸¢åŒ…é—®é¢˜çš„åŒæ—¶åˆç–¯ç‹‚æµªè´¹ç€çè´µçš„ç½‘ç»œèµ„æºã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿç‡ï¼Œè®©æ¥æ”¶æ–¹ä¸å‘é€æ–¹å¤„äºä¸€ç§åŠ¨æ€å¹³è¡¡æ‰å¥½ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ˆå¸¸è§è¯¯åŒºï¼‰ï¼š å‘é€ç«¯ä¸ç­‰åŒäºå®¢æˆ·ç«¯ æ¥æ”¶ç«¯ä¸ç­‰åŒäºæœåŠ¡ç«¯ TCP ä¸ºå…¨åŒå·¥(Full-Duplex, FDX)é€šä¿¡ï¼ŒåŒæ–¹å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ—¢å¯èƒ½æ˜¯å‘é€ç«¯åˆå¯èƒ½æ˜¯æœåŠ¡ç«¯ã€‚å› æ­¤ï¼Œä¸¤ç«¯å„æœ‰ä¸€ä¸ªå‘é€ç¼“å†²åŒºä¸æ¥æ”¶ç¼“å†²åŒºï¼Œä¸¤ç«¯éƒ½å„è‡ªç»´æŠ¤ä¸€ä¸ªå‘é€çª—å£å’Œä¸€ä¸ªæ¥æ”¶çª—å£ã€‚æ¥æ”¶çª—å£å¤§å°å–å†³äºåº”ç”¨ã€ç³»ç»Ÿã€ç¡¬ä»¶çš„é™åˆ¶ï¼ˆTCP ä¼ è¾“é€Ÿç‡ä¸èƒ½å¤§äºåº”ç”¨çš„æ•°æ®å¤„ç†é€Ÿç‡ï¼‰ã€‚é€šä¿¡åŒæ–¹çš„å‘é€çª—å£å’Œæ¥æ”¶çª—å£çš„è¦æ±‚ç›¸åŒ 10.æ‹¥å¡æ§åˆ¶TCPæ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é˜²æ­¢ç½‘ç»œä¸­çš„æ‹¥å¡ï¼Œç¡®ä¿æ•°æ®åœ¨ç½‘ç»œä¸­å¯é ä¼ è¾“ã€‚å®ƒçš„ç›®æ ‡æ˜¯åŠ¨æ€åœ°è°ƒæ•´æ•°æ®å‘é€é€Ÿåº¦ï¼Œä»¥é€‚åº”ç½‘ç»œçš„çŠ¶å†µã€‚ ä¸ºäº†è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼ŒTCP å‘é€æ–¹è¦ç»´æŒä¸€ä¸ª æ‹¥å¡çª—å£(cwnd) çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡æ§åˆ¶çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£å–ä¸ºæ‹¥å¡çª—å£å’Œæ¥æ”¶æ–¹çš„æ¥å—çª—å£ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚ TCP çš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼Œå³ æ…¢å¼€å§‹ã€ æ‹¥å¡é¿å…ã€å¿«é‡ä¼  å’Œ å¿«æ¢å¤ã€‚ æ…¢å¼€å§‹ï¼šæ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¼•èµ·ç½‘ç»œé˜»å¡ï¼Œå› ä¸ºç°åœ¨è¿˜ä¸çŸ¥é“ç½‘ç»œçš„ç¬¦åˆæƒ…å†µã€‚ç»éªŒè¡¨æ˜ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚cwnd åˆå§‹å€¼ä¸º 1ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ æ’­è½®æ¬¡ï¼ŒcwndåŠ å€ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰ã€‚ æ‹¥å¡é¿å…ï¼šå½“cwndè¾¾åˆ°é˜ˆå€¼ï¼ˆssthreshï¼‰åï¼Œè¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚ æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—å£ cwnd ç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´ RTT å°±æŠŠå‘é€æ–¹çš„ cwnd åŠ  1.ï¼ˆçº¿æ€§å¢é•¿ï¼‰ æ‹¥å¡å‘ç”Ÿï¼š å½“ç½‘ç»œæ‹¥å¡å‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š è¶…æ—¶é‡ä¼  é˜ˆå€¼è®¾ç½®ä¸ºcwndçš„ä¸€åŠï¼Œcwndé‡ç½®ä¸º1ï¼Œç„¶åå¯åŠ¨æ…¢å¼€å§‹ å¿«é€Ÿé‡ä¼  å¦‚æœå‘é€æ–¹åœ¨è¿ç»­æ”¶åˆ°3ä¸ªç›¸åŒçš„ACKæ—¶ï¼Œè®¤ä¸ºå‘ç”Ÿäº†ä¸¢åŒ…ï¼Œç«‹å³é‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…ï¼Œè€Œä¸ç­‰å¾…è¶…æ—¶é‡ä¼ ã€‚æ­¤æ—¶è¿›å…¥å¿«æ¢å¤ å¿«æ¢å¤ï¼ˆFast Recoveryï¼‰ï¼š åœ¨ä¸¢åŒ…å‘ç”Ÿåï¼Œè¿›å…¥å¿«æ¢å¤é˜¶æ®µï¼Œé˜ˆå€¼ä¸å˜ï¼Œcwndè¢«è°ƒæ•´ä¸ºåŸæ¥çš„ä¸€åŠï¼Œå¹¶è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼Œè€Œä¸æ˜¯å›åˆ°æ…¢å¯åŠ¨ã€‚ 12.TCPæŠ¥æ–‡çš„å¤´éƒ¨å­—æ®µ ä¸€ä¸ª TCP æŠ¥æ–‡æ®µä¸»è¦ç”±æŠ¥æ–‡æ®µå¤´éƒ¨ï¼ˆHeaderï¼‰å’Œæ•°æ®ä¸¤éƒ¨åˆ†ç»„æˆã€‚ æº&#x2F;ç›®çš„ç«¯å£å·ï¼šç”¨äºè¡¨ç¤ºå‘é€ç«¯å’Œæ¥æ”¶ç«¯ åºåˆ—å·ï¼šç”¨äºæ ‡è¯†ä» TCP å‘é€è€…å‘é€çš„æ•°æ®å­—èŠ‚æµä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„é¡ºåºå·ã€‚ é€šè¿‡ SYN åŒ…ä¼ ç»™æ¥æ”¶ç«¯ ç¡®è®¤å·ï¼šæŒ‡ä¸‹ä¸€æ¬¡ã€ŒæœŸæœ›ã€æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å·ï¼Œå‘é€ç«¯æ”¶åˆ°è¿™ä¸ªç¡®è®¤åº”ç­”ä»¥åå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æ¥æ”¶ã€‚ç”¨æ¥è§£å†³ä¸¢åŒ…çš„é—®é¢˜ã€‚** æ ¡éªŒå’Œï¼šç”¨äºæ£€æµ‹æŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å˜åŒ–ã€‚ çª—å£å¤§å°ï¼šç”¨äºæµé‡æ§åˆ¶ æ§åˆ¶ä½ï¼š å¸¸è§çš„æœ‰ ACKï¼šç¡®è®¤å­—æ®µæ˜¯å¦æœ‰æ•ˆ SYNï¼šåŒæ­¥åºå·ï¼Œç”¨äºå»ºç«‹è¿æ¥ FINï¼šç»“æŸå‘é€æ•°æ® 11.TCPç²˜åŒ…â­TCPç²˜åŒ…æ˜¯æŒ‡åœ¨TCPåè®®ä¸­ï¼Œç”±äºæ•°æ®çš„å‘é€å’Œæ¥æ”¶æ²¡æœ‰æ˜ç¡®çš„è¾¹ç•Œï¼Œå¤šä¸ªæ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªæ•°æ®åŒ…ã€‚è¿™ç§æƒ…å†µä¼šå¯¼è‡´æ¥æ”¶ç«¯æ— æ³•å‡†ç¡®åŒºåˆ†æ¯ä¸ªç‹¬ç«‹çš„æ¶ˆæ¯ï¼Œä»è€Œæ— æ³•æ­£ç¡®è§£ææ•°æ®ã€‚ è§£å†³æ–¹æ³•ï¼š å›ºå®šé•¿åº¦çš„æ¶ˆæ¯ï¼šå‘é€æ–¹å°†æ¯ä¸ªæ¶ˆæ¯å¡«å……åˆ°å›ºå®šçš„é•¿åº¦ï¼ˆä¾‹å¦‚ï¼Œæ¯ä¸ªæ¶ˆæ¯å›ºå®šä¸º100å­—èŠ‚ï¼Œä¸è¶³çš„éƒ¨åˆ†ç”¨ç‰¹å®šå­—ç¬¦å¡«å……ï¼‰ã€‚æ¥æ”¶æ–¹æ¯æ¬¡è¯»å–å›ºå®šé•¿åº¦çš„æ•°æ®å³å¯åˆ†å‰²æ¶ˆæ¯ã€‚ ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œï¼šåœ¨æ¯ä¸ªæ¶ˆæ¯çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„åˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚ï¼Œæ¢è¡Œç¬¦\\næˆ–è‡ªå®šä¹‰å­—ç¬¦ï¼‰ã€‚æ¥æ”¶æ–¹é€šè¿‡æ£€æµ‹åˆ†éš”ç¬¦æ¥åˆ†å‰²æ¶ˆæ¯ã€‚ æ¶ˆæ¯å¤´åŒ…å«é•¿åº¦ï¼šåœ¨æ¯ä¸ªæ¶ˆæ¯çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªå­—æ®µï¼ˆä¾‹å¦‚ï¼Œ4å­—èŠ‚ï¼‰ï¼Œç”¨æ¥æŒ‡ç¤ºè¯¥æ¶ˆæ¯çš„é•¿åº¦ã€‚æ¥æ”¶æ–¹å…ˆè¯»å–æ¶ˆæ¯å¤´çš„é•¿åº¦å­—æ®µï¼Œç„¶åæ ¹æ®è¿™ä¸ªé•¿åº¦è¯»å–åç»­çš„å®Œæ•´æ¶ˆæ¯ã€‚ äº”ã€IP1.IPåè®®çš„å®šä¹‰å’Œä½œç”¨IP åè®®ï¼ˆInternet Protocolï¼‰ç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¹‹é—´ä¼ è¾“æ•°æ®åŒ…ï¼Œå®ƒå®šä¹‰äº†æ•°æ®åŒ…çš„æ ¼å¼å’Œå¤„ç†è§„åˆ™ï¼Œç¡®ä¿æ•°æ®èƒ½å¤Ÿä»ä¸€ä¸ªè®¾å¤‡ä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¾å¤‡ï¼Œå¯èƒ½è·¨è¶Šå¤šä¸ªä¸­é—´ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰ã€‚ â‘ ã€å¯»å€ï¼šæ¯ä¸ªè¿æ¥åˆ°ç½‘ç»œçš„è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ã€‚IP åè®®ä½¿ç”¨è¿™äº›åœ°å€æ¥æ ‡è¯†æ•°æ®åŒ…çš„æºåœ°å€å’Œç›®çš„åœ°å€ï¼Œç¡®ä¿æ•°æ®åŒ…èƒ½å¤Ÿå‡†ç¡®åœ°ä¼ è¾“åˆ°ç›®æ ‡è®¾å¤‡ã€‚ â‘¡ã€è·¯ç”±ï¼šIP åè®®è´Ÿè´£å†³å®šæ•°æ®åŒ…åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„è·¯å¾„ã€‚æ¯”å¦‚è¯´è·¯ç”±å™¨ä½¿ç”¨è·¯ç”±è¡¨å’Œ IP åœ°å€ä¿¡æ¯æ¥ç¡®å®šæ•°æ®åŒ…çš„æœ€ä½³ä¼ è¾“è·¯å¾„ã€‚ â‘¢ã€åˆ†ç‰‡å’Œé‡ç»„ï¼šå½“æ•°æ®åŒ…è¿‡å¤§æ— æ³•åœ¨æŸä¸ªç½‘ç»œä¸Šä¼ è¾“æ—¶ï¼ŒIP åè®®ä¼šå°†æ•°æ®åŒ…åˆ†æˆæ›´å°çš„ç‰‡æ®µè¿›è¡Œä¼ è¾“ã€‚æ¥æ”¶ç«¯ä¼šæ ¹æ®å¤´éƒ¨ä¿¡æ¯å°†è¿™äº›ç‰‡æ®µé‡æ–°ç»„è£…æˆå®Œæ•´çš„æ•°æ®åŒ…ã€‚ 2.åŸŸåå’ŒIPçš„å…³ç³»ï¼Ÿä¸€ä¸ªIPå¯ä»¥å¯¹åº”å¤šä¸ªåŸŸåå—ï¼Ÿ IP åœ°å€åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­æ˜¯æƒŸä¸€çš„ï¼Œç”¨æ¥æ ‡è¯†æ¯ä¸€ä¸ªç½‘ç»œä¸Šçš„è®¾å¤‡ï¼Œå…¶ç›¸å½“äºä¸€ä¸ªäººçš„èº«ä»½è¯å· åŸŸååœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ä¹Ÿæ˜¯æƒŸä¸€çš„ï¼Œå°±åƒæ˜¯ä¸€ä¸ªäººçš„åå­—ã€ç»°å· å‡å¦‚ä½ æœ‰å¤šä¸ªä¸ç”¨çš„ç»°å·ï¼Œä½ çš„æœ‹å‹å¯ä»¥ç”¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªç»°å·å«ä½ ï¼Œä½†ä½ çš„èº«ä»½è¯å·ç å´æ˜¯æƒŸä¸€çš„ã€‚ä½†åŒæ—¶ä½ çš„ç»°å·ä¹Ÿå¯èƒ½å’Œåˆ«äººé‡å¤ï¼Œå‡å¦‚ä½ ä¸åœ¨ï¼Œæœ‰äººå«ä½ çš„ç»°å·ï¼Œå…¶å®ƒäººå¯èƒ½å°±ç­”åº”äº†ã€‚ ä¸€ä¸ªåŸŸåå¯ä»¥å¯¹åº”å¤šä¸ª IPï¼Œä½†è¿™ç§æƒ…å†µ DNS åšè´Ÿè½½å‡è¡¡çš„ï¼Œåœ¨ç”¨æˆ·è®¿é—®è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªåŸŸååªèƒ½å¯¹åº”ä¸€ä¸ª IPã€‚ è€Œä¸€ä¸ª IP å´å¯ä»¥å¯¹åº”å¤šä¸ªåŸŸåï¼Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ ä¸€ä¸ªåŸŸååªèƒ½å®é™…å¯¹åº”ä¸€ä¸ªIPï¼Œä¸€ä¸ªIPå¯ä»¥å¯¹åº”å¤šä¸ªåŸŸå 3.ä¸ºä»€ä¹ˆæ—¢æœ‰IPåœ°å€åˆæœ‰MACåœ°å€ MAC åœ°å€å’Œ IP åœ°å€éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ MAC åœ°å€æ˜¯æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯å†™åœ¨ç½‘å¡ä¸Šçš„ç‰©ç†åœ°å€ï¼Œç”¨æ¥å®šä¹‰ç½‘ç»œè®¾å¤‡çš„ä½ç½®ï¼Œä¸å¯å˜æ›´ã€‚ IP åœ°å€æ˜¯ç½‘ç»œå±‚å’Œä»¥ä¸Šå„å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯ä¸€ç§é€»è¾‘åœ°å€ã€‚IP åœ°å€ç”¨æ¥åŒºåˆ«ç½‘ç»œä¸Šçš„è®¡ç®—æœºã€‚ ç±»ä¼¼ç‰©ç†åœ°å€ï¼ˆMACï¼‰å’Œé€»è¾‘åœ°å€ï¼ˆIPï¼‰çš„å…³ç³» ä¸ºä»€ä¹ˆæœ‰äº† MAC åœ°å€è¿˜éœ€è¦ IP åœ°å€ï¼Ÿ å¦‚æœæˆ‘ä»¬åªä½¿ç”¨ MAC åœ°å€è¿›è¡Œå¯»å€çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è·¯ç”±å™¨è®°ä½æ¯ä¸ª MAC åœ°å€å±äºå“ªä¸ªå­ç½‘ï¼Œä¸ç„¶ä¸€æ¬¡è·¯ç”±å™¨æ”¶åˆ°æ•°æ®åŒ…éƒ½è¦æ»¡ä¸–ç•Œå¯»æ‰¾ç›®çš„ MAC åœ°å€ã€‚è€Œæˆ‘ä»¬çŸ¥é“ MAC åœ°å€çš„é•¿åº¦ä¸º 48 ä½ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šå…±æœ‰ 2 çš„ 48 æ¬¡æ–¹ä¸ª MAC åœ°å€ï¼Œè¿™å°±æ„å‘³ç€æ¯ä¸ªè·¯ç”±å™¨éœ€è¦ 256T çš„å†…å­˜ï¼Œæ˜¾ç„¶æ˜¯ä¸ç°å®çš„ã€‚ å’Œ MAC åœ°å€ä¸åŒï¼ŒIP åœ°å€æ˜¯å’Œåœ°åŸŸç›¸å…³çš„ï¼Œåœ¨ä¸€ä¸ªå­ç½‘ä¸­çš„è®¾å¤‡ï¼Œæˆ‘ä»¬ç»™å…¶åˆ†é…çš„ IP åœ°å€å‰ç¼€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·è·¯ç”±å™¨å°±èƒ½æ ¹æ® IP åœ°å€çš„å‰ç¼€çŸ¥é“è¿™ä¸ªè®¾å¤‡å±äºå“ªä¸ªå­ç½‘ï¼Œå‰©ä¸‹çš„å¯»å€å°±äº¤ç»™å­ç½‘å†…éƒ¨å®ç°ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†è·¯ç”±å™¨æ‰€éœ€è¦çš„å†…å­˜ã€‚ ç®€å•è¯´ï¼Œå°±æ˜¯MACåœ°å€å¤ªé•¿äº†ï¼Œè·¯ç”±å™¨å­˜å‚¨èµ·æ¥å ç”¨å†…å­˜ï¼›å¦ä¸€æ–¹é¢ï¼Œä¸€ä¸ªå­ç½‘å†…çš„IPåœ°å€å…·æœ‰ç›¸åŒçš„å‰ç¼€ï¼Œå› æ­¤å¯»å€èµ·æ¥åªéœ€è¦çŸ¥é“è¯¥IPåœ°å€åœ¨å“ªä¸ªå­ç½‘ï¼Œå‰©ä¸‹çš„å¯»å€å°±äº¤ç»™å­ç½‘å†…éƒ¨å®ç°ï¼Œå¯å¤§å¤§å‡å°‘è·¯ç”±å™¨æ‰€éœ€å†…å­˜ 4.ARPåè®®ARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰æ˜¯ç½‘ç»œé€šä¿¡ä¸­çš„ä¸€ç§åè®®ï¼Œä¸»è¦ç›®çš„æ˜¯å°†ç½‘ç»œå±‚çš„ IP åœ°å€è§£æä¸ºé“¾è·¯å±‚çš„ MAC åœ°å€ã€‚ ARP å·¥ä½œåŸç†ï¼š è®°ä½å‡ ä¸ªå…³é”®è¯ï¼šARP è¡¨ã€å¹¿æ’­é—®è¯¢ã€å•æ’­å“åº”ã€‚ ARP åè®®å·¥ä½œæ—¶æœ‰ä¸€ä¸ªå¤§å‰æï¼Œé‚£å°±æ˜¯ ARP è¡¨ã€‚ åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œæ¯ä¸ªç½‘ç»œè®¾å¤‡éƒ½è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ª ARP è¡¨ï¼ŒARP è¡¨è®°å½•äº†æŸäº›å…¶ä»–ç½‘ç»œè®¾å¤‡çš„ IP åœ°å€-MAC åœ°å€æ˜ å°„å…³ç³»ï¼Œè¯¥æ˜ å°„å…³ç³»ä»¥ &lt;IP, MAC, TTL&gt; ä¸‰å…ƒç»„çš„å½¢å¼å­˜å‚¨ã€‚å…¶ä¸­ï¼ŒTTL ä¸ºè¯¥æ˜ å°„å…³ç³»çš„ç”Ÿå­˜å‘¨æœŸï¼Œå…¸å‹å€¼ä¸º 20 åˆ†é’Ÿï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼Œè¯¥æ¡ç›®å°†è¢«ä¸¢å¼ƒã€‚ å·¥ä½œæµç¨‹ â‘ ã€ARP è¯·æ±‚ å½“ä¸»æœº A è¦å‘é€æ•°æ®ç»™ä¸»æœº B æ—¶ï¼Œé¦–å…ˆä¼šåœ¨è‡ªå·±çš„ ARP è¡¨ä¸­æŸ¥æ‰¾ä¸»æœº B çš„ MAC åœ°å€ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¸»æœº A ä¼šå‘ç½‘ç»œä¸­å¹¿æ’­ä¸€ä¸ª ARP è¯·æ±‚æ•°æ®åŒ…ï¼Œè¯·æ±‚ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºå‘Šè¯‰å®ƒä»¬çš„ MAC åœ°å€ï¼›è¿™ä¸ªè¯·æ±‚åŒ…å«äº†è¯·æ±‚è®¾å¤‡å’Œç›®æ ‡è®¾å¤‡çš„ IP å’Œ MAC åœ°å€ã€‚ â‘¡ã€ARP åº”ç­” ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºéƒ½ä¼šæ”¶åˆ°è¿™ä¸ª ARP è¯·æ±‚ï¼Œä½†åªæœ‰ä¸»æœº B ä¼šå›å¤ ARP åº”ç­”ï¼Œå‘Šè¯‰ä¸»æœº A è‡ªå·±çš„ MAC åœ°å€ã€‚ å¹¶ä¸”ä¸»æœº B ä¼šå°†ä¸»æœº A çš„ IP å’Œ MAC åœ°å€æ˜ å°„å…³ç³»ç¼“å­˜åˆ°è‡ªå·±çš„ ARP ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡é€šä¿¡æ—¶ç›´æ¥ä½¿ç”¨ã€‚ â‘¢ã€æ›´æ–° ARP ç¼“å­˜ ä¸»æœº A æ”¶åˆ°ä¸»æœº B çš„ ARP åº”ç­”åï¼Œä¹Ÿä¼šå°†ä¸»æœº B çš„ IP å’Œ MAC åœ°å€æ˜ å°„å…³ç³»ç¼“å­˜åˆ°è‡ªå·±çš„ ARP ç¼“å­˜ä¸­ã€‚ å…­ã€ç½‘ç»œæ”»å‡»","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"JVM","slug":"å…«è‚¡/JVM","date":"2024-10-28T12:29:13.000Z","updated":"2025-03-11T05:00:58.977Z","comments":true,"path":"2024/10/28/å…«è‚¡/JVM/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/JVM/","excerpt":"è¿™é‡Œæ˜¯æœ‰å…³JVMçš„å…«è‚¡","text":"è¿™é‡Œæ˜¯æœ‰å…³JVMçš„å…«è‚¡ 1.å¼•è¨€1.JVMçš„ç‰¹æ€§æœ€é‡è¦çš„ç‰¹æ€§è¿˜æ˜¯è·¨å¹³å°ï¼Œä»¥ä¸‹æ˜¯å…¶å®ƒç‰¹æ€§ â‘ ã€åƒåœ¾å›æ”¶ï¼šJVM å¯ä»¥è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGarbage Collectionï¼‰é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ â‘¡ã€JITï¼šJVM åŒ…å«ä¸€ä¸ªå³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰ï¼Œå®ƒåœ¨è¿è¡Œæ—¶å°†çƒ­ç‚¹ä»£ç ç¼“å­˜åˆ° codeCache ä¸­ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¸ç”¨å†ä¸€è¡Œä¸€è¡Œè§£é‡Šï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç¼“å­˜åçš„æœºå™¨ç ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šæé«˜å¾ˆå¤šã€‚ â‘¢ã€å¤šè¯­è¨€æ”¯æŒï¼šä»»ä½•å¯ä»¥é€šè¿‡ Java ç¼–è¯‘çš„è¯­è¨€ï¼Œæ¯”å¦‚è¯´ Groovyã€Kotlinã€Scala ç­‰ï¼Œéƒ½å¯ä»¥åœ¨ JVM ä¸Šè¿è¡Œã€‚ 2.å†…å­˜ç®¡ç†1.JVMçš„å†…å­˜åŒºåŸŸJVM çš„å†…å­˜åŒºåŸŸï¼Œæœ‰æ—¶å« JVM çš„å†…å­˜ç»“æ„ï¼Œæœ‰æ—¶ä¹Ÿå« JVM è¿è¡Œæ—¶æ•°æ®åŒº ä¸»è¦åŒ…æ‹¬ ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ å †ï¼ˆHeapï¼‰ æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å…¶ä¸­ çº¿ç¨‹ç§æœ‰çš„ï¼šç¨‹åºè®¡æ•°å™¨ï¼Œè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆ çº¿ç¨‹å…±äº«çš„ï¼šå †ï¼Œæ–¹æ³•åŒºï¼Œç›´æ¥å†…å­˜ (ä¹Ÿå³æœ¬åœ°å†…å­˜) ä¸‹é¢ä¾æ¬¡ä»‹ç»è¿™äº›åŒºåŸŸï¼š 1.ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ä¹Ÿè¢«ç§°ä¸º PC å¯„å­˜å™¨ï¼Œæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ã€‚ çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä»½ï¼Œå†…éƒ¨ä¿å­˜çš„å­—èŠ‚ç çš„è¡Œå·ã€‚å¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ ä»ä¸Šé¢çš„ä»‹ç»ä¸­æˆ‘ä»¬çŸ¥é“äº†ç¨‹åºè®¡æ•°å™¨ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ æ³¨æ„ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OutOfMemoryError çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ 2.è™šæ‹Ÿæœºæ ˆ Java è™šæ‹Ÿæœºæ ˆï¼ˆJVM æ ˆï¼‰ä¸­æ˜¯ä¸€ä¸ªä¸ªæ ˆå¸§ï¼Œæ¯ä¸ªæ ˆå¸§å¯¹åº”ä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚å½“çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§ï¼Œå¹¶å°†æ ˆå¸§å‹å…¥æ ˆä¸­ã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå°†æ ˆå¸§ä»æ ˆä¸­ç§»é™¤ã€‚ æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªç§æœ‰çš„æ ˆï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€æ ·ã€‚ æ ˆå¸§ï¼šç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼š StackOverFlowErrorï¼š è‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚ OutOfMemoryErrorï¼š å¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜? åƒåœ¾å›æ”¶ä¸»è¦æŒ‡å°±æ˜¯å †å†…å­˜ï¼Œå½“æ ˆå¸§å¼¹æ ˆä»¥åï¼Œå†…å­˜å°±ä¼šé‡Šæ”¾ æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¥½å—?æœªå¿…ï¼Œé»˜è®¤çš„æ ˆå†…å­˜é€šå¸¸ä¸º1024kï¼Œæ ˆè¿‡å¤§ä¼šå¯¼è‡´çº¿ç¨‹æ•°å˜å°‘ æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨?å¦‚æœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼ˆä¼ å…¥æœ‰å‚æ•°ï¼‰ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼ˆæœ‰è¿”å›å€¼ï¼‰ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º? æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡ºï¼Œå…¸å‹é—®é¢˜:é€’å½’è°ƒç”¨æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º å †æ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ? å †å±äºçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ä¸Šåˆ†é…ï¼Œç”Ÿå‘½å‘¨æœŸä¸ç”±å•ä¸ªæ–¹æ³•è°ƒç”¨æ‰€å†³å®šï¼Œå¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸåç»§ç»­å­˜åœ¨ï¼Œç›´åˆ°ä¸å†è¢«ä»»ä½•å˜é‡å¼•ç”¨ï¼Œç„¶åè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ æ ˆå±äºçº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œä¸»è¦å­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œé€šå¸¸éšç€æ–¹æ³•è°ƒç”¨çš„ç»“æŸè€Œè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸éœ€è¦åƒåœ¾æ”¶é›†å™¨å¤„ç†ã€‚ 3.æœ¬åœ°æ–¹æ³•æ ˆ ä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è™šæ‹Ÿæœºæ ˆæ˜¯æœåŠ¡ Java æ–¹æ³•çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºè°ƒç”¨ Native æ–¹æ³•æœåŠ¡çš„ï¼› åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­ï¼Œä¸»è¦å­˜æ”¾äº† native æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚å½“ä¸€ä¸ª Java ç¨‹åºè°ƒç”¨ä¸€ä¸ª native æ–¹æ³•æ—¶ï¼ŒJVM ä¼šåˆ‡æ¢åˆ°æœ¬åœ°æ–¹æ³•æ ˆæ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚ æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§é”™è¯¯ã€‚ 4.å † å †ï¼ˆheapï¼‰æ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œåœ¨ JVM å¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨å¯¹è±¡çš„ã€‚ ä»å†…å­˜å›æ”¶çš„è§’åº¦æ¥çœ‹ï¼Œç”±äºåƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡çš„ï¼Œæ‰€ä»¥å †ä¹Ÿä¼šè¢«åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€‚æ–°ç”Ÿä»£åˆä¼šåˆ’åˆ†ä¸ºEdenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ ç®€å•ä»‹ç»ä¸€ä¸‹JITå’Œé€ƒé€¸åˆ†æï¼š å¸¸è§çš„ç¼–è¯‘å‹è¯­è¨€å¦‚ C++ï¼Œé€šå¸¸ä¼šæŠŠä»£ç ç›´æ¥ç¼–è¯‘æˆ CPU æ‰€èƒ½ç†è§£çš„æœºå™¨ç æ¥è¿è¡Œã€‚è€Œ Java ä¸ºäº†å®ç°â€œä¸€æ¬¡ç¼–è¯‘ï¼Œå¤„å¤„è¿è¡Œâ€çš„ç‰¹æ€§ï¼ŒæŠŠç¼–è¯‘çš„è¿‡ç¨‹åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œé¦–å…ˆå®ƒä¼šå…ˆç”± javac ç¼–è¯‘æˆé€šç”¨çš„ä¸­é—´å½¢å¼â€”â€”å­—èŠ‚ç ï¼Œç„¶åå†ç”±è§£é‡Šå™¨é€æ¡å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç æ¥æ‰§è¡Œã€‚æ‰€ä»¥åœ¨æ€§èƒ½ä¸Šï¼ŒJava å¯èƒ½ä¼šå¹²ä¸è¿‡ C++ è¿™ç±»ç¼–è¯‘å‹è¯­è¨€ã€‚ ä¸ºäº†ä¼˜åŒ– Java çš„æ€§èƒ½ ï¼ŒJVM åœ¨è§£é‡Šå™¨ä¹‹å¤–å¼•å…¥äº† JIT ç¼–è¯‘å™¨ï¼šå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œå³æ—¶ç¼–è¯‘å™¨é€æ¸å‘æŒ¥ä½œç”¨ï¼ŒæŠŠè¶Šæ¥è¶Šå¤šçš„ä»£ç ç¼–è¯‘ä¼˜åŒ–æˆæœ¬åœ°ä»£ç ï¼Œæ¥è·å–æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚è§£é‡Šå™¨è¿™æ—¶å¯ä»¥ä½œä¸ºç¼–è¯‘è¿è¡Œçš„é™çº§æ‰‹æ®µï¼Œåœ¨ä¸€äº›ä¸å¯é çš„ç¼–è¯‘ä¼˜åŒ–å‡ºç°é—®é¢˜æ—¶ï¼Œå†åˆ‡æ¢å›è§£é‡Šæ‰§è¡Œï¼Œä¿è¯ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚ é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰æ˜¯ä¸€ç§ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºåˆ¤æ–­å¯¹è±¡çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœç¼–è¯‘å™¨ç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸ä¼šé€ƒé€¸å‡ºæ–¹æ³•æˆ–çº¿ç¨‹çš„èŒƒå›´ï¼Œå®ƒå¯ä»¥é€‰æ‹©åœ¨æ ˆä¸Šåˆ†é…è¿™ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨å †ä¸Šã€‚è¿™æ ·åšå¯ä»¥å‡å°‘åƒåœ¾å›æ”¶çš„å‹åŠ›ï¼Œå¹¶æé«˜æ€§èƒ½ã€‚ å †æœ€å®¹æ˜“å‡ºç°OOMé—®é¢˜ï¼š OutOfMemoryError: GC Overhead Limit Exceededï¼šå½“ JVM èŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¯¥é”™è¯¯ã€‚ java.lang.OutOfMemoryError: Java heap spaceï¼šå‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘è¯¥é”™è¯¯ã€‚å’Œæœ¬æœºçš„ç‰©ç†å†…å­˜æ— å…³ï¼Œå’Œæˆ‘ä»¬é…ç½®çš„è™šæ‹Ÿæœºå†…å­˜å¤§å°æœ‰å…³ï¼ 5.æ–¹æ³•åŒº æ–¹æ³•åŒºå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå±äº Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„ä¸€ä¸ªé€»è¾‘æ¦‚å¿µã€‚æ¯ä¸ªJVM åªæœ‰ä¸€ä¸ªæ–¹æ³•åŒºï¼Œå®ƒæ˜¯ä¸€ä¸ªå…±äº«çš„èµ„æºã€‚ å½“è™šæ‹Ÿæœºè¦ä½¿ç”¨ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒéœ€è¦è¯»å–å¹¶è§£æ Class æ–‡ä»¶è·å–ç›¸å…³ä¿¡æ¯ï¼Œå†å°†ä¿¡æ¯å­˜å…¥åˆ°æ–¹æ³•åŒºã€‚ æ–¹æ³•åŒºä¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚ æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´çš„å…³ç³»å¾ˆåƒ Java ä¸­ æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ï¼Œè¿™é‡Œçš„ç±»å°±å¯ä»¥çœ‹ä½œæ˜¯æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´ï¼Œ æ¥å£å¯ä»¥çœ‹ä½œæ˜¯æ–¹æ³•åŒºï¼Œä¹Ÿå°±æ˜¯è¯´æ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸¤ç§å®ç°æ–¹å¼ã€‚ å¹¶ä¸”ï¼Œæ°¸ä¹…ä»£æ˜¯ JDK 1.8 ä¹‹å‰çš„æ–¹æ³•åŒºå®ç°ï¼ŒJDK 1.8 åŠä»¥åæ–¹æ³•åŒºçš„å®ç°å˜æˆäº†å…ƒç©ºé—´ã€‚ å…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢? æ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®çš„å›ºå®šå¤§å°ä¸Šé™ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼ˆä¹Ÿå°±æ˜¯å—åˆ° JVM å†…å­˜çš„é™åˆ¶ï¼‰ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œè™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡ºï¼Œä½†æ˜¯æ¯”åŸæ¥å‡ºç°çš„å‡ ç‡ä¼šæ›´å°ã€‚ ç›´æ¥å†…å­˜ï¼ˆä¸å±äºJVMçš„å†…å­˜ç»“æ„ æ“ä½œç³»ç»Ÿåˆ’åˆ†çš„ä¸€å—ç”¨äºNIOï¼ˆnew ioï¼‰çš„æ•°æ®ç¼“å†²åŒºï¼Œå¯ä»¥æé«˜è¯»å†™æ€§èƒ½ï¼Œä¸å±äºJVMçš„å†…å­˜ç»“æ„ï¼Œä¸å—JVMå†…å­˜å›æ”¶ç®¡ç† 2.JDK1.6ã€1.7ã€1.8å†…å­˜åŒºåŸŸçš„å˜åŒ–ä¸»è¦ä½“ç°åœ¨æ–¹æ³•åŒºçš„å®ç°ï¼š JDK1.6 ä½¿ç”¨æ°¸ä¹…ä»£å®ç°æ–¹æ³•åŒºï¼š JDK1.7 æ—¶å‘ç”Ÿäº†ä¸€äº›å˜åŒ–ï¼Œå°†å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ï¼Œå­˜æ”¾åœ¨å †ä¸Š åœ¨ JDK1.8 æ—¶å½»åº•å¹²æ‰äº†æ°¸ä¹…ä»£ï¼Œè€Œåœ¨ç›´æ¥å†…å­˜ä¸­åˆ’å‡ºä¸€å—åŒºåŸŸä½œä¸ºå…ƒç©ºé—´ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ã€ç±»å¸¸é‡æ± éƒ½ç§»åŠ¨åˆ°å…ƒç©ºé—´ã€‚ 3.å››ç§å¼•ç”¨ç±»å‹å››ç§ï¼Œåˆ†åˆ«æ˜¯å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰å’Œè™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰ã€‚ å¼ºå¼•ç”¨ï¼šæ˜¯ Java ä¸­æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ã€‚ä½¿ç”¨ new å…³é”®å­—èµ‹å€¼çš„å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ï¼Œå‘ç”Ÿ gc çš„æ—¶å€™ä¸ä¼šè¢«å›æ”¶ã€‚ è½¯å¼•ç”¨ï¼šæ˜¯ä¸€ç§ç›¸å¯¹è¾ƒå¼±çš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ SoftReference ç±»å®ç°ã€‚ æœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ä¼šè¢«å›æ”¶ã€‚ å¼±å¼•ç”¨ï¼šå¯ä»¥é€šè¿‡ WeakReference ç±»å®ç°ã€‚ä»–çš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´ä½ä¸€ç‚¹ï¼Œ æœ‰ç”¨ä½†ä¸æ˜¯å¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€æ¬¡GCæ—¶ä¼šè¢«å›æ”¶ï¼Œè€Œä¸ç®¡å†…å­˜æ˜¯å¦è¶³å¤Ÿã€‚ è™šå¼•ç”¨ï¼šæ˜¯æœ€å¼±çš„å¼•ç”¨å…³ç³»ï¼Œ å¯ä»¥é€šè¿‡ PhantomReference ç±»å®ç°ã€‚è™šå¼•ç”¨å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«å›æ”¶ã€‚ä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ï¼Œå¯ä»¥ç”¨äºç®¡ç†ç›´æ¥å†…å­˜ã€‚ è™šå¼•ç”¨çš„ç”¨é€”æ˜¯åœ¨ gc æ—¶è¿”å›ä¸€ä¸ªé€šçŸ¥ã€‚ å¼•ç”¨å…³ç³»ä»å¼ºåˆ°å¼±ï¼šå¼ºå¼•ç”¨ &gt; è½¯å¼•ç”¨ &gt; å¼±å¼•ç”¨ &gt; è™šå¼•ç”¨ 4.å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²å†…å­˜æº¢å‡ºï¼ˆOut of Memoryï¼Œä¿—ç§° OOMï¼‰å’Œå†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä½†å®ƒä»¬éƒ½ä¸å†…å­˜ç®¡ç†æœ‰å…³ã€‚ â‘ ã€å†…å­˜æº¢å‡ºï¼šæ˜¯æŒ‡å½“ç¨‹åºè¯·æ±‚åˆ†é…å†…å­˜æ—¶ï¼Œç”±äºæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ»¡è¶³å…¶éœ€æ±‚ï¼Œä»è€Œè§¦å‘çš„é”™è¯¯ã€‚åœ¨ Java ä¸­ï¼Œè¿™ç§æƒ…å†µä¼šæŠ›å‡º OutOfMemoryError,OOMã€‚ å†…å­˜æº¢å‡ºå¯èƒ½æ˜¯ç”±äºå†…å­˜æ³„æ¼å¯¼è‡´çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºç¨‹åºä¸€æ¬¡æ€§å°è¯•åˆ†é…å¤§é‡å†…å­˜ï¼Œå†…å­˜ç›´æ¥å°±å¹²å´©æºƒäº†å¯¼è‡´çš„ï¼Œæ¯”å¦‚å †å†…å­˜ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ ã€‚ â‘¡ã€å†…å­˜æ³„æ¼ï¼šæ˜¯æŒ‡ç¨‹åºåœ¨ä½¿ç”¨å®Œå†…å­˜åï¼Œæœªèƒ½é‡Šæ”¾å·²åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œå¯¼è‡´è¿™éƒ¨åˆ†å†…å­˜æ— æ³•å†è¢«ä½¿ç”¨ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå†…å­˜æ³„æ¼ä¼šå¯¼è‡´å¯ç”¨å†…å­˜é€æ¸å‡å°‘ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚ åœ¨ Java ä¸­ï¼Œå†…å­˜æ³„æ¼é€šå¸¸å‘ç”Ÿåœ¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡æŒæœ‰çŸ­æœŸå­˜æ´»å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œé•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆæ²¡æœ‰åŠæ—¶é‡Šæ”¾å¯¹çŸ­æœŸå­˜æ´»å¯¹è±¡çš„å¼•ç”¨ï¼Œä»è€Œå¯¼è‡´çŸ­æœŸå­˜æ´»å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚ ç”¨ä¸€ä¸ªæ¯”è¾ƒæœ‰å‘³é“çš„æ¯”å–»æ¥å½¢å®¹å°±æ˜¯ï¼Œå†…å­˜æº¢å‡ºæ˜¯æ’é˜Ÿå»è¹²å‘ï¼Œå‘ç°æ²¡å‘äº†ï¼›å†…å­˜æ³„æ¼ï¼Œå°±æ˜¯æœ‰äººå ç€èŒ…å‘ä¸æ‹‰å±ï¼Œå ç€èŒ…å‘ä¸æ‹‰å±çš„å¤šäº†å¯èƒ½ä¼šå¯¼è‡´å‘ä½ä¸å¤Ÿç”¨ã€‚ å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¿›å…¥è€å¹´ä»£ï¼Ÿï¼ˆTODOï¼‰ å¯¹è±¡é€šå¸¸ä¼šå…ˆåœ¨å¹´è½»ä»£ä¸­åˆ†é…ï¼Œç„¶åéšç€æ—¶é—´çš„æ¨ç§»å’Œåƒåœ¾æ”¶é›†çš„å¤„ç†ï¼ŒæŸäº›å¯¹è±¡ä¼šè¿›å…¥åˆ°è€å¹´ä»£ä¸­ã€‚ â‘ ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£ å¯¹è±¡åœ¨å¹´è½»ä»£ä¸­å­˜æ´»è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼ˆå³ç»è¿‡è¶³å¤Ÿå¤šçš„åƒåœ¾å›æ”¶å‘¨æœŸï¼‰åï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚ æ¯æ¬¡ GC æœªè¢«å›æ”¶çš„å¯¹è±¡ï¼Œå…¶å¹´é¾„ä¼šå¢åŠ ã€‚å½“å¯¹è±¡çš„å¹´é¾„è¶…è¿‡ä¸€ä¸ªç‰¹å®šé˜ˆå€¼ï¼ˆé»˜è®¤é€šå¸¸æ˜¯ 15ï¼‰ï¼Œå®ƒå°±ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚è¿™ä¸ªå¹´é¾„é˜ˆå€¼å¯ä»¥é€šè¿‡ JVM å‚æ•°-XX:MaxTenuringThresholdæ¥è®¾ç½®ã€‚ â‘¡ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ ä¸ºäº†é¿å…åœ¨å¹´è½»ä»£ä¸­é¢‘ç¹å¤åˆ¶å¤§å¯¹è±¡ï¼ŒJVM æä¾›äº†ä¸€ç§ç­–ç•¥ï¼Œå…è®¸å¤§å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£ä¸­åˆ†é…ã€‚ è¿™äº›æ˜¯æ‰€è°“çš„â€œå¤§å¯¹è±¡â€ï¼Œå…¶å¤§å°è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼ˆç”± JVM å‚æ•°-XX:PretenureSizeThresholdæ§åˆ¶ï¼‰ã€‚ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…å¯ä»¥å‡å°‘åœ¨å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹é—´çš„æ•°æ®å¤åˆ¶ã€‚ â‘¢ã€åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š é™¤äº†å›ºå®šçš„å¹´é¾„é˜ˆå€¼ï¼Œè¿˜ä¼šæ ¹æ®å„ä¸ªå¹´é¾„æ®µå¯¹è±¡çš„å­˜æ´»å¤§å°å’Œå†…å­˜ç©ºé—´ç­‰å› ç´ åŠ¨æ€è°ƒæ•´å¯¹è±¡çš„æ™‹å‡ç­–ç•¥ã€‚ æ¯”å¦‚è¯´ï¼Œåœ¨ Survivor ç©ºé—´ä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œé‚£ä¹ˆå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ 2.ç±»åŠ è½½å™¨1.å¯¹è±¡çš„å†…å­˜å¸ƒå±€åœ¨ Hotspot è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚ å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š æ ‡è®°å­—æ®µï¼ˆMark Wordï¼‰ï¼šç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œ å¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ç­‰ã€‚ ç±»å‹æŒ‡é’ˆï¼ˆKlass pointerï¼‰ï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚ å¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œä»…ä»…èµ·å ä½ä½œç”¨ã€‚ å› ä¸º Hotspot è™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯ 8 å­—èŠ‚çš„å€æ•°ï¼ˆ1 å€æˆ– 2 å€ï¼‰ï¼Œå› æ­¤ï¼Œå½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚ 2.å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ ç±»åŠ è½½æ£€æŸ¥ï¼šè™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚ åˆ†é…å†…å­˜ï¼šåœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚ å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚ åˆå§‹åŒ–é›¶å€¼ï¼šå†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œ è¿™ä¸€æ­¥ä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œ ç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚ è®¾ç½®å¯¹è±¡å¤´ï¼šåˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œ ä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€ å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚ æ‰§è¡Œ init æ–¹æ³•ï¼šåœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œ ä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹â€”â€”æ„é€ å‡½æ•°ï¼Œ å³classæ–‡ä»¶ä¸­çš„æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ï¼Œ å¯¹è±¡éœ€è¦çš„å…¶ä»–èµ„æºå’ŒçŠ¶æ€ä¿¡æ¯è¿˜æ²¡æœ‰æŒ‰ç…§é¢„å®šçš„æ„å›¾æ„é€ å¥½ã€‚ æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œæ–¹æ³•ï¼Œ æŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨è¢«æ„é€ å‡ºæ¥ã€‚ 3.ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼ˆå †å†…å­˜å¦‚ä½•åˆ†é…ï¼‰ç±»åŠ è½½å®Œæˆåï¼Œæ¥ç€ä¼šåœ¨Javaå †ä¸­åˆ’åˆ†ä¸€å—å†…å­˜åˆ†é…ç»™å¯¹è±¡ã€‚å†…å­˜åˆ†é…æ ¹æ®Javaå †æ˜¯å¦è§„æ•´ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’ åŸç†ï¼šç”¨è¿‡çš„å†…å­˜å…¨éƒ¨æ•´åˆåˆ°ä¸€è¾¹ï¼Œæ²¡æœ‰ç”¨è¿‡çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æœ‰ä¸€ä¸ªåˆ†ç•ŒæŒ‡é’ˆï¼Œåªéœ€è¦å‘ç€æ²¡ç”¨è¿‡çš„å†…å­˜æ–¹å‘å°†è¯¥æŒ‡é’ˆç§»åŠ¨å¯¹è±¡å†…å­˜å¤§å°ä½ç½®å³å¯ã€‚ ç©ºé—²åˆ—è¡¨ï¼š åŸç†ï¼šè™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­ä¼šè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œæ‰¾ä¸€å—å„¿è¶³å¤Ÿå¤§çš„å†…å­˜å—å„¿æ¥åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œæœ€åæ›´æ–°åˆ—è¡¨è®°å½•ã€‚ é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼æ˜¯ç”± Java å †æ˜¯å¦è§„æ•´æ¥å†³å®šçš„ï¼Œè€Œ Java å †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚ æŒ‡é’ˆç¢°æ’é€‚ç”¨äºç®¡ç†ç®€å•ã€ç¢ç‰‡åŒ–è¾ƒå°‘çš„å†…å­˜åŒºåŸŸï¼ˆå¦‚å¹´è½»ä»£ï¼‰ï¼Œè€Œç©ºé—²åˆ—è¡¨é€‚ç”¨äºå†…å­˜ç¢ç‰‡åŒ–è¾ƒä¸¥é‡æˆ–å¯¹è±¡å¤§å°å·®å¼‚è¾ƒå¤§çš„åœºæ™¯ï¼ˆå¦‚è€å¹´ä»£ï¼‰ã€‚ 4.å¤„ç†å¹¶å‘å®‰å…¨é—®é¢˜å¯¹è±¡çš„åˆ›å»ºåœ¨è™šæ‹Ÿæœºä¸­æ˜¯ä¸€ä¸ªéå¸¸é¢‘ç¹çš„è¡Œä¸ºï¼Œå“ªæ€•åªæ˜¯ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½å‡ºç°æ­£åœ¨ç»™å¯¹è±¡ A åˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œå¯¹è±¡ B åˆåŒæ—¶ä½¿ç”¨äº†åŸæ¥çš„æŒ‡é’ˆæ¥åˆ†é…å†…å­˜çš„æƒ…å†µã€‚è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š å¯¹åˆ†é…å†…å­˜ç©ºé—´çš„åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†ï¼ˆé‡‡ç”¨ CAS + å¤±è´¥é‡è¯•æ¥ä¿éšœæ›´æ–°æ“ä½œçš„åŸå­æ€§ï¼‰ï¼› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨ Eden åŒºåˆ†é…ä¸€å—å„¿å†…å­˜ï¼ŒJVM åœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨ TLAB åˆ†é…ï¼Œ å½“å¯¹è±¡å¤§äº TLAB ä¸­çš„å‰©ä½™å†…å­˜æˆ– TLAB çš„å†…å­˜å·²ç”¨å°½æ—¶ï¼Œå†é‡‡ç”¨ä¸Šè¿°çš„ CAS è¿›è¡Œå†…å­˜åˆ†é… 5.JVMå¦‚ä½•è®¿é—®å¯¹è±¡ï¼ˆå¯¹è±¡çš„è®¿é—®å®šä½ï¼‰Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚ å¯¹è±¡çš„è®¿é—®æ–¹å¼ç”±è™šæ‹Ÿæœºå®ç°è€Œå®šï¼Œç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰ï¼šä½¿ç”¨å¥æŸ„ã€ç›´æ¥æŒ‡é’ˆã€‚ å¥æŸ„ å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸å¯¹è±¡ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚ ç›´æ¥æŒ‡é’ˆ å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚ å¥æŸ„çš„å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ ç›´æ¥æŒ‡é’ˆçš„å¥½å¤„æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚ 6.ç±»åŠ è½½çš„è¿‡ç¨‹ ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹ 7 ä¸ªé˜¶æ®µï¼š è¿æ¥æˆ–ä½œé“¾æ¥ï¼Œéƒ½ä¸€æ ·çš„ã€‚ 1.åŠ è½½ï¼šé€šè¿‡ç±»çš„å…¨é™å®šåè·å–å­—èŠ‚ç æ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ–¹æ³•åŒºå†…çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚ é€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆåŒ…å + ç±»åï¼‰ï¼Œè·å–åˆ°è¯¥ç±»çš„.classæ–‡ä»¶çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå°†äºŒè¿›åˆ¶å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ï¼Œè½¬åŒ–ä¸ºæ–¹æ³•åŒºè¿è¡Œæ—¶çš„æ•°æ®ç»“æ„ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„Java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ 2.éªŒè¯ï¼šå¯¹å­—èŠ‚ç è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿ç¬¦åˆJavaè™šæ‹Ÿæœºè§„èŒƒã€‚ ç¡®ä¿classæ–‡ä»¶ä¸­çš„å­—èŠ‚æµåŒ…å«çš„ä¿¡æ¯ï¼Œç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œä¿è¯è¿™ä¸ªè¢«åŠ è½½çš„classç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³åˆ°è™šæ‹Ÿæœºçš„å®‰å…¨ã€‚éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆä»¥ä¸‹å››ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼šæ–‡ä»¶æ ¼å¼æ ¡éªŒã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯ã€ç¬¦å·å¼•ç”¨éªŒè¯ 3.å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼ã€‚ ä¸ºç±»ä¸­çš„é™æ€å­—æ®µåˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤çš„åˆå§‹å€¼ï¼Œè¢«finalä¿®é¥°çš„staticå­—æ®µä¸ä¼šè®¾ç½®ï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±åˆ†é…äº† ä¹Ÿå°±æ˜¯è¯´ï¼Œfinalåˆ†é…å†…å­˜æ›´æ—©ï¼åœ¨ç¼–è¯‘é˜¶æ®µï¼Œstaticåˆ†é…å†…å­˜åœ¨å‡†å¤‡é˜¶æ®µï¼ 4.è§£æï¼šå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œå³å°†ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰è§£æä¸ºå…·ä½“çš„å†…å­˜åœ°å€ã€‚ ç¬¦å·å¼•ç”¨æ˜¯ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨çš„æ—¶å€™å¯ä»¥æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ï¼Œç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œ é‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»å­˜åœ¨åœ¨å†…å­˜ä¸­äº†ã€‚ 5.åˆå§‹åŒ–ï¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ä»£ç ï¼ŒåŒ…æ‹¬é™æ€å˜é‡èµ‹å€¼å’Œé™æ€ä»£ç å—çš„æ‰§è¡Œã€‚ 6.ç±»å¸è½½ å¸è½½ç±»éœ€è¦æ»¡è¶³ 3 ä¸ªè¦æ±‚: è¯¥ç±»çš„æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡éƒ½å·²è¢« GCï¼Œä¹Ÿå°±æ˜¯è¯´å †ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ã€‚ è¯¥ç±»æ²¡æœ‰åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ è¯¥ç±»çš„ç±»åŠ è½½å™¨çš„å®ä¾‹å·²è¢« GC æ‹“å±•ä¸€ä¸‹ï¼š JVM åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯å¦ç›¸åŒçš„å…·ä½“è§„åˆ™ï¼šJVM ä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚ åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚ 7.ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº›ç®€è€Œè¨€ä¹‹ï¼Œç±»åŠ è½½å™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰åˆ° JVM ä¸­ï¼Œè¯¦ç»†å¦‚ä¸‹ï¼š ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œç”¨äºå®ç°ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åŠ è½½è¿™ä¸€æ­¥ã€‚ æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoaderã€‚ æ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼ˆæ•°ç»„ç±»æ²¡æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ï¼Œæ˜¯ç”± JVM ç›´æ¥ç”Ÿæˆçš„ã€‚ ä»¥ä¸‹æ˜¯å¸¸è§çš„ç±»åŠ è½½å™¨ å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader)ï¼šç”¨æ¥åŠ è½½javaæ ¸å¿ƒç±»åº“ï¼Œæ— æ³•è¢«javaç¨‹åºç›´æ¥å¼•ç”¨ã€‚è´Ÿè´£åŠ è½½ JAVA_HOME&#x2F;jre&#x2F;lib ç›®å½•ä¸‹çš„jaråŒ…å’Œç±»,ï¼ˆå¦‚ Stringã€Systemç­‰ï¼‰ æ‰©å±•ç±»åŠ è½½å™¨(extensions class loader)ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ‰©å±•åº“ã€‚Java è™šæ‹Ÿæœºçš„å®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ã€‚è¯¥ç±»åŠ è½½å™¨åœ¨æ­¤ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½ Java ç±»ã€‚å®ƒè´Ÿè´£åŠ è½½JREçš„æ‰©å±•ç›®å½•ï¼ˆ %JAVA_HOME%&#x2F;jre&#x2F;lib&#x2F;ext ï¼‰ä¸­JARåŒ…çš„ç±» ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆsystem class loaderï¼‰ï¼šè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šçš„æŒ‡å®šç±»åº“ ï¼Œæ˜¯æˆ‘ä»¬å¹³æ—¶ç¼–å†™Javaç¨‹åºæ—¶é»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ã€‚ å®ƒæ ¹æ® Java åº”ç”¨çš„ç±»è·¯å¾„ï¼ˆCLASSPATHï¼‰æ¥åŠ è½½ Java ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½çš„ã€‚å¯ä»¥é€šè¿‡ ClassLoader.getSystemClassLoader()æ¥è·å–å®ƒã€‚ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ ï¼Œé€šè¿‡ç»§æ‰¿ java.lang.ClassLoaderç±»çš„æ–¹å¼å®ç°ã€‚ 8.ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿä¸ºä»€ä¹ˆé‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶åŒäº²å§”æ´¾æœºåˆ¶æ˜¯æŒ‡ç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»æ—¶ï¼Œé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±» ï¼Œè€Œæ˜¯å°†åŠ è½½è¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œæ‰è‡ªå·±å°è¯•åŠ è½½ã€‚ä»è€Œç¡®ä¿ç±»çš„åŠ è½½å®‰å…¨å’Œé˜²æ­¢ç±»çš„é‡å¤åŠ è½½ã€‚ ä¿è¯ç±»çš„å”¯ä¸€æ€§ ï¼šé€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…æŸä¸€ä¸ªç±»è¢«é‡å¤åŠ è½½ï¼Œå½“çˆ¶ç±»å·²ç»åŠ è½½ååˆ™æ— éœ€é‡å¤åŠ è½½ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚ ä¿è¯å®‰å…¨æ€§ï¼š ä¸ºäº†å®‰å…¨ï¼Œä¿è¯ç±»åº“APIä¸ä¼šè¢«ä¿®æ”¹ 3.åƒåœ¾æ”¶é›†åƒåœ¾å›æ”¶å°±æ˜¯å¯¹å†…å­˜å †ä¸­å·²ç»æ­»äº¡çš„æˆ–è€…é•¿æ—¶é—´æ²¡æœ‰ä½¿ç”¨çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤æˆ–å›æ”¶ã€‚ JVM åœ¨åš GC ä¹‹å‰ï¼Œä¼šå…ˆææ¸…æ¥šä»€ä¹ˆæ˜¯åƒåœ¾ï¼Œä»€ä¹ˆä¸æ˜¯åƒåœ¾ï¼Œé€šå¸¸ä¼šé€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚ åœ¨ç¡®å®šäº†å“ªäº›åƒåœ¾å¯ä»¥è¢«å›æ”¶åï¼Œåƒåœ¾æ”¶é›†å™¨ï¼ˆå¦‚ CMSã€G1ã€ZGCï¼‰è¦åšçš„äº‹æƒ…å°±æ˜¯è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯ä»¥é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°æ•´ç†ç®—æ³•ã€åˆ†ä»£æ”¶é›†ç®—æ³•ç­‰ã€‚ 1.åˆ¤æ–­åƒåœ¾çš„æ–¹æ³•ä¹Ÿå¯ä»¥é—®ï¼šå¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿå¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶ï¼Ÿ å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨æŒ‡å‘å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ç°åœ¨å°±æ˜¯åƒåœ¾ï¼Œå¦‚æœå®šä½äº†åƒåœ¾ï¼Œåˆ™æœ‰å¯èƒ½ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆreference countingï¼‰å’Œå¯è¾¾æ€§åˆ†æç®—æ³•ã€‚ å¼•ç”¨è®¡æ•°æ³• æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè®°å½•å¼•ç”¨å®ƒçš„æ¬¡æ•°ã€‚å½“è®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œå¯¹è±¡å¯ä»¥è¢«å›æ”¶ã€‚ ä½†æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œä½†ä¸å†è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå®ƒä»¬çš„å¼•ç”¨è®¡æ•°éƒ½ä¸ä¸ºé›¶ï¼Œå› æ­¤ä¸ä¼šè¢«å›æ”¶ã€‚ å¯è¾¾æ€§åˆ†æç®—æ³• é€šè¿‡ä¸€ç»„åä¸º â€œGC Rootsâ€ çš„æ ¹å¯¹è±¡ï¼Œè¿›è¡Œé€’å½’æ‰«æã€‚é‚£äº›æ— æ³•ä»æ ¹å¯¹è±¡åˆ°è¾¾çš„å¯¹è±¡æ˜¯ä¸å¯è¾¾çš„ï¼Œå¯ä»¥è¢«å›æ”¶ï¼›åä¹‹ï¼Œæ˜¯å¯è¾¾çš„ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚ å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸ºGC Rootå‘¢ï¼Ÿ è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨) ä¸­æ­£åœ¨å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­æ­£åœ¨å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ 2.finalize()æ–¹æ³•çš„ä½œç”¨å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œå°±ä»£è¡¨ä¸€å®šä¼šè¢«å›æ”¶å—ï¼Ÿ ä¸ä¸€å®š ç”¨ä¸€ä¸ªä¸å¤ªè´´åˆ‡çš„æ¯”å–»ï¼Œåƒåœ¾å›æ”¶å°±æ˜¯å¤ä»£çš„ç§‹åé—®æ–©ï¼Œfinalize()å°±æ˜¯åˆ€ä¸‹ç•™äººï¼Œåœ¨äººçŠ¯è¢«å¤„å†³ä¹‹å‰ï¼Œè¿˜è¦åšæœ€åä¸€æ¬¡å®¡è®¡ï¼Œé’å¤©å¤§è€çˆ·çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå†¤æƒ…ï¼Œéœ€ä¸éœ€è¦åˆ€ä¸‹ç•™äººã€‚ å¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸ GC Roots ç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°ï¼Œéšåè¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ã€‚å¦‚æœå¯¹è±¡åœ¨åœ¨ finalize()ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±â€”â€”åªè¦é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯ï¼Œè­¬å¦‚æŠŠè‡ªå·± ï¼ˆthis å…³é”®å­—ï¼‰èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œé‚£åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°±â€é€ƒè¿‡ä¸€åŠ«â€œï¼›ä½†æ˜¯å¦‚æœæ²¡æœ‰æŠ“ä½è¿™ä¸ªæœºä¼šï¼Œé‚£ä¹ˆå¯¹è±¡å°±çœŸçš„è¦è¢«å›æ”¶äº†ã€‚ 4.åƒåœ¾æ”¶é›†ç®—æ³• æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼š æ ‡è®°-æ¸…é™¤ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆé€šè¿‡å¯è¾¾æ€§åˆ†æï¼Œæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œ ç„¶åç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚ ç¼ºç‚¹ï¼šä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤çš„è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ ï¼›å¦ä¸€ä¸ªå°±æ˜¯ï¼Œæ¸…é™¤ç»“æŸåä¼šé€ æˆå¤§é‡ä¸è¿ç»­çš„ç¢ç‰‡ç©ºé—´ã€‚ å¤åˆ¶ç®—æ³•ï¼šä¸ºäº†è§£å†³ç¢ç‰‡ç©ºé—´çš„é—®é¢˜ï¼Œå‡ºç°äº†â€œå¤åˆ¶ç®—æ³•â€ã€‚ å®ƒæŠŠå†…å­˜ç©ºé—´åˆ’ä¸ºä¸¤ä¸ªç›¸ç­‰çš„åŒºåŸŸï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåŒºåŸŸã€‚åƒåœ¾æ”¶é›†æ—¶ï¼Œéå†å½“å‰ä½¿ç”¨çš„åŒºåŸŸï¼ŒæŠŠå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªåŒºåŸŸä¸­ï¼Œæœ€åå°†å½“å‰åŒºåŸŸæ¸…ç©ºã€‚ ç¼ºç‚¹ï¼šå› ä¸ºæ¯æ¬¡åœ¨ç”³è¯·å†…å­˜æ—¶ï¼Œéƒ½åªèƒ½ä½¿ç”¨ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚å†…å­˜åˆ©ç”¨ç‡ä¸¥é‡ä¸è¶³ã€‚ æ ‡è®°-æ•´ç†ç®—æ³•ï¼š å¤åˆ¶ç®—æ³•åœ¨ GC ä¹‹åå­˜æ´»å¯¹è±¡è¾ƒå°‘çš„æƒ…å†µä¸‹æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œä½†å¦‚æœå­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šæ—¶ï¼Œ ä¼šæ‰§è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°±ä¼šä¸‹é™ã€‚ æ ‡è®°-æ•´ç†ç®—æ³•çš„â€œæ ‡è®°â€è¿‡ç¨‹ä¸â€œæ ‡è®°-æ¸…é™¤ç®—æ³•â€çš„æ ‡è®°è¿‡ç¨‹ä¸€è‡´ï¼Œä½†æ ‡è®°ä¹‹åä¸ä¼šç›´æ¥æ¸…ç†ã€‚ è€Œæ˜¯å°†æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½ç§»åŠ¨åˆ°å†…å­˜çš„ä¸€ç«¯ã€‚ç§»åŠ¨ç»“æŸåç›´æ¥æ¸…ç†æ‰å‰©ä½™éƒ¨åˆ†ã€‚ ç¼ºç‚¹ï¼šç”±äºå¤šäº†æ•´ç†è¿™ä¸€æ­¥ï¼Œå› æ­¤æ•ˆç‡ä¹Ÿä¸é«˜ åˆ†ä»£å›æ”¶ç®—æ³•ï¼š åˆ†ä»£æ”¶é›†æ˜¯å°†å†…å­˜åˆ’åˆ†æˆäº†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚åˆ†é…çš„ä¾æ®æ˜¯å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸï¼Œæˆ–è€…è¯´ç»å†è¿‡çš„ GC æ¬¡æ•°ã€‚ å¯¹è±¡åˆ›å»ºæ—¶ï¼Œä¸€èˆ¬åœ¨æ–°ç”Ÿä»£ç”³è¯·å†…å­˜ï¼Œå½“ç»å†ä¸€æ¬¡ GC ä¹‹åå¦‚æœå¯¹è¿˜å­˜æ´»ï¼Œé‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„ +1ã€‚ å¯¹è±¡åˆ›å»ºæ—¶ï¼Œä¸€èˆ¬åœ¨æ–°ç”Ÿä»£ç”³è¯·å†…å­˜ï¼Œå½“ç»å†ä¸€æ¬¡ GC ä¹‹åå¦‚æœå¯¹è¿˜å­˜æ´»ï¼Œé‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„ +1ã€‚ æ–°ç”Ÿä»£é€šå¸¸ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ¸…é™¤æˆ–æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ å»¶ä¼¸é—®é¢˜ï¼š HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ 6.3.4ã€Minor GC&#x2F;Young GCã€Major GC&#x2F;Old GCã€Mixed GCã€Full GC éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ Minor GC ä¹Ÿç§°ä¸º Young GCï¼Œæ˜¯æŒ‡å‘ç”Ÿåœ¨å¹´è½»ä»£ï¼ˆYoung Generationï¼‰çš„åƒåœ¾æ”¶é›†ã€‚å¹´è½»ä»£åŒ…å« Eden åŒºä»¥åŠä¸¤ä¸ª Survivor åŒºã€‚ è§¦å‘æ¡ä»¶ï¼šå½“EdenåŒºç©ºé—´ä¸è¶³æ—¶ï¼ŒJVMä¼šè§¦å‘ä¸€æ¬¡Minor GCï¼Œ å°†EdenåŒºå’Œä¸€ä¸ªSurvivoråŒºä¸­çš„å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€ä¸ªSurvivoråŒºæˆ–è€å¹´ä»£ï¼ˆOld Generationï¼‰ã€‚ Major GC ä¹Ÿç§°ä¸º Old GCï¼Œä¸»è¦æŒ‡çš„æ˜¯å‘ç”Ÿåœ¨è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚CMS æ”¶é›†å™¨çš„ç‰¹æœ‰è¡Œä¸ºã€‚ è§¦å‘æ¡ä»¶ï¼šå½“è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œæˆ–è€…ç³»ç»Ÿæ£€æµ‹åˆ°å¹´è½»ä»£å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„é€Ÿåº¦è¿‡å¿« ï¼Œå¯èƒ½ä¼šè§¦å‘Major GCã€‚ Mixed GC æ˜¯ G1 åƒåœ¾æ”¶é›†å™¨ç‰¹æœ‰çš„ä¸€ç§ GC ç±»å‹ï¼Œå®ƒåœ¨ä¸€æ¬¡ GC ä¸­åŒæ—¶æ¸…ç†å¹´è½»ä»£å’Œéƒ¨åˆ†è€å¹´ä»£ã€‚ Full GC æ˜¯æœ€å½»åº•çš„åƒåœ¾æ”¶é›†ï¼Œæ¶‰åŠæ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰ã€‚å®ƒæ˜¯æœ€è€—æ—¶çš„ GCï¼Œé€šå¸¸åœ¨ JVM å‹åŠ›å¾ˆå¤§æ—¶å‘ç”Ÿã€‚ ç›´æ¥è°ƒç”¨System.gc()æˆ–Runtime.getRuntime().gc()æ–¹æ³•æ—¶ï¼Œ è™½ç„¶ä¸èƒ½ä¿è¯ç«‹å³æ‰§è¡Œï¼Œä½†JVMä¼šå°è¯•æ‰§è¡ŒFull GCã€‚ Minor GCï¼ˆæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼‰æ—¶ï¼Œå¦‚æœå­˜æ´»çš„å¯¹è±¡æ— æ³•å…¨éƒ¨æ”¾å…¥è€å¹´ä»£ ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ä¸è¶³ä»¥å®¹çº³å­˜æ´»çš„å¯¹è±¡ï¼Œ åˆ™ä¼šè§¦å‘Full GCï¼Œå¯¹æ•´ä¸ªå †å†…å­˜è¿›è¡Œå›æ”¶ã€‚ 2.3.3ã€ç®€è¿°åˆ†ä»£å›æ”¶å™¨æ€ä¹ˆå·¥ä½œçš„ï¼Ÿï¼ˆåˆ†ä»£æ”¶é›†ç®—æ³•ï¼‰åˆ†ä»£å›æ”¶å™¨æœ‰ä¸¤ä¸ªåˆ†åŒºï¼šè€ç”Ÿä»£å’Œæ–°ç”Ÿä»£ï¼Œæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ç©ºé—´å æ¯”æ˜¯1ï¼š2 æ–°ç”Ÿä»£ä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£é‡Œæœ‰ 3 ä¸ªåˆ†åŒºï¼šEdenï¼ˆä¸€denï¼‰ã€To ã€From ï¼Œå®ƒä»¬çš„é»˜è®¤å æ¯”æ˜¯ 8:1:1ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š æŠŠ Eden + From å­˜æ´»çš„å¯¹è±¡æ”¾å…¥ To åŒºï¼› æ¸…ç©º Eden å’Œ From åˆ†åŒºï¼› From å’Œ To åˆ†åŒºäº¤æ¢ï¼ŒFrom å˜ To ï¼ŒTo å˜ From ã€‚ æ¯æ¬¡åœ¨ From åˆ° To ç§»åŠ¨æ—¶éƒ½å­˜æ´»çš„å¯¹è±¡ï¼Œå¹´é¾„å°± +1ï¼Œå½“å¹´é¾„åˆ°è¾¾ 15ï¼ˆé»˜è®¤é…ç½®æ˜¯ 15ï¼‰æ—¶ï¼Œå‡çº§ä¸ºè€ç”Ÿä»£ã€‚å¤§å¯¹è±¡ä¹Ÿä¼šç›´æ¥è¿›å…¥è€ç”Ÿä»£ã€‚ è€ç”Ÿä»£å½“ç©ºé—´å ç”¨åˆ°è¾¾æŸä¸ªå€¼ä¹‹åå°±ä¼šè§¦å‘å…¨å±€åƒåœ¾æ”¶å›ï¼Œä¸€èˆ¬ä½¿ç”¨æ ‡è®°æ•´ç†çš„æ‰§è¡Œç®—æ³•ã€‚ä»¥ä¸Šè¿™äº›å¾ªç¯å¾€å¤å°±æ„æˆäº†æ•´ä¸ªåˆ†ä»£åƒåœ¾å›æ”¶çš„æ•´ä½“æ‰§è¡Œæµç¨‹ã€‚ 4.CMSåƒåœ¾æ”¶é›†å™¨CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚ ä»¥è·å–æœ€çŸ­GCå›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå…·æœ‰é«˜å¹¶å‘ã€ä½åœé¡¿çš„ç‰¹ç‚¹ï¼Œé‡‡å–æ ‡è®°â€”â€”æ¸…é™¤ç®—æ³• å·¥ä½œæ­¥éª¤ åˆå§‹æ ‡è®°ï¼š çŸ­æš‚åœé¡¿ï¼ˆStop-The-Worldï¼ŒSTWï¼‰ï¼Œæ ‡è®°ç›´æ¥ä¸ GCRoots ç›¸è¿çš„å¯¹è±¡ï¼ˆæ ¹å¯¹è±¡ï¼‰ï¼Œè¯¥é˜¶æ®µéœ€è¦STWï¼Œç”±äºåªæ ‡è®°ç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™ä¸€é˜¶æ®µé€šå¸¸å¾ˆå¿«ã€‚ å¹¶å‘æ ‡è®°ï¼š æŒ‡çš„æ˜¯å¯¹ã€Œåˆå§‹æ ‡è®°é˜¶æ®µã€æ ‡è®°çš„å¯¹ è±¡è¿›è¡Œæ•´ä¸ªå¼•ç”¨é“¾çš„æ‰«æï¼Œè¯¥é˜¶æ®µä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶è¿è¡Œ, ä¸éœ€è¦STW ã€‚å› ä¸ºæ˜¯å¹¶å‘è¿›è¡Œï¼Œåº”ç”¨çº¿ç¨‹å¯èƒ½ä¿®æ”¹å¯¹è±¡å›¾ï¼Œå¯¼è‡´æ ‡è®°å¯èƒ½ä¸å®Œå…¨å‡†ç¡®ã€‚ å³ï¼š å¹¶å‘æ ‡è®°çš„æ—¶å€™ï¼Œå¼•ç”¨å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤å¯èƒ½å‘ç”Ÿæ¼æ ‡ï¼ˆæœ¬åº”è¯¥å›æ”¶çš„åƒåœ¾æ²¡æœ‰è¢«å›æ”¶ï¼‰å’Œå¤šæ ‡ï¼ˆæœ¬ä¸åº”è¯¥å›æ”¶çš„åƒåœ¾è¢«å›æ”¶ï¼‰äº†ã€‚ é‡æ–°æ ‡è®°ï¼š é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­ å¹¶å‘æ¸…é™¤ï¼šæŒ‡çš„æ˜¯å°†æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡è¿›è¡Œæ¸… é™¤ï¼Œè¯¥é˜¶æ®µä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶è¿è¡Œ,ä¸éœ€è¦STW ç¼ºç‚¹ï¼š æ— æ³•å¤„ç†åœ¨å¹¶å‘æ¸…ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„â€œæµ®åŠ¨åƒåœ¾â€ï¼Œ ä¸èƒ½åšåˆ°å®Œå…¨çš„åƒåœ¾å›æ”¶ å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ 5.G1æ”¶é›†å™¨G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨. ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾ã€‚ åŒæ—¶æ³¨é‡ååé‡(Throughput)å’Œä½å»¶è¿Ÿ å·¥ä½œæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼š çŸ­æš‚åœé¡¿ï¼Œæ ‡è®°ä» GC Roots å¯ç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œå³æ ‡è®°æ‰€æœ‰ç›´æ¥å¯è¾¾çš„æ´»è·ƒå¯¹è±¡ å¹¶å‘æ ‡è®°ï¼šä¸åº”ç”¨å¹¶å‘è¿è¡Œï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚ è¿™ä¸€é˜¶æ®µå¯èƒ½æŒç»­è¾ƒé•¿æ—¶é—´ï¼Œå–å†³äºå †çš„å¤§å°å’Œå¯¹è±¡çš„æ•°é‡ã€‚ æœ€ç»ˆæ ‡è®°ï¼š çŸ­æš‚åœé¡¿ï¼ˆSTWï¼‰ï¼Œå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸåæ®‹ç•™çš„å°‘é‡æœªå¤„ç†çš„å¼•ç”¨å˜æ›´ã€‚ ç­›é€‰å›æ”¶ï¼šæ ¹æ®æ ‡è®°ç»“æœï¼Œé€‰æ‹©å›æ”¶ä»·å€¼é«˜çš„åŒºåŸŸï¼Œå¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°æ–°åŒºåŸŸï¼Œå›æ”¶æ—§åŒºåŸŸå†…å­˜ã€‚è¿™ä¸€é˜¶æ®µåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåœé¡¿ï¼ˆSTWï¼‰ï¼Œå…·ä½“å–å†³äºå›æ”¶çš„å¤æ‚åº¦ã€‚ G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥) ã€‚ ç‰¹ç‚¹ï¼š å¹¶è¡Œä¸å¹¶å‘ï¼šG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚ åœé¡¿æ—¶é—´å¯æ§ï¼š G1å¯ä»¥é€šè¿‡è®¾ç½®é¢„æœŸåœé¡¿æ—¶é—´ï¼ˆPause Timeï¼‰æ¥æ§åˆ¶åƒåœ¾æ”¶é›†æ—¶é—´é¿å…åº”ç”¨é›ªå´©ç°è±¡ã€‚ CMSå’ŒG1çš„åŒºåˆ«","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}]},{"title":"Redis","slug":"å…«è‚¡/Redis","date":"2024-10-28T12:14:56.000Z","updated":"2025-03-02T14:21:38.210Z","comments":true,"path":"2024/10/28/å…«è‚¡/Redis/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/Redis/","excerpt":"è¿™é‡Œæ˜¯Redisç›¸å…³çš„å…«è‚¡","text":"è¿™é‡Œæ˜¯Redisç›¸å…³çš„å…«è‚¡ 1.åŸºç¡€1.Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ å†…å­˜æ“ä½œï¼šå®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿ I&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼šåŸºäº Linux çš„ select&#x2F;epoll æœºåˆ¶ã€‚è¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—ï¼Œå†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›å¥—æ¥å­—ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–è€…æ•°æ®è¯·æ±‚ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis å¤„ç†ï¼Œå°±å®ç°äº†æ‰€è°“çš„ Redis å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO è¯»å†™çš„è¯·æ±‚ã€‚ é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼šRedis æä¾›äº†å¤šç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€åˆ—è¡¨ï¼ˆListï¼‰ã€é›†åˆï¼ˆSetï¼‰ã€æœ‰åºé›†åˆï¼ˆSorted Setï¼‰ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„ç»è¿‡äº†é«˜åº¦ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæ”¯æŒå¿«é€Ÿçš„æ•°æ®æ“ä½œã€‚ 1.ä¸‰ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥ 1ã€Cache Aside Pattern ï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼ŒåŒå†™æ¨¡å¼ï¼‰ è¿™æ˜¯æœ€å¸¸è§çš„ç¼“å­˜ä½¿ç”¨æ¨¡å¼ï¼Œç¼“å­˜å’Œæ•°æ®åº“åˆ†å¼€ç®¡ç†ï¼Œåº”ç”¨ç¨‹åºè´Ÿè´£åè°ƒä¸¤è€…ã€‚ å†™ï¼š å…ˆæ›´æ–°æ•°æ®åº“ ç„¶åç›´æ¥åˆ é™¤ç¼“å­˜ å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° db ä¹ˆï¼Ÿ ä¸è¡Œçš„ï¼å› ä¸ºè¿™æ ·å¯èƒ½ä¼šé€ æˆ æ•°æ®åº“ï¼ˆdbï¼‰å’Œç¼“å­˜ï¼ˆCacheï¼‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ æ¯”å¦‚ï¼š çº¿ç¨‹Aåˆ é™¤äº†ç¼“å­˜ï¼Œä½†è¿˜æ²¡æ¥å¾—åŠæ›´æ–°db çº¿ç¨‹Bæœªè¯»åˆ°ç¼“å­˜ï¼Œç„¶åä»dbç§è¯»å–äº†æ—§æ•°æ®ï¼Œå¹¶å†™å…¥ç¼“å­˜ çº¿ç¨‹Aæ›´æ–°dbï¼Œä½†ç¼“å­˜ä»æ˜¯æ—§æ•°æ® ç»“æœå°±æ˜¯ç¼“å­˜å’Œdbå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ è¯»ï¼š ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› cache ä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» db ä¸­è¯»å–æ•°æ®è¿”å› å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚ ç¼ºç‚¹ï¼š é¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸åœ¨ cache çš„é—®é¢˜ è§£å†³æ–¹æ³•ï¼šå¯ä»¥å°†çƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ cache ä¸­ã€‚ å†™æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¯å¯¼è‡´ cache ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹è¢«åˆ é™¤ï¼Œè¿™æ ·ä¼šå½±å“ç¼“å­˜å‘½ä¸­ç‡ ã€‚ è§£å†³æ–¹æ³•ï¼š æ•°æ®åº“å’Œç¼“å­˜æ•°æ®å¼ºä¸€è‡´åœºæ™¯ï¼šæ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªé”&#x2F;åˆ†å¸ƒå¼é”æ¥ä¿è¯æ›´æ–° cache çš„æ—¶å€™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ å¯ä»¥çŸ­æš‚åœ°å…è®¸æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„åœºæ™¯ï¼šæ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä½†æ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®ä¸ä¸€è‡´çš„è¯å½±å“ä¹Ÿæ¯”è¾ƒå°ã€‚ 2ã€Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼Œç›´å†™ç¼“å­˜æ¨¡å¼ ï¼‰ åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½ä¼šå…ˆæ›´æ–°ç¼“å­˜ï¼Œç„¶åå†åŒæ­¥æ›´æ–°æ•°æ®åº“ã€‚ å†™ï¼š å…ˆæŸ¥ç¼“å­˜ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–°ç¼“å­˜ ç¼“å­˜ä¸­å­˜åœ¨ï¼Œå…ˆæ›´æ–°ç¼“å­˜ï¼Œç„¶åç”±ç¼“å­˜æœåŠ¡å†æ›´æ–°db è¯»ï¼š ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚ è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» db åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚ 3ã€Write behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰ å†™æ“ä½œåªæ›´æ–°ç¼“å­˜ï¼Œä¸ç«‹å³åŒæ­¥åˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯å»¶è¿Ÿæ‰¹é‡æ›´æ–°æ•°æ®åº“ã€‚ Write Behind Pattern å’Œ Read&#x2F;Write Through Pattern å¾ˆç›¸ä¼¼ï¼Œä¸¤è€…éƒ½æ˜¯ç”± cache æœåŠ¡æ¥è´Ÿè´£ cache å’Œ db çš„è¯»å†™ã€‚ ä½†æ˜¯ï¼Œä¸¤ä¸ªåˆæœ‰å¾ˆå¤§çš„ä¸åŒï¼šRead&#x2F;Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ dbï¼Œè€Œ Write Behind åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° dbï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° dbã€‚ å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹å¼å¯¹æ•°æ®ä¸€è‡´æ€§å¸¦æ¥äº†æ›´å¤§çš„æŒ‘æˆ˜ï¼Œæ¯”å¦‚ cache æ•°æ®å¯èƒ½è¿˜æ²¡å¼‚æ­¥æ›´æ–° db çš„è¯ï¼Œcache æœåŠ¡å¯èƒ½å°±å°±æŒ‚æ‰äº†ã€‚ è¿™ç§ç­–ç•¥åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿéå¸¸éå¸¸å°‘è§ï¼Œä½†æ˜¯ä¸ä»£è¡¨å®ƒçš„åº”ç”¨åœºæ™¯å°‘ï¼Œæ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„å¼‚æ­¥å†™å…¥ç£ç›˜ã€MySQL çš„ Innodb Buffer Pool æœºåˆ¶éƒ½ç”¨åˆ°äº†è¿™ç§ç­–ç•¥ã€‚ Write Behind Pattern ä¸‹ db çš„å†™æ€§èƒ½éå¸¸é«˜ï¼Œéå¸¸é€‚åˆä¸€äº›æ•°æ®ç»å¸¸å˜åŒ–åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æµè§ˆé‡ã€ç‚¹èµé‡ã€‚ æ¯”è¾ƒ ç‰¹æ€§ Cache Aside Write Through Write Back è¯»æ€§èƒ½ é«˜ é«˜ é«˜ å†™æ€§èƒ½ ä¸­ ä½ é«˜ ä¸€è‡´æ€§ ä¸­ é«˜ ä½ å®ç°å¤æ‚åº¦ ä¸­ ä¸­ é«˜ é€‚ç”¨åœºæ™¯ï¼š Cache Aside é€‚åˆè¯»æ“ä½œé¢‘ç¹ã€å†™æ“ä½œè¾ƒå°‘ä¸”æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚ç”¨æˆ·ä¿¡æ¯ã€å•†å“è¯¦æƒ…æŸ¥è¯¢ç­‰ã€‚ Write Through é€‚åˆè¯»å†™æ“ä½œéƒ½é¢‘ç¹ä¸”æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚é‡‘èäº¤æ˜“ç³»ç»Ÿã€‚ Write Back é€‚åˆå†™æ“ä½œé¢‘ç¹ã€å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ä¸”å®¹å¿ä¸€å®šå»¶è¿Ÿçš„åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—ç³»ç»Ÿã€è®¡æ•°ç»Ÿè®¡ç­‰ã€‚ 2.Redisæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯ Stringï¼šå­˜å‚¨å•ä¸ªå€¼ï¼Œé€‚ç”¨äºç¼“å­˜å’Œé”®å€¼å­˜å‚¨ï¼Œå¸¸ç”¨å‘½ä»¤:SETç”¨äºè®¾ç½®å€¼ï¼ŒGETç”¨äºè·å–å€¼ã€‚ åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼Sessionã€å€¼ç¼“å­˜ã€æµè§ˆæ•°ã€åˆ†åº“åˆ†è¡¨ä¸»é”®åºåˆ—å· Listï¼šæœ‰åºã€å¯é‡å¤çš„å­—ç¬¦ä¸²é›†åˆï¼Œé€‚ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—å’Œå‘å¸ƒ&#x2F;è®¢é˜…ç³»ç»Ÿï¼Œå¸¸ç”¨å‘½ä»¤:LPUSHç”¨äºä»åˆ—è¡¨å·¦ä¾§æ·»åŠ å…ƒç´ ï¼ŒLRANGEç”¨äºè·å–æŒ‡å®šèŒƒå›´çš„å…ƒç´ ã€‚ åˆ†å¸ƒå¼Duqueã€æ¶ˆæ¯é˜Ÿåˆ—ã€Pushå¼ä¿¡æ¯æµ Setï¼šæ— åºã€ä¸å¯é‡å¤çš„å­—ç¬¦ä¸²é›†åˆï¼Œé€‚ç”¨äºæ ‡ç­¾ç³»ç»Ÿå’Œå¥½å‹å…³ç³»ç­‰ï¼Œå¸¸ç”¨å‘½ä»¤:SADDç”¨äºå‘é›†åˆæ·»åŠ æˆå‘˜ï¼ŒSMEMBERSç”¨äºè·å–é›†åˆæ‰€æœ‰æˆå‘˜ã€‚ ç‚¹èµã€æŠ½å¥–ã€é›†åˆè¿ç®— Hashï¼šåŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ï¼Œé€‚ç”¨äºå­˜å‚¨å¯¹è±¡ã€ç¼“å­˜å’Œè®¡æ•°å™¨ï¼Œå¸¸ç”¨å‘½ä»¤:HSETç”¨äºè®¾ç½®å­—æ®µå€¼ï¼ŒHGETALLç”¨äºè·å–æ•£åˆ—çš„æ‰€æœ‰å­—æ®µå’Œå€¼ã€‚ è´­ç‰©è½¦ã€å¯¹è±¡å­˜å‚¨ Zsetï¼šä¹Ÿå°±æ˜¯Sorted Setï¼Œæœ‰åºçš„å­—ç¬¦ä¸²é›†åˆï¼Œæ¯ä¸ªæˆå‘˜å…³è”ä¸€ä¸ªåˆ†æ•°ï¼Œé€‚ç”¨äºæ’è¡Œæ¦œå’ŒæŒ‰åˆ†æ•°èŒƒå›´è·å–æˆå‘˜ï¼Œå¸¸ç”¨å‘½ä»¤:ZADDç”¨äºæ·»åŠ æˆå‘˜åŠå…¶åˆ†æ•°ï¼ŒZRANGEç”¨äºè·å–æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼Œ çƒ­æœã€æœ€è¿‘æ’­æ”¾ 3.Rediså¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ ç¼“å­˜ æ’è¡Œæ¦œ åˆ†å¸ƒå¼è®¡æ•°å™¨ åˆ†å¸ƒå¼é” æ¶ˆæ¯é˜Ÿåˆ— å»¶æ—¶é˜Ÿåˆ— åˆ†å¸ƒå¼ token é™æµ 2.æŒä¹…åŒ–ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼Ÿ å¤§éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†ä¹‹åé‡ç”¨æ•°æ®ï¼ˆæ¯”å¦‚é‡å¯æœºå™¨ã€æœºå™¨æ•…éšœä¹‹åæ¢å¤æ•°æ®ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸ºäº†åšæ•°æ®åŒæ­¥ï¼ˆæ¯”å¦‚ Redis é›†ç¾¤çš„ä¸»ä»èŠ‚ç‚¹é€šè¿‡ RDB æ–‡ä»¶åŒæ­¥æ•°æ®ï¼‰ã€‚ Redis æä¾›ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ RDBï¼ˆé»˜è®¤ï¼‰ å’Œ AOF æœºåˆ¶: 1.RDBRDBï¼šæ˜¯ç¼©å†™å¿«ç…§ RDB(Redis DataBase)æ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚å°†æŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ï¼Œä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å†™å…¥ç£ç›˜ï¼› å¯¹åº”äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ä¸ºdump.rdbã€‚é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„saveå‚æ•°æ¥å®šä¹‰å¿«ç…§çš„å‘¨æœŸã€‚ å› ä¸º AOF æ—¥å¿—è®°å½•çš„æ˜¯æ“ä½œå‘½ä»¤ï¼Œä¸æ˜¯å®é™…çš„æ•°æ®ï¼Œæ‰€ä»¥ç”¨ AOF æ–¹æ³•åšæ•…éšœæ¢å¤æ—¶ ï¼Œéœ€è¦å…¨é‡æŠŠæ—¥å¿—éƒ½æ‰§è¡Œä¸€éï¼Œä¸€æ—¦ AOF æ—¥å¿—éå¸¸å¤šï¼ŒåŠ¿å¿…ä¼šé€ æˆ Redis çš„æ¢å¤æ“ä½œç¼“æ…¢ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¢åŠ äº† RDB å¿«ç…§ã€‚ RDB å¿«ç…§å°±æ˜¯è®°å½•æŸä¸€ä¸ªç¬é—´çš„å†…å­˜æ•°æ®ï¼Œè®°å½•çš„æ˜¯å®é™…æ•°æ® Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶ï¼š save:åŒæ­¥ä¿å­˜æ“ä½œï¼Œä¼šé˜»å¡ Redis ä¸»è¿›ç¨‹ï¼› bgsave:fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ Redis ä¸»çº¿ç¨‹ï¼Œé»˜è®¤é€‰é¡¹ã€‚ 2.AOFAOFæŒä¹…åŒ–(å³Append Only File)ï¼ŒRedis åœ¨æ‰§è¡Œå®Œä¸€æ¡å†™æ“ä½œå‘½ä»¤åï¼Œå°±ä¼šæŠŠè¯¥å‘½ä»¤ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œ ç„¶å Redis é‡å¯æ—¶ï¼Œä¼šè¯»å–è¯¥æ–‡ä»¶è®°å½•çš„å‘½ä»¤ï¼Œç„¶åé€ä¸€æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®æ¢å¤ã€‚ AOFä¸ºä»€ä¹ˆæ˜¯åœ¨æ‰§è¡Œå®Œå†™å‘½ä»¤æ‰å°†è¯¥å‘½ä»¤è®°å½•åˆ°AOFæ—¥å¿—ï¼Ÿ é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€ï¼ŒAOF è®°å½•æ—¥å¿—ä¸ä¼šå¯¹å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼› åœ¨å‘½ä»¤æ‰§è¡Œå®Œä¹‹åå†è®°å½•ï¼Œä¸ä¼šé˜»å¡å½“å‰çš„å‘½ä»¤æ‰§è¡Œã€‚ æ½œåœ¨é£é™© å¦‚æœåˆšæ‰§è¡Œå®Œå‘½ä»¤ Redis å°±å®•æœºä¼šå¯¼è‡´å¯¹åº”çš„ä¿®æ”¹ä¸¢å¤±ï¼› å¯èƒ½ä¼šé˜»å¡åç»­å…¶ä»–å‘½ä»¤çš„æ‰§è¡Œï¼ˆAOF è®°å½•æ—¥å¿—æ˜¯åœ¨ Redis ä¸»çº¿ç¨‹ä¸­è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªæ“ä½œæ˜¯åŒæ­¥çš„ï¼Œå¦‚æœåœ¨å°†æ—¥å¿—å†…å®¹å†™å…¥åˆ°ç¡¬ç›˜æ—¶ï¼ŒæœåŠ¡å™¨çš„ç¡¬ç›˜çš„ I&#x2F;O å‹åŠ›å¤ªå¤§ï¼Œå°±ä¼šå¯¼è‡´å†™ç¡¬ç›˜çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œ è¿›è€Œé˜»å¡ä½äº†ï¼Œä¹Ÿå°±ä¼šå¯¼è‡´åç»­çš„å‘½ä»¤æ— æ³•æ‰§è¡Œã€‚ ä¼˜ç‚¹ï¼šé¦–å…ˆï¼ŒAOFæä¾›äº†æ›´å¥½çš„æ•°æ®å®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒé»˜è®¤æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ å³ä½¿RedisæœåŠ¡å™¨å®•æœºï¼Œä¹Ÿåªä¼šä¸¢å¤±æœ€åä¸€æ¬¡å†™å…¥å‰çš„æ•°æ®ã€‚ ç¼ºç‚¹ï¼šå› ä¸ºè®°å½•äº†æ¯ä¸€ä¸ªå†™æ“ä½œï¼Œæ‰€ä»¥AOFæ–‡ä»¶é€šå¸¸æ¯”RDBæ–‡ä»¶æ›´å¤§ï¼Œæ¶ˆè€—æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚ æ€»ç»“ï¼šRDBæ˜¯Redisçš„å¿«ç…§æŒä¹…åŒ–æ–¹å¼ï¼Œé€šè¿‡å‘¨æœŸæ€§çš„å¿«ç…§å°†æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œå ç”¨æ›´å°‘çš„ç£ç›˜ç©ºé—´å’Œ CPUèµ„æºï¼Œé€‚ç”¨äºæ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼Œä½†å¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚AOF æ˜¯è¿½åŠ æ—¥å¿—æŒä¹…åŒ–æ–¹å¼ï¼Œå°†æ¯ä¸ªå†™æ“ä½œä»¥è¿½åŠ çš„æ–¹å¼è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç¡®ä¿äº†æ›´é«˜çš„æ•°æ®å®Œæ•´æ€§å’ŒæŒä¹…æ€§ï¼Œä½†ç›¸å¯¹äºRDB æ¶ˆè€—æ›´å¤šçš„ç£ç›˜ç©ºé—´å’Œå†™å…¥æ€§èƒ½ï¼Œé€‚ç”¨äºæ•°æ®æŒä¹…åŒ–å’Œç¾éš¾æ¢å¤ï¼Œä¸”å¯ä»¥é€šè¿‡é…ç½®å®ç°ä¸åŒçš„åŒæ­¥é¢‘ç‡ã€‚ 3.Rediså†…å­˜ç®¡ç†1.è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æœ‰å“ªäº› å®šæ—¶è¿‡æœŸï¼ˆCPUä¸å‹å¥½ï¼Œå†…å­˜å‹å¥½ï¼‰ï¼šæ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œåˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥ç«‹å³æ¸…é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå¯¹å†…å­˜å¾ˆå‹å¥½ï¼›ä½†æ˜¯ä¼šå ç”¨å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå½±å“ç¼“å­˜çš„å“åº”æ—¶é—´å’Œååé‡ã€‚ æƒ°æ€§è¿‡æœŸï¼ˆCPUå‹å¥½ï¼Œå†…å­˜ä¸å‹å¥½ï¼‰ï¼šåªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥keyæ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æºï¼Œå´å¯¹å†…å­˜éå¸¸ä¸å‹å¥½ã€‚æç«¯æƒ…å†µå¯èƒ½å‡ºç°å¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰å†æ¬¡è¢«è®¿é—®ï¼Œä»è€Œä¸ä¼šè¢«æ¸…é™¤ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚ å®šæœŸè¿‡æœŸï¼ˆå‰ä¸¤ç§çš„æŠ˜ä¸­ï¼‰ï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„æ•°æ®åº“çš„expireså­—å…¸ä¸­ä¸€å®šæ•°é‡çš„keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„keyã€‚è¯¥ç­–ç•¥æ˜¯å‰ä¸¤è€…çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆã€‚é€šè¿‡è°ƒæ•´å®šæ—¶æ‰«æçš„æ—¶é—´é—´éš”å’Œæ¯æ¬¡æ‰«æçš„é™å®šè€—æ—¶ï¼Œå¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹ä½¿å¾—CPUå’Œå†…å­˜èµ„æºè¾¾åˆ°æœ€ä¼˜çš„å¹³è¡¡æ•ˆæœã€‚ Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½® expireå‘½ä»¤å’Œpersistå‘½ä»¤ 2.å†…å­˜æ·˜æ±°ç²—ç•¥æœ‰å“ªäº› MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ rediså†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚ å…¨å±€çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤ noevictionï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚ allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚ è®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤ volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚ volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼ŒæŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚ 4.Redisç”Ÿäº§é—®é¢˜1.ç¼“å­˜ç©¿é€ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰ç”¨æˆ·è¦è®¿é—®çš„æ•°æ®ï¼Œå½“æœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ•°æ®åº“çš„å‹åŠ›éª¤å¢ ï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚ è§£å†³æ–¹æ¡ˆï¼š éæ³•è¯·æ±‚çš„é™åˆ¶ï¼šå½“æœ‰å¤§é‡æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œå› æ­¤åœ¨ API å…¥å£å¤„æˆ‘ä»¬è¦åˆ¤æ–­æ±‚è¯·æ±‚å‚æ•°æ˜¯å¦åˆç†ï¼Œè¯·æ±‚å‚æ•°æ˜¯å¦å«æœ‰éæ³•å€¼ã€è¯·æ±‚å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œ å¦‚æœåˆ¤æ–­å‡ºæ˜¯æ¶æ„è¯·æ±‚å°±ç›´æ¥è¿”å›é”™è¯¯ï¼Œé¿å…è¿›ä¸€æ­¥è®¿é—®ç¼“å­˜å’Œæ•°æ®åº“ã€‚ ç¼“å­˜ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼šå½“æˆ‘ä»¬çº¿ä¸Šä¸šåŠ¡å‘ç°ç¼“å­˜ç©¿é€çš„ç°è±¡æ—¶ï¼Œå¯ä»¥é’ˆå¯¹æŸ¥è¯¢çš„æ•°æ®ï¼Œ åœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿™æ ·åç»­è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–åˆ°ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œ è¿”å›ç»™åº”ç”¨ï¼Œè€Œä¸ä¼šç»§ç»­æŸ¥è¯¢æ•°æ®åº“ã€‚ è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚ å¸ƒéš†è¿‡æ»¤å™¨ï¼šæˆ‘ä»¬å¯ä»¥åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšä¸ªæ ‡è®°ï¼Œ ç„¶ååœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä¸šåŠ¡çº¿ç¨‹ç¡®è®¤ç¼“å­˜å¤±æ•ˆåï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œ å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¸ç”¨é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚å³ä½¿å‘ç”Ÿäº†ç¼“å­˜ç©¿é€ï¼Œå¤§é‡è¯·æ±‚åªä¼šæŸ¥è¯¢ Redis å’Œå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œä¿è¯äº†æ•°æ®åº“èƒ½æ­£å¸¸è¿è¡Œ 2.å¸ƒéš†è¿‡æ»¤å™¨å¸ƒéš†è¿‡æ»¤å™¨ä¸»è¦æ˜¯ä¸ºäº†è§£å†³æµ·é‡æ•°æ®çš„å­˜åœ¨æ€§é—®é¢˜ã€‚å¯¹äºæµ·é‡æ•°æ®ä¸­åˆ¤å®šæŸä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ä¸”å®¹å¿è½»å¾®è¯¯å·®è¿™ä¸€åœºæ™¯ï¼ˆæ¯”å¦‚ç¼“å­˜ç©¿é€ã€æµ·é‡æ•°æ®å»é‡ï¼‰æ¥è¯´ï¼Œéå¸¸é€‚åˆã€‚ å¸ƒéš†è¿‡æ»¤å™¨ç”±ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„å’Œå¤šä¸ªå“ˆå¸Œå‡½æ•°ç»„æˆ å¼€å§‹æ—¶ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„æ¯ä¸ªä½éƒ½è¢«è®¾ç½®ä¸º 0ã€‚ å½“ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œå®ƒä¼šè¢« k ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å¾—åˆ° k ä¸ªä½ç½®ï¼Œç„¶åå°†ä½æ•°ç»„ä¸­å¯¹åº”çš„ä½è®¾ç½®ä¸º 1ã€‚ å½“æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºè¿‡æ»¤å™¨ä¸­æ—¶ï¼ŒåŒæ ·ä½¿ç”¨ k ä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—ä½ç½®ï¼Œå¦‚æœä»»ä¸€ä½ç½®çš„ä½ä¸º 0ï¼Œåˆ™è¯¥å…ƒç´ è‚¯å®šä¸åœ¨è¿‡æ»¤å™¨ä¸­ï¼›å¦‚æœæ‰€æœ‰ä½ç½®çš„ä½éƒ½ä¸º 1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½åœ¨è¿‡æ»¤å™¨ä¸­ã€‚ ä¸ºä»€ä¹ˆä¼šè¯¯åˆ¤ï¼Ÿ å½“å¸ƒéš†è¿‡æ»¤å™¨ä¿å­˜çš„å…ƒç´ è¶Šå¤šï¼Œè¢«ç½®ä¸º 1 çš„ bit ä½å°±ä¼šè¶Šå¤šã€‚å‡è®¾å…ƒç´  x æ²¡æœ‰å­˜å‚¨è¿‡ï¼Œä½†å…¶ä»–å…ƒç´ çš„å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸‰ä¸ªä½åˆšå¥½éƒ½ä¸º 1 ä¸”æ°å¥½è¦†ç›–äº†å…ƒç´  x æ˜ å°„çš„ä½ç½®ï¼Œé‚£ä¹ˆå¯¹äºå¸ƒéš†è¿‡æ»¤å™¨æ¥è®²ï¼Œå…ƒç´  x è¿™ä¸ªå€¼å°±æ˜¯å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ã€‚ å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚ 3.ç¼“å­˜å‡»ç©¿ç¼“å­˜å‡»ç©¿ä¸­ï¼Œè¯·æ±‚çš„ key å¯¹åº”çš„æ˜¯ çƒ­ç‚¹æ•°æ® ï¼Œè¯¥æ•°æ® å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œä½†ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼ˆé€šå¸¸æ˜¯å› ä¸ºç¼“å­˜ä¸­çš„é‚£ä»½æ•°æ®å·²ç»è¿‡æœŸï¼‰ã€‚è¿™å°±å¯èƒ½ä¼šå¯¼è‡´ç¬æ—¶å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚ è§£å†³æ–¹æ¡ˆï¼š äº’æ–¥é”æ–¹æ¡ˆï¼ˆçœ‹æƒ…å†µï¼‰ï¼šä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹æ›´æ–°ç¼“å­˜ï¼Œæœªèƒ½è·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œ è¦ä¹ˆç­‰å¾…é”é‡Šæ”¾åé‡æ–°è¯»å–ç¼“å­˜ï¼Œè¦ä¹ˆå°±è¿”å›ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ã€‚ æ°¸ä¸è¿‡æœŸï¼ˆä¸æ¨èï¼‰ï¼šè®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸæˆ–è€…è¿‡æœŸæ—¶é—´æ¯”è¾ƒé•¿ã€‚ æå‰é¢„çƒ­ï¼ˆæ¨èï¼‰ï¼šé’ˆå¯¹çƒ­ç‚¹æ•°æ®æå‰é¢„çƒ­ï¼Œå°†å…¶å­˜å…¥ç¼“å­˜ä¸­å¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´æ¯”å¦‚ç§’æ€åœºæ™¯ä¸‹çš„æ•°æ®åœ¨ç§’æ€ç»“æŸä¹‹å‰ä¸è¿‡æœŸã€‚ 4.ç¼“å­˜é›ªå´©å½“å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼ˆå¤±æ•ˆï¼‰æˆ–è€… Redis æ•…éšœå®•æœºæ—¶ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œ éƒ½æ— æ³•åœ¨ Redis ä¸­å¤„ç†ï¼Œäºæ˜¯å…¨éƒ¨è¯·æ±‚éƒ½ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œ ä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºï¼Œä»è€Œå½¢æˆä¸€ç³»åˆ—è¿é”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œ è§£å†³æ–¹æ¡ˆï¼š é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼š Redis é›†ç¾¤ï¼šé‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿ç”¨ã€‚Redis Cluster å’Œ Redis Sentinel æ˜¯ä¸¤ç§æœ€å¸¸ç”¨çš„ Redis é›†ç¾¤å®ç°æ–¹æ¡ˆ å¤šçº§ç¼“å­˜ï¼šè®¾ç½®å¤šçº§ç¼“å­˜ï¼Œä¾‹å¦‚æœ¬åœ°ç¼“å­˜+Redis ç¼“å­˜çš„äºŒçº§ç¼“å­˜ç»„åˆï¼Œå½“ Redis ç¼“å­˜å‡ºç°é—®é¢˜æ—¶ï¼Œè¿˜å¯ä»¥ä»æœ¬åœ°ç¼“å­˜ä¸­è·å–åˆ°éƒ¨åˆ†æ•°æ®ã€‚ é’ˆå¯¹å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆçš„æƒ…å†µï¼š è®¾ç½®éšæœºå¤±æ•ˆæ—¶é—´ï¼ˆå¯é€‰ï¼‰ï¼šä¸ºç¼“å­˜è®¾ç½®éšæœºçš„å¤±æ•ˆæ—¶é—´ï¼Œ è¿™æ ·å¯ä»¥é¿å…å¤§é‡ç¼“å­˜åŒæ—¶åˆ°æœŸï¼Œä»è€Œå‡å°‘ç¼“å­˜é›ªå´©çš„é£é™©ã€‚ æå‰é¢„çƒ­ï¼ˆæ¨èï¼‰ï¼šé’ˆå¯¹çƒ­ç‚¹æ•°æ®æå‰é¢„çƒ­ï¼Œå°†å…¶å­˜å…¥ç¼“å­˜ä¸­å¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´æ¯”å¦‚ç§’æ€åœºæ™¯ä¸‹çš„æ•°æ®åœ¨ç§’æ€ç»“æŸä¹‹å‰ä¸è¿‡æœŸã€‚ è®¾ç½®ç¼“å­˜é”:åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œè®¾ç½®ä¸€ä¸ªçŸ­æš‚çš„é”å®šæ—¶é—´ï¼Œåªå…è®¸ä¸€ä¸ªè¯·æ±‚æŸ¥è¯¢æ•°æ®åº“å¹¶åˆ·æ–°ç¼“å­˜ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…é”é‡Šæ”¾åå†è¯»å–ç¼“å­˜ã€‚ 5.å¤§Keyé—®é¢˜ ä»€ä¹ˆæ˜¯å¤§keyï¼Ÿ Rediså¤§keyé—®é¢˜æŒ‡çš„æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼æ‰€å çš„å†…å­˜ç©ºé—´æ¯”è¾ƒå¤§ï¼Œ bigkey é™¤äº†ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´å’Œå¸¦å®½ï¼Œè¿˜ä¼šå¯¹æ€§èƒ½é€ æˆæ¯”è¾ƒå¤§çš„å½±å“ã€‚ å¦‚ä½•æ‰¾åˆ°å¤§keyï¼Ÿ 1ã€ä½¿ç”¨ Redis è‡ªå¸¦çš„ â€“bigkeys å‚æ•°æ¥æŸ¥æ‰¾ã€‚ å¦‚ä½•å¤„ç†å¤§keyï¼Ÿ åˆ†å‰² bigkeyï¼šå°†ä¸€ä¸ª bigkey åˆ†å‰²ä¸ºå¤šä¸ªå° keyã€‚ ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªå«æœ‰ä¸Šä¸‡å­—æ®µæ•°é‡çš„ Hash æŒ‰ç…§ä¸€å®šç­–ç•¥ï¼ˆæ¯”å¦‚äºŒæ¬¡å“ˆå¸Œï¼‰æ‹†åˆ†ä¸ºå¤šä¸ª Hashã€‚ åˆ é™¤å¤§ keyï¼šRedis 4.0ä»¥ä¸Šå¯ä»¥ä½¿ç”¨ UNLINK å‘½ä»¤æ¥å¼‚æ­¥åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„ keyã€‚Redis 4.0 ä»¥ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨ SCAN å‘½ä»¤ç»“åˆ DEL å‘½ä»¤æ¥åˆ†åˆ é™¤ã€‚ 6.çƒ­Key ä»€ä¹ˆæ˜¯çƒ­keyï¼Ÿ å¦‚æœä¸€ä¸ª key çš„è®¿é—®æ¬¡æ•°æ¯”è¾ƒå¤šä¸”æ˜æ˜¾å¤šäºå…¶ä»– key çš„è¯ï¼Œé‚£è¿™ä¸ª key å°±å¯ä»¥çœ‹ä½œæ˜¯ hotkeyï¼ˆçƒ­ Keyï¼‰ã€‚ä¾‹å¦‚åœ¨ Redis å®ä¾‹çš„æ¯ç§’å¤„ç†è¯·æ±‚è¾¾åˆ° 5000 æ¬¡ï¼Œè€Œå…¶ä¸­æŸä¸ª key çš„æ¯ç§’è®¿é—®é‡å°±é«˜è¾¾ 2000 æ¬¡ï¼Œé‚£è¿™ä¸ª key å°±å¯ä»¥çœ‹ä½œæ˜¯ hotkeyã€‚ hotkey å‡ºç°çš„åŸå› ä¸»è¦æ˜¯æŸä¸ªçƒ­ç‚¹æ•°æ®è®¿é—®é‡æš´å¢ï¼Œå¦‚é‡å¤§çš„çƒ­æœäº‹ä»¶ã€å‚ä¸ç§’æ€çš„å•†å“ã€‚ å¦‚ä½•æ‰¾åˆ°çƒ­keyï¼Ÿ ä½¿ç”¨ Redis è‡ªå¸¦çš„ â€“hotkeys å‚æ•°æ¥æŸ¥æ‰¾ã€‚ å¦‚ä½•å¤„ç†å¤§keyï¼Ÿ è¯»å†™åˆ†ç¦»ï¼šä¸»èŠ‚ç‚¹å¤„ç†å†™è¯·æ±‚ï¼Œä»èŠ‚ç‚¹å¤„ç†è¯»è¯·æ±‚ã€‚ ä½¿ç”¨ Redis Clusterï¼šå°†çƒ­ç‚¹æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ª Redis èŠ‚ç‚¹ä¸Šã€‚ 6.ç¼“å­˜é¢„çƒ­ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼ å¸¸è§çš„ç¼“å­˜é¢„çƒ­æ–¹å¼æœ‰ä¸¤ç§ï¼š ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚ xxl-jobï¼Œæ¥å®šæ—¶è§¦å‘ç¼“å­˜é¢„çƒ­çš„é€»è¾‘ï¼Œå°†æ•°æ®åº“ä¸­çš„çƒ­ç‚¹æ•°æ®æŸ¥è¯¢å‡ºæ¥å¹¶å­˜å…¥ç¼“å­˜ä¸­ã€‚ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚ Kafkaï¼Œæ¥å¼‚æ­¥åœ°è¿›è¡Œç¼“å­˜é¢„çƒ­ï¼Œå°†æ•°æ®åº“ä¸­çš„çƒ­ç‚¹æ•°æ®çš„ä¸»é”®æˆ–è€… ID å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±ç¼“å­˜æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œæ ¹æ®ä¸»é”®æˆ–è€… ID æŸ¥è¯¢æ•°æ®åº“å¹¶æ›´æ–°ç¼“å­˜ã€‚ 6ã€é«˜å¯ç”¨6.1ã€ä¸»ä»å¤åˆ¶ä¸ºäº†åº”å¯¹å¹¶å‘èƒ½åŠ›é—®é¢˜ï¼Œå¯ä»¥æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼ŒRediså¤§å¤šéƒ½æ˜¯è¯»å¤šå†™å°‘çš„åœºæ™¯ å¤šå°æœåŠ¡å™¨è¦ä¿å­˜åŒä¸€ä»½æ•°æ®ï¼Œè¿™äº›æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®å¦‚ä½•ä¿æŒä¸€è‡´æ€§å‘¢ï¼Ÿæ•°æ®çš„è¯»å†™æ“ä½œæ˜¯å¦æ¯å°æœåŠ¡å™¨éƒ½å¯ä»¥å¤„ç†ï¼Ÿ Redis æä¾›äº†ä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œæ¥é¿å…ä¸Šè¿°çš„é—®é¢˜ã€‚ å½“æ˜¯å†™æ“ä½œï¼Œåœ¨ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œï¼Œç„¶åå°†è¿™ä¸ªæ“ä½œåŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œå½“æ˜¯è¯»æ“ä½œï¼Œå°±åˆ†å‘ç»™ä»æœåŠ¡å™¨ã€‚ ç¬¬ä¸€æ¬¡åŒæ­¥â€”â€”å…¨é‡åŒæ­¥ å¦‚ä½•ç¡®å®šä¸»ä»å…³ç³»ï¼Ÿæ¯”å¦‚æƒ³è®©æœåŠ¡å™¨Bå˜æˆæœåŠ¡å™¨Açš„ä»æœåŠ¡å™¨ 12# æœåŠ¡å™¨ B æ‰§è¡Œè¿™æ¡å‘½ä»¤replicaof &lt;æœåŠ¡å™¨ A çš„ IP åœ°å€&gt; &lt;æœåŠ¡å™¨ A çš„ Redis ç«¯å£å·&gt; åœ¨ä»‹ç»ç¬¬ä¸€æ¬¡åŒæ­¥çš„è¿‡ç¨‹ä¹‹å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸¤ä¸ªå‚æ•° ä»æœåŠ¡å™¨å°±ä¼šç»™ä¸»æœåŠ¡å™¨å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ã€‚ psync å‘½ä»¤åŒ…å«ä¸¤ä¸ªå‚æ•° ï¼Œå¯ä»¥åˆ¤æ–­ä»æœåŠ¡å™¨æ˜¯å¦ç¬¬ä¸€æ¬¡æ¥åŒæ­¥æ•°æ® Replicationldï¼šç®€ç§°replidï¼Œæ¯ä¸ª Redis æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿäº§ä¸€ä¸ªéšæœºçš„ ID æ¥å”¯ä¸€æ ‡è¯†è‡ªå·±ã€‚ ä»æœåŠ¡å™¨ä¼šç»§æ‰¿ä¸»æœåŠ¡å™¨çš„replid offsetï¼šåç§»é‡ï¼Œè¡¨ç¤ºå¤åˆ¶çš„è¿›åº¦ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚ å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚ å…¨é‡åŒæ­¥çš„æµç¨‹å¦‚ä¸‹ï¼š slaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥ masterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥ï¼Œæ‰§è¡Œå…¨é‡åŒæ­¥ masterå°†æ‰§è¡Œ bgsave å‘½ä»¤ï¼ˆå¼‚æ­¥ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼‰ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slaveã€‚ slaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB masterå°†ç”ŸæˆRDBæœŸé—´ã€å‘é€RBDæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™slave slaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥ è‡³æ­¤ï¼Œä¸»ä»æœåŠ¡å™¨çš„ç¬¬ä¸€æ¬¡åŒæ­¥çš„å·¥ä½œå°±å®Œæˆäº†ã€‚ æ–­å¼€åçš„åŒæ­¥â€”â€”å¢é‡åŒæ­¥ ä»èŠ‚ç‚¹æ–­å¼€åé‡å¯ï¼Œé‡‡ç”¨å¢é‡åŒæ­¥ slaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave repl_baklogå¤§å°æœ‰ä¸Šé™ï¼Œæ˜¯ä¸€ä¸ªç¯å½¢åŒºåŸŸï¼Œå†™æ»¡åä¼šè¦†ç›–æœ€æ—©çš„æ•°æ®ã€‚å¦‚æœslaveæ–­å¼€æ—¶é—´è¿‡ä¹…ï¼Œå¯¼è‡´å°šæœªå¤‡ä»½çš„æ•°æ®è¢«è¦†ç›–ï¼Œåˆ™æ— æ³•åŸºäºlogåšå¢é‡åŒæ­¥ï¼Œåªèƒ½å†æ¬¡å…¨é‡åŒæ­¥ã€‚ å› æ­¤ï¼Œä¸ºäº†é¿å…åœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œä¸»æœåŠ¡å™¨é¢‘ç¹åœ°ä½¿ç”¨å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®repl_backlog_buffer ç¼“å†²åŒºå°½å¯èƒ½çš„å¤§ä¸€äº›ï¼Œ å‡å°‘å‡ºç°ä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¢«è¦†ç›–çš„æ¦‚ç‡ï¼Œä»è€Œä½¿å¾—ä¸»æœåŠ¡å™¨é‡‡ç”¨å¢é‡åŒæ­¥çš„æ–¹å¼ã€‚ 6.2ã€å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶ ä¸ºä»€ä¹ˆè¦æœ‰å“¨å…µæœºåˆ¶ï¼Ÿ ä¸»èŠ‚ç‚¹å¦‚æœè¦æ˜¯æŒ‚äº†ï¼Œå°±æ²¡åŠæ³•æ¥æ”¶å†™æ“ä½œäº† å“¨å…µçš„ä¸‰ä¸ªä½œç”¨ï¼Ÿ ç›‘æ§ï¼šSentinelä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ è‡ªåŠ¨æ•…éšœæ¢å¤ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸» é€šçŸ¥ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚RedisTemplateï¼‰çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯ å¦‚ä½•åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ•…éšœï¼Ÿ SentinelåŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªå®ä¾‹å‘é€pingå‘½ä»¤ ä¸»è§‚ä¸‹çº¿ï¼šå¦‚æœæŸsentinelèŠ‚ç‚¹å‘ç°æŸå®ä¾‹æœªåœ¨è§„å®šæ—¶é—´å“åº”ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ã€‚ å®¢è§‚ä¸‹çº¿ï¼šè‹¥è¶…è¿‡æŒ‡å®šæ•°é‡(quorum)çš„sentineléƒ½è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥å®ä¾‹å®¢è§‚ä¸‹çº¿ã€‚quorumå€¼æœ€å¥½è¶…è¿‡Sentinelå®ä¾‹æ•°é‡çš„ä¸€åŠã€‚ é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹çš„è§„åˆ™ï¼Ÿ é¦–å…ˆè¦æŠŠç½‘ç»œçŠ¶æ€ä¸å¥½çš„ä»èŠ‚ç‚¹ç»™è¿‡æ»¤æ‰ï¼Œé¦–å…ˆæŠŠå·²ç»ä¸‹çº¿çš„ä»èŠ‚ç‚¹è¿‡æ»¤æ‰ ã€‚ç„¶åå¯¹æ‰€æœ‰ä»èŠ‚ç‚¹è¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID å·ã€‚ ä¼˜å…ˆçº§æœ€é«˜çš„ä»èŠ‚ç‚¹èƒœå‡º èŠ‚ç‚¹çš„offsetå€¼ï¼ˆåæ˜ äº†å¤åˆ¶è¿›åº¦ï¼‰è¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ slaveèŠ‚ç‚¹çš„è¿è¡Œidå¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚ æ•…éšœè½¬ç§»çš„è¿‡ç¨‹ï¼Ÿ é€‰å‡ºä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹ è®©æ—§ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ® å°†æ–°ä¸»èŠ‚ç‚¹çš„IPåœ°å€å’Œä¿¡æ¯ï¼Œé€šçŸ¥ç»™å®¢æˆ·ç«¯ ç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ TODO å¦‚ä½•ä» Sentinel é›†ç¾¤ä¸­é€‰æ‹©å‡º Leader ï¼Ÿï¼ˆç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼‰ è„‘è£‚Sentinel å¯ä»¥é˜²æ­¢è„‘è£‚å—ï¼Ÿï¼ˆåœ¨å°æ—â€ä¸»ä»å¤åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„â€œé‚£é‡Œæœ€åæœ‰æåˆ°è„‘è£‚ï¼Œå¯ç»“åˆgptçœ‹çœ‹ï¼‰ 6.3ã€åˆ†ç‰‡é›†ç¾¤ï¼ˆCluster ï¼‰ ä¸ºä»€ä¹ˆéœ€è¦ Redis Clusterï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ ä¸»ä»è§£å†³äº†é«˜å¹¶å‘ï¼ˆè¯»ï¼‰é—®é¢˜ï¼Œä½†å­˜åœ¨é«˜å¯ç”¨é—®é¢˜ï¼Œå“¨å…µè§£å†³äº†é«˜å¯ç”¨é—®é¢˜ã€‚ä½†è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼š æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ é«˜å¹¶å‘å†™çš„é—®é¢˜ ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œåˆ†ç‰‡é›†ç¾¤ç‰¹å¾ï¼š é›†ç¾¤ä¸­æœ‰å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹ä¿å­˜ä¸åŒæ•°æ® æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ ä¸»èŠ‚ç‚¹ä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€ å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹ Redis Cluster æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ï¼Ÿ ä¸ºä»€ä¹ˆ Redis Cluster çš„å“ˆå¸Œæ§½æ˜¯ 16384 ä¸ª? å¦‚ä½•ç¡®å®šç»™å®š key çš„åº”è¯¥åˆ†å¸ƒåˆ°å“ªä¸ªå“ˆå¸Œæ§½ä¸­ï¼Ÿ Redis Cluster æ”¯æŒé‡æ–°åˆ†é…å“ˆå¸Œæ§½å—ï¼Ÿ Redis Cluster æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—ï¼Ÿ Redis Cluster ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„ï¼Ÿ 7.åœºæ™¯1.åˆ†å¸ƒå¼é”çš„è®¾è®¡æ–¹æ¡ˆè®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼é”è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š é¿å…æ­»é”ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹è·å¾—é”åå› ä¸ºæŸäº›åŸå› å´©æºƒäº†ï¼Œä¸èƒ½ä¸»åŠ¨é‡Šæ”¾é”ï¼Œè¦ä¿è¯å…¶å®ƒå®¢æˆ·ç«¯ä¾ç„¶èƒ½è·å¾—é” åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼šå¿…é¡»ä¿è¯è·å¾—é”å’Œé‡Šæ”¾é”çš„æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ è€Œredissonä¸ä»…å®ç°äº†ä¸Šè¿°åŠŸèƒ½ï¼Œè¿˜æ›´ä¸ºå¼ºå¤§ï¼Œæœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š è‡ªåŠ¨ç»­æœŸï¼š è¯»å†™é”ï¼š å…¬å¹³é”ï¼š ä¸‹é¢ä»‹ç»redissonåŸç† åŠ é” keyæ˜¯é”çš„åç§°ï¼Œvalueæ˜¯ä¸ªmapï¼Œmapçš„keyæ˜¯çº¿ç¨‹idï¼Œvalueæ˜¯é”çš„é‡å…¥æ¬¡æ•°ï¼Œç„¶åè®¾ç½®é”è¿‡æœŸæ—¶é—´ å¦‚æœåŠ é”æˆåŠŸï¼Œé”çš„é‡å…¥æ¬¡æ•°åŠ ä¸€ï¼Œè¿™å°±å®ç°äº†é‡å…¥é”çš„åŠŸèƒ½ï¼› åŠ é”æˆåŠŸåï¼Œå°±ä¼šæ‰§è¡Œä¸€ä¸ªçœ‹é—¨ç‹—çš„æœºåˆ¶ã€‚çœ‹é—¨ç‹—æœºåˆ¶æ˜¯ä¸ºäº†é˜²æ­¢ä¸šåŠ¡è¿˜æ²¡æ‰§è¡Œå®Œï¼Œä½†é”åˆ°æœŸäº†çš„é—®é¢˜ã€‚çœ‹é—¨ç‹—å°±æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåªè¦å½“å‰çº¿ç¨‹ä»»åŠ¡æ²¡æœ‰æŒ‚æ‰ï¼Œä¸”æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±ä¼šéš”ä¸€æ®µæ—¶é—´ç»™é”ç»­æœŸ å¦‚æœå¤±è´¥ï¼Œè¿”å›é”çš„è¿‡æœŸæ—¶é—´ åŠ é”å¤±è´¥åï¼Œä¼šè¿›å…¥ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œæ­¤çº¿ç¨‹ä¼šè¢«semaphoreé˜»å¡ï¼Œå½“ä¹‹å‰çš„çº¿ç¨‹é‡Šæ”¾é”åï¼Œä¼šé€šè¿‡semaphoreæ¥å”¤é†’æ­¤çº¿ç¨‹ï¼Œç„¶åè·å¾—é”åè·³å‡ºæ­¤å¾ªç¯ é‡Šæ”¾é”æ—¶ï¼Œå¦‚æœè¯¥é”çš„çº¿ç¨‹idä¸æ˜¯è‡ªå·±çš„ï¼Œå°±æ— æƒé‡Šæ”¾ï¼›å¦‚æœæ˜¯ï¼Œå°±å°†é‡å…¥æ¬¡æ•°å‡ä¸€ï¼Œå¦‚æœå‡åçš„é‡å…¥æ¬¡æ•°è¿˜æ˜¯ï¼0ï¼Œå°±ä¸èƒ½é‡Šæ”¾ï¼Œæ›´æ–°é”åˆ°æœŸæ—¶é—´ï¼Œå¦åˆ™å°±é‡Šæ”¾é”ï¼Œç„¶åå‘é€é”é‡Šæ”¾æ¶ˆæ¯ï¼Œå”¤é†’è¢«é˜»å¡çš„çº¿ç¨‹ æ— è®ºåŠ é”æˆåŠŸæˆ–å¤±è´¥ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªfutureç»“æœå™¨æ¥æ¥æ”¶åŠ é”ç»“æœ 2.å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€åœºæ™¯","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"}]},{"title":"Mysql","slug":"å…«è‚¡/Mysql","date":"2024-10-28T12:14:46.000Z","updated":"2025-03-14T13:27:54.958Z","comments":true,"path":"2024/10/28/å…«è‚¡/Mysql/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/Mysql/","excerpt":"è¿™é‡Œæ˜¯æ•°æ®åº“MYSQLçš„ä¸€äº›å…«è‚¡çŸ¥è¯†","text":"è¿™é‡Œæ˜¯æ•°æ®åº“MYSQLçš„ä¸€äº›å…«è‚¡çŸ¥è¯† 1.åŸºç¡€çŸ¥è¯†1.MyISAMä¸InnoDBåŒºåˆ«å­˜å‚¨å¼•æ“ï¼ˆStorage Engineï¼‰æ˜¯ç”¨æ¥å®šä¹‰æ•°æ®è¡¨å¦‚ä½•å­˜å‚¨ã€è¯»å–ã€ç®¡ç†å’Œå¤„ç†æ•°æ®çš„åº•å±‚æœºåˆ¶ã€‚æ¢å¥è¯è¯´ï¼Œå­˜å‚¨å¼•æ“å†³å®šäº† MySQL å¦‚ä½•åœ¨ç‰©ç†å±‚é¢ä¸Šå­˜å‚¨æ•°æ®ã€å¦‚ä½•å»ºç«‹ç´¢å¼•ã€å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢ï¼Œä»¥åŠæ”¯æŒå“ªäº›ç‰¹æ€§ï¼ˆå¦‚äº‹åŠ¡ã€é”æœºåˆ¶ç­‰ï¼‰ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“é€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œå› æ­¤ MySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚ å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œä½¿ç”¨é»˜è®¤çš„Innodbå³å¯ 1ã€æ˜¯å¦æ”¯æŒè¡Œçº§é” MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€Œ InnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”ã€‚ 2ã€æ˜¯å¦æ”¯æŒäº‹åŠ¡ MyISAM ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚ InnoDB æä¾›äº‹åŠ¡æ”¯æŒï¼Œå®ç°äº† SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼Œå…·æœ‰æäº¤(commit)å’Œå›æ»š(rollback)äº‹åŠ¡çš„èƒ½åŠ›ã€‚å¹¶ä¸”ï¼ŒInnoDB é»˜è®¤ä½¿ç”¨çš„ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰éš”ç¦»çº§åˆ«æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼ˆåŸºäº MVCC å’Œ Next-Key Lockï¼‰ã€‚ 3ã€ç´¢å¼•ç»“æ„ MyISAMæ˜¯éèšç°‡ç´¢å¼•ï¼Œè€ŒInnoDBæœ‰èšç°‡ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•çš„æŸ¥æ‰¾æ•ˆç‡æ›´é«˜ 4ã€æ˜¯å¦æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤ MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚ ä½¿ç”¨ InnoDB çš„æ•°æ®åº“åœ¨å¼‚å¸¸å´©æºƒåï¼Œæ•°æ®åº“é‡æ–°å¯åŠ¨çš„æ—¶å€™ä¼šä¿è¯æ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„çŠ¶æ€ã€‚è¿™ä¸ªæ¢å¤çš„è¿‡ç¨‹ä¾èµ–äº redo log ã€‚ 2.æ‰§è¡Œä¸€æ¡SQLè¯·æ±‚çš„è¿‡ç¨‹ Server å±‚ï¼šä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ï¼Œå‡½æ•°ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šç”¨çš„æ—¥å¿—æ¨¡å— binlog æ—¥å¿—æ¨¡å—ã€‚ å­˜å‚¨å¼•æ“ï¼šä¸»è¦è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼Œé‡‡ç”¨å¯ä»¥æ›¿æ¢çš„æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œå…¶ä¸­ InnoDB å¼•æ“æœ‰è‡ªæœ‰çš„æ—¥å¿—æ¨¡å— redolog æ¨¡å—ã€‚**ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5 ç‰ˆæœ¬å¼€å§‹å°±è¢«å½“åšé»˜è®¤å­˜å‚¨å¼•æ“äº†ã€‚ MySQL æœåŠ¡å™¨çš„è¿æ¥å™¨å¼€å§‹å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œä¸»è¦è´Ÿè´£ç”¨æˆ·ç™»å½•æ•°æ®åº“ï¼Œè¿›è¡Œç”¨æˆ·çš„èº«ä»½è®¤è¯ï¼ŒåŒ…æ‹¬æ ¡éªŒè´¦æˆ·å¯†ç ï¼Œæƒé™ç­‰æ“ä½œ åˆ†æå™¨å¼€å§‹å¯¹ SQL è¯­å¥è¿›è¡Œè§£æï¼Œæ£€æŸ¥è¯­å¥æ˜¯å¦ç¬¦åˆ SQL è¯­æ³•è§„åˆ™ï¼Œç¡®ä¿å¼•ç”¨çš„æ•°æ®åº“ã€è¡¨å’Œåˆ—éƒ½å­˜åœ¨ï¼Œå¹¶å¤„ç† SQL è¯­å¥ä¸­çš„åç§°è§£æå’Œæƒé™éªŒè¯ã€‚ ä¼˜åŒ–å™¨è´Ÿè´£ç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œè¿™åŒ…æ‹¬é€‰æ‹©ä½¿ç”¨å“ªäº›ç´¢å¼•ï¼Œä»¥åŠå†³å®šè¡¨ä¹‹é—´çš„è¿æ¥é¡ºåºç­‰ã€‚ä¼˜åŒ–å™¨ä¼šå°è¯•æ‰¾å‡ºæœ€é«˜æ•ˆçš„æ–¹å¼æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚ æ‰§è¡Œå™¨é¦–å…ˆæ‰§è¡Œå‰ä¼šæ ¡éªŒè¯¥ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œå°±ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰æƒé™ï¼Œå°±ä¼šå»è°ƒç”¨å¼•æ“çš„æ¥å£ï¼Œè¿”å›æ¥å£æ‰§è¡Œçš„ç»“æœã€‚ psï¼šå¦‚æœæ˜¯ä¸€æ¡æ›´æ–°è¯­å¥ï¼Œç•¥æœ‰ä¸€ç‚¹ä¸åŒï¼š æ‰§è¡Œæ›´æ–°çš„æ—¶å€™è‚¯å®šè¦è®°å½•æ—¥å¿—å•¦ï¼Œè¿™å°±ä¼šå¼•å…¥æ—¥å¿—æ¨¡å—äº† ï¼ŒMySQL è‡ªå¸¦çš„æ—¥å¿—æ¨¡å—æ˜¯ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ ï¼Œæ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ InnoDB å¼•æ“è¿˜è‡ªå¸¦äº†ä¸€ä¸ªæ—¥å¿—æ¨¡å— redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ å‰é¢çš„å¤§è‡´éƒ½ç±»ä¼¼ äº‹åŠ¡ï¼šåœ¨å‡†å¤‡æ›´æ–°è®°å½•ä¹‹å‰ä¼šè®°å½•undologï¼Œç”¨äºå¤±è´¥å›æ»šå’ŒMVCCï¼ˆæ”¯æŒå…¶å®ƒäº‹åŠ¡è¯»å–æ—§ç‰ˆæœ¬ï¼‰ prepareé˜¶æ®µï¼š å…ˆæ›´æ–°å†…å­˜ï¼Œå…ˆæ›´æ–°å†…å­˜ï¼ˆåŒæ—¶æ ‡è®°ä¸ºè„é¡µï¼‰ï¼Œç„¶åå°†è®°å½•å†™åˆ° redo log é‡Œé¢ï¼Œç„¶åå‘Šè¯‰æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤ã€‚ æ‰§è¡Œå™¨æ”¶åˆ°é€šçŸ¥åè®°å½• binlogï¼Œç„¶åè°ƒç”¨å¼•æ“æ¥å£ï¼Œæäº¤ redo log ä¸ºæäº¤çŠ¶æ€ã€‚ æ›´æ–°å®Œæˆã€‚ 3.ä¸‰å¤§èŒƒå¼ ç¬¬ä¸€èŒƒå¼ï¼šè¦æ±‚æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ã€‚ ç¬¬äºŒèŒƒå¼ï¼šåœ¨ 1NF çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸èƒ½åªä¸ä¸»é”®çš„æŸä¸€éƒ¨åˆ†ç›¸å…³ï¼ˆä¸»è¦é’ˆå¯¹è”åˆä¸»é”®ï¼‰ã€‚ æ¯”å¦‚è¯´åœ¨ä¸€ä¸ªè®¢å•è¡¨ä¸­ï¼Œå¯èƒ½ä¼šå­˜åœ¨è®¢å•ç¼–å·å’Œå•†å“ç¼–å·ï¼Œè®¾è®¡å‡ºæ¥çš„è¡¨å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚ è¿™ä¸ªè®¢å•è¡¨ä¸­å°±å­˜åœ¨å†—ä½™æ•°æ®ï¼Œæ¯”å¦‚è¯´å•†å“åç§°ã€å•ä½ã€å•†å“ä»·æ ¼ç­‰ï¼Œåº”è¯¥å°†å…¶æ‹†åˆ†ä¸ºè®¢å•è¡¨ã€è®¢å•å•†å“å…³è”è¡¨ã€å•†å“è¡¨ã€‚ è¿™ä¸ªè®¢å•è¡¨ä¸­å°±å­˜åœ¨å†—ä½™æ•°æ®ï¼Œæ¯”å¦‚è¯´å•†å“åç§°ã€å•ä½ã€å•†å“ä»·æ ¼ç­‰ï¼Œåº”è¯¥å°†å…¶æ‹†åˆ†ä¸ºè®¢å•è¡¨ã€è®¢å•å•†å“å…³è”è¡¨ã€å•†å“è¡¨ã€‚ ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨2NFåŸºç¡€ä¸Šï¼Œä»»ä½•éä¸»å±æ€§ä¸ä¾èµ–äºå…¶å®ƒéä¸»å±æ€§ï¼ˆåœ¨2NFåŸºç¡€ä¸Šæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰ï¼Œç¬¬ä¸‰èŒƒå¼éœ€è¦ç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—æ•°æ®éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸èƒ½é—´æ¥ç›¸å…³ã€‚ 4.è¡¨è¿æ¥ å†…è¿æ¥ï¼šè¿”å›ä¸¤ä¸ªè¡¨ä¸­æœ‰åŒ¹é…å…³ç³»çš„è¡Œ ã€‚ç›¸å½“äºå–äº¤é›† å¤–è¿æ¥ï¼šä»…è¿”å›ä¸¤ä¸ªè¡¨ä¸­åŒ¹é…çš„è¡Œï¼Œè¿˜è¿”å›å·¦è¡¨ã€å³è¡¨æˆ–ä¸¤è€…ä¸­æœªåŒ¹é…çš„è¡Œã€‚ å·¦è¿æ¥ï¼šä»¥å·¦è¡¨ä¸ºä¸»ï¼Œå…ˆæŸ¥è¯¢å‡ºå·¦è¡¨ï¼ŒæŒ‰ç…§ONåçš„å…³è”æ¡ä»¶åŒ¹é…å³è¡¨ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ç”¨NULLå¡«å……ï¼Œå¯ä»¥ç®€å†™æˆLEFT JOIN å³è¿æ¥ï¼šRIGHT OUTER JOIN, ä»¥å³è¡¨ä¸ºä¸»ï¼Œå…ˆæŸ¥è¯¢å‡ºå³è¡¨ï¼ŒæŒ‰ç…§ONåçš„å…³è”æ¡ä»¶åŒ¹é…å·¦è¡¨ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ç”¨NULLå¡«å……ï¼Œå¯ä»¥ç®€å†™æˆRIGHT JOIN äº¤å‰è¿æ¥ï¼ˆå¾—åˆ°ç¬›å¡å°”ç§¯ï¼‰ï¼šè¿”å›ç¬¬ä¸€ä¸ªè¡¨ä¸­çš„æ¯ä¸€è¡Œä¸ç¬¬äºŒä¸ªè¡¨ä¸­çš„æ¯ä¸€è¡Œçš„ç»„åˆï¼Œè¿™ç§ç±»å‹çš„è¿æ¥é€šå¸¸ç”¨äºç”Ÿæˆç¬›å¡å°”ç§¯ã€‚ 5.inå’Œexitçš„åŒºåˆ«IN å’Œ EXISTS éƒ½æ˜¯ç”¨æ¥å¤„ç†å­æŸ¥è¯¢çš„å…³é”®è¯ï¼Œ ä½†å®ƒä»¬åœ¨åŠŸèƒ½ã€æ€§èƒ½å’Œä½¿ç”¨åœºæ™¯ä¸Šæœ‰å„è‡ªçš„ç‰¹ç‚¹å’ŒåŒºåˆ«ã€‚ IN ç”¨äºæ£€æŸ¥å·¦è¾¹çš„è¡¨è¾¾å¼æ˜¯å¦å­˜åœ¨äºå³è¾¹çš„åˆ—è¡¨æˆ–å­æŸ¥è¯¢çš„ç»“æœé›†ä¸­ã€‚ å¦‚æœå­˜åœ¨ï¼Œåˆ™IN è¿”å›TRUEï¼Œå¦åˆ™è¿”å›FALSEã€‚ EXISTS ç”¨äºåˆ¤æ–­å­æŸ¥è¯¢æ˜¯å¦è‡³å°‘èƒ½è¿”å›ä¸€è¡Œæ•°æ®ã€‚ å®ƒä¸å…³å¿ƒå­æŸ¥è¯¢è¿”å›ä»€ä¹ˆæ•°æ®ï¼Œåªå…³å¿ƒæ˜¯å¦æœ‰ç»“æœã€‚ å¦‚æœå­æŸ¥è¯¢æœ‰ç»“æœï¼Œåˆ™EXISTS è¿”å›TRUEï¼Œå¦åˆ™è¿”å›FALSEã€‚ å½“ä½¿ç”¨ IN æ—¶ï¼ŒMySQL ä¼šé¦–å…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œç„¶åå°†å­æŸ¥è¯¢çš„ç»“æœé›†ç”¨äºå¤–éƒ¨æŸ¥è¯¢çš„æ¡ä»¶ã€‚è¿™æ„å‘³ç€å­æŸ¥è¯¢çš„ç»“æœé›†éœ€è¦å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ è€Œ EXISTS ä¼šå¯¹å¤–éƒ¨æŸ¥è¯¢çš„æ¯ä¸€è¡Œï¼Œæ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢ã€‚å¦‚æœå­æŸ¥è¯¢è¿”å›ä»»ä½•è¡Œï¼Œåˆ™ EXISTS æ¡ä»¶ä¸ºçœŸã€‚EXISTS å…³æ³¨çš„æ˜¯å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œè€Œä¸æ˜¯è¿”å›çš„å…·ä½“å€¼ã€‚ IN é€‚ç”¨äºå­æŸ¥è¯¢ç»“æœé›†è¾ƒå°çš„æƒ…å†µã€‚å¦‚æœå­æŸ¥è¯¢è¿”å›å¤§é‡æ•°æ®ï¼ŒIN çš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ•´ä¸ªç»“æœé›†åŠ è½½åˆ°å†…å­˜ã€‚ è€Œ EXISTS é€‚ç”¨äºå­æŸ¥è¯¢ç»“æœé›†å¯èƒ½å¾ˆå¤§çš„æƒ…å†µã€‚ç”±äº EXISTS åªéœ€è¦åˆ¤æ–­å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªç»“æœé›†ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½æ›´å¥½ï¼Œç‰¹åˆ«æ˜¯å½“å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•æ—¶ã€‚ åŒºåˆ«å¦‚ä¸‹ æ€§èƒ½å·®å¼‚ï¼šåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒEXISTS çš„æ€§èƒ½ä¼˜äº INï¼Œ ç‰¹åˆ«æ˜¯å½“å­æŸ¥è¯¢çš„è¡¨å¾ˆå¤§æ—¶ã€‚è¿™æ˜¯å› ä¸ºEXISTS ä¸€æ—¦æ‰¾åˆ°åŒ¹é…é¡¹å°±ä¼šç«‹å³åœæ­¢æŸ¥è¯¢ï¼Œè€ŒINå¯èƒ½ä¼šæ‰«ææ•´ä¸ªå­æŸ¥è¯¢ç»“æœé›†ã€‚ ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœå­æŸ¥è¯¢ç»“æœé›†è¾ƒå°ä¸”ä¸é¢‘ç¹å˜åŠ¨ï¼ŒIN å¯èƒ½æ›´ç›´è§‚æ˜“æ‡‚ã€‚ è€Œå½“å­æŸ¥è¯¢æ¶‰åŠå¤–éƒ¨æŸ¥è¯¢çš„æ¯ä¸€è¡Œåˆ¤æ–­ï¼Œå¹¶ä¸”å­æŸ¥è¯¢çš„æ•ˆç‡è¾ƒé«˜æ—¶ï¼ŒEXISTS æ›´ä¸ºåˆé€‚ã€‚ NULLå€¼å¤„ç†ï¼šIN èƒ½å¤Ÿæ­£ç¡®å¤„ç†å­æŸ¥è¯¢ä¸­åŒ…å«NULLå€¼çš„æƒ…å†µï¼Œ è€ŒEXISTS ä¸å—å­æŸ¥è¯¢ç»“æœä¸­NULLå€¼çš„å½±å“ï¼Œå› ä¸ºå®ƒå…³æ³¨çš„æ˜¯è¡Œçš„å­˜åœ¨æ€§ï¼Œè€Œä¸æ˜¯å…·ä½“å€¼ã€‚ 6.NULLå’Œ&#39;&#39;çš„åŒºåˆ«ä¹Ÿå¯ä»¥è¿™æ ·é—®ï¼šä¸ºä»€ä¹ˆ MySQL ä¸å»ºè®®ä½¿ç”¨ NULL ä½œä¸ºåˆ—é»˜è®¤å€¼ï¼Ÿ NULLçš„å€¼ä¸ç¡®å®šï¼šNULL ä»£è¡¨ä¸€ä¸ªä¸ç¡®å®šçš„å€¼ï¼Œå°±ç®—æ˜¯ä¸¤ä¸ª NULL,å®ƒä¿©ä¹Ÿä¸ä¸€å®šç›¸ç­‰ã€‚ä¾‹å¦‚ï¼ŒSELECT NULL=NULLçš„ç»“æœä¸º falseï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä½¿ç”¨DISTINCT,GROUP BY,ORDER BYæ—¶,NULLåˆè¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚ å ç”¨ç©ºé—´ï¼š&#39;&#39;çš„é•¿åº¦æ˜¯ 0ï¼Œæ˜¯ä¸å ç”¨ç©ºé—´çš„ï¼Œè€ŒNULL æ˜¯éœ€è¦å ç”¨ç©ºé—´çš„ã€‚ NULL ä¼šå½±å“èšåˆå‡½æ•°çš„ç»“æœã€‚ä¾‹å¦‚ï¼ŒSUMã€AVGã€MINã€MAX ç­‰èšåˆå‡½æ•°ä¼šå¿½ç•¥ NULL å€¼ã€‚ COUNT çš„å¤„ç†æ–¹å¼å–å†³äºå‚æ•°çš„ç±»å‹ã€‚å¦‚æœå‚æ•°æ˜¯ *(COUNT(*))ï¼Œåˆ™ä¼šç»Ÿè®¡æ‰€æœ‰çš„è®°å½•æ•°ï¼ŒåŒ…æ‹¬ NULL å€¼ï¼›å¦‚æœå‚æ•°æ˜¯æŸä¸ªå­—æ®µå(COUNT(åˆ—å))ï¼Œåˆ™ä¼šå¿½ç•¥ NULL å€¼ï¼Œåªç»Ÿè®¡éç©ºå€¼çš„ä¸ªæ•°ã€‚ æŸ¥è¯¢ NULL å€¼æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ IS NULL æˆ– IS NOT NULLl æ¥åˆ¤æ–­ï¼Œè€Œä¸èƒ½ä½¿ç”¨ &#x3D;ã€!&#x3D;ã€ &lt;ã€&gt; ä¹‹ç±»çš„æ¯”è¾ƒè¿ç®—ç¬¦ã€‚è€Œ&#39;&#39;æ˜¯å¯ä»¥ä½¿ç”¨è¿™äº›æ¯”è¾ƒè¿ç®—ç¬¦çš„ã€‚ 7.charå’Œvarcharçš„åŒºåˆ«CHAR æ˜¯å®šé•¿å­—ç¬¦ä¸²ï¼ŒVARCHAR æ˜¯å˜é•¿å­—ç¬¦ä¸²ã€‚ CHAR åœ¨å­˜å‚¨æ—¶ä¼šåœ¨å³è¾¹å¡«å……ç©ºæ ¼ä»¥è¾¾åˆ°æŒ‡å®šçš„é•¿åº¦ï¼Œæ£€ç´¢æ—¶ä¼šå»æ‰ç©ºæ ¼ï¼› 8.unionå’ŒunionAllçš„åŒºåˆ« å¦‚æœä½¿ç”¨ UNIONï¼Œä¼šåœ¨è¡¨é“¾æ¥åç­›é€‰æ‰é‡å¤çš„è®°å½•è¡Œ å¦‚æœä½¿ç”¨ UNION ALLï¼Œä¸ä¼šåˆå¹¶é‡å¤çš„è®°å½•è¡Œ ä»æ•ˆç‡ä¸Šè¯´ï¼ŒUNION ALL è¦æ¯” UNION å¿«å¾ˆå¤šï¼Œå¦‚æœåˆå¹¶æ²¡æœ‰åˆ»æ„è¦åˆ é™¤é‡å¤è¡Œï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ UNION All 9.MySQLæ•°æ®çš„å­˜å‚¨å½¢å¼MySQL æ˜¯ä»¥è¡¨çš„å½¢å¼å­˜å‚¨æ•°æ®çš„ï¼Œè€Œè¡¨ç©ºé—´çš„ç»“æ„åˆ™ç”±æ®µã€åŒºã€é¡µã€è¡Œç»„æˆã€‚ è¡¨â€”â€”æ®µâ€”â€”åŒºâ€”â€”é¡µâ€”â€”è¡Œï¼ˆè®°å½•ï¼‰ 2.ç´¢å¼•å¯¹äºè¿™æ ·ä¸€å¼ è¡¨ å®ƒçš„ç´¢å¼•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼ˆå…¶ä¸­å¶å­èŠ‚ç‚¹æ˜¯åŒé“¾è¡¨è¿æ¥ï¼‰ 1.ç´¢å¼•çš„ç§ç±» ä»æ•°æ®ç»“æ„è§’åº¦ Bæ•°ç´¢å¼•ï¼šMySQL é‡Œé»˜è®¤å’Œæœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨ valueï¼Œéå¶å­èŠ‚ç‚¹åªæœ‰æŒ‡é’ˆå’Œ keyã€‚ Hashç´¢å¼•ï¼šç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼ï¼Œä¸€æ¬¡å³å¯å®šä½ã€‚ ä»ç‰©ç†å­˜å‚¨è§’åº¦ èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«åœ¨äºç´¢å¼•å’Œæ•°æ®è¡Œçš„å­˜å‚¨æ–¹å¼ã€‚èšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®è¡Œå­˜å‚¨åœ¨ä¸€èµ·ï¼Œè€Œéèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®è¡Œåˆ†å¼€å­˜å‚¨ã€‚ èšç°‡ç´¢å¼•ï¼šèšç°‡ç´¢å¼•æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡æ–¹å¼ï¼Œå®ƒå°†ç´¢å¼•å’Œæ•°æ®è¡Œå­˜å‚¨åœ¨ä¸€èµ·ï¼Œå³æ•°æ®è¡ŒæŒ‰ç…§ç´¢å¼•çš„é¡ºåºå­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯å®Œæ•´çš„æ•°æ®è¡Œï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„æŸ¥æ‰¾æ“ä½œå°±å¯ä»¥è·å–åˆ°æ‰€éœ€çš„æ•°æ®ã€‚InnoDB ä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼•ã€‚ éèšç°‡ç´¢å¼•ï¼šå®ƒå°†ç´¢å¼•å’Œæ•°æ®è¡Œåˆ†å¼€å­˜å‚¨ï¼Œå³ç´¢å¼•ä¿å­˜äº†æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆï¼ˆé€šå¸¸æ˜¯è¡Œçš„ç‰©ç†åœ°å€æˆ–ä¸»é”®å€¼ï¼‰ã€‚éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯æŒ‡å‘æ•°æ®è¡Œçš„å¼•ç”¨ï¼Œå½“æŸ¥è¯¢éœ€è¦è·å–æ•°æ®æ—¶ï¼Œé¦–å…ˆæ ¹æ®ç´¢å¼•æŸ¥æ‰¾åˆ°ç›¸åº”çš„è¡ŒæŒ‡é’ˆï¼Œç„¶åå†é€šè¿‡è¡ŒæŒ‡é’ˆè·å–æ•°æ®è¡Œã€‚ MyISAM å­˜å‚¨å¼•æ“çš„ç´¢å¼•é€šå¸¸æ˜¯éèšç°‡ç´¢å¼•ã€‚ ä»é€»è¾‘è§’åº¦ ä¸»é”®ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ä¸ºNULLï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚ å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸ºNULLå€¼ï¼Œä¸€ä¸ªè¡¨å…è®¸å¤šä¸ªåˆ—åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚å…³é”®å­—UNIQUE å¯ä»¥é€šè¿‡ ALTER TABLE table_name ADD UNIQUE (column); åˆ›å»ºå”¯ä¸€ç´¢å¼• æ™®é€šç´¢å¼•ï¼šåŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰å”¯ä¸€æ€§çš„é™åˆ¶ï¼Œå…è®¸ä¸ºNULLå€¼ã€‚ å¯ä»¥é€šè¿‡ALTER TABLE table_name ADD INDEX index_name (column);åˆ›å»ºæ™®é€šç´¢å¼• è”åˆç´¢å¼•ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚ å¯ä»¥é€šè¿‡ALTER TABLE table_name ADD INDEX index_name(column1, column2, column3);åˆ›å»ºè”åˆç´¢å¼• å¯ä»¥é€šè¿‡ ALTER TABLE table_name ADD UNIQUE (column1,column2); åˆ›å»ºå”¯ä¸€è”åˆç´¢å¼• åœ¨åˆ›å»ºè¡¨æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šæ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„åˆ—ä½œä¸ºç´¢å¼•ï¼š å¦‚æœæœ‰ä¸»é”®ï¼Œé»˜è®¤ä¼šä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼ˆkeyï¼‰ï¼› å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å« NULL å€¼çš„å”¯ä¸€åˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼ˆkeyï¼‰ï¼› å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±é€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å« NULL å€¼çš„å”¯ä¸€åˆ—ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼ˆkeyï¼‰ï¼› å…¶å®ƒç´¢å¼•éƒ½å±äºè¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•æˆ–éèšç°‡ç´¢å¼•ã€‚ ä¸»é”®ç´¢å¼•çš„ B+Tree å’ŒäºŒçº§ç´¢å¼•çš„ B+Tree åŒºåˆ«å¦‚ä¸‹ï¼š ä¸»é”®ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼Œ æ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨ä¸»é”®ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹é‡Œï¼› äºŒçº§ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®é™…æ•°æ®ã€‚ 2.å›è¡¨æŸ¥è¯¢åœ¨ä½¿ç”¨éèšç°‡ç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¦‚æœéœ€è¦æŸ¥çš„æ•°æ®æ˜¯ä¸»é”®ä¹‹å¤–çš„æ•°æ®ï¼Œåœ¨æŸ¥åˆ°ä¸»é”®ä¹‹åç„¶åå›åˆ°ä¸»é”®ç´¢å¼•å†æŸ¥ä¸€æ¬¡ï¼Œè¿™ä¸ªå°±å«å›è¡¨æŸ¥è¯¢ã€‚ å¯¹äºéèšç°‡ç´¢å¼•ï¼Œä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ ä¸ä¸€å®šã€‚è¯•æƒ³ä¸€ç§æƒ…å†µï¼Œç”¨æˆ·å‡†å¤‡ä½¿ç”¨ SQL æŸ¥è¯¢ç”¨æˆ·åï¼Œè€Œç”¨æˆ·åå­—æ®µæ­£å¥½å»ºç«‹äº†ç´¢å¼•ã€‚é‚£ä¹ˆè¿™ä¸ªç´¢å¼•çš„ key æœ¬èº«å°±æ˜¯ nameï¼ŒæŸ¥åˆ°å¯¹åº”çš„ name ç›´æ¥è¿”å›å°±è¡Œäº†ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚ è¿™ç§æƒ…å†µå°±ç§°ä¹‹ä¸ºç´¢å¼•è¦†ç›–ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œè¿™æ˜¯äºŒçº§ç´¢å¼•çš„æŸ¥æ‰¾è¿‡ç¨‹ å°†å•†å“è¡¨ä¸­çš„ product_no ï¼ˆå•†å“ç¼–ç ï¼‰å­—æ®µè®¾ç½®ä¸ºäºŒçº§ç´¢å¼•ï¼Œ é‚£ä¹ˆäºŒçº§ç´¢å¼•çš„ B+Tree å¦‚ä¸‹å›¾ å…¶ä¸­éå¶å­çš„ key å€¼æ˜¯ product_noï¼ˆå›¾ä¸­æ©™è‰²éƒ¨åˆ†ï¼‰ï¼Œ å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸»é”®å€¼ï¼ˆå›¾ä¸­ç»¿è‰²éƒ¨åˆ†ï¼‰ã€‚ å¦‚æœæˆ‘ç”¨ product_no äºŒçº§ç´¢å¼•æŸ¥è¯¢å•†å“ï¼Œå¦‚ä¸‹æŸ¥è¯¢è¯­å¥ï¼š 1select * from product where product_no = &#x27;0002&#x27;; ä¼šå…ˆæ£€äºŒçº§ç´¢å¼•ä¸­çš„ B+Tree çš„ç´¢å¼•å€¼(å•†å“ç¼–ç ï¼Œproduct no)æ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åè·å–ä¸»é”®å€¼ï¼Œç„¶åå†é€šè¿‡ä¸»é”®ç´¢å¼•ä¸­çš„ B+Tree æ ‘æŸ¥è¯¢åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åè·å–æ•´è¡Œæ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹å«ã€Œå›è¡¨ã€ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æŸ¥ä¸¤ä¸ª B+Tree æ‰èƒ½æŸ¥åˆ°æ•°æ®ã€‚ ä¸è¿‡ï¼Œå½“æŸ¥è¯¢çš„æ•°æ®æ˜¯èƒ½åœ¨äºŒçº§ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹é‡ŒæŸ¥è¯¢åˆ°ï¼Œ è¿™æ—¶å°±ä¸ç”¨å†æŸ¥ä¸»é”®ç´¢å¼•æŸ¥ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ï¼š 1select id from product where product_no = &#x27;0002&#x27;; è¿™ç§åœ¨äºŒçº§ç´¢å¼•çš„ B+Tree å°±èƒ½æŸ¥è¯¢åˆ°ç»“æœçš„è¿‡ç¨‹å°±å«ä½œã€Œè¦†ç›–ç´¢å¼•ã€ ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦æŸ¥ä¸€ä¸ª B+Tree å°±èƒ½æ‰¾åˆ°æ•°æ®ã€‚ 3.ç´¢å¼•åº•å±‚åŸç†MySQLçš„ç´¢å¼•åº•å±‚ç»“æ„æ˜¯ B+æ ‘ã€‚ B+æ ‘æ˜¯ä¸€ç§å¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹: æ‰€æœ‰å…³é”®å­—ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹ä¹‹é—´é€šè¿‡é“¾è¡¨è¿æ¥ï¼Œå½¢æˆä¸€ä¸ªæœ‰åºçš„å¶å­èŠ‚ç‚¹åºåˆ—ã€‚ éå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•å­—æ®µçš„å€¼å’Œå­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¸ä¿å­˜å®é™…çš„æ•°æ®ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨æ›´å¤šçš„å…³é”®å­—ï¼Œå‡å°‘äº†æ ‘çš„é«˜åº¦ï¼ŒåŠ å¿«æœç´¢é€Ÿåº¦ã€‚ å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰ç´¢å¼•å­—æ®µçš„å€¼å’ŒæŒ‡å‘å¯¹åº”æ•°æ®çš„æŒ‡é’ˆã€‚ åœ¨ B+æ ‘ç´¢å¼•ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸ç£ç›˜é¡µçš„å¤§å°ç›¸å½“ã€‚èŠ‚ç‚¹çš„å¤§å°é€šå¸¸æ˜¯æ•°æ®åº“é¡µçš„å¤§å°ä¾‹å¦‚16KBæˆ– 32KBã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨å¤šä¸ªå…³é”®å­—å’ŒæŒ‡é’ˆã€‚å¶å­èŠ‚ç‚¹çš„å…³é”®å­—æ˜¯æœ‰åºçš„ï¼Œä¸”é€šè¿‡é“¾è¡¨è¿æ¥åœ¨ä¸€èµ·ã€‚ ç´¢å¼•æŸ¥è¯¢å¿«çš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹: è·¯å¾„é•¿åº¦çŸ­:B+æ ‘å…·æœ‰å¹³è¡¡æ€§ï¼Œæ‰€æœ‰å¶å­èŠ‚ç‚¹çš„æ·±åº¦ç›¸åŒï¼Œå› æ­¤åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­åªéœ€è¦æ²¿ç€æ ‘çš„é«˜åº¦è¿›è¡Œå‡ æ¬¡ç£ç›˜ &#x2F;&#x2F;O æ“ä½œï¼Œæ‰€ä»¥æŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«ã€‚ é¡ºåºè®¿é—®ä¼˜åŠ¿:B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨é“¾è¡¨è¿æ¥ï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹çš„å…³é”®å­—æ˜¯æœ‰åºçš„ï¼Œå› æ­¤å¯¹äºèŒƒå›´æŸ¥è¯¢æ“ä½œï¼Œå¯ä»¥é€šè¿‡é¡ºåºæ‰«æå¶å­èŠ‚ç‚¹æ¥è·å–æœ‰åºçš„æ•°æ®ç»“æœï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ æœ€å°åŒ–ç£ç›˜I&#x2F;0 æ“ä½œ:B+æ ‘å…·æœ‰è¾ƒé«˜çš„å¡«å……å› å­ï¼Œæ¯ä¸ªç£ç›˜é¡µä¸Šå­˜å‚¨çš„å…³é”®å­—æ•°é‡è¾ƒå¤šï¼Œèƒ½å¤Ÿå‡å°‘ç£ç›˜ I&#x2F;0 æ“ä½œçš„æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒB+æ ‘çš„å¹³è¡¡æ€§ã€æœ‰åºçš„å¶å­èŠ‚ç‚¹ã€é¡ºåºè®¿é—®ä»¥åŠæœ€å°åŒ–çš„ç£ç›˜!&#x2F;0 æ“ä½œæ˜¯ä½¿å¾—ç´¢å¼•æŸ¥è¯¢å¿«é€Ÿçš„å…³é”®å› ç´ ã€‚é€šè¿‡ B+ æ ‘çš„æ•°æ®ç»“æ„å’Œç´¢å¼•çš„å»ºç«‹ï¼Œå¯ä»¥å¤§å¹…åº¦å‡å°‘ç£ç›˜è®¿é—®æ¬¡æ•°ï¼Œæé«˜æ•°æ®åº“æŸ¥è¯¢çš„æ•ˆç‡ã€‚ ç®€ç­”ï¼šç´¢å¼•åº•å±‚åŸç†ä½¿ç”¨äº† B+æ ‘æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ç§å¹³è¡¡æ ‘ï¼Œèƒ½å¿«é€Ÿå®šä½å’Œæ£€ç´¢æ•°æ®ã€‚B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨å®é™…æ•°æ®ï¼Œä¸­é—´èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•ï¼Œé€šè¿‡å‡å°‘ç£ç›˜I&#x2F;Oæ¥æé«˜æŸ¥è¯¢æ•ˆç‡;ç´¢å¼•æŒ‰ç…§å€¼çš„å¤§å°é¡ºåºæ’åˆ—ï¼Œä½¿å¾—èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚ 4.ä¸ºä»€ä¹ˆ MySQL InnoDB é€‰æ‹© B+tree ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿï¼ˆTODOè¦è®¾è®¡ä¸€ä¸ªé€‚åˆ MySQL ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œè‡³å°‘æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š èƒ½åœ¨å°½å¯èƒ½å°‘çš„ç£ç›˜çš„ I&#x2F;O æ“ä½œä¸­å®ŒæˆæŸ¥è¯¢å·¥ä½œï¼› è¦èƒ½é«˜æ•ˆåœ°æŸ¥è¯¢æŸä¸€ä¸ªè®°å½•ï¼Œä¹Ÿè¦èƒ½é«˜æ•ˆåœ°æ‰§è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼› 1ã€B+Tree vs B Tree åœ¨B+æ ‘ä¸­ï¼Œæ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œè€Œéå¶å­èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•ä¿¡æ¯ï¼›è€ŒBæ ‘çš„éå¶å­èŠ‚ç‚¹æ—¢å­˜å‚¨ç´¢å¼•ä¿¡æ¯ä¹Ÿå­˜å‚¨éƒ¨åˆ†æ•°æ®ã€‚ å¦å¤–ï¼ŒB+Tree å¶å­èŠ‚ç‚¹é‡‡ç”¨çš„æ˜¯åŒé“¾è¡¨è¿æ¥ï¼Œé€‚åˆ MSQL ä¸­å¸¸è§çš„åŸºäºèŒƒå›´çš„é¡ºåºæŸ¥æ‰¾ï¼Œè€ŒBæ ‘æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚ B+æ ‘çš„æŸ¥æ‰¾æ€§èƒ½æ›´ç¨³å®šï¼Œæ¯æ¬¡æŸ¥æ‰¾éƒ½éœ€è¦æŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹;è€ŒBæ ‘çš„æŸ¥æ‰¾å¯èƒ½ä¼šåœ¨éå¶å­èŠ‚ç‚¹æ‰¾åˆ°æ•°æ®ï¼Œæ€§èƒ½ç›¸å¯¹ä¸ç¨³å®šã€‚ B+ æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„è®°å½•æ•°æ®ï¼Œä»…å­˜æ”¾ç´¢å¼•ï¼Œå› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”å­˜å‚¨å³å­˜ç´¢å¼•åˆå­˜è®°å½•çš„ Bæ ‘ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œå› æ­¤ B+ æ ‘å¯ä»¥æ¯” Bæ ‘æ›´ã€ŒçŸ®èƒ–ã€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜ &#x2F;Oæ¬¡æ•°ä¼šæ›´å°‘ã€‚ B+ æ ‘å¶å­èŠ‚ç‚¹ä¹‹é—´ç”¨é“¾è¡¨è¿æ¥äº†èµ·æ¥ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢ï¼Œè€ŒBæ ‘è¦å®ç°èŒƒå›´æŸ¥è¯¢ï¼Œå› æ­¤åªèƒ½é€šè¿‡æ ‘çš„éå†æ¥å®ŒæˆèŒƒå›´æŸ¥è¯¢ï¼Œè¿™ä¼šæ¶‰åŠå¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ &#x2F;0 æ“ä½œï¼ŒèŒƒå›´æŸ¥è¯¢æ•ˆç‡ä¸å¦‚ B+ æ ‘ã€‚ 2ã€B+Tree vs äºŒå‰æ ‘ æ™®é€šäºŒå‰æ ‘å­˜åœ¨é€€åŒ–çš„æƒ…å†µï¼Œå¦‚æœå®ƒé€€åŒ–æˆé“¾è¡¨ï¼Œå°±ç›¸å½“äºå…¨è¡¨æ‰«æã€‚ 5.æœ€å·¦åŒ¹é…åŸåˆ™MySQLè”åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼ŒæŸ¥è¯¢çš„æ—¶å€™ä¼šä¼˜å…ˆåŒ¹é…æœ€å·¦è¾¹çš„ç´¢å¼•ã€‚ä¾‹å¦‚å½“æˆ‘ä»¬åœ¨ (a,b,c)ä¸‰ä¸ªå­—æ®µä¸Šåˆ›å»ºè”åˆç´¢å¼•æ—¶ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸‰ä¸ªç´¢å¼•ï¼Œåˆ†åˆ«æ˜¯(a)ã€(a,b).(a,b,c)ã€‚ mysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a &#x3D; 1 and b &#x3D; 2 and c &gt; 3 and d &#x3D; 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ å»ºç«‹(a,b,c,d)çš„ç´¢å¼•ï¼Œå¯ä»¥æ”¯æŒä»¥ä¸‹å‰ç¼€ç´¢å¼•çš„æŸ¥è¯¢ (a) (a, b) (a, b, d) (a, b, d, c) éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œå¯¹äº c &#x3D; ? AND d &#x3D; ? AND b &#x3D; ? AND a &#x3D; ? ä¼šè¢«ä¼˜åŒ–å™¨é‡æ–°æ’åˆ—ä¸ºabcdçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯ä»ç„¶å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚æŸ¥è¯¢æ¡ä»¶ä¸­çš„åˆ—é¡ºåºå¹¶ä¸é‡è¦ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–é‡æ–°æ’åˆ— æ¯”å¦‚ï¼Œå°†å•†å“è¡¨ä¸­çš„ product_no å’Œ name å­—æ®µç»„åˆæˆè”åˆç´¢å¼•(product_no, name) ï¼Œå®ƒçš„B+æ ‘ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œè”åˆç´¢å¼•çš„éå¶å­èŠ‚ç‚¹ç”¨ä¸¤ä¸ªå­—æ®µçš„å€¼ä½œä¸º B+Tree çš„ key å€¼ã€‚å½“åœ¨è”åˆç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå…ˆæŒ‰ product no å­—æ®µæ¯”è¾ƒï¼Œåœ¨ product no ç›¸åŒçš„æƒ…å†µä¸‹å†æŒ‰ name å­—æ®µæ¯”è¾ƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè”åˆç´¢å¼•æŸ¥è¯¢çš„ B+Tree æ˜¯å…ˆæŒ‰ product no è¿›è¡Œæ’åºï¼Œç„¶åå† product no ç›¸åŒçš„æƒ…å†µå†æŒ‰name å­—æ®µæ’åºã€‚ å†æ¯”å¦‚å»ºç«‹ï¼ˆaï¼Œbï¼‰çš„ç´¢å¼•ï¼Œå®ƒçš„ç´¢å¼•ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œa æ˜¯å…¨å±€æœ‰åºçš„ï¼ˆ1, 2, 2, 3, 4, 5, 6, 7 ,8ï¼‰ï¼Œ è€Œ b æ˜¯å…¨å±€æ˜¯æ— åºçš„ï¼ˆ12ï¼Œ7ï¼Œ8ï¼Œ2ï¼Œ3ï¼Œ8ï¼Œ10ï¼Œ5ï¼Œ2ï¼‰ã€‚ å› æ­¤ï¼Œç›´æ¥æ‰§è¡Œwhere b = 2è¿™ç§æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰åŠæ³•åˆ©ç”¨è”åˆç´¢å¼•çš„ï¼Œ åˆ©ç”¨ç´¢å¼•çš„å‰ææ˜¯ç´¢å¼•é‡Œçš„ key æ˜¯æœ‰åºçš„ã€‚ åªæœ‰åœ¨ a ç›¸åŒçš„æƒ…å†µæ‰ï¼Œb æ‰æ˜¯æœ‰åºçš„ï¼Œæ¯”å¦‚ a ç­‰äº 2 çš„æ—¶å€™ï¼Œ b çš„å€¼ä¸ºï¼ˆ7ï¼Œ8ï¼‰ï¼Œè¿™æ—¶å°±æ˜¯æœ‰åºçš„ï¼Œè¿™ä¸ªæœ‰åºçŠ¶æ€æ˜¯å±€éƒ¨çš„ï¼Œ å› æ­¤ï¼Œæ‰§è¡Œwhere a = 2 and b = 7æ˜¯ a å’Œ b å­—æ®µèƒ½ç”¨åˆ°è”åˆç´¢å¼•çš„ æ¥ä¸‹æ¥è¯´å‡ ä¸ªèŒƒå›´æŸ¥è¯¢çš„ç»å…¸ä¾‹å­ 1ã€select * from t_table where a &gt; 1 and b &#x3D; 2 ã€‚ ç”±äºè”åˆç´¢å¼•(äºŒçº§ç´¢å¼•)æ˜¯å…ˆæŒ‰ç…§aå­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆa&gt;1æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»ï¼Œäºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆa&gt;1æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆa&gt;1æ¡ä»¶ä½ç½®ï¼Œæ‰€ä»¥aå­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚ ä½†æ˜¯åœ¨ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯æ— åºçš„ã€‚ æ¯”å¦‚å‰é¢å›¾çš„è”åˆç´¢å¼•çš„ B+ Tree é‡Œï¼Œ ä¸‹é¢è¿™ä¸‰æ¡è®°å½•çš„ a å­—æ®µçš„å€¼éƒ½ç¬¦åˆ a &gt; 1 æŸ¥è¯¢æ¡ä»¶ï¼Œ è€Œ b å­—æ®µçš„å€¼æ˜¯æ— åºçš„ï¼š a å­—æ®µå€¼ä¸º 5 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ b å­—æ®µå€¼ä¸º 8ï¼› a å­—æ®µå€¼ä¸º 6 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ b å­—æ®µå€¼ä¸º 10ï¼› a å­—æ®µå€¼ä¸º 7 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ b å­—æ®µå€¼ä¸º 5ï¼› å› æ­¤ï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥åªæœ‰ a å­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ï¼Œè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™åœ¨é‡åˆ° a å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼ˆ &gt;ï¼‰åå°±åœæ­¢åŒ¹é…äº† è€Œ b å­—æ®µå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°è”åˆç´¢å¼•ã€‚ 2ã€select * from t_table where a &gt;&#x3D; 1 and b &#x3D; 2 åœ¨ç¬¦åˆ a&gt;&#x3D; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯ã€Œæ— åºã€çš„ï¼Œ ä½†æ˜¯å¯¹äºç¬¦åˆ a &#x3D; 1 çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯ã€Œæœ‰åºã€çš„ ï¼ˆå› ä¸ºå¯¹äºè”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºï¼Œç„¶ååœ¨ a å­—æ®µçš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹ ï¼Œå†æŒ‰ç…§ b å­—æ®µçš„å€¼è¿›è¡Œæ’åºï¼‰ã€‚ å½“äºŒçº§ç´¢å¼•è®°å½•çš„ a å­—æ®µå€¼ä¸º 1 æ—¶ï¼Œå¯ä»¥é€šè¿‡ b &#x3D; 2 æ¡ä»¶å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•èŒƒå›´ è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚ 3ã€SELECT * FROM t_table WHERE a BETWEEN 2 AND 8 AND b &#x3D; 2 åœ¨ MySQL ä¸­ï¼ŒBETWEEN åŒ…å«äº† value1 å’Œ value2 è¾¹ç•Œå€¼ï¼Œ ç±»ä¼¼äº &gt;&#x3D; and &#x3D;&lt;ã€‚ å› æ­¤ è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚ 4ã€SELECT * FROM t_user WHERE name like â€˜j%â€™ and age &#x3D; 22 å¯¹äºç¬¦åˆ name &#x3D; j çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œageå­—æ®µçš„å€¼æ˜¯ã€Œæœ‰åºã€çš„ ï¼Œï¼ˆå› ä¸ºå¯¹äºè”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ç…§ name å­—æ®µçš„å€¼æ’åºï¼Œç„¶ååœ¨ name å­—æ®µçš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ç…§ age å­—æ®µçš„å€¼è¿›è¡Œæ’åºï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ç¬¦åˆ name = &#39;j&#39; and age = 22 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•æ—¶å¼€å§‹æ‰«æï¼Œè€Œä¸éœ€è¦ä»ç¬¬ä¸€ä¸ª name ä¸º j çš„è®°å½•å¼€å§‹æ‰«æ ã€‚ è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ &gt;ã€&lt;ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ï¼Œ** **ä¹Ÿå°±æ˜¯èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œ** **ä½†æ˜¯åœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µçš„åé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•ã€‚** **æ³¨æ„ï¼Œå¯¹äº &gt;&#x3D;ã€&lt;&#x3D;ã€BETWEENã€like å‰ç¼€åŒ¹é…çš„èŒƒå›´æŸ¥è¯¢ï¼Œ å¹¶ä¸ä¼šåœæ­¢åŒ¹é… 6.ç´¢å¼•ä¸‹æ¨å¯¹äºè”åˆç´¢å¼•ï¼ˆa, bï¼‰ ï¼Œåœ¨æ‰§è¡Œ select * from table where a &gt; 1 and b &#x3D; 2åªæœ‰ a å­—æ®µèƒ½ç”¨åˆ°ç´¢å¼• ï¼Œé‚£åœ¨è”åˆç´¢å¼•çš„ B+Tree æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ä¸»é”®å€¼ï¼ˆID ä¸º 2ï¼‰å ï¼Œè¿˜éœ€è¦åˆ¤æ–­å…¶ä»–æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼ˆçœ‹ b æ˜¯å¦ç­‰äº 2ï¼‰ï¼Œ é‚£æ˜¯åœ¨è”åˆç´¢å¼•é‡Œåˆ¤æ–­ï¼Ÿè¿˜æ˜¯å›ä¸»é”®ç´¢å¼•å»åˆ¤æ–­å‘¢ï¼Ÿ MySQL 5.6 å¼•å…¥çš„ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–ï¼Œå…è®¸å­˜å‚¨å¼•æ“åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œéƒ¨åˆ† WHEREå­—å¥çš„åˆ¤æ–­æ¡ä»¶ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œä»è€Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ å½“ä½ çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’é‡Œï¼Œå‡ºç°äº† Extra ä¸º Using index condition é‚£ä¹ˆè¯´æ˜ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨çš„ä¼˜åŒ–ã€‚ 7.ç´¢å¼•å¤±æ•ˆæœ‰å“ªäº›æƒ…å†µ å½“æˆ‘ä»¬ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…çš„æ—¶å€™ï¼Œ ä¹Ÿå°±æ˜¯ like %xx æˆ–è€… like %xx%è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼› ä¸çŸ¥é“ä»å“ªä¸ªç´¢å¼•å€¼å¼€å§‹æ¯”è¾ƒï¼Œäºæ˜¯å°±åªèƒ½é€šè¿‡å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥æŸ¥è¯¢ã€‚ å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°ï¼Œå°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚å› ä¸ºç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡å‡½æ•°è®¡ç®—åçš„å€¼ï¼Œè‡ªç„¶å°±æ²¡åŠæ³•èµ°ç´¢å¼•äº†ã€‚ å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—ï¼Œä¹Ÿæ˜¯æ— æ³•èµ°ç´¢å¼•çš„ã€‚å› ä¸ºç´¢å¼•ä¿å­˜çš„æ˜¯ç´¢å¼•å­—æ®µçš„åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯id +1è¡¨è¾¾å¼è®¡ç®—åçš„å€¼ï¼Œæ‰€ä»¥æ— æ³•èµ°ç´¢å¼•ï¼Œåªèƒ½é€šè¿‡æŠŠç´¢å¼•å­—æ®µçš„å–å€¼éƒ½å–å‡ºæ¥ï¼Œç„¶åä¾æ¬¡è¿›è¡Œè¡¨è¾¾å¼çš„è®¡ç®—æ¥è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤é‡‡ç”¨çš„å°±æ˜¯å…¨è¡¨æ‰«æçš„æ–¹å¼ã€‚ å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—è¿›è¡Œéšå¼ç±»å‹è½¬æ¢æ“ä½œ ï¼ŒèƒŒåå¯èƒ½ä¹Ÿåšäº†å‡½æ•°è¿ç®— è”åˆç´¢å¼•è¦èƒ½æ­£ç¡®ä½¿ç”¨éœ€è¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é… ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ åœ¨è”åˆç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œæ•°æ®æ˜¯æŒ‰ç…§ç´¢å¼•ç¬¬ä¸€åˆ—æ’åºï¼Œç¬¬ä¸€åˆ—æ•°æ®ç›¸åŒæ—¶æ‰ä¼šæŒ‰ç…§ç¬¬äºŒåˆ—æ’åºã€‚ åœ¨ WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œ é‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚ OR çš„å«ä¹‰å°±æ˜¯ä¸¤ä¸ªåªè¦æ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œ 8.ç´¢å¼•åˆ›å»ºçš„åŸåˆ™ï¼ˆäº†è§£1ï¼‰ æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œç»„åˆç´¢å¼•éå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a &#x3D; 1 and b &#x3D; 2 and c &gt; 3 and d &#x3D; 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚ 2ï¼‰è¾ƒé¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µæ‰å»åˆ›å»ºç´¢å¼• 3ï¼‰æ›´æ–°é¢‘ç¹å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼• 4ï¼‰è‹¥æ˜¯ä¸èƒ½æœ‰æ•ˆåŒºåˆ†æ•°æ®çš„åˆ—ä¸é€‚åˆåšç´¢å¼•åˆ—(å¦‚æ€§åˆ«ï¼Œç”·å¥³æœªçŸ¥ï¼Œæœ€å¤šä¹Ÿå°±ä¸‰ç§ï¼ŒåŒºåˆ†åº¦å®åœ¨å¤ªä½) 5ï¼‰å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚æ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚ 6ï¼‰å®šä¹‰æœ‰å¤–é”®çš„æ•°æ®åˆ—ä¸€å®šè¦å»ºç«‹ç´¢å¼•ã€‚ 7ï¼‰å¯¹äºé‚£äº›æŸ¥è¯¢ä¸­å¾ˆå°‘æ¶‰åŠçš„åˆ—ï¼Œé‡å¤å€¼æ¯”è¾ƒå¤šçš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ã€‚ 8ï¼‰å¯¹äºå®šä¹‰ä¸ºtextã€imageå’Œbitçš„æ•°æ®ç±»å‹çš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ã€‚ 9.ç´¢å¼•çš„ç¼ºç‚¹(äº†è§£)å ç”¨å­˜å‚¨ç©ºé—´ï¼š æ¯ä¸ªç´¢å¼•éƒ½ä¼šå ç”¨é¢å¤–çš„ç£ç›˜ç©ºé—´ï¼Œå°¤å…¶åœ¨æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå­˜å‚¨éœ€æ±‚ä¼šæ˜¾è‘—å¢åŠ ã€‚ å½±å“å†™æ“ä½œæ€§èƒ½ï¼š æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ—¶ï¼ŒMySQLéœ€è¦ç»´æŠ¤æ‰€æœ‰ç›¸å…³ç´¢å¼•ã€‚è¿™ä¼šå¯¼è‡´å†™æ“ä½œå˜æ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢‘ç¹æ›´æ–°çš„è¡¨ä¸­ã€‚ å¤æ‚çš„ç´¢å¼•é€‰æ‹©ï¼š å¦‚æœç´¢å¼•è¿‡å¤šï¼Œä¼˜åŒ–å™¨åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶éœ€è¦èŠ±è´¹é¢å¤–æ—¶é—´å†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¼˜åŒ–å™¨é€‰æ‹©ä¸å½“ã€‚ å¢åŠ ç»´æŠ¤æˆæœ¬ï¼š å¼€å‘å’Œç»´æŠ¤äººå‘˜éœ€è¦ç†è§£å’Œç®¡ç†è¿™äº›ç´¢å¼•ï¼Œå¯èƒ½å¯¼è‡´å¤æ‚æ€§å¢åŠ ã€‚ å› æ­¤ï¼Œå¯¹äºå†™æ“ä½œå¤šäºè¯»æ“ä½œçš„åœºæ™¯ï¼Œå°½é‡å‡å°‘ç´¢å¼•æ•°é‡ã€‚ 10.ä¸»é”®ç´¢å¼•ä¸ºä»€ä¹ˆæœ€å¥½è®¾ç½®ä¸ºè‡ªå¢çš„å¦‚æœæˆ‘ä»¬ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥çš„æ–°æ•°æ®å°±ä¼šæŒ‰é¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„ä½ç½®ï¼Œ ä¸éœ€è¦ç§»åŠ¨å·²æœ‰çš„æ•°æ®ï¼Œå½“é¡µé¢å†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°é¡µé¢ã€‚ å› ä¸ºæ¯æ¬¡æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œä¸éœ€è¦é‡æ–°ç§»åŠ¨æ•°æ®ï¼Œå› æ­¤è¿™ç§æ’å…¥æ•°æ®çš„æ–¹æ³•æ•ˆç‡éå¸¸é«˜ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„ç´¢å¼•å€¼éƒ½æ˜¯éšæœºçš„ï¼Œå› æ­¤æ¯æ¬¡æ’å…¥æ–°çš„æ•°æ®æ—¶ï¼Œ å°±å¯èƒ½ä¼šæ’å…¥åˆ°ç°æœ‰æ•°æ®é¡µä¸­é—´çš„æŸä¸ªä½ç½®ï¼Œè¿™å°†ä¸å¾—ä¸ç§»åŠ¨å…¶å®ƒæ•°æ®æ¥æ»¡è¶³æ–°æ•°æ®çš„æ’å…¥ï¼Œ ç”šè‡³éœ€è¦ä»ä¸€ä¸ªé¡µé¢å¤åˆ¶æ•°æ®åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬é€šå¸¸å°†è¿™ç§æƒ…å†µç§°ä¸ºé¡µåˆ†è£‚ã€‚ é¡µåˆ†è£‚è¿˜æœ‰å¯èƒ½ä¼šé€ æˆå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´ç´¢å¼•ç»“æ„ä¸ç´§å‡‘ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æŸä¸ªæ•°æ®é¡µä¸­çš„æ•°æ®æ˜¯1ã€3ã€5ã€9ï¼Œä¸”æ•°æ®é¡µæ»¡äº†ï¼Œç°åœ¨å‡†å¤‡æ’å…¥ä¸€ä¸ªæ•°æ®7ï¼Œåˆ™éœ€è¦æŠŠæ•°æ®é¡µåˆ†å‰²ä¸ºä¸¤ä¸ªæ•°æ®é¡µ: å‡ºç°é¡µåˆ†è£‚æ—¶ï¼Œéœ€è¦å°†ä¸€ä¸ªé¡µçš„è®°å½•ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé¡µï¼Œæ€§èƒ½ä¼šå—åˆ°å½±å“ï¼Œ åŒæ—¶é¡µç©ºé—´çš„åˆ©ç”¨ç‡ä¸‹é™ï¼Œé€ æˆå­˜å‚¨ç©ºé—´çš„æµªè´¹ã€‚ è€Œå¦‚æœè®°å½•æ˜¯é¡ºåºæ’å…¥çš„ï¼Œä¾‹å¦‚æ’å…¥æ•°æ®11ï¼Œåˆ™åªéœ€å¼€è¾Ÿæ–°çš„æ•°æ®é¡µï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿé¡µåˆ†è£‚ï¼š 3.äº‹åŠ¡äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚ 1.äº‹åŠ¡çš„ACIDç‰¹æ€§ä»¥åŠæ€ä¹ˆå®ç°çš„ åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼› ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼› éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ä¹Ÿå°±æ˜¯è¯´ Aã€Iã€D æ˜¯æ‰‹æ®µï¼ŒC æ˜¯ç›®çš„ï¼ æŒä¹…æ€§æ˜¯é€šè¿‡ redo log ï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ä¿è¯çš„ï¼› åŸå­æ€§æ˜¯é€šè¿‡ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ æ¥ä¿è¯çš„ï¼› éš”ç¦»æ€§æ˜¯é€šè¿‡ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ æˆ–é”æœºåˆ¶æ¥ä¿è¯çš„ï¼› ä¸€è‡´æ€§åˆ™æ˜¯é€šè¿‡æŒä¹…æ€§+åŸå­æ€§+éš”ç¦»æ€§æ¥ä¿è¯ï¼› 2.è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯» è„è¯»ï¼ˆè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼› å¦‚æœä¸€ä¸ªäº‹åŠ¡ã€Œè¯»åˆ°ã€äº†å¦ä¸€ä¸ªã€Œæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®ã€ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†ã€Œè„è¯»ã€ç°è±¡ã€‚ æŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚ ä¸å¯é‡å¤è¯»ï¼ˆå‰åè¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼› åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‡ºç°å‰åä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†ã€Œä¸å¯é‡å¤è¯»ã€ç°è±¡ã€‚ åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†åŸæœ‰çš„æ•°æ®ã€‚ å¹»è¯»ï¼ˆå‰åè¯»å–çš„è®°å½•æ•°é‡ä¸ä¸€è‡´ åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢æŸä¸ªç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„ã€Œè®°å½•æ•°é‡ã€ï¼Œå¦‚æœå‡ºç°å‰åä¸¤æ¬¡æŸ¥è¯¢åˆ°çš„è®°å½•æ•°é‡ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†ã€Œå¹»è¯»ã€ç°è±¡ã€‚ ä¸¥é‡æ€§æ’åºï¼šè„è¯» &gt; ä¸å¯é‡å¤è¯» &gt; å¹»è¯» 3.äº‹åŠ¡çš„éš”ç¦»çº§åˆ«éš”ç¦»æ°´å¹³é«˜ä½æ’åºå¦‚ä¸‹ï¼šä¸²è¡ŒåŒ– &gt; å¯é‡å¤è¯» &gt; è¯»å·²æäº¤ &gt; è¯»æœªæäº¤ è¯»æœªæäº¤ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼› è¯»æäº¤ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼› å¯é‡å¤è¯»ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œä¸€ç›´è·Ÿè¿™ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ŒMySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼› ä¸²è¡ŒåŒ–ï¼šä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œåœ¨å¤šä¸ªäº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œå¦‚æœå‘ç”Ÿäº†è¯»å†™å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼› åœ¨å„ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼š åœ¨ã€Œè¯»æœªæäº¤ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ç°è±¡ï¼› åœ¨ã€Œè¯»æäº¤ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»å’Œå¹»è¯»ç°è±¡ï¼Œä½†æ˜¯ä¸å¯èƒ½å‘ç”Ÿè„è¯»ç°è±¡ï¼› åœ¨ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½å‘ç”Ÿå¹»è¯»ç°è±¡ï¼Œä½†æ˜¯ä¸å¯èƒ½è„è¯»å’Œä¸å¯é‡å¤è¯»ç°è±¡ï¼› åœ¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ç°è±¡éƒ½ä¸å¯èƒ½ä¼šå‘ç”Ÿã€‚ MySQL åœ¨ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿï¼ˆæ³¨æ„æ˜¯å¾ˆå¤§ç¨‹åº¦é¿å…ï¼Œå¹¶ä¸æ˜¯å½»åº•é¿å…ï¼‰ï¼Œæ‰€ä»¥ MySQL å¹¶ä¸ä¼šä½¿ç”¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«æ¥é¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿï¼Œå› ä¸ºä½¿ç”¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«ä¼šå½±å“æ€§èƒ½ã€‚ 4.éš”ç¦»çº§åˆ«çš„å®ç°åŸç†MySQL çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸»è¦ä¾èµ– é”æœºåˆ¶ å’Œ MVCC å®ç°ã€‚ è¯»å·²æäº¤å’Œå¯é‡å¤è¯»é€šè¿‡ MVCC æœºåˆ¶ä¸­çš„ ReadView æ¥å®ç°ã€‚ è¯»å·²æäº¤ï¼šæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ç”Ÿæˆä¸€ä¸ª ReadViewï¼Œä¿è¯æ¯æ¬¡è¯»æ“ä½œéƒ½æ˜¯æœ€æ–°çš„æ•°æ®ã€‚ å¯é‡å¤è¯»ï¼šåªåœ¨ç¬¬ä¸€æ¬¡è¯»æ“ä½œæ—¶ç”Ÿæˆä¸€ä¸ª ReadViewï¼Œåç»­è¯»æ“ä½œéƒ½ä½¿ç”¨è¿™ä¸ª ReadViewï¼Œä¿è¯äº‹åŠ¡å†…è¯»å–çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ ä¸²è¡ŒåŒ–æ˜¯é€šè¿‡é”æ¥å®ç°çš„ï¼šäº‹åŠ¡åœ¨è¯»æ“ä½œæ—¶ï¼Œå¿…é¡»å…ˆåŠ è¡¨çº§å…±äº«é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾ï¼›äº‹åŠ¡åœ¨å†™æ“ä½œæ—¶ï¼Œå¿…é¡»å…ˆåŠ è¡¨çº§æ’ä»–é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾ã€‚ ä»¥ä¸‹äº†è§£å³å¯ (1) é”æœºåˆ¶ å…±äº«é”ï¼ˆS é”ï¼‰ï¼šå…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘è¯»å–åŒä¸€æ•°æ®ï¼Œä½†é˜»æ­¢å†™å…¥ã€‚ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼šé˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å–æˆ–å†™å…¥ã€‚ éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œé”çš„ç²’åº¦å’ŒèŒƒå›´è¶Šå¤§ã€‚ 5.MVCC åŸºæœ¬æ¦‚å¿µ å½“å‰è¯» è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚å¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„æ“ä½œï¼Œå¦‚:select .. lockin share mode(å…±äº«é”)ï¼Œselect.... for updateã€updateã€insertã€delete(æ’ä»–é”)éƒ½æ˜¯ä¸€ç§å½“å‰è¯»ã€‚ å¿«ç…§è¯» ç®€å•çš„select(ä¸åŠ é”)å°±æ˜¯å¿«ç…§è¯»ï¼Œå¿«ç…§è¯»ï¼Œè¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„å¯è§ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æ˜¯å†å²æ•°æ®ï¼Œä¸åŠ é”ï¼Œæ˜¯éé˜»å¡è¯»ã€‚ RCè¯»å·²æäº¤ï¼šæ¯æ¬¡selectï¼Œéƒ½ç”Ÿæˆä¸€ä¸ªå¿«ç…§è¯»ã€‚ RRå¯é‡å¤è¯»ï¼šå¼€å¯äº‹åŠ¡åç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹ ä¸²è¡ŒåŒ–ï¼šå¿«ç…§è¯»é€€åŒ–ä¸ºå½“å‰è¯» MVCC å…¨ç§° Multi-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCC æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ç”¨äºå®ç°äº‹åŠ¡éš”ç¦»æ€§å’Œå¹¶å‘æ§åˆ¶çš„ä¸€ç§å…³é”®æŠ€æœ¯ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯é€šè¿‡ç»´æŠ¤æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡èƒ½å¤Ÿåœ¨ä¸ç›¸äº’é˜»å¡çš„æƒ…å†µä¸‹è¯»å–å’Œå†™å…¥æ•°æ®ï¼Œä»è€Œæé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ï¼ŒåŒæ—¶ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚ åŸºæœ¬åŸç† MVCC çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ¯æ¬¡å†™æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥è¦†ç›–æ—§æ•°æ®ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè¯»æ“ä½œå¯ä»¥è®¿é—®ä¸äº‹åŠ¡å¼€å§‹æ—¶ä¸€è‡´çš„æ—§ç‰ˆæœ¬æ•°æ®ï¼Œè€Œæ— éœ€ç­‰å¾…å†™æ“ä½œå®Œæˆã€‚è¿™ç§æœºåˆ¶é¿å…äº†è¯»å†™ä¹‹é—´çš„é”ç«äº‰ï¼Œä»è€Œæå‡äº†å¹¶å‘æ€§èƒ½ã€‚ MVCCçš„å…·ä½“å®ç°ï¼Œè¿˜éœ€è¦ä¾èµ–äºæ•°æ®åº“è®°å½•ä¸­ä¸ªéšå¼å­—æ®µã€undologã€readViewã€‚ å®ç°è¿‡ç¨‹ï¼š è¯»å–æ—¶ï¼Œæ ¹æ®äº‹åŠ¡çš„å¼€å§‹æ—¶é—´æˆ–å¿«ç…§ï¼Œè®¿é—®å¯¹åº”çš„æ—§ç‰ˆæœ¬æ•°æ®ã€‚ å†™å…¥æ—¶ï¼Œç”Ÿæˆæ–°çš„ç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬é€šè¿‡ Undo Log ä¿ç•™ã€‚ ä¸‰ä¸ªå­—æ®µ TRX_ID: æœ€è¿‘ä¿®æ”¹è¯¥æ¡æ•°æ®çš„äº‹åŠ¡IDï¼Œè®°å½•æ’å…¥è¿™æ¡è®°å½•æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡IDã€‚ ROLL_PTRï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œï¼ˆå†å²æ•°æ®å­˜å‚¨åœ¨undologä¸­ï¼‰ ROW_IDï¼šéšè—ä¸»é”®ï¼Œå¦‚æœè¡¨ç»“æ„æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œå°†ä¼šç”Ÿæˆè¯¥éšè—å­—æ®µã€‚æœ‰çš„è¯å°±ä¸ç”¨è¿™ä¸ªäº†ã€‚è¿™ä¸ªä¸æ˜¯å¾ˆé‡è¦ undolog readview ReadView(è¯»è§†å›¾)ä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­ã€‚æ˜¯ å¿«ç…§è¯» SQLæ‰§è¡Œæ—¶MVCCæå–æ•°æ®çš„ä¾æ®ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒçš„äº‹åŠ¡(æœªæäº¤çš„)idã€‚ å››ä¸ªæ ¸å¿ƒå­—æ®µï¼š m_idsï¼šæ‰€æœ‰æ´»è·ƒäº‹åŠ¡çš„ ID åˆ—è¡¨ï¼Œæ´»è·ƒäº‹åŠ¡æ˜¯æŒ‡é‚£äº›å·²ç»å¼€å§‹ä½†å°šæœªæäº¤çš„äº‹åŠ¡ã€‚ min_trx_idï¼šæ´»è·ƒäº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡id max_trx_idï¼šä¸‹ä¸€ä¸ªå³å°†ç”Ÿæˆçš„äº‹åŠ¡IDï¼Œä¹Ÿå°±æ˜¯å³å°†å¼€å§‹çš„äº‹åŠ¡ creator_trx_id:ï¼šåˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡çš„äº‹åŠ¡ idã€‚ äº‹åŠ¡å¯è§æ€§ç¤ºæ„å›¾ å½“ä¸€ä¸ªäº‹åŠ¡è¯»å–æŸæ¡æ•°æ®æ—¶ï¼ŒInnoDB ä¼šæ ¹æ® ReadView ä¸­çš„ä¿¡æ¯æ¥åˆ¤æ–­è¯¥æ•°æ®çš„æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è§ã€‚ å¦‚æœï¼œ min_trx_id ï¼Œåˆ™è¯¥æ•°æ®ç‰ˆæœ¬åœ¨ç”Ÿæˆ ReadView ä¹‹å‰å°±å·²ç»æäº¤ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ã€‚ å¦‚æœï¼ max_trx_id ï¼Œåˆ™è¡¨ç¤ºåˆ›å»ºè¯¥æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”Ÿæˆ ReadView ä¹‹åå¼€å§‹ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ å¦‚æœåœ¨äºŒè€…ä¹‹é—´ï¼Œéœ€è¦åˆ¤æ–­è¯¥äº‹åŠ¡æ˜¯å¦åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­ å¦‚æœä¸åœ¨ï¼Œè¡¨ç¤ºåˆ›å»ºè¯¥æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”Ÿæˆ ReadView ä¹‹åå·²ç»æäº¤ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚ åœ¨ï¼Œåˆ™è¡¨ç¤ºåˆ›å»ºè¯¥æ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ä»ç„¶æ´»è·ƒï¼Œæˆ–è€…åœ¨å½“å‰äº‹åŠ¡ç”Ÿæˆ ReadView ä¹‹åå¼€å§‹ï¼Œå› æ­¤å¯¹å½“å‰äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚ 4.é”(äº†è§£)å½“æ•°æ®åº“æœ‰å¹¶å‘äº‹åŠ¡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™éœ€è¦ä¸€äº›æœºåˆ¶æ¥ä¿è¯è®¿é—®çš„æ¬¡åºï¼Œé”æœºåˆ¶å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ã€‚ å°±åƒé…’åº—çš„æˆ¿é—´ï¼Œå¦‚æœå¤§å®¶éšæ„è¿›å‡ºï¼Œå°±ä¼šå‡ºç°å¤šäººæŠ¢å¤ºåŒä¸€ä¸ªæˆ¿é—´çš„æƒ…å†µï¼Œè€Œåœ¨æˆ¿é—´ä¸Šè£…ä¸Šé”ï¼Œç”³è¯·åˆ°é’¥åŒ™çš„äººæ‰å¯ä»¥å…¥ä½å¹¶ä¸”å°†æˆ¿é—´é”èµ·æ¥ï¼Œå…¶ä»–äººåªæœ‰ç­‰ä»–ä½¿ç”¨å®Œæ¯•æ‰å¯ä»¥å†æ¬¡ä½¿ç”¨ã€‚ 1.è¡¨çº§é”å’Œè¡Œçº§é”äºŒè€…çš„åŒºåˆ«æ˜¯é”ç²’åº¦ä¸åŒ è¡Œçº§é” è¡Œçº§é”æ˜¯Mysqlä¸­é”å®šç²’åº¦æœ€ç»†çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ã€‚è¡Œçº§é”åˆ†ä¸ºå…±äº«é” å’Œ æ’ä»–é”ã€‚ ç‰¹ç‚¹ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚ è¡¨çº§é” è¡¨çº§é”æ˜¯MySQLä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ƒå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—è¾ƒå°‘ï¼Œè¢«å¤§éƒ¨åˆ†MySQLå¼•æ“æ”¯æŒã€‚æœ€å¸¸ä½¿ç”¨çš„MYISAMä¸INNODBéƒ½æ”¯æŒè¡¨çº§é”å®šã€‚è¡¨çº§é”å®šåˆ†ä¸ºè¡¨å…±äº«è¯»é”ï¼ˆå…±äº«é”ï¼‰ä¸è¡¨ç‹¬å å†™é”ï¼ˆæ’ä»–é”ï¼‰ã€‚ ç‰¹ç‚¹ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘å‡ºé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ã€‚ é¡µçº§é” é¡µçº§é”æ˜¯MySQLä¸­é”å®šç²’åº¦ä»‹äºè¡Œçº§é”å’Œè¡¨çº§é”ä¸­é—´çš„ä¸€ç§é”ã€‚è¡¨çº§é”é€Ÿåº¦å¿«ï¼Œä½†å†²çªå¤šï¼Œè¡Œçº§å†²çªå°‘ï¼Œä½†é€Ÿåº¦æ…¢ã€‚æ‰€ä»¥å–äº†æŠ˜è¡·çš„é¡µçº§ï¼Œä¸€æ¬¡é”å®šç›¸é‚»çš„ä¸€ç»„è®°å½•ã€‚ ç‰¹ç‚¹ï¼šå¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ 2.å…±äº«é”å’Œæ’ä»–é”ä»é”çš„ç±»åˆ«ä¸Šæ¥è®²ï¼Œæœ‰å…±äº«é”å’Œæ’ä»–é”ã€‚ å…±äº«é”: åˆå«åšè¯»é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„è¯»å–æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šå…±äº«é”ã€‚å…±äº«é”å¯ä»¥åŒæ—¶åŠ ä¸Šå¤šä¸ªã€‚ æ’ä»–é”: åˆå«åšå†™é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„å†™å…¥æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šæ’ä»–é”ã€‚æ’ä»–é”åªå¯ä»¥åŠ ä¸€ä¸ªï¼Œä»–å’Œå…¶ä»–çš„æ’ä»–é”ï¼Œå…±äº«é”éƒ½ç›¸æ–¥ã€‚ 5.æ—¥å¿—Redo log(é‡åšæ—¥å¿—)ï¼šæ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œç”¨äºä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œå®ƒåœ¨äº‹åŠ¡æäº¤å‰å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ä¸»è¦ç”¨äºæ‰ç”µç­‰æ•…éšœæ¢å¤ï¼› Undo log(å›æ»šæ—¥å¿—)ï¼šæ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œ ç”¨äºäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå®ƒè®°å½•äº†äº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œä»¥ä¾¿åœ¨äº‹åŠ¡å›æ»šæ—¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œä¸»è¦ç”¨äºäº‹åŠ¡å›æ»šå’Œ MVCCã€‚ Bin log(äºŒè¿›åˆ¶æ—¥å¿—)ï¼šæ˜¯ Server å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œ è®°å½•äº†æ•°æ®åº“çš„æ‰€æœ‰ä¿®æ”¹æ“ä½œï¼ŒåŒ…æ‹¬å¯¹æ•°æ®çš„å¢åˆ æ”¹æ“ä½œï¼Œä¸»è¦ç”¨äºæ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶ï¼› 1.Undo logundo log æ˜¯ä¸€ç§ç”¨äºæ’¤é”€å›é€€çš„æ—¥å¿—ã€‚åœ¨äº‹åŠ¡æ²¡æäº¤ä¹‹å‰ï¼ŒMySQL ä¼šå…ˆè®°å½•æ›´æ–°å‰çš„æ•°æ®åˆ° undo log æ—¥å¿—æ–‡ä»¶é‡Œé¢ï¼Œå½“äº‹åŠ¡å›æ»šæ—¶ï¼Œå¯ä»¥åˆ©ç”¨ undo log æ¥è¿›è¡Œå›æ»šã€‚å¦‚ä¸‹å›¾: æ¯å½“ InnoDB å¼•æ“å¯¹ä¸€æ¡è®°å½•è¿›è¡Œæ“ä½œï¼ˆä¿®æ”¹ã€åˆ é™¤ã€æ–°å¢ï¼‰æ—¶ï¼Œ è¦æŠŠå›æ»šæ—¶éœ€è¦çš„ä¿¡æ¯éƒ½è®°å½•åˆ° undo log é‡Œ ã€‚åœ¨å‘ç”Ÿå›æ»šæ—¶ï¼Œå°±è¯»å– undo log é‡Œçš„æ•°æ®ï¼Œç„¶ååšåŸå…ˆç›¸åæ“ä½œã€‚ åœ¨æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œè¦æŠŠè¿™æ¡è®°å½•çš„ä¸»é”®å€¼è®°ä¸‹æ¥ï¼Œ å›æ»šæ—¶åªéœ€è¦æŠŠè¿™ä¸ªä¸»é”®å€¼å¯¹åº”çš„è®°å½•åˆ æ‰å°±å¥½äº†ï¼› åœ¨åˆ é™¤ä¸€æ¡è®°å½•æ—¶ï¼Œè¦æŠŠè¿™æ¡è®°å½•ä¸­çš„å†…å®¹éƒ½è®°ä¸‹æ¥ï¼Œ å›æ»šæ—¶å†æŠŠç”±è¿™äº›å†…å®¹ç»„æˆçš„è®°å½•æ’å…¥åˆ°è¡¨ä¸­å°±å¥½äº†ï¼› åœ¨æ›´æ–°ä¸€æ¡è®°å½•æ—¶ï¼Œè¦æŠŠè¢«æ›´æ–°çš„åˆ—çš„æ—§å€¼è®°ä¸‹æ¥ï¼Œ è¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠè¿™äº›åˆ—æ›´æ–°ä¸ºæ—§å€¼å°±å¥½äº†ã€‚ å¦å¤–ï¼Œundo log è¿˜æœ‰ä¸€ä¸ªä½œç”¨ï¼Œ é…åˆReadView å®ç° MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ã€‚ å› æ­¤ï¼Œundo log ä¸¤å¤§ä½œç”¨ï¼š å®ç°äº‹åŠ¡å›æ»šï¼Œä¿éšœäº‹åŠ¡çš„åŸå­æ€§ã€‚ å®ç° MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å…³é”®å› ç´ ä¹‹ä¸€ã€‚ å½“è¯»å–è®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•è¢«å…¶ä»–äº‹åŠ¡å ç”¨æˆ–å½“å‰ç‰ˆæœ¬å¯¹è¯¥äº‹åŠ¡ä¸å¯è§ï¼Œåˆ™å¯ä»¥é€šè¿‡ undo log è¯»å–ä¹‹å‰çš„ç‰ˆæœ¬æ•°æ®ï¼Œä»¥æ­¤å®ç°å¿«ç…§è¯»ï¼ˆéé”å®šè¯»ï¼‰ 2.Redo Logredo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ˜¯ InnoDB å­˜å‚¨å¼•æ“ç‹¬æœ‰çš„ï¼Œå®ƒè®© MySQL æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚æ˜¯ç”¨æ¥å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ æ¯”å¦‚ MySQL å®ä¾‹æŒ‚äº†æˆ–å®•æœºäº†ï¼Œé‡å¯æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¼šä½¿ç”¨ redo log æ¢å¤æ•°æ®ï¼Œä¿è¯æ•°æ®çš„æŒä¹…æ€§ä¸å®Œæ•´æ€§ã€‚ MySQL ä¸­æ•°æ®æ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œä½ æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œä¼šä»ç¡¬ç›˜æŠŠä¸€é¡µçš„æ•°æ®åŠ è½½å‡ºæ¥ï¼ŒåŠ è½½å‡ºæ¥çš„æ•°æ®å«æ•°æ®é¡µï¼Œä¼šæ”¾å…¥åˆ° Buffer Pool ä¸­ã€‚ åç»­çš„æŸ¥è¯¢éƒ½æ˜¯å…ˆä» Buffer Pool ä¸­æ‰¾ï¼Œæ²¡æœ‰å‘½ä¸­å†å»ç¡¬ç›˜åŠ è½½ï¼Œå‡å°‘ç¡¬ç›˜ IO å¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚ æ›´æ–°è¡¨æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå‘ç° Buffer Pool é‡Œå­˜åœ¨è¦æ›´æ–°çš„æ•°æ®ï¼Œå°±ç›´æ¥åœ¨ Buffer Pool é‡Œæ›´æ–°ã€‚ ç„¶åä¼šæŠŠâ€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€è®°å½•åˆ°é‡åšæ—¥å¿—ç¼“å­˜ï¼ˆredo log bufferï¼‰é‡Œï¼Œæ¥ç€åˆ·ç›˜åˆ° redo log æ–‡ä»¶é‡Œã€‚ è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé‡åšæ—¥å¿—ç¼“å†²(redolog buffer)ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶(redolog file)ï¼Œå‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­ã€‚å½“äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½å­˜åˆ°è¯¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç”¨äºåœ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜,å‘ç”Ÿé”™è¯¯æ—¶,è¿›è¡Œæ•°æ®æ¢å¤ä½¿ç”¨ã€‚ WAL æŠ€æœ¯æŒ‡çš„æ˜¯ï¼Œ MySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»å†™åˆ°ç£ç›˜ä¸Šï¼Œ è€Œæ˜¯å…ˆå†™æ—¥å¿—ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†å†™åˆ°ç£ç›˜ä¸Šã€‚ ä¸ºäº†é˜²æ­¢æ–­ç”µå¯¼è‡´æ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼Œå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼Œ InnoDB å¼•æ“å°±ä¼šå…ˆæ›´æ–°å†…å­˜ï¼ˆåŒæ—¶æ ‡è®°ä¸ºè„é¡µï¼‰ï¼Œ ç„¶åå°†æœ¬æ¬¡å¯¹è¿™ä¸ªé¡µçš„ä¿®æ”¹ä»¥ redo log çš„å½¢å¼è®°å½•ä¸‹æ¥ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚ åç»­ï¼ŒInnoDB å¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œ ç”±åå°çº¿ç¨‹å°†ç¼“å­˜åœ¨ Buffer Pool çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜é‡Œï¼Œè¿™å°±æ˜¯ WAL ï¼ˆWrite-Ahead Loggingï¼‰æŠ€æœ¯ã€‚ è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š é¡ºåºå†™vséšæœºå†™ redo log è¦å†™åˆ°ç£ç›˜ï¼Œæ•°æ®ä¹Ÿè¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ å†™å…¥ redo log çš„æ–¹å¼ä½¿ç”¨äº†è¿½åŠ æ“ä½œï¼Œ æ‰€ä»¥ç£ç›˜æ“ä½œæ˜¯é¡ºåºå†™ï¼Œ è€Œå†™å…¥æ•°æ®éœ€è¦å…ˆæ‰¾åˆ°å†™å…¥ä½ç½®ï¼Œç„¶åæ‰å†™åˆ°ç£ç›˜ï¼Œ æ‰€ä»¥ç£ç›˜æ“ä½œæ˜¯éšæœºå†™ã€‚ ç£ç›˜çš„ã€Œé¡ºåºå†™ ã€æ¯”ã€Œéšæœºå†™ã€ é«˜æ•ˆçš„å¤šï¼Œ å› æ­¤ redo log å†™å…¥ç£ç›˜çš„å¼€é”€æ›´å°ã€‚ è‡³æ­¤ï¼Œä¸ºä»€ä¹ˆéœ€è¦ redo log è¿™ä¸ªé—®é¢˜æˆ‘ä»¬æœ‰ä¸¤ä¸ªç­”æ¡ˆï¼š å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œè®© MySQL æœ‰ å´©æºƒæ¢å¤ çš„èƒ½åŠ›ï¼Œ èƒ½å¤Ÿä¿è¯ MySQL åœ¨ä»»ä½•æ—¶é—´æ®µçªç„¶å´©æºƒï¼Œé‡å¯åä¹‹å‰å·²æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼› å°†å†™æ“ä½œä»ã€Œéšæœºå†™ã€å˜æˆäº†ã€Œé¡ºåºå†™ã€ï¼Œæå‡ MySQL å†™å…¥ç£ç›˜çš„æ€§èƒ½ã€‚ äº§ç”Ÿçš„ redo log æ˜¯ç›´æ¥å†™å…¥ç£ç›˜çš„å—ï¼Ÿ ä¸æ˜¯çš„ã€‚å®é™…ä¸Šï¼Œæ‰§è¡Œä¸€ä¸ªäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿçš„ redo log ä¹Ÿä¸æ˜¯ç›´æ¥å†™å…¥ç£ç›˜çš„ï¼Œå› ä¸ºè¿™æ ·ä¼šäº§ç”Ÿå¤§é‡çš„ I&#x2F;0æ“ä½œï¼Œè€Œä¸”ç£ç›˜çš„è¿è¡Œé€Ÿåº¦è¿œæ…¢äºå†…å­˜ã€‚æ‰€ä»¥ï¼Œredo logä¹Ÿæœ‰è‡ªå·±çš„ç¼“å­˜â€“ redo log bufferï¼Œæ¯å½“äº§ç”Ÿä¸€æ¡ redo log æ—¶ï¼Œä¼šå…ˆå†™å…¥åˆ° redo logbufferï¼Œåç»­åœ¨æŒä¹…åŒ–åˆ°ç£ç›˜å¦‚ä¸‹å›¾: redo log buffer é»˜è®¤å¤§å° 16 MBï¼Œå¯ä»¥é€šè¿‡ innodb_log_Buffer_size å‚æ•°åŠ¨æ€çš„è°ƒæ•´å¤§å°ï¼Œ å¢å¤§å®ƒçš„å¤§å°å¯ä»¥è®© MySQL å¤„ç†ã€Œå¤§äº‹åŠ¡ã€æ˜¯ä¸å¿…å†™å…¥ç£ç›˜ï¼Œè¿›è€Œæå‡å†™ IO æ€§èƒ½ã€‚ redo logå’Œundo logçš„åŒºåˆ« è¿™ä¸¤ç§æ—¥å¿—æ˜¯å±äº InnoDB å­˜å‚¨å¼•æ“çš„æ—¥å¿—ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼š redo log è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡ã€Œä¿®æ”¹åã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°ä¹‹åçš„å€¼ï¼Œ ä¸»è¦ç”¨äºäº‹åŠ¡å´©æºƒæ¢å¤ï¼Œä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ undo log è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡ã€Œä¿®æ”¹å‰ã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°ä¹‹å‰çš„å€¼ï¼Œ ä¸»è¦ç”¨äºäº‹åŠ¡å›æ»šï¼Œä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚ äº‹åŠ¡æäº¤ä¹‹å‰å‘ç”Ÿäº†å´©æºƒ(è¿™é‡Œçš„å´©æºƒä¸æ˜¯å®•æœºå´©æºƒï¼Œè€Œæ˜¯äº‹åŠ¡æ‰§è¡Œé”™è¯¯ï¼Œmysql è¿˜æ˜¯æ­£å¸¸è¿è¡Œçš„)ï¼Œé‡å¯åä¼šé€šè¿‡ undo log å›æ»šäº‹åŠ¡ã€‚ äº‹åŠ¡æäº¤ä¹‹åå‘ç”Ÿäº†å´©æºƒï¼ˆè¿™é‡Œçš„å´©æºƒæ˜¯å®•æœºå´©æºƒï¼‰ï¼Œé‡å¯åä¼šé€šè¿‡ redo log æ¢å¤äº‹åŠ¡ï¼Œå¦‚ä¸‹å›¾ï¼š redologåˆ·ç›˜æ—¶æœºï¼ˆTODO 3.Bin logbinog æ–‡ä»¶æ˜¯è®°å½•äº†æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„å˜æ›´å’Œè¡¨æ•°æ®ä¿®æ”¹çš„æ—¥å¿—ï¼Œä¸ä¼šè®°å½•æŸ¥è¯¢ç±»çš„æ“ä½œï¼Œæ¯”å¦‚ SELECTå’Œ SHOW æ“ä½œã€‚ ä½œç”¨ï¼š ç¾éš¾æ—¶çš„æ•°æ®æ¢å¤; MySQ4çš„ä¸»ä»å¤åˆ¶ã€‚ binlog æœ‰3ç§æ ¼å¼ç±»å‹ åˆ†åˆ«æ˜¯ STATEMENT(é»˜è®¤æ ¼å¼)ã€ROWã€ MIXEDï¼ŒåŒºåˆ«å¦‚ä¸‹: æŒ‡å®šstatementï¼Œè®°å½•çš„å†…å®¹æ˜¯SQLè¯­å¥åŸæ–‡ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€æ¡update T set update_time=now() where id=1ï¼Œè®°å½•çš„å†…å®¹å¦‚ä¸‹ã€‚ åŒæ­¥æ•°æ®æ—¶ï¼Œä¼šæ‰§è¡Œè®°å½•çš„SQLè¯­å¥ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œupdate_time=now()è¿™é‡Œä¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚ ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸ºrowï¼Œè®°å½•çš„å†…å®¹ä¸å†æ˜¯ç®€å•çš„SQLè¯­å¥äº†ï¼Œè¿˜åŒ…å«æ“ä½œçš„å…·ä½“æ•°æ®ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹ã€‚ ä½† ROW çš„ç¼ºç‚¹æ˜¯æ¯è¡Œæ•°æ®çš„å˜åŒ–ç»“æœéƒ½ä¼šè¢«è®°å½•ï¼Œæ¯”å¦‚æ‰§è¡Œæ‰¹é‡update è¯­å¥ï¼Œæ›´æ–°å¤šå°‘è¡Œæ•°æ®å°±ä¼šäº§ç”Ÿå¤šå°‘æ¡è®°å½•ï¼Œä½¿ binog æ–‡ä»¶è¿‡å¤§ï¼Œè€Œåœ¨ STATEMENT æ ¼å¼ä¸‹åªä¼šè®°å½•ä¸€ä¸ª update è¯­å¥è€Œå·²; æ‰€ä»¥å°±æœ‰äº†ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼ŒæŒ‡å®šä¸ºmixedï¼Œè®°å½•çš„å†…å®¹æ˜¯å‰ä¸¤è€…çš„æ··åˆã€‚ MySQL ä¼šåˆ¤æ–­è¿™æ¡SQLè¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç”¨rowæ ¼å¼ï¼Œå¦åˆ™å°±ç”¨statementæ ¼å¼ã€‚ å¦‚æœä¸å°å¿ƒæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œèƒ½ä½¿ç”¨ redo log æ–‡ä»¶æ¢å¤æ•°æ®å—ï¼Ÿ ä¸å¯ä»¥ä½¿ç”¨ redo log æ–‡ä»¶æ¢å¤ï¼Œåªèƒ½ä½¿ç”¨ binlog æ–‡ä»¶æ¢å¤ã€‚ å› ä¸º redo log æ–‡ä»¶æ˜¯å¾ªç¯å†™ï¼Œæ˜¯ä¼šè¾¹å†™è¾¹æ“¦é™¤æ—¥å¿—çš„ï¼Œåªè®°å½•æœªè¢«åˆ·å…¥ç£ç›˜çš„æ•°æ®çš„ç‰©ç†æ—¥å¿—ï¼Œå·²ç»åˆ·å…¥ç£ç›˜çš„æ•°æ®éƒ½ä¼šä» redo log æ–‡ä»¶é‡Œæ“¦é™¤ã€‚ binlog æ–‡ä»¶ä¿å­˜çš„æ˜¯å…¨é‡çš„æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜äº†æ‰€æœ‰æ•°æ®å˜æ›´çš„æƒ…å†µï¼Œ ç†è®ºä¸Šåªè¦è®°å½•åœ¨ binlog ä¸Šçš„æ•°æ®ï¼Œéƒ½å¯ä»¥æ¢å¤ï¼Œ æ‰€ä»¥å¦‚æœä¸å°å¿ƒæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œå¾—ç”¨ binlog æ–‡ä»¶æ¢å¤æ•°æ®ã€‚ ä¸¤é˜¶æ®µæäº¤ redo logï¼ˆé‡åšæ—¥å¿—ï¼‰è®© InnoDB å­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ä¿è¯äº† MySQL é›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ã€‚ è™½ç„¶å®ƒä»¬éƒ½å±äºæŒä¹…åŒ–çš„ä¿è¯ï¼Œä½†æ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚ åœ¨æ‰§è¡Œæ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½• redo log ä¸ binlog ä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½ï¼Œredo log åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­å†™å…¥ï¼Œè€Œ binlog åªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥ redo log ä¸ binlog çš„å†™å…¥æ—¶æœºä¸ä¸€æ ·ã€‚ å…ˆå†™ redo log ï¼Œç„¶åå†™ binlogï¼Œ å‡è®¾å†™å®Œ redo log åï¼Œæœºå™¨æŒ‚äº†ï¼Œbinlog æ—¥å¿—æ²¡æœ‰è¢«å†™å…¥ï¼Œé‚£ä¹ˆæœºå™¨é‡å¯åï¼Œè¿™å°æœºå™¨ä¼šé€šè¿‡ redo log æ¢å¤æ•°æ®ï¼Œ ä½†æ˜¯è¿™ä¸ªæ—¶å€™ binlog å¹¶æ²¡æœ‰è®°å½•è¯¥æ•°æ®ï¼Œåç»­è¿›è¡Œæœºå™¨å¤‡ä»½çš„æ—¶å€™ï¼Œå°±ä¼šä¸¢å¤±è¿™ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶ä¸»ä»åŒæ­¥ä¹Ÿä¼šä¸¢å¤±è¿™ä¸€æ¡æ•°æ®ã€‚ å…ˆå†™ binlogï¼Œç„¶åå†™ redo logï¼Œå‡è®¾å†™å®Œäº† binlogï¼Œæœºå™¨å¼‚å¸¸é‡å¯äº†ï¼Œ ç”±äºæ²¡æœ‰ redo logï¼Œæœ¬æœºæ˜¯æ— æ³•æ¢å¤è¿™ä¸€æ¡è®°å½•çš„ï¼Œ ä½†æ˜¯ binlog åˆæœ‰è®°å½•ï¼Œé‚£ä¹ˆå’Œä¸Šé¢åŒæ ·çš„é“ç†ï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æŒä¹…åŒ– redo log å’Œ binlog è¿™ä¸¤ä»½æ—¥å¿—çš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°åŠæˆåŠŸçš„çŠ¶æ€ï¼Œ å°±ä¼šé€ æˆä¸»ä»ç¯å¢ƒçš„æ•°æ®ä¸ä¸€è‡´æ€§ã€‚è¿™æ˜¯å› ä¸º redo log å½±å“ä¸»åº“çš„æ•°æ®ï¼Œ binlog å½±å“ä»åº“çš„æ•°æ®ï¼Œæ‰€ä»¥ redo log å’Œ binlog å¿…é¡»ä¿æŒä¸€è‡´æ‰èƒ½ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´ã€‚ ä¸¤é˜¶æ®µæäº¤çš„è¿‡ç¨‹åœ¨ä¸€æ¡æ›´æ–°è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹é‚£é‡Œ 6.SQLä¼˜åŒ–0.MySQLå¸¸è§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ æ…¢ SQL å®šä½ä¸åˆ†æ ç›‘æ§å·¥å…·ï¼š ä»‹ç»å¸¸ç”¨çš„æ…¢ SQL ç›‘æ§å·¥å…·ï¼Œå¦‚ MySQL æ…¢æŸ¥è¯¢æ—¥å¿— EXPLAIN å‘½ä»¤ï¼š è¯¦ç»†è¯´æ˜ EXPLAIN å‘½ä»¤çš„ä½¿ç”¨ï¼Œåˆ†ææŸ¥è¯¢è®¡åˆ’ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µ ç´¢å¼•ã€è¡¨ç»“æ„å’Œ SQL ä¼˜åŒ– ç´¢å¼•ä¼˜åŒ–ï¼š è¿™æ˜¯ MySQL æ€§èƒ½ä¼˜åŒ–çš„é‡ç‚¹ï¼Œå¯ä»¥ä»‹ç»ç´¢å¼•çš„åˆ›å»ºåŸåˆ™ã€è¦†ç›–ç´¢å¼•ã€æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ç­‰ã€‚ è¡¨ç»“æ„ä¼˜åŒ–ï¼š ä¼˜åŒ–è¡¨ç»“æ„è®¾è®¡ï¼ŒåŒ…æ‹¬é€‰æ‹©åˆé€‚çš„å­—æ®µç±»å‹ã€é¿å…å†—ä½™å­—æ®µã€åˆç†ä½¿ç”¨èŒƒå¼å’ŒåèŒƒå¼è®¾è®¡ç­‰ç­‰ã€‚ SQLè¯­å¥çš„ä¼˜åŒ–ï¼š é¿å…ä½¿ç”¨ SELECT *ã€å°½é‡ä½¿ç”¨å…·ä½“å­—æ®µã€ä½¿ç”¨è¿æ¥æŸ¥è¯¢ä»£æ›¿å­æŸ¥è¯¢ã€åˆç†ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ã€æ‰¹é‡æ“ä½œç­‰ï¼Œéƒ½æ˜¯ SQL ç¼–å†™è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚ æ¶æ„ä¼˜åŒ– è¯»å†™åˆ†ç¦»ï¼š å°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†ç¦»åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ï¼Œæå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ åˆ†åº“åˆ†è¡¨ï¼š å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹æˆ–æ•°æ®è¡¨ä¸­ï¼Œé™ä½å•è¡¨æ•°æ®é‡ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚ä½†è¦æƒè¡¡å…¶å¸¦æ¥çš„å¤æ‚æ€§å’Œç»´æŠ¤æˆæœ¬ï¼Œè°¨æ…ä½¿ç”¨ã€‚ æ•°æ®å†·çƒ­åˆ†ç¦»ï¼šæ ¹æ®æ•°æ®çš„è®¿é—®é¢‘ç‡å’Œä¸šåŠ¡é‡è¦æ€§ï¼Œå°†æ•°æ®åˆ†ä¸ºå†·æ•°æ®å’Œçƒ­æ•°æ®ï¼Œå†·æ•°æ®ä¸€èˆ¬å­˜å‚¨åœ¨å­˜å‚¨åœ¨ä½æˆæœ¬ã€ä½æ€§èƒ½çš„ä»‹è´¨ä¸­ï¼Œçƒ­æ•°æ®é«˜æ€§èƒ½å­˜å‚¨ä»‹è´¨ä¸­ã€‚ ç¼“å­˜æœºåˆ¶ï¼š ä½¿ç”¨ Redis ç­‰ç¼“å­˜ä¸­é—´ä»¶ï¼Œå°†çƒ­ç‚¹æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›ã€‚è¿™ä¸ªéå¸¸å¸¸ç”¨ï¼Œæå‡æ•ˆæœéå¸¸æ˜æ˜¾ï¼Œæ€§ä»·æ¯”æé«˜ï¼ 1.MySQL æ…¢æŸ¥è¯¢çš„æ’é™¤ä¸ä¼˜åŒ– æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šåœ¨ MySQLä¸­ï¼Œå¯ä»¥å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æ¥è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡è®¾å®šé˜ˆå€¼çš„æŸ¥è¯¢ã€‚é€šè¿‡åˆ†æè¿™äº›æ—¥å¿—ï¼Œå¯ä»¥æ‰¾åˆ°æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„SQLè¯­å¥ã€‚ ä½¿ç”¨ EXPLAINåˆ†æï¼šå¯¹æ…¢SQLè¯­å¥ä½¿ç”¨ MySQLçš„EXPLAINå‘½ä»¤ï¼Œå¯ä»¥åˆ†ææŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ã€‚è¿™æœ‰åŠ©äºäº†è§£ MySQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„æŸ¥è¯¢çš„ï¼ŒåŒ…æ‹¬æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€æ˜¯å¦è¿›è¡Œäº†å…¨è¡¨æ‰«æç­‰ã€‚ æŸ¥è¯¢äº†è¿‡å¤šä¸éœ€è¦çš„æ•°æ®ï¼šæœ‰æ—¶å€™ï¼ŒæŸ¥è¯¢è¯­å¥å¯èƒ½ä¼šè¿”å›æ¯”å®é™…éœ€è¦æ›´å¤šçš„æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´æŸ¥è¯¢å˜æ…¢ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ SELECT*ä»å¤šä¸ªè¡¨ä¸­è¿›è¡Œå…³è”æŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä¼šå–å‡ºæ‰€æœ‰åˆ—çš„æ•°æ®ï¼Œä½†å®é™…ä¸Šå¯èƒ½åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†åˆ—ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¼˜åŒ–SQLè¯­å¥ï¼Œåªé€‰æ‹©éœ€è¦çš„åˆ—ã€‚ å¦‚æœå¯¹è¯­å¥çš„ä¼˜åŒ–å·²ç»æ— æ³•è¿›è¡Œï¼Œå¯ä»¥è€ƒè™‘è¡¨ä¸­çš„æ•°æ®é‡æ˜¯å¦å¤ªå¤§ï¼Œå¦‚æœæ˜¯çš„è¯å¯ä»¥è¿›è¡Œæ¨ªå‘æˆ–è€…çºµå‘çš„åˆ†è¡¨ã€‚ 2.explainæ‰§è¡Œè®¡åˆ’å¦‚æœä¸€æ¡sqlæ‰§è¡Œå¾ˆæ…¢çš„è¯ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨mysqlè‡ªåŠ¨çš„æ‰§è¡Œè®¡åˆ’explainæ¥å»æŸ¥çœ‹è¿™æ¡sqlçš„æ‰§è¡Œæƒ…å†µï¼Œ æ¯”å¦‚åœ¨è¿™é‡Œé¢å¯ä»¥é€šè¿‡keyå’Œkey_lenæ£€æŸ¥æ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Œå¦‚æœæœ¬èº«å·²ç»æ·»åŠ äº†ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åˆ¤æ–­ç´¢å¼•æ˜¯å¦æœ‰å¤±æ•ˆçš„æƒ…å†µï¼Œ ç¬¬äºŒä¸ªï¼Œå¯ä»¥é€šè¿‡typeå­—æ®µæŸ¥çœ‹sq!æ˜¯å¦æœ‰è¿›ä¸€æ­¥çš„ä¼˜åŒ–ç©ºé—´ï¼Œæ˜¯å¦å­˜åœ¨å…¨ç´¢å¼•æ‰«ææˆ–å…¨ç›˜æ‰«æï¼Œ ç¬¬ä¸‰ä¸ªå¯ä»¥é€šè¿‡extraå»ºè®®æ¥åˆ¤æ–­ï¼Œæ˜¯å¦å‡ºç°äº†å›è¡¨çš„æƒ…å†µï¼Œå¦‚æœå‡ºç°äº†å¯ä»¥å°è¯•æ·»åŠ ç´¢å¼•æˆ–ä¿®æ”¹è¿”å›å­—æ®µæ¥ä¿®å¤ æœ€é‡è¦çš„ä¸‰ä¸ªå­—æ®µï¼Œkeyï¼Œ typeï¼Œextra key æ˜¾ç¤ºMySQLåœ¨æŸ¥è¯¢ä¸­å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œè‹¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ˜¾ç¤ºä¸ºNULLã€‚ key_length ç´¢å¼•é•¿åº¦ã€‚è”åˆç´¢å¼•çš„æƒ…å†µä¸‹å¯ç»“åˆkey_lenåˆ¤æ–­å®é™…ä½¿ç”¨çš„ç´¢å¼• type(éå¸¸é‡è¦ï¼Œå¯ä»¥çœ‹åˆ°æœ‰æ²¡æœ‰èµ°ç´¢å¼•) æŸ¥è¯¢æ‰§è¡Œçš„ç±»å‹ï¼Œæè¿°äº†æŸ¥è¯¢æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚ æ€§èƒ½ä»æœ€ä¼˜åˆ°æœ€å·®åˆ†åˆ«ä¸ºï¼šsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALLã€‚ systemï¼Œè¡¨åªæœ‰ä¸€è¡Œï¼Œä¸€èˆ¬æ˜¯ç³»ç»Ÿè¡¨ï¼Œå¾€å¾€ä¸éœ€è¦è¿›è¡Œç£ç›˜ IOï¼Œé€Ÿåº¦éå¸¸å¿« constã€eq_refã€refï¼šè¿™äº›ç±»å‹è¡¨ç¤º MySQL å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥æŸ¥æ‰¾å•ä¸ªè¡Œï¼Œå…¶ä¸­ const æ˜¯æœ€ä¼˜çš„ï¼Œè¡¨ç¤ºæŸ¥è¯¢æœ€å¤šè¿”å›ä¸€è¡Œã€‚ rangeï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢ã€‚åœ¨whereè¯­å¥ä¸­ä½¿ç”¨ bettween...andã€&lt;ã€&gt;ã€&lt;=ã€in ç­‰æ¡ä»¶æŸ¥è¯¢ type éƒ½æ˜¯ rangeã€‚ indexï¼šéå†ç´¢å¼•æ ‘è¯»å–ã€‚æŸ¥è¯¢éå†äº†æ•´æ£µç´¢å¼•æ ‘ï¼Œä¸ ALL ç±»ä¼¼ï¼Œåªä¸è¿‡æ‰«æçš„æ˜¯ç´¢å¼•ï¼Œè€Œç´¢å¼•ä¸€èˆ¬åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ ALLï¼šå…¨è¡¨æ‰«æï¼Œæ•ˆç‡æœ€ä½ã€‚ extra çš„ä¿¡æ¯éå¸¸ä¸°å¯Œï¼Œå¸¸è§çš„æœ‰ï¼š Using indexï¼šè¡¨æ˜æŸ¥è¯¢ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œä¸ç”¨å›è¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡éå¸¸é«˜ã€‚ Using whereï¼šè¡¨ç¤ºä½¿ç”¨äº† WHERE è¿‡æ»¤ã€‚ Using temporary ï¼šè¡¨ç¤ºä½¿ç”¨äº†ä¸´æ—¶è¡¨æ¥å­˜å‚¨ä¸­é—´ç»“æœã€‚ Using index conditionï¼šè¡¨ç¤ºæŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨äº†ç´¢å¼•æ¡ä»¶ä¸‹æ¨è¿™ä¸ªç‰¹æ€§ã€‚ ã€æ¨èã€‘SQLæ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯refçº§åˆ«ï¼Œå¦‚æœå¯ä»¥æ˜¯constsæœ€å¥½ã€‚è¯´æ˜ï¼š1ï¼‰ consts å•è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼ˆä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œåœ¨ä¼˜åŒ–é˜¶æ®µå³å¯è¯»å–åˆ°æ•°æ®ã€‚2ï¼‰ ref æŒ‡çš„æ˜¯ä½¿ç”¨æ™®é€šçš„ç´¢å¼•ï¼ˆnormal indexï¼‰ã€‚3ï¼‰ range å¯¹ç´¢å¼•è¿›è¡ŒèŒƒå›´æ£€ç´¢ã€‚ 3.ç»™ä½ å¼ è¡¨ï¼Œå‘ç°æŸ¥è¯¢é€Ÿåº¦å¾ˆæ…¢ï¼Œä½ æœ‰é‚£äº›è§£å†³æ–¹æ¡ˆ åˆ†ææŸ¥è¯¢è¯­å¥ï¼šä½¿ç”¨EXPLAINå‘½ä»¤åˆ†æSQLæ‰§è¡Œè®¡åˆ’ï¼Œæ‰¾å‡ºæ…¢æŸ¥è¯¢çš„åŸå›  ï¼Œæ¯”å¦‚æ˜¯å¦ä½¿ç”¨äº†å…¨è¡¨æ‰«æï¼Œæ˜¯å¦å­˜åœ¨ç´¢å¼•æœªè¢«åˆ©ç”¨çš„æƒ…å†µç­‰ï¼Œå¹¶æ ¹æ®ç›¸åº”æƒ…å†µå¯¹ç´¢å¼•è¿›è¡Œé€‚å½“ä¿®æ”¹ã€‚ åˆ›å»ºæˆ–ä¼˜åŒ–ç´¢å¼•ï¼š æ ¹æ®æŸ¥è¯¢æ¡ä»¶åˆ›å»ºåˆé€‚çš„ç´¢å¼• é¿å…ç´¢å¼•å¤±æ•ˆï¼š ä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ æŸ¥è¯¢ä¼˜åŒ–ï¼šé¿å…ä½¿ç”¨SELECT *ï¼ŒåªæŸ¥è¯¢çœŸæ­£éœ€è¦çš„åˆ—ï¼›ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå³ç´¢å¼•åŒ…å«æ‰€æœ‰æŸ¥è¯¢çš„å­—æ®µï¼› ä¼˜åŒ–æ•°æ®åº“è¡¨ï¼šå¦‚æœå•è¡¨çš„æ•°æ®è¶…è¿‡äº†åƒä¸‡çº§åˆ«ï¼Œè€ƒè™‘æ˜¯å¦éœ€è¦å°†å¤§è¡¨æ‹†åˆ†ä¸ºå°è¡¨ï¼Œå‡è½»å•ä¸ªè¡¨çš„æŸ¥è¯¢å‹åŠ›ã€‚ ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼š å¼•å…¥ç¼“å­˜å±‚ ï¼Œå¦‚Redisï¼Œå­˜å‚¨çƒ­ç‚¹æ•°æ®å’Œé¢‘ç¹æŸ¥è¯¢çš„ç»“æœï¼Œ 4.ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿæ¨èä½¿ç”¨è‡ªå¢IDï¼Œä¸è¦ä½¿ç”¨UUIDã€‚ å› ä¸ºåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•æ˜¯ä½œä¸ºèšç°‡ç´¢å¼•å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»é”®ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹ä¸Šå­˜å‚¨äº†ä¸»é”®ç´¢å¼•ä»¥åŠå…¨éƒ¨çš„æ•°æ®(æŒ‰ç…§é¡ºåº)ï¼Œå¦‚æœä¸»é”®ç´¢å¼•æ˜¯è‡ªå¢IDï¼Œé‚£ä¹ˆåªéœ€è¦ä¸æ–­å‘åæ’åˆ—å³å¯ï¼Œå¦‚æœæ˜¯UUIDï¼Œç”±äºåˆ°æ¥çš„IDä¸åŸæ¥çš„å¤§å°ä¸ç¡®å®šï¼Œä¼šé€ æˆéå¸¸å¤šçš„æ•°æ®æ’å…¥ï¼Œæ•°æ®ç§»åŠ¨ï¼Œç„¶åå¯¼è‡´äº§ç”Ÿå¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ï¼Œè¿›è€Œé€ æˆæ’å…¥æ€§èƒ½çš„ä¸‹é™ã€‚ æ€»ä¹‹ï¼Œåœ¨æ•°æ®é‡å¤§ä¸€äº›çš„æƒ…å†µä¸‹ï¼Œç”¨è‡ªå¢ä¸»é”®æ€§èƒ½ä¼šå¥½ä¸€äº›ã€‚ 7.æ¶æ„1.è¯»å†™åˆ†ç¦»è¯»å†™åˆ†ç¦»ä¸»è¦æ˜¯ä¸ºäº†å°†å¯¹æ•°æ®åº“çš„è¯»å†™æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“èŠ‚ç‚¹ä¸Šã€‚ è¿™æ ·çš„è¯ï¼Œå°±èƒ½å¤Ÿå°å¹…æå‡å†™æ€§èƒ½ï¼Œå¤§å¹…æå‡è¯»æ€§èƒ½ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šé€‰æ‹©ä¸€ä¸»å¤šä»ï¼Œä¹Ÿå°±æ˜¯ä¸€å°ä¸»æ•°æ®åº“è´Ÿè´£å†™ï¼Œå…¶ä»–çš„ä»æ•°æ®åº“è´Ÿè´£è¯»ã€‚ä¸»åº“å’Œä»åº“ä¹‹é—´ä¼šè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä»¥ä¿è¯ä»åº“ä¸­æ•°æ®çš„å‡†ç¡®æ€§ã€‚è¿™æ ·çš„æ¶æ„å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”ä¹Ÿç¬¦åˆç³»ç»Ÿçš„å†™å°‘è¯»å¤šçš„ç‰¹ç‚¹ã€‚ å¦‚ä½•å®ç°è¯»å†™åˆ†ç¦»ï¼Ÿ ä»£ç†æ–¹å¼ æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åº”ç”¨ç¨‹åºæ‰€æœ‰çš„æ•°æ®è¯·æ±‚éƒ½äº¤ç»™ä»£ç†å±‚å¤„ç†ï¼Œä»£ç†å±‚è´Ÿè´£åˆ†ç¦»è¯»å†™è¯·æ±‚ï¼Œå°†å®ƒä»¬è·¯ç”±åˆ°å¯¹åº”çš„æ•°æ®åº“ä¸­ã€‚ æä¾›ç±»ä¼¼åŠŸèƒ½çš„ä¸­é—´ä»¶æœ‰ MySQL Routerï¼ˆå®˜æ–¹ï¼Œ MySQL Proxy çš„æ›¿ä»£æ–¹æ¡ˆï¼‰ã€Atlasï¼ˆåŸºäº MySQL Proxyï¼‰ã€MaxScaleã€MyCatã€‚ ç»„ä»¶æ–¹å¼ 2.ä¸»ä»å¤åˆ¶ åŸç† MySQL çš„ä¸»ä»å¤åˆ¶ä¾èµ–äº binlog ï¼Œä¹Ÿå°±æ˜¯è®°å½• MySQL ä¸Šçš„æ‰€æœ‰å˜åŒ–å¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚å¤åˆ¶çš„è¿‡ç¨‹å°±æ˜¯å°† binlog ä¸­çš„æ•°æ®ä»ä¸»åº“ä¼ è¾“åˆ°ä»åº“ä¸Šã€‚ æµç¨‹å¦‚ä¸‹ï¼š MySQL ä¸»åº“åœ¨æ”¶åˆ°å®¢æˆ·ç«¯æäº¤äº‹åŠ¡çš„è¯·æ±‚ä¹‹åï¼Œä¼šå…ˆå†™å…¥ binlogï¼Œå†æäº¤äº‹åŠ¡ï¼Œ æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œäº‹åŠ¡æäº¤å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯â€œæ“ä½œæˆåŠŸâ€çš„å“åº”ã€‚ ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ I&#x2F;O çº¿ç¨‹ï¼Œè¿æ¥ä¸»åº“çš„ log dump çº¿ç¨‹ï¼Œ æ¥æ¥æ”¶ä¸»åº“çš„ binlog æ—¥å¿—ï¼Œå†æŠŠ binlog ä¿¡æ¯å†™å…¥ relay log çš„ä¸­ç»§æ—¥å¿—é‡Œï¼Œ å†è¿”å›ç»™ä¸»åº“â€œå¤åˆ¶æˆåŠŸâ€çš„å“åº”ã€‚ ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªç”¨äºå›æ”¾ binlog çš„çº¿ç¨‹ï¼Œå»è¯» relay log ä¸­ç»§æ—¥å¿—ï¼Œ ç„¶åå›æ”¾ binlog æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆå®ç°ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚ åœ¨å®Œæˆä¸»ä»å¤åˆ¶ä¹‹åï¼Œä½ å°±å¯ä»¥åœ¨å†™æ•°æ®æ—¶åªå†™ä¸»åº“ï¼Œåœ¨è¯»æ•°æ®æ—¶åªè¯»ä»åº“ï¼Œ è¿™æ ·å³ä½¿å†™è¯·æ±‚ä¼šé”è¡¨æˆ–è€…é”è®°å½•ï¼Œä¹Ÿä¸ä¼šå½±å“è¯»è¯·æ±‚çš„æ‰§è¡Œã€‚ 3.ä¸»ä»å»¶è¿Ÿè¯»å†™åˆ†ç¦»å¯¹äºæå‡æ•°æ®åº“çš„å¹¶å‘éå¸¸æœ‰æ•ˆï¼Œä½†æ˜¯ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•æ¥ä¸€ä¸ªé—®é¢˜ï¼šä¸»åº“å’Œä»åº“çš„æ•°æ®å­˜åœ¨å»¶è¿Ÿï¼Œæ¯”å¦‚ä½ å†™å®Œä¸»åº“ä¹‹åï¼Œä¸»åº“çš„æ•°æ®åŒæ­¥åˆ°ä»åº“æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè¿™ä¸ªæ—¶é—´å·®å°±å¯¼è‡´äº†ä¸»åº“å’Œä»åº“çš„æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„ ä¸»ä»åŒæ­¥å»¶è¿Ÿ ã€‚ ä¸»ä»å»¶è¿Ÿå‡ºç°çš„åŸå›  MySQL ä¸»ä»åŒæ­¥å»¶æ—¶æ˜¯æŒ‡ä»åº“çš„æ•°æ®è½åäºä¸»åº“çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µå¯èƒ½ç”±ä»¥ä¸‹åŸå› é€ æˆï¼š ç½‘ç»œå»¶è¿Ÿ ä¸»åº“å’Œä»åº“ä¹‹é—´å¦‚æœå­˜åœ¨ç½‘ç»œä¼ è¾“å»¶è¿Ÿ ä¸»åº“å†™å…¥å‹åŠ›å¤§ å½“ä¸»åº“çš„å†™å…¥æ“ä½œï¼ˆå¦‚INSERTã€UPDATEã€DELETEï¼‰éå¸¸é¢‘ç¹æ—¶ï¼Œä»åº“å¯èƒ½æ— æ³•ä»¥åŒæ ·çš„é€Ÿåº¦å¤„ç†è¿™äº›æ›´æ–°ã€‚ ä»åº“è´Ÿè½½è¿‡é«˜ ä»åº“å¯èƒ½æ­£åœ¨å¤„ç†å…¶ä»–æŸ¥è¯¢æˆ–ä»»åŠ¡ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶åº”ç”¨ä¸»åº“ä¼ æ¥çš„æ›´æ–°æ—¥å¿—ã€‚ å¦‚ä½•åœ¨ä¸»ä»å»¶è¿Ÿæ—¶ä¿è¯è¯»åˆ°æœ€æ–°æ•°æ® å¼ºåˆ¶è¯»ä¸»åº“ å¯¹äºéœ€è¦å®æ—¶ä¸€è‡´æ€§çš„å…³é”®ä¸šåŠ¡ï¼Œå¯ä»¥é…ç½®åº”ç”¨ç¨‹åºç›´æ¥ä»ä¸»åº“è¯»å–æ•°æ®ï¼Œé¿å…ä»åº“å»¶è¿Ÿçš„å½±å“ã€‚ å»¶è¿Ÿç›‘æ§ä¸åˆ‡æ¢ å®æ—¶ç›‘æ§ä¸»ä»å»¶è¿Ÿï¼ˆä¾‹å¦‚é€šè¿‡Seconds_Behind_Masterå‚æ•°ï¼‰ï¼Œå½“å»¶è¿Ÿè¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨å°†è¯»è¯·æ±‚åˆ‡æ¢åˆ°ä¸»åº“ã€‚ 5.åˆ†åº“åˆ†è¡¨è¯»å†™åˆ†ç¦»ä¸»è¦åº”å¯¹çš„æ˜¯æ•°æ®åº“è¯»å¹¶å‘ï¼Œæ²¡æœ‰è§£å†³æ•°æ®åº“å­˜å‚¨é—®é¢˜ã€‚è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœ MySQL ä¸€å¼ è¡¨çš„æ•°æ®é‡è¿‡å¤§æ€ä¹ˆåŠ? æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³ MySQL çš„å­˜å‚¨å‹åŠ›å‘¢ï¼Ÿ ç­”æ¡ˆä¹‹ä¸€å°±æ˜¯ åˆ†åº“åˆ†è¡¨ã€‚ åˆ†åº“ å‚ç›´åˆ†åº“ï¼šæŒ‰ä¸šåŠ¡åˆ’åˆ†ï¼ŒæŠŠå•ä¸€æ•°æ®åº“æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼Œä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ï¼Œè¿›è€Œå°†ä¸€ä¸ªæ•°æ®åº“çš„å‹åŠ›åˆ†æ‹…åˆ°å¤šä¸ªæ•°æ®åº“ã€‚ æ¯”å¦‚å°†æ•°æ®åº“ä¸­çš„ç”¨æˆ·è¡¨ã€è®¢å•è¡¨å’Œå•†å“è¡¨åˆ†åˆ«å•ç‹¬æ‹†åˆ†ä¸ºç”¨æˆ·æ•°æ®åº“ã€è®¢å•æ•°æ®åº“å’Œå•†å“æ•°æ®åº“ã€‚ æ°´å¹³åˆ†åº“ï¼šåŒä¸€ä¸ªè¡¨æŒ‰ä¸€å®šè§„åˆ™æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªåº“å¯ä»¥ä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±å®ç°äº†æ°´å¹³æ‰©å±•ï¼Œè§£å†³äº†å•è¡¨çš„å­˜å‚¨å’Œæ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šè®¢å•è¡¨æ•°æ®é‡å¤ªå¤§ï¼Œä½ å¯¹è®¢å•è¡¨è¿›è¡Œäº†æ°´å¹³åˆ‡åˆ†ï¼ˆæ°´å¹³åˆ†è¡¨ï¼‰ï¼Œç„¶åå°†åˆ‡åˆ†åçš„ 2 å¼ è®¢å•è¡¨åˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„æ•°æ®åº“ã€‚ åˆ†åº“æœ‰ä¸ªè¯»æ‰©æ•£é—®é¢˜ï¼šè§Bç«™è§†é¢‘åŸç¥é‚£ä¸€é›†ï¼ˆTODOï¼‰ åˆ†è¡¨ å‚ç›´åˆ†è¡¨ï¼šæ˜¯å¯¹æ•°æ®è¡¨åˆ—çš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ åˆ—æ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨ä¸­çš„ä¸€äº›åˆ—å•ç‹¬æŠ½å‡ºæ¥ä½œä¸ºä¸€ä¸ªè¡¨ã€‚ ä¼˜ç‚¹ï¼šå¯ä»¥ä½¿å¾—è¡Œæ•°æ®å˜å°ï¼Œåœ¨æŸ¥è¯¢æ—¶å‡å°‘è¯»å–çš„Blockæ•°ï¼Œå‡å°‘I&#x2F;Oæ¬¡æ•°ã€‚ æ°´å¹³åˆ†è¡¨ï¼šæ˜¯å¯¹æ•°æ®è¡¨è¡Œçš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ è¡Œæ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ï¼Œå¯ä»¥è§£å†³å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨æ‹†åˆ†æˆå¤šä¸ªç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚ å¸¸è§çš„åˆ†ç‰‡ç®—æ³• åˆ†ç‰‡ç®—æ³•ä¸»è¦è§£å†³äº†æ•°æ®è¢«æ°´å¹³åˆ†ç‰‡ä¹‹åï¼Œæ•°æ®ç©¶ç«Ÿè¯¥å­˜æ”¾åœ¨å“ªä¸ªè¡¨çš„é—®é¢˜ã€‚ å¸¸è§çš„åˆ†ç‰‡ç®—æ³•æœ‰ï¼š å“ˆå¸Œåˆ†ç‰‡ï¼šæ±‚æŒ‡å®šåˆ†ç‰‡é”®çš„å“ˆå¸Œï¼Œç„¶åæ ¹æ®å“ˆå¸Œå€¼ç¡®å®šæ•°æ®åº”è¢«æ”¾ç½®åœ¨å“ªä¸ªè¡¨ä¸­ã€‚ èŒƒå›´åˆ†ç‰‡ï¼šæŒ‰ç…§ç‰¹å®šçš„èŒƒå›´åŒºé—´ï¼ˆæ¯”å¦‚æ—¶é—´åŒºé—´ã€ID åŒºé—´ï¼‰æ¥åˆ†é…æ•°æ®ï¼Œæ¯”å¦‚ å°† id ä¸º 1~299999 çš„è®°å½•åˆ†åˆ°ç¬¬ä¸€ä¸ªè¡¨ï¼Œ 300000~599999 çš„åˆ†åˆ°ç¬¬äºŒä¸ªè¡¨ã€‚ æ˜ å°„è¡¨åˆ†ç‰‡ï¼šä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„è¡¨ï¼ˆç§°ä¸ºæ˜ å°„è¡¨ï¼‰æ¥å­˜å‚¨åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ä½ç½®çš„å¯¹åº”å…³ç³»ã€‚ ä¸€è‡´æ€§å“ˆå¸Œåˆ†ç‰‡ï¼šå°†å“ˆå¸Œç©ºé—´ç»„ç»‡æˆä¸€ä¸ªç¯å½¢ç»“æ„ï¼Œå°†åˆ†ç‰‡é”®å’ŒèŠ‚ç‚¹ï¼ˆæ•°æ®åº“æˆ–è¡¨ï¼‰éƒ½æ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šï¼Œç„¶åæ ¹æ®é¡ºæ—¶é’ˆçš„è§„åˆ™ç¡®å®šæ•°æ®æˆ–è¯·æ±‚åº”è¯¥åˆ†é…åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œè§£å†³äº†ä¼ ç»Ÿå“ˆå¸Œå¯¹åŠ¨æ€ä¼¸ç¼©ä¸å‹å¥½çš„é—®é¢˜ã€‚ 6.å†·çƒ­åˆ†ç¦»æ•°æ®å†·çƒ­åˆ†ç¦»æ˜¯æŒ‡æ ¹æ®æ•°æ®çš„è®¿é—®é¢‘ç‡å’Œä¸šåŠ¡é‡è¦æ€§ï¼Œå°†æ•°æ®åˆ†ä¸ºå†·æ•°æ®å’Œçƒ­æ•°æ®ï¼Œå†·æ•°æ®ä¸€èˆ¬å­˜å‚¨åœ¨å­˜å‚¨åœ¨ä½æˆæœ¬ã€ä½æ€§èƒ½çš„ä»‹è´¨ä¸­ï¼Œçƒ­æ•°æ®é«˜æ€§èƒ½å­˜å‚¨ä»‹è´¨ä¸­ã€‚ å†·çƒ­åˆ†ç¦»çš„æ€æƒ³éå¸¸ç®€å•ï¼Œå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œç„¶ååˆ†å¼€å­˜å‚¨ã€‚ 7.æ·±åº¦åˆ†é¡µå…¨è¡¨æŸ¥è¯¢é€šå¸¸æ˜¯é¡ºåº IOã€‚æ•°æ®åº“åœ¨æ‰§è¡Œå…¨è¡¨æ‰«ææ—¶ï¼Œä¼šæŒ‰å­˜å‚¨é¡ºåºä»å¤´åˆ°å°¾è¯»å–è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œè¿™ç§è¯»å–æ–¹å¼å±äºé¡ºåº IOï¼Œç›¸æ¯”éšæœº IO æ›´åŠ é«˜æ•ˆã€‚ ä½†åœ¨æ·±åº¦åˆ†é¡µåœºæ™¯ä¸­ï¼Œå°½ç®¡æŸ¥è¯¢ä»æ˜¯å…¨è¡¨æ‰«æï¼Œç”±äº OFFSET å€¼å¾ˆå¤§ï¼Œæ•°æ®åº“éœ€è¦è·³è¿‡å¤§é‡æ•°æ®æ‰èƒ½åˆ°è¾¾ç›®æ ‡è¡Œã€‚è™½ç„¶è·³è¿‡æ•°æ®çš„æ“ä½œä»ç„¶æ˜¯é¡ºåºè¯»å–ï¼Œä½†è·³è¿‡çš„è¿‡ç¨‹ä¼šå¢åŠ é¢å¤–çš„ IO å¼€é”€ã€‚ç‰¹åˆ«æ˜¯åœ¨æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè·³è¿‡å¤§é‡æ•°æ®ä¼šæ˜¾è‘—å½±å“æ€§èƒ½ï¼Œå› æ­¤æ·±åº¦åˆ†é¡µçš„æ•ˆç‡ä¼šä¸‹é™ã€‚ æŸ¥è¯¢åç§»é‡è¿‡å¤§çš„åœºæ™¯æˆ‘ä»¬ç§°ä¸ºæ·±åº¦åˆ†é¡µï¼Œè¿™ä¼šå¯¼è‡´æŸ¥è¯¢æ€§èƒ½è¾ƒä½ï¼Œä¾‹å¦‚ï¼š 12# MySQL åœ¨æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æƒ…å†µä¸‹è·³è¿‡1000000æ¡è®°å½•åï¼Œå†è·å–10æ¡è®°å½•SELECT * FROM t_order ORDER BY id LIMIT 1000000, 10 å½“æŸ¥è¯¢åç§»é‡è¿‡å¤§æ—¶ï¼ŒMySQL çš„æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½ä¼šé€‰æ‹©å…¨è¡¨æ‰«æè€Œä¸æ˜¯åˆ©ç”¨ç´¢å¼•æ¥ä¼˜åŒ–æŸ¥è¯¢ã€‚è¿™æ˜¯å› ä¸ºæ‰«æç´¢å¼•å’Œè·³è¿‡å¤§é‡è®°å½•å¯èƒ½æ¯”ç›´æ¥å…¨è¡¨æ‰«ææ›´è€—è´¹èµ„æºã€‚ MySQL çš„æŸ¥è¯¢ä¼˜åŒ–å™¨é‡‡ç”¨åŸºäºæˆæœ¬çš„ç­–ç•¥æ¥é€‰æ‹©æœ€ä¼˜çš„æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ã€‚å®ƒä¼šæ ¹æ® CPU å’Œ I&#x2F;O çš„æˆæœ¬æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç´¢å¼•æ‰«ææˆ–å…¨è¡¨æ‰«æã€‚å¦‚æœä¼˜åŒ–å™¨è®¤ä¸ºå…¨è¡¨æ‰«æçš„æˆæœ¬æ›´ä½ï¼Œå®ƒå°±ä¼šæ”¾å¼ƒä½¿ç”¨ç´¢å¼•ã€‚ä¸è¿‡ï¼Œå³ä½¿åç§»é‡å¾ˆå¤§ï¼Œå¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆcovering indexï¼‰ï¼ŒMySQL ä»ç„¶å¯èƒ½ä¼šä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å›è¡¨æ“ä½œã€‚ æ·±åº¦åˆ†é¡µè§£å†³æ‰‹æ®µ 8.å†…å­˜1.BufferPoolè¿™ä¸ªç¼“å†²æ± æ˜¯å­˜å‚¨å¼•æ“çš„ç¼“å†²æ± ã€‚MySQLçš„serverä¹Ÿæœ‰ä¸€ä¸ªç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è‡ªå¸¦çš„ç¼“å­˜ï¼Œé‚£ä¸ªç¼“å­˜å¯ä»¥å¯¹æŸ¥è¯¢è¯­å¥åšå“ˆå¸Œï¼Œç„¶åä»¥key-valueçš„å½¢å¼å­˜å‚¨æŸ¥æ‰¾ç»“æœï¼Œå½“æŸ¥æ‰¾è¯­å¥å®Œå…¨å‘½ä¸­ï¼ˆå¿…é¡»ä¸€æ¨¡ä¸€æ ·ï¼‰ï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»“æœé›†ï¼Œä¸è¿‡è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒé¸¡è‚‹ï¼Œåé¢å°±åœæ­¢äº†ã€‚ è™½ç„¶è¯´ MySQLçš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ç£ç›˜é‡Œçš„ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½æ¯æ¬¡éƒ½ä»ç£ç›˜é‡Œé¢è¯»å–æ•°æ®ï¼Œè¿™æ ·æ€§èƒ½æ˜¯æå·®çš„ã€‚ è¦æƒ³æå‡æŸ¥è¯¢æ€§èƒ½ï¼ŒåŠ ä¸ªç¼“å­˜å°±è¡Œäº†å˜›ã€‚æ‰€ä»¥ï¼Œå½“æ•°æ®ä»ç£ç›˜ä¸­å–å‡ºåï¼Œç¼“å­˜å†…å­˜ä¸­ï¼Œä¸‹æ¬¡æŸ¥è¯¢åŒæ ·çš„æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜ä¸­è¯»å–ã€‚ ä¸ºæ­¤ï¼ŒInnodb å­˜å‚¨å¼•æ“è®¾è®¡äº†ä¸€ä¸ªç¼“å†²æ± (Buffer Pool)æ¥æé«˜æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚ æœ‰äº†ç¼“å†²æ± å: å½“è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äº Bufer Pool ä¸­ï¼Œå®¢æˆ·ç«¯å°±ä¼šç›´æ¥è¯»å– Buffer Pool ä¸­çš„æ•°æ®ï¼Œå¦åˆ™å†å»ç£ç›˜ä¸­è¯»å–ã€‚ å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œé¦–å…ˆæ˜¯ä¿®æ”¹ Buffer Pool ä¸­æ•°æ®æ‰€åœ¨çš„é¡µï¼Œç„¶åå°†å…¶é¡µè®¾ç½®ä¸ºè„é¡µï¼Œæœ€åç”±åå°çº¿ç¨‹å°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"Mysql","slug":"Mysql","permalink":"http://example.com/tags/Mysql/"}]},{"title":"æ¡†æ¶","slug":"å…«è‚¡/æ¡†æ¶","date":"2024-10-28T12:14:40.000Z","updated":"2025-03-11T08:07:31.983Z","comments":true,"path":"2024/10/28/å…«è‚¡/æ¡†æ¶/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/%E6%A1%86%E6%9E%B6/","excerpt":"è¿™é‡Œæ˜¯æœ‰å…³æ¡†æ¶çš„å…«è‚¡","text":"è¿™é‡Œæ˜¯æœ‰å…³æ¡†æ¶çš„å…«è‚¡ 1.SpringSpring æ˜¯ä¸€ä¸ªè½»é‡çº§ã€éå…¥ä¾µå¼çš„æ§åˆ¶åè½¬ (IoC) å’Œé¢å‘åˆ‡é¢ (AOP) çš„æ¡†æ¶ã€‚ 1ã€Springç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ å·¥å‚æ¨¡å¼ï¼šBeanFactoryå°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å®ä¾‹ï¼› å•ä¾‹æ¨¡å¼ï¼šBeané»˜è®¤ä¸ºå•ä¾‹æ¨¡å¼ã€‚ ä»£ç†æ¨¡å¼ï¼šSpringçš„AOPåŠŸèƒ½ç”¨åˆ°äº†JDKçš„åŠ¨æ€ä»£ç†å’ŒCGLIBå­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ï¼› æ¨¡æ¿æ¨¡å¼ï¼šç”¨æ¥è§£å†³ä»£ç é‡å¤çš„é—®é¢˜ã€‚æ¯”å¦‚. RestTemplate, JmsTemplate, JpaTemplateã€‚ è§‚å¯Ÿè€…æ¨¡å¼ï¼šå®šä¹‰å¯¹è±¡é”®ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥è¢«åˆ¶åŠ¨æ›´æ–°ï¼Œå¦‚Springä¸­listenerçš„å®ç°â€“ApplicationListenerã€‚ 2ã€Springçš„åŸºæœ¬ç‰¹æ€§ IoCå®¹å™¨ AOP äº‹åŠ¡ç®¡ç† ï¼šSpringæä¾›äº†ä¸€è‡´çš„äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œæ”¯æŒå£°æ˜å¼å’Œç¼–ç¨‹å¼äº‹åŠ¡ã€‚ å¼€å‘è€…å¯ä»¥è½»æ¾åœ°è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œè€Œæ— éœ€å…³å¿ƒå…·ä½“çš„äº‹åŠ¡APIã€‚ MVCæ¡†æ¶ï¼š Spring MVCæ˜¯ä¸€ä¸ªåŸºäºServlet APIæ„å»ºçš„Webæ¡†æ¶ï¼Œ é‡‡ç”¨äº†æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¶æ„ã€‚ 1.IOCIOC(lnversion Of Controllï¼Œæ§åˆ¶åè½¬)æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”±ç»™Springæ¡†æ¶æ¥ç®¡ç†ã€‚ IOC è´Ÿè´£åˆ›å»ºå¯¹è±¡ï¼Œç®¡ç†å¯¹è±¡ï¼ˆé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼Œè£…é…å¯¹è±¡ï¼Œé…ç½®å¯¹è±¡ï¼Œå¹¶ä¸”ç®¡ç†è¿™äº›å¯¹è±¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ª Mapï¼ˆkeyï¼Œvalueï¼‰ï¼ŒMap ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚ Spring ä¸­çš„ IoC çš„å®ç°åŸç†å°±æ˜¯å·¥å‚æ¨¡å¼åŠ åå°„æœºåˆ¶ã€‚ ä¾èµ–æ³¨å…¥ï¼šä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ°æ°ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§å…·ä½“çš„ç¼–ç æŠ€å·§ã€‚æˆ‘ä»¬ä¸é€šè¿‡ new çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’(æˆ–æ³¨å…¥)ç»™ç±»æ¥ä½¿ç”¨ã€‚ ä»€ä¹ˆæ˜¯Spring Beanï¼Ÿ ç®€å•æ¥è¯´ï¼ŒBean ä»£æŒ‡çš„å°±æ˜¯é‚£äº›è¢« IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚ æˆ‘ä»¬éœ€è¦å‘Šè¯‰ IoC å®¹å™¨å¸®åŠ©æˆ‘ä»¬ç®¡ç†å“ªäº›å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥å®šä¹‰çš„ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯ XML æ–‡ä»¶ã€æ³¨è§£æˆ–è€… Java é…ç½®ç±»ã€‚ 2.@Resourceå’Œ@Autowired çš„åŒºåˆ«è¿™ä¸¤ä¸ªéƒ½æ˜¯æ³¨å…¥Beançš„æ³¨è§£ éƒ½æ˜¯ç”¨æ¥è‡ªåŠ¨è£…é…çš„ï¼Œéƒ½å¯ä»¥æ”¾åœ¨å±æ€§çš„å­—æ®µä¸Š @Autowiredï¼š æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼Œ é»˜è®¤é€šè¿‡ byTypeï¼ˆæ ¹æ®ç±»å‹åŒ¹é…ï¼‰çš„æ–¹å¼æ³¨å…¥ï¼Œè€Œä¸”å¿…é¡»è¦æ±‚è¿™ä¸ªå¯¹è±¡å­˜åœ¨! @Resourceï¼šæ˜¯ JDK æä¾›çš„æ³¨è§£ï¼Œé»˜è®¤é€šè¿‡ byNameï¼ˆæ ¹æ®åç§°è¿›è¡ŒåŒ¹é…ï¼‰çš„æ–¹å¼å®ç°ï¼Œå¦‚æœæ‰¾ä¸åˆ°åå­—ï¼Œåˆ™é€šè¿‡ byTypeæ³¨å…¥ @Resource æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦ä¸”æ—¥å¸¸å¼€å‘å¸¸ç”¨çš„å±æ€§ï¼šnameï¼ˆåç§°ï¼‰ã€typeï¼ˆç±»å‹ï¼‰ã€‚ å½“ä¸€ä¸ªæ¥å£å­˜åœ¨å¤šä¸ªå®ç°ç±»çš„æƒ…å†µä¸‹ï¼Œ@Autowired å’Œ@Resourceéƒ½éœ€è¦é€šè¿‡åç§°æ‰èƒ½æ­£ç¡®åŒ¹é…åˆ°å¯¹åº”çš„Beanã€‚Autowired å¯ä»¥é€šè¿‡ @Qualifier æ³¨è§£æ¥æ˜¾å¼æŒ‡å®šåç§°ï¼Œ@Resourceå¯ä»¥é€šè¿‡ name å±æ€§æ¥æ˜¾å¼æŒ‡å®šåç§°ã€‚ 3.æ³¨å…¥Beançš„æ–¹å¼ä¾èµ–æ³¨å…¥ (Dependency Injection, DI) çš„å¸¸è§æ–¹å¼ï¼š æ„é€ å‡½æ•°æ³¨å…¥ï¼šé€šè¿‡ç±»çš„æ„é€ å‡½æ•°æ¥æ³¨å…¥ä¾èµ–é¡¹ã€‚ Setter æ³¨å…¥ï¼šé€šè¿‡ç±»çš„ Setter æ–¹æ³•æ¥æ³¨å…¥ä¾èµ–é¡¹ã€‚ Fieldï¼ˆå­—æ®µï¼‰ æ³¨å…¥ï¼šç›´æ¥åœ¨ç±»çš„å­—æ®µä¸Šä½¿ç”¨æ³¨è§£ï¼ˆå¦‚ @Autowired æˆ– @Resourceï¼‰æ¥æ³¨å…¥ä¾èµ–é¡¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536371ã€æ„é€ å‡½æ•°æ³¨å…¥@Servicepublic class UserService &#123; private final UserRepository userRepository; public UserService(UserRepository userRepository) &#123; this.userRepository = userRepository; &#125; //...&#125;2ã€Setteræ³¨å…¥@Servicepublic class UserService &#123; private UserRepository userRepository; // åœ¨ Spring 4.3 åŠä»¥åçš„ç‰ˆæœ¬ï¼Œç‰¹å®šæƒ…å†µä¸‹ @Autowired å¯ä»¥çœç•¥ä¸å†™ @Autowired public void setUserRepository(UserRepository userRepository) &#123; this.userRepository = userRepository; &#125; //...&#125;3ã€å­—æ®µæ³¨å…¥@Servicepublic class UserService &#123; @Autowired private UserRepository userRepository; //...&#125; æ„é€ å™¨æ³¨å…¥ï¼šæ¨èä½¿ç”¨çš„æ–¹å¼ï¼Œé€‚ç”¨äºæ‰€æœ‰å¿…éœ€çš„ä¾èµ–é¡¹ï¼Œç¡®ä¿ä¾èµ–é¡¹åœ¨å¯¹è±¡åˆ›å»ºæ—¶å·²è¢«æ³¨å…¥ã€‚æ„é€ å‡½æ•°æ³¨å…¥é€‚åˆå¤„ç†å¿…éœ€çš„ä¾èµ–é¡¹ Setter æ³¨å…¥ï¼šé€‚ç”¨äºå¯é€‰çš„ä¾èµ–é¡¹ï¼Œçµæ´»æ€§è¾ƒé«˜ï¼Œä½†ä¸å¦‚æ„é€ å™¨æ³¨å…¥å®‰å…¨ã€‚ Setter æ³¨å…¥ åˆ™æ›´é€‚åˆå¯é€‰çš„ä¾èµ–é¡¹ï¼Œè¿™äº›ä¾èµ–é¡¹å¯ä»¥æœ‰é»˜è®¤å€¼æˆ–åœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸­åŠ¨æ€è®¾ç½®ã€‚ å­—æ®µæ³¨å…¥ï¼šæœ€ç®€æ´çš„æ–¹å¼ï¼Œé€‚ç”¨äºå°é¡¹ç›®æˆ–å¿«é€Ÿå¼€å‘ï¼Œä½†ä¸æ¨èç”¨äºå¤§è§„æ¨¡é¡¹ç›®ï¼Œå› å…¶å¯ç»´æŠ¤æ€§å·®ã€‚ 4.Beançš„ä½œç”¨åŸŸé‡ç‚¹å…³æ³¨å‰ä¸¤ç§ singleton : IoC å®¹å™¨ä¸­åªæœ‰å”¯ä¸€çš„ bean å®ä¾‹ã€‚Spring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¯¹å•ä¾‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨ã€‚ prototype : æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿ç»­ getBean() ä¸¤æ¬¡ï¼Œå¾—åˆ°çš„æ˜¯ä¸åŒçš„ Bean å®ä¾‹ã€‚ request ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰: æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆè¯·æ±‚ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚ session ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ : æ¯ä¸€æ¬¡æ¥è‡ªæ–° session çš„ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆä¼šè¯ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚ application&#x2F;global-session ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸ª Web åº”ç”¨åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ª Beanï¼ˆåº”ç”¨ Beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰åº”ç”¨å¯åŠ¨æ—¶é—´å†…æœ‰æ•ˆã€‚ websocket ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸€æ¬¡ WebSocket ä¼šè¯äº§ç”Ÿä¸€ä¸ªæ–°çš„ beanã€‚ 5ã€Beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—æ€»ç»“ï¼šé»˜è®¤singletonä½œç”¨åŸŸä¸‹æ˜¯å•ä¾‹çš„ï¼Œä½†å¦‚æœbeanæ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¯èƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¦‚æœæ˜¯prototypeä½œç”¨åŸŸï¼Œä¸æ˜¯å•ä¾‹çš„ï¼Œæ¯æ¬¡è·å–çš„Beanä¸åŒï¼Œä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ Spring æ¡†æ¶ä¸­çš„ Bean æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Œå–å†³äºå…¶ä½œç”¨åŸŸå’ŒçŠ¶æ€ã€‚ æˆ‘ä»¬è¿™é‡Œä»¥æœ€å¸¸ç”¨çš„ä¸¤ç§ä½œç”¨åŸŸ prototype å’Œ singleton ä¸ºä¾‹ä»‹ç»ã€‚å‡ ä¹æ‰€æœ‰åœºæ™¯çš„ Bean ä½œç”¨åŸŸéƒ½æ˜¯ä½¿ç”¨é»˜è®¤çš„ singleton ï¼Œé‡ç‚¹å…³æ³¨ singleton ä½œç”¨åŸŸå³å¯ã€‚ prototype ä½œç”¨åŸŸä¸‹ï¼Œæ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ï¼Œä¸å­˜åœ¨èµ„æºç«äº‰é—®é¢˜ï¼Œæ‰€ä»¥ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚singleton ä½œç”¨åŸŸä¸‹ï¼ŒIoC å®¹å™¨ä¸­åªæœ‰å”¯ä¸€çš„ bean å®ä¾‹ï¼Œå¯èƒ½ä¼šå­˜åœ¨èµ„æºç«äº‰é—®é¢˜ï¼ˆå–å†³äº Bean æ˜¯å¦æœ‰çŠ¶æ€ï¼‰ã€‚å¦‚æœè¿™ä¸ª bean æ˜¯æœ‰çŠ¶æ€çš„è¯ï¼Œé‚£å°±å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆæœ‰çŠ¶æ€ Bean æ˜¯æŒ‡åŒ…å«å¯å˜çš„æˆå‘˜å˜é‡çš„å¯¹è±¡ï¼‰ã€‚ æœ‰çŠ¶æ€ Bean ç¤ºä¾‹ï¼š 12345678910111213// å®šä¹‰äº†ä¸€ä¸ªè´­ç‰©è½¦ç±»ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¿å­˜ç”¨æˆ·çš„è´­ç‰©è½¦é‡Œå•†å“çš„ List@Componentpublic class ShoppingCart &#123; private List&lt;String&gt; items = new ArrayList&lt;&gt;(); public void addItem(String item) &#123; items.add(item); &#125; public List&lt;String&gt; getItems() &#123; return items; &#125;&#125; ä¸è¿‡ï¼Œå¤§éƒ¨åˆ† Bean å®é™…éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆæ²¡æœ‰å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ï¼‰çš„ï¼ˆæ¯”å¦‚ Daoã€Serviceï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å¯¹äºæœ‰çŠ¶æ€å•ä¾‹ Bean çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¸¸è§çš„ä¸‰ç§è§£å†³åŠæ³•æ˜¯ï¼š é¿å…å¯å˜æˆå‘˜å˜é‡: å°½é‡è®¾è®¡ Bean ä¸ºæ— çŠ¶æ€ã€‚ ä½¿ç”¨ThreadLocal: å°†å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal ä¸­ï¼Œç¡®ä¿çº¿ç¨‹ç‹¬ç«‹ã€‚ ä½¿ç”¨åŒæ­¥æœºåˆ¶: åˆ©ç”¨ synchronized æˆ– ReentrantLock æ¥è¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚ â€‹ 6ã€spring bean çš„ç”Ÿå‘½å‘¨æœŸæ¦‚æ‹¬ï¼šå®ä¾‹åŒ– â€”&gt; å±æ€§èµ‹å€¼ â€”&gt; åˆå§‹åŒ– â€”&gt; é”€æ¯ å®ä¾‹åŒ–ï¼šå®ä¾‹åŒ–ä¸€ä¸ª bean å¯¹è±¡ï¼›Bean å®¹å™¨é¦–å…ˆä¼šæ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­çš„ Bean å®šä¹‰ï¼Œç„¶åä½¿ç”¨ Java åå°„ API æ¥åˆ›å»º Bean çš„å®ä¾‹ã€‚ å±æ€§èµ‹å€¼ï¼šä¸º Bean è®¾ç½®ç›¸å…³å±æ€§å’Œä¾èµ–ï¼Œä¾‹å¦‚@Autowired ç­‰æ³¨è§£æ³¨å…¥çš„å¯¹è±¡ã€@Value æ³¨å…¥çš„å€¼ã€setteræ–¹æ³•æˆ–æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–å’Œå€¼ã€@Resourceæ³¨å…¥çš„å„ç§èµ„æºã€‚ åˆå§‹åŒ–ï¼šç¬¬ 3~7 æ­¥ï¼Œæ­¥éª¤è¾ƒå¤šï¼Œå…¶ä¸­ç¬¬ 5ã€6 æ­¥ä¸ºåˆå§‹åŒ–æ“ä½œï¼Œç¬¬ 3ã€4 æ­¥ä¸ºåœ¨åˆå§‹åŒ–å‰æ‰§è¡Œï¼Œç¬¬ 7 æ­¥åœ¨åˆå§‹åŒ–åæ‰§è¡Œï¼Œè¯¥é˜¶æ®µç»“æŸï¼Œæ‰èƒ½è¢«ç”¨æˆ·ä½¿ç”¨ï¼› Aware BeanNameAwareï¼šæ³¨å…¥å½“å‰ bean å¯¹åº” beanNameï¼› BeanClassLoaderAwareï¼šæ³¨å…¥åŠ è½½å½“å‰ bean çš„ ClassLoaderï¼› BeanFactoryAwareï¼šæ³¨å…¥ å½“å‰BeanFactoryå®¹å™¨ çš„å¼•ç”¨ã€‚ å¦‚æœ Bean å®ç°äº† BeanNameAware æ¥å£ï¼Œè°ƒç”¨ setBeanName()æ–¹æ³•ï¼Œä¼ å…¥ Bean çš„åå­—ã€‚ å¦‚æœ Bean å®ç°äº† BeanClassLoaderAware æ¥å£ï¼Œè°ƒç”¨ setBeanClassLoader()æ–¹æ³•ï¼Œä¼ å…¥ ClassLoaderå¯¹è±¡çš„å®ä¾‹ã€‚ å¦‚æœ Bean å®ç°äº† BeanFactoryAware æ¥å£ï¼Œè°ƒç”¨ setBeanFactory()æ–¹æ³•ï¼Œä¼ å…¥ BeanFactoryå¯¹è±¡çš„å®ä¾‹ã€‚ å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ BeanPostProcessor å¯¹è±¡ï¼Œæ‰§è¡ŒpostProcessBeforeInitialization() æ–¹æ³• å¦‚æœ Bean å®ç°äº†InitializingBeanæ¥å£ï¼Œæ‰§è¡ŒafterPropertiesSet()æ–¹æ³•ã€‚ å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« init-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚ å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ BeanPostProcessor å¯¹è±¡ï¼Œæ‰§è¡ŒpostProcessAfterInitialization() æ–¹æ³•ã€‚ é”€æ¯ï¼šç¬¬ 8~10æ­¥ï¼Œç¬¬8æ­¥ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„é”€æ¯ï¼ˆè¿˜æ²¡ä½¿ç”¨å‘¢ï¼‰ï¼Œè€Œæ˜¯å…ˆåœ¨ä½¿ç”¨å‰æ³¨å†Œäº†é”€æ¯çš„ç›¸å…³è°ƒç”¨æ¥å£ï¼Œä¸ºäº†åé¢ç¬¬9ã€10æ­¥çœŸæ­£é”€æ¯ bean æ—¶å†æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ã€‚ å¦‚æœ Bean å®ç°äº† DisposableBean æ¥å£ï¼Œæ‰§è¡Œ destroy() æ–¹æ³•ã€‚ å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« destroy-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„ Bean é”€æ¯æ–¹æ³•ã€‚ å¦‚æœæƒ³åœ¨BeanåŠ è½½&#x2F;é”€æ¯å‰åï¼Œå®ç°æŸäº›é€»è¾‘ï¼Œå¯ä»¥åœ¨Beanä¸­å®ç°init-methodå’Œdestory-method è®°å¿†ï¼š åˆå§‹åŒ–è¿™ä¸€æ­¥æ¶‰åŠåˆ°çš„æ­¥éª¤æ¯”è¾ƒå¤šï¼ŒåŒ…å« Aware æ¥å£çš„ä¾èµ–æ³¨å…¥ã€BeanPostProcessor åœ¨åˆå§‹åŒ–å‰åçš„å¤„ç†ä»¥åŠ InitializingBean å’Œ init-method çš„åˆå§‹åŒ–æ“ä½œã€‚ é”€æ¯è¿™ä¸€æ­¥ä¼šæ³¨å†Œç›¸å…³é”€æ¯å›è°ƒæ¥å£ï¼Œæœ€åé€šè¿‡DisposableBean å’Œ destory-method è¿›è¡Œé”€æ¯ã€‚ 7ã€å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªSpringIocï¼Œä½ è§‰å¾—ä¼šä»å“ªäº›æ–¹é¢è€ƒè™‘è¿™ä¸ªè®¾è®¡ï¼Ÿ Beançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†:éœ€è¦è®¾è®¡Beançš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å·¥å‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚ ä¾èµ–æ³¨å…¥:éœ€è¦å®ç°ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å±æ€§æ³¨å…¥ã€æ„é€ å‡½æ•°æ³¨å…¥ã€æ–¹æ³•æ³¨å…¥ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åå°„æœºåˆ¶å’ŒXMLé…ç½®æ–‡ä»¶æ¥å®ç°ã€‚ Beançš„ä½œç”¨åŸŸ:éœ€è¦æ”¯æŒå¤šç§Beanä½œç”¨åŸŸï¼Œæ¯”å¦‚å•ä¾‹ã€åŸå‹ã€ä¼šè¯ã€è¯·æ±‚ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Mapæ¥å­˜è¯¸ä¸åŒä½œç”¨åŸŸçš„Beanå®ä¾‹ã€‚ AOPåŠŸèƒ½çš„æ”¯æŒ:éœ€è¦æ”¯æŒAOPåŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶å’Œåˆ‡é¢ç¼–ç¨‹æ¥å®ç°ã€‚ å¼‚å¸¸å¤„ç†:éœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬Beanåˆ›å»ºå¼‚å¸¸ã€ä¾èµ–æ³¨å…¥å¼‚å¸¸ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨try-catchæœºåˆ¶æ¥å¤„ç†å¼‚å¸¸ã€‚ é…ç½®æ–‡ä»¶åŠ è½½:éœ€è¦æ”¯æŒä»ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­åŠ è½½Beançš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨XMLã€æ³¨è§£æˆ–è€…Javaé…ç½®ç±»æ¥å®ç°ã€‚ 7.AOPAOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ SpringAOPçš„å®ç°åŸç†ï¼š Spring AOP å°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆ Spring AOP ä¼šä½¿ç”¨ JDK Proxyï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œè¿™æ—¶å€™ Spring AOP ä¼šä½¿ç”¨ Cglib ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç† Spring AOP å’Œ AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œè€Œ AspectJ AOPæ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚ Spring AOP åŸºäºä»£ç†(Proxying)ï¼Œè€Œ AspectJ åŸºäºå­—èŠ‚ç æ“ä½œ(Bytecode Manipulation)ã€‚ Spring AOP å·²ç»é›†æˆäº† AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚AspectJ ç›¸æ¯”äº Spring AOP åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä½†æ˜¯ Spring AOP ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œ å¦‚æœæˆ‘ä»¬çš„åˆ‡é¢æ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆä¸¤è€…æ€§èƒ½å·®å¼‚ä¸å¤§ã€‚ä½†æ˜¯ï¼Œå½“åˆ‡é¢å¤ªå¤šçš„è¯ï¼Œæœ€å¥½é€‰æ‹© AspectJ ï¼Œå®ƒæ¯” Spring AOP å¿«å¾ˆå¤šã€‚ æœ¯è¯­ï¼š æœ¯è¯­ å«ä¹‰ ç›®æ ‡(Target) è¢«é€šçŸ¥çš„å¯¹è±¡ ä»£ç†(Proxy) å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ è¿æ¥ç‚¹(JoinPoint) ç›®æ ‡å¯¹è±¡çš„æ‰€å±ç±»ä¸­ï¼Œå®šä¹‰çš„æ‰€æœ‰æ–¹æ³•å‡ä¸ºè¿æ¥ç‚¹ åˆ‡å…¥ç‚¹(Pointcut) è¢«åˆ‡é¢æ‹¦æˆª &#x2F; å¢å¼ºçš„è¿æ¥ç‚¹ï¼ˆåˆ‡å…¥ç‚¹ä¸€å®šæ˜¯è¿æ¥ç‚¹ï¼Œè¿æ¥ç‚¹ä¸ä¸€å®šæ˜¯åˆ‡å…¥ç‚¹ï¼‰ é€šçŸ¥(Advice) å¢å¼ºçš„é€»è¾‘ &#x2F; ä»£ç ï¼Œä¹Ÿå³æ‹¦æˆªåˆ°ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¹‹åè¦åšçš„äº‹æƒ… åˆ‡é¢(Aspect) åˆ‡å…¥ç‚¹(Pointcut)+é€šçŸ¥(Advice) Weaving(ç»‡å…¥) å°†é€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡ï¼Œè¿›è€Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹åŠ¨ä½œ 8.AOPé€šçŸ¥çš„ç±»å‹ é€šçŸ¥åˆ†ç±»ï¼š Beforeï¼ˆå‰ç½®é€šçŸ¥ï¼‰ï¼šé€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œ After ï¼ˆåç½®é€šçŸ¥ï¼‰ï¼šé€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•è¿”å›æˆ–å¼‚å¸¸åæ‰§è¡Œ AfterReturningï¼ˆè¿”å›é€šçŸ¥ï¼‰ï¼šé€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›åè°ƒç”¨ AfterThrowingï¼ˆå¼‚å¸¸é€šçŸ¥ï¼‰ï¼šé€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨ Around ï¼ˆç¯ç»•é€šçŸ¥ï¼‰ï¼šé€šçŸ¥æ–¹æ³•ä¼šå°†ç›®æ ‡æ–¹æ³•å°è£…èµ·æ¥ SpringAOPç»‡å…¥æ—¶æœŸï¼ˆTODOï¼‰ 9.springå¾ªç¯ä¾èµ–å¾ªç¯ä¾èµ–æ˜¯æŒ‡ Bean å¯¹è±¡å¾ªç¯å¼•ç”¨ï¼Œæ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ª Bean ä¹‹é—´ç›¸äº’æŒæœ‰å¯¹æ–¹çš„å¼•ç”¨ï¼Œä¾‹å¦‚ CircularDependencyA â†’ CircularDependencyB â†’ CircularDependencyAã€‚ 1234567891011@Componentpublic class CircularDependencyA &#123; @Autowired private CircularDependencyB circB;&#125;@Componentpublic class CircularDependencyB &#123; @Autowired private CircularDependencyA circA;&#125; Spring æ¡†æ¶é€šè¿‡ä½¿ç”¨ä¸‰çº§ç¼“å­˜æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¡®ä¿å³ä½¿åœ¨å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ­£ç¡®åˆ›å»º Beanã€‚ ä¸‰çº§ç¼“å­˜åˆ†åˆ«æ˜¯ä»€ä¹ˆ ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰ï¼šå­˜æ”¾æœ€ç»ˆå½¢æ€çš„ Beanï¼ˆå·²ç»å®ä¾‹åŒ–ã€å±æ€§å¡«å……ã€åˆå§‹åŒ–ï¼‰ï¼Œå•ä¾‹æ± ï¼Œä¸ºâ€œSpring çš„å•ä¾‹å±æ€§â€â½½â½£ã€‚ä¸€èˆ¬æƒ…å†µæˆ‘ä»¬è·å– Bean éƒ½æ˜¯ä»è¿™é‡Œè·å–çš„ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„ Bean éƒ½åœ¨å•ä¾‹æ± é‡Œé¢ï¼Œä¾‹å¦‚åŸå‹ Bean å°±ä¸åœ¨é‡Œé¢ã€‚ äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰ï¼šå­˜æ”¾è¿‡æ¸¡ Beanï¼ˆåŠæˆå“ï¼Œå°šæœªå±æ€§å¡«å……ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸‰çº§ç¼“å­˜ä¸­ObjectFactoryäº§ç”Ÿçš„å¯¹è±¡ï¼Œä¸ä¸‰çº§ç¼“å­˜é…åˆä½¿ç”¨çš„ï¼Œå¯ä»¥é˜²æ­¢ AOP çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è°ƒç”¨ObjectFactory#getObject()éƒ½æ˜¯ä¼šäº§ç”Ÿæ–°çš„ä»£ç†å¯¹è±¡çš„ã€‚ ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰ï¼šå­˜æ”¾ObjectFactoryï¼ŒObjectFactoryçš„getObject()æ–¹æ³•ï¼ˆæœ€ç»ˆè°ƒç”¨çš„æ˜¯getEarlyBeanReference()æ–¹æ³•ï¼‰å¯ä»¥ç”ŸæˆåŸå§‹ Bean å¯¹è±¡æˆ–è€…ä»£ç†å¯¹è±¡ï¼ˆå¦‚æœ Bean è¢« AOP åˆ‡é¢ä»£ç†ï¼‰ã€‚ä¸‰çº§ç¼“å­˜åªä¼šå¯¹å•ä¾‹ Bean ç”Ÿæ•ˆã€‚ Spring åˆ›å»º Bean çš„æµç¨‹ å…ˆå» ä¸€çº§ç¼“å­˜ singletonObjects ä¸­è·å–ï¼Œå­˜åœ¨å°±è¿”å›ï¼› å¦‚æœä¸å­˜åœ¨æˆ–è€…å¯¹è±¡æ­£åœ¨åˆ›å»ºä¸­ï¼Œäºæ˜¯å» äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸­è·å–ï¼› å¦‚æœè¿˜æ²¡æœ‰è·å–åˆ°ï¼Œå°±å» ä¸‰çº§ç¼“å­˜ singletonFactories ä¸­è·å–ï¼Œé€šè¿‡æ‰§è¡Œ ObjectFacotry çš„ getObject() å°±å¯ä»¥è·å–è¯¥å¯¹è±¡ï¼Œè·å–æˆåŠŸä¹‹åï¼Œä»ä¸‰çº§ç¼“å­˜ç§»é™¤ï¼Œå¹¶å°†è¯¥å¯¹è±¡åŠ å…¥åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚ ä¸¾ä¾‹ 12345678class A &#123; // ä½¿ç”¨äº† B private B b;&#125;class B &#123; // ä½¿ç”¨äº† A private A a;&#125; å½“ Spring åˆ›å»º A ä¹‹åï¼Œå‘ç° A ä¾èµ–äº† B ï¼Œåˆå»åˆ›å»º Bï¼ŒB ä¾èµ–äº† A ï¼Œåˆå»åˆ›å»º Aï¼› åœ¨ B åˆ›å»º A çš„æ—¶å€™ï¼Œé‚£ä¹ˆæ­¤æ—¶ A å°±å‘ç”Ÿäº†å¾ªç¯ä¾èµ–ï¼Œç”±äº A æ­¤æ—¶è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼Œå› æ­¤åœ¨ ä¸€äºŒçº§ç¼“å­˜ ä¸­è‚¯å®šæ²¡æœ‰ Aï¼› é‚£ä¹ˆæ­¤æ—¶å°±å»ä¸‰çº§ç¼“å­˜ä¸­è°ƒç”¨ getObject() æ–¹æ³•å»è·å– A çš„ å‰æœŸæš´éœ²çš„å¯¹è±¡ ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸Šè¾¹åŠ å…¥çš„ getEarlyBeanReference() æ–¹æ³•ï¼Œç”Ÿæˆä¸€ä¸ª A çš„ å‰æœŸæš´éœ²å¯¹è±¡ï¼› ç„¶åå°±å°†è¿™ä¸ª ObjectFactory ä»ä¸‰çº§ç¼“å­˜ä¸­ç§»é™¤ï¼Œå¹¶ä¸”å°†å‰æœŸæš´éœ²å¯¹è±¡æ”¾å…¥åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆ B å°±å°†è¿™ä¸ªå‰æœŸæš´éœ²å¯¹è±¡æ³¨å…¥åˆ°ä¾èµ–ï¼Œæ¥æ”¯æŒå¾ªç¯ä¾èµ–ã€‚ åªç”¨ä¸¤çº§ç¼“å­˜å¤Ÿå—ï¼Ÿ åœ¨æ²¡æœ‰ AOP çš„æƒ…å†µä¸‹ï¼Œç¡®å®å¯ä»¥åªä½¿ç”¨ä¸€çº§å’Œä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå½“æ¶‰åŠåˆ° AOP æ—¶ï¼ŒäºŒçº§ç¼“å­˜å°±æ˜¾å¾—éå¸¸é‡è¦äº†ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†å³ä½¿åœ¨ Bean çš„åˆ›å»ºè¿‡ç¨‹ä¸­æœ‰å¤šæ¬¡å¯¹æ—©æœŸå¼•ç”¨çš„è¯·æ±‚ï¼Œä¹Ÿå§‹ç»ˆåªè¿”å›åŒä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä»è€Œé¿å…äº†åŒä¸€ä¸ª Bean æœ‰å¤šä¸ªä»£ç†å¯¹è±¡çš„é—®é¢˜ã€‚ æ€»ç»“ä¸€ä¸‹ Spring å¦‚ä½•è§£å†³ä¸‰çº§ç¼“å­˜ï¼š åœ¨ä¸‰çº§ç¼“å­˜è¿™ä¸€å—ï¼Œä¸»è¦è®°ä¸€ä¸‹ Spring æ˜¯å¦‚ä½•æ”¯æŒå¾ªç¯ä¾èµ–çš„å³å¯ï¼Œä¹Ÿå°±æ˜¯å¦‚æœå‘ç”Ÿå¾ªç¯ä¾èµ–çš„è¯ï¼Œå°±å» ä¸‰çº§ç¼“å­˜ singletonFactories ä¸­æ‹¿åˆ°ä¸‰çº§ç¼“å­˜ä¸­å­˜å‚¨çš„ ObjectFactory å¹¶è°ƒç”¨å®ƒçš„ getObject() æ–¹æ³•æ¥è·å–è¿™ä¸ªå¾ªç¯ä¾èµ–å¯¹è±¡çš„å‰æœŸæš´éœ²å¯¹è±¡ï¼ˆè™½ç„¶è¿˜æ²¡åˆå§‹åŒ–å®Œæˆï¼Œä½†æ˜¯å¯ä»¥æ‹¿åˆ°è¯¥å¯¹è±¡åœ¨å †ä¸­çš„å­˜å‚¨åœ°å€äº†ï¼‰ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå‰æœŸæš´éœ²å¯¹è±¡æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼Œè¿™æ ·åœ¨å¾ªç¯ä¾èµ–æ—¶ï¼Œå°±ä¸ä¼šé‡å¤åˆå§‹åŒ–äº†ï¼ ä¸è¿‡ï¼Œè¿™ç§æœºåˆ¶ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚å¢åŠ äº†å†…å­˜å¼€é”€ï¼ˆéœ€è¦ç»´æŠ¤ä¸‰çº§ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ª Mapï¼‰ï¼Œé™ä½äº†æ€§èƒ½ï¼ˆéœ€è¦è¿›è¡Œå¤šæ¬¡æ£€æŸ¥å’Œè½¬æ¢ï¼‰ã€‚å¹¶ä¸”ï¼Œè¿˜æœ‰å°‘éƒ¨åˆ†æƒ…å†µæ˜¯ä¸æ”¯æŒå¾ªç¯ä¾èµ–çš„ï¼Œæ¯”å¦‚éå•ä¾‹çš„ bean å’Œ@Asyncæ³¨è§£çš„ bean æ— æ³•æ”¯æŒå¾ªç¯ä¾èµ–ã€‚ 10.Springä¸­ç®¡ç†äº‹åŠ¡çš„æ–¹å¼ç¼–ç¨‹å¼äº‹åŠ¡ï¼šåœ¨ä»£ç ä¸­ç¡¬ç¼–ç (åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¨èä½¿ç”¨) : é€šè¿‡ TransactionTemplateæˆ–è€… TransactionManager æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œäº‹åŠ¡èŒƒå›´è¿‡å¤§ä¼šå‡ºç°äº‹åŠ¡æœªæäº¤å¯¼è‡´è¶…æ—¶ï¼Œå› æ­¤äº‹åŠ¡è¦æ¯”é”çš„ç²’åº¦æ›´å°ã€‚ å£°æ˜å¼äº‹åŠ¡ï¼šåœ¨ XML é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ–è€…ç›´æ¥åŸºäºæ³¨è§£ï¼ˆå•ä½“åº”ç”¨æˆ–è€…ç®€å•ä¸šåŠ¡ç³»ç»Ÿæ¨èä½¿ç”¨ï¼‰ : å®é™…æ˜¯é€šè¿‡ AOP å®ç°ï¼ˆåŸºäº@Transactional çš„å…¨æ³¨è§£æ–¹å¼ä½¿ç”¨æœ€å¤šï¼‰ å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ›´åŠ ç®€æ´ï¼Œé€‚åˆå¤§å¤šæ•°æƒ…å†µï¼›è€Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†åˆ™æä¾›äº†æ›´é«˜çš„çµæ´»æ€§ï¼Œé€‚ç”¨äºæ›´å¤æ‚çš„åœºæ™¯ã€‚é€‰æ‹©åˆé€‚çš„äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ 2ã€äº‹åŠ¡æ€ä¹ˆå¼€å¯åœ¨ Spring Boot ä¸­å¼€å¯äº‹åŠ¡éå¸¸ç®€å•ï¼Œåªéœ€åœ¨æœåŠ¡å±‚çš„æ–¹æ³•ä¸Šæ·»åŠ @Transactionalæ³¨è§£å³å¯ã€‚ 3ã€springçš„äº‹åŠ¡ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆSpringä¸­å¦‚ä½•é…ç½®ä¸€ä¸ªç±»åŠ è½½ä¸€ä¸ªç±»ä¸åŠ è½½ @Autowireå’Œ@ResourceåŒºåˆ« AOPä½¿ç”¨çš„ä»€ä¹ˆåŠ¨æ€ä»£ç†ï¼ŒAOPåŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°è¿‡ç¨‹ï¼Œè¯¦ç»†è¯´æ˜ SpringMVCMVCå…¨åæ˜¯Model View Controllerï¼Œæ˜¯æ¨¡å‹(model)ä¸€è§†å›¾(view)ä¸€æ§åˆ¶å™¨(controller)çš„ç¼©å†™ï¼Œä¸€ç§è½¯ä»¶è®¾è®¡å…¸èŒƒï¼Œç”¨ä¸€ç§ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€ç•Œé¢æ˜¾ç¤ºåˆ†ç¦»çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œå°†ä¸šåŠ¡é€»è¾‘èšé›†åˆ°ä¸€ä¸ªéƒ¨ä»¶é‡Œé¢ï¼Œåœ¨æ”¹è¿›å’Œä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢åŠç”¨æˆ·äº¤äº’çš„åŒæ—¶ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚ 1ã€æ ¸å¿ƒç»„ä»¶ DispatcherServletï¼šæ ¸å¿ƒçš„ä¸­å¤®å¤„ç†å™¨ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚ã€åˆ†å‘ï¼Œå¹¶ç»™äºˆå®¢æˆ·ç«¯å“åº”ã€‚ HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„å™¨ï¼Œæ ¹æ® URL å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ Handler ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ Handler ä¸€èµ·å°è£…ã€‚ HandlerAdapterï¼šå¤„ç†å™¨é€‚é…å™¨ï¼Œæ ¹æ® HandlerMapping æ‰¾åˆ°çš„ Handler ï¼Œé€‚é…æ‰§è¡Œå¯¹åº”çš„ Handlerï¼› Handlerï¼šè¯·æ±‚å¤„ç†å™¨ï¼Œå¤„ç†å®é™…è¯·æ±‚çš„å¤„ç†å™¨ã€‚ ViewResolverï¼šè§†å›¾è§£æå™¨ï¼Œæ ¹æ® Handler è¿”å›çš„é€»è¾‘è§†å›¾ &#x2F; è§†å›¾ï¼Œè§£æå¹¶æ¸²æŸ“çœŸæ­£çš„è§†å›¾ï¼Œå¹¶ä¼ é€’ç»™ DispatcherServlet å“åº”å®¢æˆ·ç«¯ 2ã€å·¥ä½œåŸç† å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œ DispatcherServletæ‹¦æˆªè¯·æ±‚ã€‚ DispatcherServlet æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ HandlerMapping ã€‚HandlerMapping æ ¹æ® URL å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ Handlerï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ Controller æ§åˆ¶å™¨ï¼‰ ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ Handler ä¸€èµ·å°è£…ã€‚ DispatcherServlet è°ƒç”¨ HandlerAdapteré€‚é…å™¨æ‰§è¡Œ Handler ã€‚ Handler å®Œæˆå¯¹ç”¨æˆ·è¯·æ±‚çš„å¤„ç†åï¼Œä¼šè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ç»™DispatcherServletï¼ŒModelAndView é¡¾åæ€ä¹‰ï¼ŒåŒ…å«äº†æ•°æ®æ¨¡å‹ä»¥åŠç›¸åº”çš„è§†å›¾çš„ä¿¡æ¯ã€‚Model æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡ï¼ŒView æ˜¯ä¸ªé€»è¾‘ä¸Šçš„ Viewã€‚ ViewResolver ä¼šæ ¹æ®é€»è¾‘ View æŸ¥æ‰¾å®é™…çš„ Viewã€‚ DispaterServlet æŠŠè¿”å›çš„ Model ä¼ ç»™ Viewï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚ æŠŠ View è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰ Mybatis1ã€Mybatisé‡Œçš„ # å’Œ $ çš„åŒºåˆ«ï¼Ÿ Mybatis åœ¨å¤„ç† #{} æ—¶ï¼Œä¼šåˆ›å»ºé¢„ç¼–è¯‘çš„ SQL è¯­å¥ï¼Œå°† SQL ä¸­çš„ #{} æ›¿æ¢ä¸º ? å·ï¼Œåœ¨æ‰§è¡Œ SQL æ—¶ä¼šä¸ºé¢„ç¼–è¯‘ SQL ä¸­çš„å ä½ç¬¦ï¼ˆ?ï¼‰èµ‹å€¼ï¼Œé¢„ç¼–è¯‘çš„ SQL è¯­å¥æ‰§è¡Œæ•ˆç‡é«˜ï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢SQL æ³¨å…¥ Mybatis åœ¨å¤„ç† ${} æ—¶ï¼Œåªæ˜¯åˆ›å»ºæ™®é€šçš„ SQL è¯­å¥ï¼Œç„¶ååœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ MyBatis å°†å‚æ•°ç›´æ¥æ‹¼å…¥åˆ° SQL é‡Œï¼Œä¸èƒ½é˜²æ­¢ SQL æ³¨å…¥ sqlæ³¨å…¥ï¼š å‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„ç™»å½•è¡¨å•ï¼Œå…¶åç«¯éªŒè¯ç”¨æˆ·åå’Œå¯†ç çš„SQLæŸ¥è¯¢å¦‚ä¸‹ï¼š sql 1SELECT * FROM users WHERE username = &#x27;è¾“å…¥çš„ç”¨æˆ·å&#x27; AND password = &#x27;è¾“å…¥çš„å¯†ç &#x27; å¦‚æœæ”»å‡»è€…åœ¨ç”¨æˆ·åå­—æ®µè¾“å…¥ï¼š 1&#x27; OR &#x27;1&#x27;=&#x27;1 é‚£ä¹ˆå®Œæ•´çš„SQLæŸ¥è¯¢å°†å˜ä¸ºï¼š sql 1SELECT * FROM users WHERE username = &#x27;&#x27; OR &#x27;1&#x27;=&#x27;1&#x27; AND password = &#x27;è¾“å…¥çš„å¯†ç &#x27; ç”±äº&#39;1&#39;=&#39;1&#39;å§‹ç»ˆä¸ºçœŸï¼Œè¿™ä¸ªæŸ¥è¯¢å°†è¿”å›æ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·çš„è®°å½•ï¼Œå¯¼è‡´æ•°æ®æ³„éœ²ã€‚ 2ã€ MybatisPluså’ŒMybatisçš„åŒºåˆ«ï¼Ÿ3ã€MyBatisè¿ç”¨äº†å“ªäº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ4ã€ResultType å’Œ ResultMap çš„åŒºåˆ« å¦‚æœæ•°æ®åº“ç»“æœé›†ä¸­çš„åˆ—åå’Œè¦å°è£…å®ä½“çš„å±æ€§åå®Œå…¨ä¸€è‡´çš„è¯ç”¨ resultType å±æ€§ã€‚ å¦‚æœæ•°æ®åº“ç»“æœé›†ä¸­çš„åˆ—åå’Œè¦å°è£…å®ä½“çš„å±æ€§åæœ‰ä¸ä¸€è‡´çš„æƒ…å†µç”¨ resultMap å± æ€§ï¼Œé€šè¿‡ã€‚resultMap æ‰‹åŠ¨å»ºç«‹å¯¹è±¡å…³ç³»æ˜ å°„ï¼ŒresultMap è¦é…ç½®ä¸€ä¸‹è¡¨å’Œç±»çš„â€“å¯¹åº”å…³ç³»ï¼Œæ‰€ä»¥è¯´å°±ç®—ä½ çš„å­—æ®µåå’Œä½ çš„å®ä½“ç±»çš„å±æ€§åä¸ä¸€æ ·ä¹Ÿæ²¡å…³ç³»ï¼Œéƒ½ä¼šç»™ä½ æ˜ å°„å‡ºæ¥ SpringBoot1ã€why springboot ç®€åŒ–å¼€å‘:Spring Booté€šè¿‡æä¾›ä¸€ç³»åˆ—çš„å¼€ç®±å³ç”¨çš„ç»„ä»¶å’Œè‡ªåŠ¨é…ç½®ï¼Œç®€åŒ–äº†é¡¹ç›®çš„é…ç½®å’Œå¼€å‘è¿‡ç¨‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œè€Œä¸éœ€è¦èŠ±è´¹è¿‡å¤šæ—¶é—´åœ¨ç¹ççš„é…ç½®ä¸Šã€‚ å¿«é€Ÿå¯åŠ¨:Spring Bootæä¾›äº†å¿«é€Ÿçš„åº”ç”¨ç¨‹åºå¯åŠ¨æ–¹å¼ï¼Œå¯é€šè¿‡å†…åµŒçš„Tomcatã€Jettyæˆ–Undertowç­‰å®¹å™¨å¿«é€Ÿå¯åŠ¨åº”ç”¨ç¨‹åºï¼Œæ— éœ€é¢å¤–çš„éƒ¨ç½²æ­¥éª¤ï¼Œæ–¹ä¾¿å¿«æ·ã€‚ è‡ªåŠ¨åŒ–é…ç½®:Spring Booté€šè¿‡è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œæ ¹æ®é¡¹ç›®ä¸­çš„ä¾èµ–å…³ç³»å’Œçº¦å®šä¿—æˆçš„è§„åˆ™æ¥é…ç½®åº”ç”¨ç¨‹åºï¼Œå‡å°‘äº†é…ç½®çš„å¤æ‚æ€§ï¼Œä½¿å¼€å‘è€…æ›´å®¹æ˜“å®ç°åº”ç”¨çš„æœ€ä½³å®è·µã€‚ 2ã€spring VS spring boot Spring Boot æä¾›äº†è‡ªåŠ¨åŒ–é…ç½®ï¼Œå¤§å¤§ç®€åŒ–äº†é¡¹ç›®çš„é…ç½®è¿‡ç¨‹ã€‚é€šè¿‡çº¦å®šä¼˜äºé…ç½®çš„åŸåˆ™ï¼Œå¾ˆå¤šå¸¸ç”¨çš„é…ç½®å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚ Spring Boot æä¾›äº†å¿«é€Ÿçš„é¡¹ç›®å¯åŠ¨å™¨ï¼Œé€šè¿‡å¼•å…¥ä¸åŒçš„ Starterï¼Œå¯ä»¥å¿«é€Ÿé›†æˆå¸¸ç”¨çš„æ¡†æ¶å’Œåº“(å¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Web å¼€å‘ç­‰)ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚ Spring Boot é»˜è®¤é›†æˆäº†å¤šç§å†…åµŒæœåŠ¡å™¨(å¦‚Tomcatã€Jettyã€Undertow)ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼Œå³å¯å°†åº”ç”¨æ‰“åŒ…æˆå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œæ–¹ä¾¿éƒ¨ç½²å’Œè¿è¡Œã€‚ 3ã€springbootæ€ä¹ˆå®ç°çº¦å®šå¤§äºé…ç½®çš„ è‡ªåŠ¨åŒ–é…ç½®ï¼šSpring Bootæ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œç¯å¢ƒè‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºï¼Œ æ— éœ€æ‰‹åŠ¨é…ç½®å¤§é‡çš„XMLæˆ–Javaé…ç½®æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®å¼•å…¥äº†Spring Web MVCä¾èµ–ï¼Œ Spring Bootä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªåŸºæœ¬çš„Webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚ èµ·æ­¥ä¾èµ–ï¼šSpring Bootæä¾›äº†ä¸€ç³»åˆ—èµ·æ­¥ä¾èµ–ï¼Œè¿™äº›ä¾èµ–åŒ…å«äº†å¸¸ç”¨çš„æ¡†æ¶å’ŒåŠŸèƒ½ï¼Œ å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ­å»ºé¡¹ç›®ã€‚ 4ã€Springbootè‡ªåŠ¨è£…é…5ã€è¯´å‡ ä¸ªå¯åŠ¨å™¨ï¼Ÿå†™è¿‡SpringBoot starterå—SpringCloudäº†è§£SpringCloudå—ï¼Œè¯´ä¸€ä¸‹ä»–å’ŒSpringBootçš„åŒºåˆ« å¾®æœåŠ¡ç»„ä»¶ è´Ÿè½½å‡è¡¡æœ‰å“ªäº›ç®—æ³•ï¼Ÿ å¦‚ä½•å®ç°ä¸€ç›´å‡è¡¡ç»™ä¸€ä¸ªç”¨æˆ·ï¼Ÿ ç†”æ–­é™çº§ï¼ˆäº†è§£ï¼‰","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"Spring, SSM","slug":"Spring-SSM","permalink":"http://example.com/tags/Spring-SSM/"}]},{"title":"JUC","slug":"å…«è‚¡/JUC","date":"2024-10-28T12:14:32.000Z","updated":"2025-03-06T14:14:24.390Z","comments":true,"path":"2024/10/28/å…«è‚¡/JUC/","permalink":"http://example.com/2024/10/28/%E5%85%AB%E8%82%A1/JUC/","excerpt":"è¿™é‡Œæ˜¯JAVAå¹¶å‘ç›¸å…³çš„ä¸€äº›å…«è‚¡","text":"è¿™é‡Œæ˜¯JAVAå¹¶å‘ç›¸å…³çš„ä¸€äº›å…«è‚¡ 1.çº¿ç¨‹åŸºç¡€1.çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ« è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡Œå®ä¾‹ï¼Œæ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ã€æ•°æ®æ®µã€å †æ ˆã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼Œè¿›ç¨‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œé€šå¸¸ä¸èƒ½ç›´æ¥å…±äº«å†…å­˜ã€‚ ç‰¹ç‚¹ï¼š è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰å„è‡ªçš„èµ„æºå’Œå†…å­˜ç©ºé—´ã€‚ è¿›ç¨‹åˆ›å»ºã€é”€æ¯çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å¼€é”€è¾ƒå¤§ã€‚ çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œå®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œ å®ƒä»¬å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´å’Œèµ„æº(å¦‚å †ï¼Œå…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ï¼Œæ–‡ä»¶ç­‰å…¬å…±èµ„æº)ï¼Œä½†æ‹¥æœ‰ç‹¬ç«‹çš„æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ ç‰¹ç‚¹ï¼š çº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´å’Œèµ„æºï¼Œå› æ­¤åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€è¾ƒå°ã€‚ çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€æ¯”è¿›ç¨‹å° ç”±äºå¤šä¸ªçº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´ï¼Œå› æ­¤å­˜åœ¨æ•°æ®ç«äº‰å’Œçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œéœ€è¦é€šè¿‡åŒæ­¥å’Œäº’æ–¥æœºåˆ¶æ¥è§£å†³ã€‚ åç¨‹ï¼šåç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ï¼Œç”±ç¨‹åºå‘˜åœ¨ä»£ç ä¸­æ˜¾å¼æ§åˆ¶è°ƒåº¦ï¼Œè€Œéæ“ä½œç³»ç»Ÿã€‚ ç‰¹ç‚¹ï¼š åç¨‹åˆ‡æ¢çš„å¼€é”€æå°ï¼Œæ¯”çº¿ç¨‹æ›´è½»é‡ï¼Œå› ä¸ºä¸éœ€è¦æ“ä½œç³»ç»Ÿçš„å¹²é¢„ã€‚ åç¨‹é€šå¸¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå› æ­¤å®ƒä»¬å…±äº«çº¿ç¨‹çš„æ‰€æœ‰èµ„æºã€‚ åç¨‹æ˜¯éæŠ¢å å¼çš„è°ƒåº¦ï¼ˆå³åç¨‹å¿…é¡»æ˜¾å¼è®©å‡ºæ§åˆ¶æƒï¼‰ï¼Œé¿å…äº†çº¿ç¨‹çš„åˆ‡æ¢å’ŒåŒæ­¥çš„å¤æ‚æ€§ã€‚ é€‚ç”¨åœºæ™¯ é«˜éš”ç¦»æ€§ä»»åŠ¡â€”â€”è¿›ç¨‹ é«˜å¹¶å‘å…±äº«æ•°æ®ä»»åŠ¡â€”â€”çº¿ç¨‹ é«˜å¹¶å‘ I&#x2F;O å¯†é›†å‹ä»»åŠ¡â€”â€”åç¨‹ 2.å¹¶è¡Œä¸å¹¶å‘çš„åŒºåˆ« å¹¶å‘ï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€ æ—¶é—´æ®µ å†…æ‰§è¡Œã€‚ å¹¶è¡Œï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€ æ—¶åˆ» æ‰§è¡Œã€‚ 3.åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼(å››ç§ï¼‰ ç»§æ‰¿ Thread ç±» åˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³• åˆ›å»ºè¯¥ç±»çš„ç¤ºä¾‹ è°ƒç”¨å®ä¾‹çš„star()æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ 123456789101112public static class myThread_1 extends Thread&#123; @Override public void run() &#123; System.out.println(&quot;ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹....&quot;); &#125; &#125;public static void main(String[] args) throws ExecutionException, InterruptedException &#123; //ç¬¬ä¸€ç§æ–¹å¼ myThread_1 thread_1 = new myThread_1(); thread_1.start(); &#125; å®ç° Runnable æ¥å£ åˆ›å»ºä¸€ä¸ªç±»å®ç°Runnableæ¥å£ï¼Œå¹¶é‡å†™run()æ–¹æ³• åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ï¼Œç„¶åç”¨è¿™ä¸ªå®ä¾‹åˆ›å»ºThreadå®ä¾‹ è°ƒç”¨Threadå®ä¾‹çš„start()æ–¹æ³• 12345678910111213public static class myRunable implements Runnable&#123; @Override public void run() &#123; System.out.println(&quot;ç¬¬äºŒç§æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹....&quot;); &#125;&#125;public static void main(String[] args) throws ExecutionException, InterruptedException &#123; //ç¬¬äºŒç§æ–¹å¼ myRunable myRunable = new myRunable(); Thread thread_2 = new Thread(myRunable); thread_2.start(); &#125; å®ç° Callable æ¥å£ åˆ›å»ºå®ç°Callableæ¥å£çš„ç±»myCallableï¼Œé‡å†™call()æ–¹æ³• ä»¥myCallableä¸ºå‚æ•°åˆ›å»ºFutureTaskå¯¹è±¡ å°†FutureTaskå®ä¾‹ä½œä¸ºå‚æ•°åˆ›å»ºThreadå¯¹è±¡ è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³• 123456789101112131415public static class myCallable implements Callable&lt;String&gt;&#123; @Override public String call() throws Exception &#123; return &quot;ç¬¬ä¸‰ç§æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹....&quot;; &#125;&#125;public static void main(String[] args) throws ExecutionException, InterruptedException &#123; //ç¬¬ä¸‰ç§æ–¹å¼ myCallable task = new myCallable(); FutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(task); Thread thread_3 = new Thread(futureTask); thread_3.start(); System.out.println(futureTask.get()); //è¿™ä¸ªç›¸å½“äºå¾—åˆ°é‡å†™cllçš„ç»“æœï¼Œä¸èƒ½çœç•¥ &#125; ä½¿ç”¨ Executors å·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ±  Executorsæä¾›äº†ä¸€ç³»åˆ—å·¥å‚æ–¹æ³•ç”¨äºåˆ›å…ˆçº¿ç¨‹æ± ï¼Œè¿”å›çš„çº¿ç¨‹æ± éƒ½å®ç°äº†ExecutorServiceæ¥å£ã€‚ ä¸»è¦æœ‰newFixedThreadPoolï¼ŒnewCachedThreadPoolï¼ŒnewSingleThreadExecutorï¼ŒnewScheduledThreadPoolï¼Œåç»­è¯¦ç»†ä»‹ç»è¿™å››ç§çº¿ç¨‹æ±  è¿™é‡Œä»£ç äº†è§£å³å¯ã€‚å‰ä¸‰ç§å¤§æ¦‚è¦ä¼šå†™ 123456789101112131415public static class Task implements Runnable&#123; @Override public void run() &#123; System.out.println(&quot;è¿™æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼š&quot;); &#125; &#125;public static void main(String[] args) throws ExecutionException, InterruptedException &#123; //ç¬¬å››ç§æ–¹å¼ ExecutorService executor = Executors.newFixedThreadPool(10); for (int i = 0; i &lt; 20; i++) &#123; executor.submit(new Task()); // æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± æ‰§è¡Œ &#125; executor.shutdown(); &#125; runnable å’Œ callable çš„åŒºåˆ« Runnable æ¥å£runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼ŒCallableæ¥å£callæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œéœ€è¦FutureTaskè·å–ç»“æœ Callableæ¥å£çš„call()æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸; è€ŒRunnableæ¥å£çš„run()æ–¹æ³•çš„å¼‚å¸¸åªèƒ½åœ¨å†…éƒ¨æ¶ˆåŒ–ï¼Œä¸èƒ½ç»§ç»­ä¸ŠæŠ› 4.run()å’Œ start()çš„åŒºåˆ« start():ç”¨æ¥å¯åŠ¨çº¿ç¨‹ï¼Œé€šè¿‡è¯¥çº¿ç¨‹è°ƒç”¨runæ–¹æ³•æ‰§è¡Œrunæ–¹æ³•ä¸­æ‰€å®šä¹‰çš„é€»è¾‘ä»£ç ã€‚ startæ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚run():å°è£…äº†è¦è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œå¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ã€‚ 5.å¯ä»¥ç›´æ¥è°ƒç”¨Threadçš„runæ–¹æ³•å—ï¼Ÿnew ä¸€ä¸ª Threadï¼Œçº¿ç¨‹è¿›å…¥äº†æ–°å»ºçŠ¶æ€ã€‚è°ƒç”¨ start()æ–¹æ³•ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥äº†å°±ç»ªçŠ¶æ€ï¼Œå½“åˆ†é…åˆ°æ—¶é—´ç‰‡åå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ã€‚ start() ä¼šæ‰§è¡Œçº¿ç¨‹çš„ç›¸åº”å‡†å¤‡å·¥ä½œï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œ run() æ–¹æ³•çš„å†…å®¹ï¼Œè¿™æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹å·¥ä½œã€‚ ä½†æ˜¯ï¼Œç›´æ¥æ‰§è¡Œ run() æ–¹æ³•ï¼Œä¼šæŠŠ run() æ–¹æ³•å½“æˆä¸€ä¸ª main çº¿ç¨‹ä¸‹çš„æ™®é€šæ–¹æ³•å»æ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå®ƒï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯å¤šçº¿ç¨‹å·¥ä½œã€‚ æ€»ç»“ï¼šè°ƒç”¨ start() æ–¹æ³•æ–¹å¯å¯åŠ¨çº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç›´æ¥æ‰§è¡Œ run() æ–¹æ³•çš„è¯ä¸ä¼šä»¥å¤šçº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œã€‚ 6.çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„çŠ¶æ€ï¼šæ–°å»º(NEW)ã€å¯è¿è¡Œ(RUNNABLE)ã€é˜»å¡(BLOCKED)ã€ç­‰å¾…(WAITING)ã€æ—¶é—´ç­‰å¾…(TIMED_WALTING)ã€ç»ˆæ­¢(TERMINATED) å˜åŒ–ï¼š åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ˜¯æ–°å»ºçŠ¶æ€ è°ƒç”¨äº†start()æ–¹æ³•è½¬å˜ä¸ºå¯æ‰§è¡ŒçŠ¶æ€çº¿ ç¨‹è·å–åˆ°äº†CPUçš„æ‰§è¡Œæƒï¼Œæ‰§è¡Œç»“æŸæ˜¯ç»ˆæ­¢çŠ¶æ€ åœ¨å¯æ‰§è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰è·å–CPUçš„æ‰§è¡Œæƒï¼Œå¯èƒ½ä¼šåˆ‡æ¢å…¶ä»–çŠ¶æ€ å¦‚æœæ²¡æœ‰è·å–é”(synchronizedæˆ–lock)è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè·å¾—é”å†åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€ å¦‚æœçº¿ç¨‹è°ƒç”¨äº†wait()æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨notify()å”¤é†’åå¯åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€ å¦‚æœçº¿ç¨‹è°ƒç”¨äº†sleep(50)æ–¹æ³•ï¼Œè¿›å…¥è®¡æ—¶ç­‰å¾…çŠ¶æ€ï¼Œåˆ°æ—¶é—´åå¯åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€ 7.sleepå’Œwaitçš„åŒºåˆ« ä¸¤è€…éƒ½å¯ä»¥æš‚åœçº¿ç¨‹çš„æ‰§è¡Œ ä¸åŒç‚¹åœ¨äºï¼š ç±»çš„ä¸åŒï¼šsleep() æ˜¯ Threadçº¿ç¨‹ç±»çš„é™æ€æ–¹æ³•ï¼Œwait() æ˜¯ Objectç±»çš„æ–¹æ³•ã€‚ sleep() ä¸é‡Šæ”¾é”ï¼›wait() é‡Šæ”¾é”ã€‚ ä¼šä¸ä¼šè‡ªåŠ¨è‹é†’ï¼šwait() æ–¹æ³•è¢«è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šè‡ªåŠ¨è‹é†’ï¼Œ éœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šçš„ notify()æˆ–è€… notifyAll() æ–¹æ³•ã€‚ sleep()æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ wait(long timeout) è¶…æ—¶åçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ã€‚ ç”¨é€”ä¸åŒï¼šWait é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’&#x2F;é€šä¿¡ï¼Œsleep é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œã€‚ å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼ˆäº†è§£ï¼‰ ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢(ä¸æ¨èï¼Œæ–¹æ³•å·²ä½œåºŸ) ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹ æ‰“æ–­é˜»å¡çš„çº¿ç¨‹(sleepï¼Œwaitï¼Œjoin)çš„çº¿ç¨‹ï¼Œçº¿ç¨‹ä¼šæŠ›å‡ºInteruptedExceptionå¼‚å¸¸ æ‰“æ–­æ­£å¸¸çš„çº¿ç¨‹ï¼Œå¯ä»¥æ ¹æ®æ‰“æ–­çŠ¶æ€æ¥æ ‡è®°æ˜¯å¦é€€å‡ºçº¿ç¨‹ 8.çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç”±äºå…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡å…±äº«æ•°æ®æˆ–åŒæ­¥æœºåˆ¶å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦çš„é€šä¿¡æ–¹å¼ï¼š å…±äº«å˜é‡ï¼šå¤šä¸ªçº¿ç¨‹é€šè¿‡å…±äº«å˜é‡ç›´æ¥è¯»å†™æ•°æ®ã€‚æ¯”å¦‚è¯´ volatile å’Œ synchronized å…³é”®å­—ã€‚ **ä½¿ç”¨ wait() å’Œ notify()**ï¼Œä¾‹å¦‚ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ï¼Œé€šè¿‡ wait() å’Œ notify() æ–¹æ³•å¯ä»¥å®ç°ç”Ÿäº§å’Œæ¶ˆè´¹çš„åè°ƒã€‚ CountDownLatch å’Œ CyclicBarrier ï¼šè¿™ä¸¤ä¸ªå·¥å…·ç±»ç”¨äºåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´è¿›è¡ŒåŒæ­¥ï¼Œå°¤å…¶é€‚ç”¨äºç­‰å¾…å¤šä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡åå†ç»§ç»­æ‰§è¡Œã€‚ Semaphoreï¼ˆä¿¡å·é‡ï¼‰ ï¼šSemaphore æ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚å®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ªä¿¡å·é‡è®¡æ•°æ¥å†³å®šæ˜¯å¦å…è®¸çº¿ç¨‹è®¿é—®èµ„æºã€‚ 9.å¹¶å‘ç¼–ç¨‹ä¸‰è¦ç´  åŸå­æ€§ï¼šåŸå­ï¼Œå³ä¸€ä¸ªä¸å¯å†è¢«åˆ†å‰²çš„é¢—ç²’ã€‚åŸå­æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚ å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹,å¦ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ã€‚ï¼ˆsynchronized,volatileï¼‰ æœ‰åºæ€§ï¼šç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚ï¼ˆå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼‰ å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„åŸå› ï¼š çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜ ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜ ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜ è§£å†³åŠæ³•ï¼š JDK Atomicå¼€å¤´çš„åŸå­ç±»ã€synchronizedã€LOCKï¼Œå¯ä»¥è§£å†³åŸå­æ€§é—®é¢˜ synchronizedã€volatileã€LOCKï¼Œå¯ä»¥è§£å†³å¯è§æ€§é—®é¢˜ Happens-Before è§„åˆ™å¯ä»¥è§£å†³æœ‰åºæ€§é—®é¢˜ 10.JMMâ€”â€”Javaå†…å­˜æ¨¡å‹ æ˜¯ä»€ä¹ˆ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡æ¨¡å‹ï¼Œä¸»è¦ç”¨æ¥å®šä¹‰å¤šçº¿ç¨‹ä¸­å˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå¯ä»¥è§£å†³å˜é‡çš„å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§é—®é¢˜ï¼Œç¡®ä¿åœ¨å¹¶å‘ç¯å¢ƒä¸­å®‰å…¨åœ°è®¿é—®å…±äº«å˜é‡ã€‚ çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹å†…éƒ¨çš„è¯»å†™æ“ä½œã€‚ å½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†æœ¬åœ°å†…å­˜ä¸­å…±äº«å˜é‡çš„å‰¯æœ¬åï¼Œå®ƒéœ€è¦å°†è¿™äº›æ›´æ”¹åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ç¡®ä¿å…¶ä»–çº¿ç¨‹å¯ä»¥çœ‹åˆ°è¿™äº›æ›´æ”¹ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è¯»å–å…±äº«å˜é‡æ—¶ï¼Œå®ƒå¯èƒ½é¦–å…ˆä»æœ¬åœ°å†…å­˜ä¸­è¯»å–ã€‚å¦‚æœæœ¬åœ°å†…å­˜ä¸­çš„å‰¯æœ¬æ˜¯è¿‡æ—¶çš„ï¼Œçº¿ç¨‹å°†ä»ä¸»å†…å­˜ä¸­é‡æ–°åŠ è½½å…±äº«å˜é‡çš„æœ€æ–°å€¼åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚ æœ¬åœ°å†…å­˜æ˜¯ JMM ä¸­çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚ happens-before æŒ‡ä»¤é‡æ’ä¹Ÿæ˜¯æœ‰ä¸€äº›é™åˆ¶çš„ï¼Œæœ‰ä¸¤ä¸ªè§„åˆ™happens-beforeå’Œas-if-serialæ¥çº¦æŸã€‚ happens-before çš„å®šä¹‰ï¼š å¦‚æœä¸€ä¸ªæ“ä½œ happens-before å¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§ï¼Œè€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚ ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨ happens-before å…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ Java å¹³å°çš„å…·ä½“å®ç°å¿…é¡»è¦æŒ‰ç…§ happens-before å…³ç³»æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚å¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœï¼Œä¸æŒ‰ happens-before å…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³• as-if-serial as-if-serial è¯­ä¹‰ä¿è¯å•çº¿ç¨‹å†…é‡æ’åºåçš„æ‰§è¡Œç»“æœå’Œç¨‹åºä»£ç æœ¬èº«åº”æœ‰çš„ç»“æœæ˜¯ä¸€è‡´çš„ happens-before å…³ç³»ä¿è¯æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¢«é‡æ’åºæ”¹å˜ã€‚ 2.é”1.voliatlevolatile å…³é”®å­—ç”¨äºä¿®é¥°å˜é‡ ï¼Œä¸»è¦æ˜¯ä¿è¯å¤šçº¿ç¨‹å¯è§æ€§å’Œæœ‰åºæ€§ ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§ ç¡®ä¿ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹èƒ½å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ å½“ä¸€ä¸ªå…±äº«å˜é‡è¢« volatile ä¿®é¥°æ—¶ï¼Œå®ƒä¼šä¿è¯ä¿®æ”¹çš„å€¼ä¼šè¢«æ›´æ–°åˆ°ä¸»å­˜ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦è¯»å–æ—¶ï¼Œå®ƒä¼šå»ä¸»å­˜ä¸­è¯»å–æ–°å€¼ã€‚ ç¦æ­¢æŒ‡ä»¤é‡æ’åº å¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º volatile ï¼Œåœ¨å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ’å…¥ç‰¹å®šçš„ å†…å­˜å±éšœ çš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚ä»¥ä¸‹ä¾›ç†è§£ï¼š ç®€å•è¯´å°±æ˜¯JVMä¸ºäº†å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–æé«˜æ€§èƒ½ä¼šåœ¨ä¸å½±å“ç»“æœçš„æƒ…å†µä¸‹æŠŠä»£ç æ‰§è¡Œé¡ºåºæ”¹å˜ï¼Œä½†å¤šçº¿ç¨‹å°±å¯èƒ½ä¼šå‡ºç°ç»“æœä¸å¯¹çš„é—®é¢˜ç„¶åvolatileåŸç†å°±æ˜¯åŠ äº†ä¸€äº›å±éšœï¼Œä½¿å±éšœåçš„ä»£ç ä¸€å®šä¸ä¼šæ¯”å±éšœå‰çš„ä»£ç å…ˆæ‰§è¡Œï¼Œä»è€Œå®ç°æœ‰åºæ€§ 2.ä¹è§‚é”å’Œæ‚²è§‚é” æ‚²è§‚é” æ‚²è§‚é”:è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œåœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚ é”å®ç°:å…³é”®å­—synchronizedã€æ¥å£Lockçš„å®ç°ç±» é€‚ç”¨åœºæ™¯:å†™æ“ä½œè¾ƒå¤šï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡® ä¹è§‚é” ä¹è§‚é”:è®¤ä¸ºè‡ªå·±ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ® é”å®ç°1:CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼ŒCompare-and-Swapï¼‰ç®—æ³•ï¼Œæ˜¯ä¸€ç§æ— é”çš„åŸå­æ“ä½œã€‚ Vï¼šè¦æ›´æ–°çš„å˜é‡å€¼(Var) Eï¼šé¢„æœŸå€¼(Expected) Nï¼šæ–°å€¼(New) å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº E æ—¶ï¼ŒCAS é€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼ N æ¥æ›´æ–° V çš„å€¼ã€‚å¦‚æœä¸ç­‰ï¼Œè¯´æ˜å·²ç»æœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº† Vï¼Œåˆ™å½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ã€‚ ActomicIntegerç±»çš„åŸå­è‡ªå¢æ˜¯é€šè¿‡CASè‡ªé€‰å®ç°ã€‚ é”å®ç° 2:ç‰ˆæœ¬å·æ§åˆ¶:æ•°æ®è¡¨ä¸­åŠ ä¸Šç‰ˆæœ¬å·å­—æ®µ versionï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶è¿™ä¸ªå­—æ®µå€¼ä¼šåŠ 1ï¼Œå½“æ›´æ–°æ•°æ®æ—¶ï¼ŒåŒæ—¶æ¯”è¾ƒç‰ˆæœ¬å·ï¼Œè‹¥å½“å‰ç‰ˆæœ¬å·å’Œæ›´æ–°å‰è·å–çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œ åˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚ é€‚ç”¨åœºæ™¯:è¯»æ“ä½œè¾ƒå¤šï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ CASå­˜åœ¨çš„ç¼ºç‚¹ï¼ˆé—®é¢˜ï¼‰ ABAé—®é¢˜ ABAçš„é—®é¢˜æŒ‡çš„æ˜¯åœ¨CASæ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå½“è¯»å–åˆ°çš„å€¼æ˜¯Aï¼Œç„¶åå‡†å¤‡èµ‹å€¼çš„æ—¶å€™ä»ç„¶æ˜¯Aï¼Œä½†æ˜¯å®é™…ä¸Šæœ‰å¯èƒ½Açš„å€¼è¢«æ”¹æˆäº†Bï¼Œç„¶ååˆè¢«æ”¹å›äº†Aï¼Œè¿™ä¸ªCASæ›´æ–°çš„æ¼æ´å°±å«åšABAã€‚ å¾ªç¯æ—¶é—´å¼€é”€å¤§ è‡ªæ—‹CASçš„æ–¹å¼å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§ åªå¯¹ä¸€ä¸ªå…±äº«å˜é‡æ“ä½œå¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä½†æ˜¯å¤šä¸ªåˆ™ä¸è¡Œ,å¤šä¸ªå¯ä»¥é€šè¿‡AtomicReferenceæ¥å¤„ç†æˆ–è€…ä½¿ç”¨é”synchronizedå®ç°ã€‚ 3.synchronizedåœ¨ Java ä¸­ï¼Œå…³é”®å­— synchronizedï¼ˆç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œåŒæ­¥â€çš„æ„æ€ï¼‰ å¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—(ä¸»è¦æ˜¯å¯¹æ–¹æ³•æˆ–è€…ä»£ç å—ä¸­å­˜åœ¨å…±äº«æ•°æ®çš„æ“ä½œ) ã€‚ synchronized å¯ç”¨æ¥ä¿®é¥°æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•å’Œä»£ç å— synchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•å’Œ synchronized(class) ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ï¼› synchronized å…³é”®å­—åŠ åˆ°æ™®é€šæ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ã€‚ 1.synchronizedå…³é”®å­—çš„åº•å±‚åŸç† ä½¿ç”¨synchronizedä¹‹åï¼Œç¼–è¯‘ä¹‹ååœ¨åŒæ­¥çš„ä»£ç å—å‰ååŠ ä¸Šmonitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»–ä¾èµ–æ“ä½œç³»ç»Ÿåº•å±‚äº’æ–¥é”å®ç°ã€‚ä»–çš„ä½œç”¨ä¸»è¦å°±æ˜¯å®ç°åŸå­æ€§æ“ä½œå’Œè§£å†³å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§é—®é¢˜, æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶ä¼šå°è¯•è·å–å¯¹è±¡é”ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰è¢«é”å®šæˆ–è€…å·²ç»è·å¾—äº†é”ï¼Œé”çš„è®¡æ•°å™¨+1ã€‚æ­¤æ—¶å…¶ä»–ç«äº‰é”çš„çº¿ç¨‹åˆ™ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚æ‰§è¡ŒmonitorexitæŒ‡ä»¤æ—¶åˆ™ä¼šæŠŠè®¡æ•°å™¨-1ï¼Œå½“è®¡æ•°å™¨å€¼ä¸º0æ—¶åˆ™é”é‡Šæ”¾ï¼Œå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å†ç»§ç»­ç«äº‰é”ã€‚ synchronizedæ˜¯æ’å®ƒé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½è·å¾—é”ï¼Œè€Œä¸”ç”±äºJavaä¸­çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œçº¿ç¨‹è¢«é˜»å¡æˆ–è€…å”¤é†’æ—¶æ—¶ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€è¿™ç§è½¬æ¢éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚ 2.synchronizedå¯é‡å…¥çš„åŸç† é‡å…¥é”æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°è¯¥é”ä¹‹åï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­è·å¾—è¯¥é”ã€‚åº•å±‚åŸç†ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“çº¿ç¨‹è·å–è¯¥é”æ—¶ï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œå†æ¬¡è·å¾—è¯¥é”æ—¶ç»§ç»­åŠ ä¸€ï¼Œé‡Šæ”¾é”æ—¶ï¼Œè®¡æ•°å™¨å‡ä¸€ï¼Œå½“è®¡æ•°å™¨å€¼ä¸º0æ—¶ï¼Œè¡¨æ˜è¯¥é”æœªè¢«ä»»ä½•çº¿ç¨‹æ‰€æŒæœ‰ï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥ç«äº‰è·å–é”ã€‚ 3.synchronized é”å‡çº§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ æ— é”-&gt;åå‘é”-&gt;è½»é‡çº§é”-&gt;é‡é‡çº§é” åå‘é”ï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦CASæ“ä½œï¼Œåç»­å†è·å–è¯¥é”åªè¦çº¿ç¨‹idä¸€æ ·ï¼ˆæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼‰å°±æ— éœ€å†ç”¨CASæ“ä½œã€‚ åå‘é”çš„ç›®çš„æ˜¯æ¶ˆé™¤åŒä¸€çº¿ç¨‹çš„åç»­é”è·å–å’Œé‡Šæ”¾çš„å¼€é”€ã€‚å¦‚æœåŒä¸€çº¿ç¨‹å†æ¬¡è¯·æ±‚é”ï¼Œå°±æ— éœ€å†æ¬¡åŒæ­¥ã€‚ å½“æœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰é”ï¼Œä½†æ²¡æœ‰é”ç«äº‰çš„å¼ºçƒˆè¿¹è±¡ï¼ˆå³çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—ï¼‰æ—¶ï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚ è½»é‡çº§é”ï¼šæ¯æ¬¡éƒ½éœ€è¦CASæ“ä½œ synchronized é”å‡çº§åŸç†ï¼šåœ¨é”å¯¹è±¡çš„å¯¹è±¡å¤´é‡Œé¢æœ‰ä¸€ä¸ª threadid å­—æ®µï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ threadid ä¸ºç©ºï¼Œjvm è®©å…¶æŒæœ‰åå‘é”ï¼Œå¹¶å°† threadid è®¾ç½®ä¸ºå…¶çº¿ç¨‹ idï¼Œå†æ¬¡è¿›å…¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­ threadid æ˜¯å¦ä¸å…¶çº¿ç¨‹ id ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™å‡çº§åå‘é”ä¸ºè½»é‡çº§é”ï¼Œé€šè¿‡è‡ªæ—‹å¾ªç¯ä¸€å®šæ¬¡æ•°æ¥è·å–é”ï¼Œæ‰§è¡Œä¸€å®šæ¬¡æ•°ä¹‹åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ­£å¸¸è·å–åˆ°è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œæ­¤æ—¶å°±ä¼šæŠŠé”ä»è½»é‡çº§å‡çº§ä¸ºé‡é‡çº§é”ï¼Œæ­¤è¿‡ç¨‹å°±æ„æˆäº† synchronized é”çš„å‡çº§ã€‚ é”çš„å‡çº§çš„ç›®çš„ï¼šé”å‡çº§æ˜¯ä¸ºäº†å‡ä½äº†é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚åœ¨ Java 6 ä¹‹åä¼˜åŒ– synchronized çš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨äº†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”å†å‡çº§åˆ°é‡é‡çº§é”çš„æ–¹å¼ï¼Œä»è€Œå‡ä½äº†é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚ Javaä¸­çš„synchronizedæœ‰åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ä¸‰ç§å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”äº†é”åªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€ä¸åŒçº¿ç¨‹äº¤æ›¿æŒæœ‰é”ã€å¤šçº¿ç¨‹ç«äº‰é”ä¸‰ç§æƒ…å†µã€‚ é‡é‡çº§é” åº•å±‚ä½¿ç”¨çš„Monitorå®ç°ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬è¾ƒé«˜æ€§èƒ½æ¯”è¾ƒä½ã€‚ è½»é‡çº§é” çº¿ç¨‹åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„(ä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰)ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚è½»é‡çº§ä¿®æ”¹äº†å¯¹è±¡å¤´çš„é”æ ‡å¿—ï¼Œç›¸å¯¹é‡é‡çº§é”æ€§èƒ½æå‡å¾ˆå¤šã€‚æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯CASæ“ä½œï¼Œä¿è¯åŸå­æ€§ åå‘é” ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´å†…éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”ï¼Œå¯ä»¥ä½¿ç”¨äº†åå‘é”ï¼Œåœ¨ç¬¬ä¸€æ¬¡è·å¾—é”æ—¶ä¼šæœ‰ä¸€ä¸ªCASæ“ä½œï¼Œä¹‹åè¯¥çº¿ç¨‹å†è·å–é”ï¼Œåªéœ€è¦åˆ¤æ–­mark wordä¸­æ˜¯å¦æ˜¯è‡ªå·±çš„çº¿ç¨‹idå³å¯ï¼Œè€Œä¸æ˜¯å¼€é”€ç›¸å¯¹è¾ƒå¤§çš„CASå‘½ä»¤ 4.ä»€ä¹ˆæ˜¯è‡ªæ—‹å¾ˆå¤š synchronized é‡Œé¢çš„ä»£ç åªæ˜¯ä¸€äº›å¾ˆç®€å•çš„ä»£ç ï¼Œæ‰§è¡Œæ—¶é—´éå¸¸å¿«ï¼Œæ­¤æ—¶ç­‰å¾…çš„çº¿ç¨‹éƒ½åŠ é”å¯èƒ½æ˜¯ä¸€ç§ä¸å¤ªå€¼å¾—çš„æ“ä½œï¼Œå› ä¸ºçº¿ç¨‹é˜»å¡æ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢çš„é—®é¢˜ã€‚æ—¢ç„¶ synchronized é‡Œé¢çš„ä»£ç æ‰§è¡Œå¾—éå¸¸å¿«ï¼Œä¸å¦¨è®©ç­‰å¾…é”çš„çº¿ç¨‹ä¸è¦è¢«é˜»å¡ï¼Œè€Œæ˜¯åœ¨ synchronized çš„è¾¹ç•Œåšå¿™å¾ªç¯ï¼Œè¿™å°±æ˜¯è‡ªæ—‹ã€‚å¦‚æœåšäº†å¤šæ¬¡å¾ªç¯å‘ç°è¿˜æ²¡æœ‰è·å¾—é”ï¼Œå†é˜»å¡ï¼Œè¿™æ ·å¯èƒ½æ˜¯ä¸€ç§æ›´å¥½çš„ç­–ç•¥ã€‚ 5.synchronized å’Œ volatile çš„åŒºåˆ«â€‹ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—æ˜¯ä¸¤ä¸ªäº’è¡¥çš„å­˜åœ¨ï¼Œè€Œä¸æ˜¯å¯¹ç«‹çš„å­˜åœ¨ï¼ äºŒè€…çš„åº”ç”¨åœºæ™¯ä¹Ÿä¸åŒ volatile æ˜¯å˜é‡ä¿®é¥°ç¬¦ï¼›synchronized ä¿®é¥°ä¿®é¥°ç±»ã€æ–¹æ³•ã€‚ volatile ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ synchronized åˆ™å¯ä»¥ä¿è¯å˜é‡çš„åŸå­æ€§ã€‚ volatileå…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥volatileæ€§èƒ½è‚¯å®šæ¯”synchronizedå…³é”®å­—è¦å¥½ã€‚ 6.ReentrantLockReentrantLockæ˜¯ä¸€ä¸ªç±»ï¼Œå…¶åº•å±‚å®ç°ä¸»è¦ä¾èµ–äº AbstractQueuedSynchronizerï¼ˆAQSï¼‰è¿™ä¸ªæŠ½è±¡ç±»ã€‚ ReentrantLock å®ç°äº† Lock æ¥å£ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥ä¸”ç‹¬å å¼çš„é”ï¼Œå’Œ synchronized å…³é”®å­—ç±»ä¼¼ã€‚ ä½†æä¾›äº†æ¯” synchronized æ›´ç»†ç²’åº¦çš„é”æ§åˆ¶ï¼Œæ”¯æŒå…¬å¹³é”ã€å¯ä¸­æ–­é”ã€å°è¯•è·å–é”ç­‰åŠŸèƒ½ã€‚ é€‚ç”¨åœºæ™¯ï¼š å½“éœ€è¦æ›´å¤æ‚çš„é”æ§åˆ¶ã€å½“çº¿ç¨‹éœ€è¦ä¸­æ–­æ—¶ã€å½“é”çš„è·å–éœ€è¦è¶…æ—¶é™åˆ¶æ—¶ï¼Œ 1.å…¬å¹³é”å’Œéå…¬å¹³é” å…¬å¹³é” : é”è¢«é‡Šæ”¾ä¹‹åï¼Œå…ˆç”³è¯·çš„çº¿ç¨‹å…ˆå¾—åˆ°é”ã€‚æ€§èƒ½è¾ƒå·®ä¸€äº›ï¼Œå› ä¸ºå…¬å¹³é”ä¸ºäº†ä¿è¯æ—¶é—´ä¸Šçš„ç»å¯¹é¡ºåºï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ›´é¢‘ç¹ã€‚ éå…¬å¹³é”ï¼šé”è¢«é‡Šæ”¾ä¹‹åï¼Œåç”³è¯·çš„çº¿ç¨‹å¯èƒ½ä¼šå…ˆè·å–åˆ°é”ï¼Œæ˜¯éšæœºæˆ–è€…æŒ‰ç…§å…¶ä»–ä¼˜å…ˆçº§æ’åºçš„ã€‚æ€§èƒ½æ›´å¥½ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´æŸäº›çº¿ç¨‹æ°¸è¿œæ— æ³•è·å–åˆ°é”ã€‚ 2.å¯ä¸­æ–­é”å’Œä¸å¯ä¸­æ–­é” å¯ä¸­æ–­é”ï¼šè·å–é”çš„è¿‡ç¨‹ä¸­å¯ä»¥è¢«ä¸­æ–­ï¼Œä¸éœ€è¦ä¸€ç›´ç­‰åˆ°è·å–é”ä¹‹åæ‰èƒ½è¿›è¡Œå…¶ä»–é€»è¾‘å¤„ç†ã€‚ReentrantLock å°±å±äºæ˜¯å¯ä¸­æ–­é”ã€‚ ä¸å¯ä¸­æ–­é”ï¼šä¸€æ—¦çº¿ç¨‹ç”³è¯·äº†é”ï¼Œå°±åªèƒ½ç­‰åˆ°æ‹¿åˆ°é”ä»¥åæ‰èƒ½è¿›è¡Œå…¶ä»–çš„é€»è¾‘å¤„ç†ã€‚ synchronized å°±å±äºæ˜¯ä¸å¯ä¸­æ–­é”ã€‚ 7.synchronized å’Œ ReentrantLock çš„åŒºåˆ« ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é” å¯é‡å…¥é” ä¹Ÿå«é€’å½’é”ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥å†æ¬¡è·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æŸä¸ªå¯¹è±¡çš„é”ï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å…¶å†æ¬¡æƒ³è¦è·å–è¿™ä¸ªå¯¹è±¡çš„é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„ï¼Œå¦‚æœæ˜¯ä¸å¯é‡å…¥é”çš„è¯ï¼Œå°±ä¼šé€ æˆæ­»é”ã€‚ synchronized ä¾èµ–äº JVM è€Œ ReentrantLock ä¾èµ–äº API synchronized æ˜¯JM å±‚é¢é€šè¿‡ç›‘è§†å™¨å®ç°çš„ï¼Œè€Œ ReentrantLock æ˜¯åŸºäº AQS å®ç°çš„ã€‚ ReentrantLockæ¯”sychronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ ReentrantLock å¯ä»¥å“åº”ä¸­æ–­ï¼Œè§£å†³æ­»é”çš„é—®é¢˜ï¼Œè€Œ synchronized ä¸èƒ½å“åº”ä¸­æ–­ã€‚ synchronized å±äºéå…¬å¹³é”ï¼Œè€Œ ReentrantLock æ—¢å¯ä»¥æ˜¯å…¬å¹³é”ä¹Ÿå¯ä»¥æ˜¯éå…¬å¹³é”ã€‚ 3.ThreadLocal æ˜¯ä»€ä¹ˆ ThreadLocalæ˜¯çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ºä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹å˜é‡çš„å®‰å…¨è®¿é—®ï¼Œå¯ä»¥å°†å˜é‡æ”¾åˆ°ThreadLocalç±»å‹çš„å¯¹è±¡ä¸­ï¼Œä½¿å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ç‹¬ç«‹å€¼ï¼Œçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ï¼Œç›¸äº’éš”ç¦»ï¼Œæé«˜äº†çº¿ç¨‹å®‰å…¨æ€§ åº•å±‚åŸç† ThreadLocalåº•å±‚ä½¿ç”¨çš„æ˜¯å½“å‰çº¿ç¨‹çš„ ThreadLocalMap æ¥å­˜å‚¨æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„ThreadLocalMapã€‚ThreadLocalMapçš„keyæ˜¯ThreadLocalå®ä¾‹çš„å¼±å¼•ç”¨ï¼Œå¯¹åº”çš„valueæ˜¯éœ€è¦å­˜å‚¨çš„å€¼ keyï¼šThreadLocal valueï¼šéœ€è¦å­˜å‚¨çš„å€¼ å­˜åœ¨çš„é—®é¢˜â€”â€”å†…å­˜æ³„éœ²é—®é¢˜ ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¼šè¢«é‡å¤ä½¿ç”¨ã€‚ThreadLocalMapæ˜¯Threadä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå› æ­¤ï¼ŒThreadLocalMapçš„ç”Ÿå‘½å‘¨æœŸä¸Threadä¸€è‡´ã€‚mapä¸­Entryå¯¹è±¡çš„keyè¢«è®¾ç½®æˆå¼±å¼•ç”¨ï¼Œä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œä½†æ˜¯valueä¸ä¼šè¢«å›æ”¶ï¼ˆ value æ˜¯å¼ºå¼•ç”¨ ï¼‰ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨å®Œä¹‹åæ‰‹åŠ¨è°ƒç”¨remove()é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚ æœ‰å…³å¼ºå¼•ç”¨ï¼Œå¼±å¼•ç”¨å‚çœ‹JVMç¯‡ 4.çº¿ç¨‹æ± ä½œç”¨ï¼šç®¡ç†å’Œå¤ç”¨çº¿ç¨‹ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ï¼Œæ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½ é™ä½èµ„æºæ¶ˆè€—ï¼šé€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚ æé«˜å“åº”é€Ÿåº¦ï¼šå½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼šçº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚ çº¿ç¨‹å¤ç”¨åŸç†ï¼šçº¿ç¨‹æ± å¯¹ Thread è¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡æ‰§è¡Œä»»åŠ¡éƒ½ä¼šè°ƒç”¨ Thread.start() æ¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯è®©æ¯ä¸ªçº¿ç¨‹å¾ªç¯æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä»»åŠ¡ç­‰å¾…è¢«æ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä»»åŠ¡çš„ run æ–¹æ³•ï¼Œç›¸å½“äºæŠŠæ¯ä¸ªä»»åŠ¡çš„ run() æ–¹æ³•ä¸²è”äº†èµ·æ¥ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°é‡å¹¶ä¸å¢åŠ ã€‚ 1.çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†ï¼‰ corePoolSizeï¼šçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°é‡ maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­æœ€å¤šå¯å®¹çº³çš„çº¿ç¨‹æ•°é‡ã€‚ keepAliveTime ï¼šå½“å‰çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ unit ï¼škeepAliveTimeçš„å•ä½ workQueueï¼šçº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡ threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ handlerï¼šæ‹’ç»ç­–ç•¥ï¼Œçº¿ç¨‹æ± ä»»åŠ¡é˜Ÿåˆ—è¶…è¿‡ maxinumPoolSize ä¹‹åçš„æ‹’ç»ç­–ç•¥ æµç¨‹ 2.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥é¢„ç½®çš„æœ‰å››ç§ç­–ç•¥ AbortPolicy(é»˜è®¤æ–¹å¼ï¼Œç›´æ¥æŠ›å‡ºä¸€ä¸ªä»»åŠ¡è¢«çº¿ç¨‹æ± æ‹’ç»çš„å¼‚å¸¸ã€‚ CallerRunsPolicyï¼šç”±çº¿ç¨‹æ± çš„è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹å»æ‰§è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ DiscardPolicy(ä¸åšä»»ä½•å¤„ç†ï¼Œé™é»˜æ‹’ç»æäº¤çš„ä»»åŠ¡ã€‚ DiscardOldestPolicy(ä¸¢å¼ƒæœ€æ—©è¢«æ·»åŠ åˆ°é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•é‡æ–°æäº¤æ–°ä»»åŠ¡) å¦‚æœå¸Œæœ›å¿«é€Ÿå¤±è´¥å¹¶å°†å¼‚å¸¸ä¼ é€’ç»™è°ƒç”¨è€…ï¼Œåˆ™é€‰æ‹©AbortPolicyã€‚å¦‚æœå¸Œæœ›å°½å¯èƒ½ä¿è¯ä»»åŠ¡çš„æ‰§è¡Œè€Œä¸å †ç§¯åœ¨é˜Ÿåˆ—ä¸­ï¼Œåˆ™é€‰æ‹©CallerRunsPolicyã€‚å¦‚æœå¯¹ä»»åŠ¡çš„ä¸¢å¤±æƒ…å†µä¸æ•æ„Ÿï¼Œåˆ™é€‰æ‹© DiscardPolicyã€‚è€Œå¦‚æœå¸Œæœ›å°½å¯èƒ½ä¿ç•™æœ€æ–°çš„ä»»åŠ¡è€Œä¸æ˜¯æ—§æ—¥çš„ä»»åŠ¡ï¼Œåˆ™é€‰æ‹©DiscardOldestPolicyã€‚ 3.çº¿ç¨‹æ± å¦‚ä½•å…³é—­å¯ä»¥é€šè¿‡è°ƒç”¨çº¿ç¨‹æ± çš„shutdownæˆ–shutdownNowæ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ã€‚ shutdownï¼šåœæ­¢æ¥æ”¶å¤–éƒ¨æäº¤çš„ä»»åŠ¡ï¼Œå†…éƒ¨æ­£åœ¨è·‘çš„ä»»åŠ¡å’Œé˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œå®Œï¼Œæ‰§è¡Œå®Œä¹Ÿå°±å…³é—­äº† shutdownNowï¼šä¹Ÿæ˜¯å…ˆåœæ­¢æ¥æ”¶å¤–éƒ¨æäº¤çš„ä»»åŠ¡ï¼Œä½†æ˜¯è¿™é‡Œä¸åŒçš„æ˜¯ä¼šå¿½ç•¥é˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•å»å…³é—­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ 4.çº¿ç¨‹æ± çš„å¤§å°å¦‚ä½•è®¾å®šNæ˜¯CPUæ ¸å¿ƒæ•°ï¼Œè®¾ç½®corePoolSizeçš„å¤§å°ä¸ºï¼š CPUå¯†é›†å‹ä»»åŠ¡ï¼šN+1ã€‚æˆ‘çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥ä¼˜åŒ– CPU ä½¿ç”¨ç‡ã€‚ æ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†æŸäº›çº¿ç¨‹å› ç­‰å¾…ç³»ç»Ÿèµ„æºè€Œé˜»å¡ ï¼Œä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚ I&#x2F;Oå¯†é›†å‹ä»»åŠ¡ï¼š2Nã€‚ç”±äºçº¿ç¨‹ç»å¸¸å¤„äºç­‰å¾…çŠ¶æ€ï¼ˆç­‰å¾… IO æ“ä½œå®Œæˆï¼‰ï¼Œå¯ä»¥è®¾ç½®æ›´å¤šçš„çº¿ç¨‹æ¥æé«˜å¹¶å‘æ€§ï¼ˆæ¯”å¦‚è¯´ 2 å€ï¼‰ï¼Œä»è€Œå¢åŠ  CPU åˆ©ç”¨ç‡ã€‚ 5.ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­å¼ºåˆ¶çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™© Executors å„ä¸ªæ–¹æ³•çš„å¼Šç«¯ï¼š ï¼ˆåŠ ç²—çš„ä¹Ÿæ˜¯åˆ›å»ºçº¿ç¨‹æ± çš„å››ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œåˆ›å»ºå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œåˆ›å»ºä¸€ä¸ªæ— é™å¤§å°çš„çº¿ç¨‹æ± ï¼‰ newFixedThreadPool å’Œ newSingleThreadExecutor: ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ— LinkedBlockingQueueï¼Œå¯ä»¥æ— é™åœ°æ¥å—ä»»åŠ¡ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨ä»»åŠ¡æäº¤è¿‡å¤šä¸”ä»»åŠ¡å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šæ—¶ã€‚ newCachedThreadPool å’Œ newScheduledThreadPool:ä¸»è¦é—®é¢˜æ˜¯çº¿ç¨‹æ•°æœ€å¤§æ•°æ˜¯ Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºæ•°é‡éå¸¸å¤šçš„çº¿ç¨‹ï¼Œç”šè‡³ OOMã€‚ ThreaPoolExecutoråˆ›å»ºçº¿ç¨‹æ± æ–¹å¼åªæœ‰ä¸€ç§ï¼Œå°±æ˜¯èµ°å®ƒçš„æ„é€ å‡½æ•°ï¼Œå‚æ•°è‡ªå·±æŒ‡å®š å››ç§çº¿ç¨‹æ± ï¼š FixedThreadPool ï¼šå›ºå®šå¤§å°çš„çº¿ç¨‹æ±  å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œå°±åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼› å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äº corePoolSize åï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œä¼šå°†ä»»åŠ¡åŠ å…¥ LinkedBlockingQueueï¼› çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œå®Œ æ‰‹å¤´çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä» LinkedBlockingQueue ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼› SingleThreadExecutorï¼š æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ±  å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº1ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼› å½“å‰çº¿ç¨‹æ± ä¸­æœ‰ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹åï¼Œå°†ä»»åŠ¡åŠ å…¥ LinkedBlockingQueue çº¿ç¨‹æ‰§è¡Œå®Œå½“å‰çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä»LinkedBlockingQueue ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œ CachedThreadPoolï¼šæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ±  CachedThreadPool çš„corePoolSize è¢«è®¾ç½®ä¸ºç©ºï¼ˆ0ï¼‰ï¼ŒmaximumPoolSizeè¢«è®¾ç½®ä¸º Integer.MAX.VALUEï¼Œ å³å®ƒæ˜¯æ— ç•Œçš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœä¸»çº¿ç¨‹æäº¤ä»»åŠ¡çš„é€Ÿåº¦é«˜äº maximumPool ä¸­çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦æ—¶ï¼Œ CachedThreadPool ä¼šä¸æ–­åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚æç«¯æƒ…å†µä¸‹ï¼Œè¿™æ ·ä¼šå¯¼è‡´è€—å°½ cpu å’Œå†…å­˜èµ„æºã€‚ ScheduledThreadPoolï¼šåˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚ æ ¸å¿ƒçº¿ç¨‹æ•°å›ºå®šï¼Œä½†ä»»åŠ¡é˜Ÿåˆ—ä¸ºæ— ç•Œé˜Ÿåˆ—ï¼ˆDelayedWorkQueueï¼‰ã€‚ 5.å¹¶å‘å·¥å…·ç±»1.AQSAQSï¼Œå…¨ç§°æ˜¯ Abstract Queued Synchronizerï¼Œä¸­æ–‡æ„æ€æ˜¯æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ã€‚AQS å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦ç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨ã€‚ AQS çš„æ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å½“å‰çº¿ç¨‹èƒ½å¤ŸæˆåŠŸè·å–èµ„æºï¼›å¦åˆ™ï¼Œå®ƒå°†è¿›å…¥ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œç³»ç»Ÿä¼šæŒ‘é€‰ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œèµ‹äºˆå…¶èµ„æºã€‚ åŸç† æ˜¯å¤šçº¿ç¨‹ä¸­çš„é˜Ÿåˆ—åŒæ­¥å™¨ã€‚æ˜¯ä¸€ç§é”æœºåˆ¶ï¼Œå®ƒæ˜¯åšä¸ºä¸€ä¸ªåŸºç¡€æ¡†æ¶ä½¿ç”¨çš„ï¼ŒåƒReentrantLockã€Semaphoreéƒ½æ˜¯åŸºäºAQSå®ç°çš„ AQSå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„åŒå‘é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ’é˜Ÿçš„çº¿ç¨‹åœ¨AQSå†…éƒ¨è¿˜æœ‰ä¸€ä¸ª int å±æ€§stateï¼Œè¿™ä¸ªstateå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªèµ„æºï¼Œé»˜è®¤æ˜¯0(æ— é”çŠ¶æ€)ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­çš„æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹æˆåŠŸäº†stateä¸º1ï¼Œåˆ™å½“å‰çº¿ç¨‹å°±ç›¸ç­‰äºè·å–äº†èµ„æº åœ¨å¯¹stateä¿®æ”¹çš„æ—¶å€™ä½¿ç”¨çš„CASæ“ä½œï¼Œä¿è¯å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„æƒ…å†µä¸‹åŸå­æ€§ AQS æ”¯æŒä¸¤ç§åŒæ­¥æ–¹å¼ï¼š ç‹¬å æ¨¡å¼ï¼šè¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œä¾‹å¦‚ ReentrantLockã€‚ å…±äº«æ¨¡å¼ï¼šè¿™ç§æ–¹å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–é”ï¼Œä¾‹å¦‚ Semaphore å’Œ CountDownLatchã€‚ ä»¥ ReentrantLock ä¸ºä¾‹ï¼Œstate åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚A çº¿ç¨‹ lock() æ—¶ï¼Œä¼šè°ƒç”¨ tryAcquire() ç‹¬å è¯¥é”å¹¶å°† state+1 ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å† tryAcquire() æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ° A çº¿ç¨‹ unlock() åˆ° state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstate ä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šå°‘æ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ state æ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚ å†ä»¥ CountDownLatch ä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸º N ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstate ä¹Ÿåˆå§‹åŒ–ä¸º Nï¼ˆæ³¨æ„ N è¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™ N ä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown() ä¸€æ¬¡ï¼Œstate ä¼š CAS(Compare and Swap) å‡ 1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³ state=0 )ï¼Œä¼š unpark() ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä» await() å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚ 2.semaphoresynchronized å’Œ ReentrantLock éƒ½æ˜¯ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªèµ„æºï¼Œè€ŒSemaphore(ä¿¡å·é‡)å¯ä»¥ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚ Semaphore é€šå¸¸ç”¨äºé‚£äº›èµ„æºæœ‰æ˜ç¡®è®¿é—®æ•°é‡é™åˆ¶çš„åœºæ™¯æ¯”å¦‚é™æµï¼Œä¹Ÿå°±æ˜¯æµé‡æ§åˆ¶ semaphoreçš„åŸç† Semaphore æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°ï¼Œå®ƒé»˜è®¤æ„é€  AQS çš„ state å€¼ä¸º permitsï¼Œä½ å¯ä»¥å°† permits çš„å€¼ç†è§£ä¸ºè®¸å¯è¯çš„æ•°é‡ï¼Œåªæœ‰æ‹¿åˆ°è®¸å¯è¯çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œã€‚ è°ƒç”¨semaphore.acquire() ï¼Œçº¿ç¨‹å°è¯•è·å–è®¸å¯è¯ï¼Œå¦‚æœ state &gt;= 0 çš„è¯ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥è·å–æˆåŠŸã€‚å¦‚æœè·å–æˆåŠŸçš„è¯ï¼Œä½¿ç”¨ CAS æ“ä½œå»ä¿®æ”¹ state çš„å€¼ state=state-1ã€‚å¦‚æœ state&lt;0 çš„è¯ï¼Œåˆ™è¡¨ç¤ºè®¸å¯è¯æ•°é‡ä¸è¶³ã€‚æ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ª Node èŠ‚ç‚¹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚ è°ƒç”¨semaphore.release(); ï¼Œçº¿ç¨‹å°è¯•é‡Šæ”¾è®¸å¯è¯ï¼Œå¹¶ä½¿ç”¨ CAS æ“ä½œå»ä¿®æ”¹ state çš„å€¼ state=state+1ã€‚é‡Šæ”¾è®¸å¯è¯æˆåŠŸä¹‹åï¼ŒåŒæ—¶ä¼šå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ã€‚ è¢«å”¤é†’çš„çº¿ç¨‹ä¼šé‡æ–°å°è¯•å»ä¿®æ”¹ state çš„å€¼ state=state-1 ï¼Œå¦‚æœ state&gt;=0 åˆ™è·å–ä»¤ç‰ŒæˆåŠŸï¼Œå¦åˆ™é‡æ–°è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·çº¿ç¨‹ã€‚ 3.CountDownLatchCountDownLatch ï¼ˆå€’è®¡æ—¶å™¨ï¼‰ç”¨äºåè°ƒå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚ å®ƒå…è®¸ count ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ã€‚ CountDownLatch çš„æ ¸å¿ƒæ–¹æ³•ä¹Ÿä¸å¤šï¼š CountDownLatch(int count)ï¼šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰ç»™å®šè®¡æ•°å™¨çš„ CountDownLatchã€‚ void await()ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸ºé›¶ã€‚ void countDown()ï¼šé€’å‡è®¡æ•°å™¨çš„å€¼ï¼Œå¦‚æœè®¡æ•°å™¨å€¼å˜ä¸ºé›¶ï¼Œåˆ™é‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚ CountDownLatch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å™¨çš„å€¼åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åæ²¡æœ‰ä»»ä½•æœºåˆ¶å†æ¬¡å¯¹å…¶è®¾ç½®å€¼ï¼Œå½“ CountDownLatch ä½¿ç”¨å®Œæ¯•åï¼Œå®ƒä¸èƒ½å†æ¬¡è¢«ä½¿ç”¨ã€‚ CountDownLatchçš„åŸç†æ˜¯ä»€ä¹ˆ CountDownLatch æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°,å®ƒé»˜è®¤æ„é€  AQS çš„ state å€¼ä¸º countã€‚ å½“çº¿ç¨‹ä½¿ç”¨ countDown() æ–¹æ³•æ—¶,å…¶å®ä½¿ç”¨äº†tryReleaseSharedæ–¹æ³•ä»¥ CAS çš„æ“ä½œæ¥å‡å°‘ state,ç›´è‡³ state ä¸º 0 ã€‚ å½“è°ƒç”¨ await() æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœ state ä¸ä¸º 0ï¼Œé‚£å°±è¯æ˜ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œawait() æ–¹æ³•å°±ä¼šä¸€ç›´é˜»å¡ï¼Œä¹Ÿå°±æ˜¯è¯´ await() æ–¹æ³•ä¹‹åçš„è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œã€‚ ç›´åˆ°count ä¸ªçº¿ç¨‹è°ƒç”¨äº†countDown()ä½¿ state å€¼è¢«å‡ä¸º 0ï¼Œæˆ–è€…è°ƒç”¨await()çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œè¯¥çº¿ç¨‹æ‰ä¼šä»é˜»å¡ä¸­è¢«å”¤é†’ï¼Œawait() æ–¹æ³•ä¹‹åçš„è¯­å¥å¾—åˆ°æ‰§è¡Œã€‚ ç”¨è¿‡CountDownLatchå—ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨çš„ æµ‹è¯•åˆ†å¸ƒå¼IDç”Ÿæˆé€Ÿåº¦çš„æ—¶å€™ç”¨è¿‡ 1234567891011121314151617181920212223242526272829303132333435//æµ‹è¯•ç±»@SpringBootTestpublic class RedisIdWorkerTest &#123; @Resource private RedisIdWorker redisIdWorker; private ExecutorService es = Executors.newFixedThreadPool(500); /** * æµ‹è¯•åˆ†å¸ƒå¼IDç”Ÿæˆå™¨çš„æ€§èƒ½ï¼Œä»¥åŠå¯ç”¨æ€§ */ @Test public void testNextId() throws InterruptedException &#123; // ä½¿ç”¨CountDownLatchè®©çº¿ç¨‹åŒæ­¥ç­‰å¾… CountDownLatch latch = new CountDownLatch(300); // åˆ›å»ºçº¿ç¨‹ä»»åŠ¡ Runnable task = () -&gt; &#123; for (int i = 0; i &lt; 100; i++) &#123; long id = redisIdWorker.nextId(&quot;order&quot;); System.out.println(&quot;id = &quot; + id); &#125; // ç­‰å¾…æ¬¡æ•°-1 latch.countDown(); &#125;; long begin = System.currentTimeMillis(); // åˆ›å»º300ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ›å»º100ä¸ªidï¼Œæ€»è®¡ç”Ÿæˆ3wä¸ªid for (int i = 0; i &lt; 300; i++) &#123; es.submit(task); &#125; // çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’0æ—¶æ‰å…¨éƒ¨å”¤é†’æ‰€æœ‰çº¿ç¨‹ latch.await(); long end = System.currentTimeMillis(); System.out.println(&quot;ç”Ÿæˆ3wä¸ªidå…±è€—æ—¶&quot; + (end - begin) + &quot;ms&quot;); &#125;&#125; 4.ConcurrentHashMapå‚ç…§é›†åˆç¯‡ 5.CyclicBarrieråŒæ­¥å±éšœã€‚CyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚ CyclicBarrier å…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾ä¸€ä¸ªå…¬å…±çš„å±éšœç‚¹ã€‚ å½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾è¿™ä¸ªå±éšœç‚¹åï¼Œå®ƒä»¬å¯ä»¥ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œ å¹¶ä¸”è¿™ä¸ªå±éšœå¯ä»¥è¢«é‡ç½®å¾ªç¯ä½¿ç”¨ã€‚ å®ƒå’Œ CountDownLatch ç±»ä¼¼ï¼Œéƒ½å¯ä»¥åè°ƒå¤šçº¿ç¨‹çš„ç»“æŸåŠ¨ä½œï¼Œåœ¨å®ƒä»¬ç»“æŸåéƒ½å¯ä»¥æ‰§è¡Œç‰¹å®šåŠ¨ä½œ","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"JUC","slug":"JUC","permalink":"http://example.com/tags/JUC/"}]},{"title":"ç™½éª¡å¤´æ¡","slug":"ç™½éª¡å¤´æ¡","date":"2024-10-23T12:08:21.000Z","updated":"2024-10-27T13:37:11.080Z","comments":true,"path":"2024/10/23/ç™½éª¡å¤´æ¡/","permalink":"http://example.com/2024/10/23/%E7%99%BD%E9%AA%A1%E5%A4%B4%E6%9D%A1/","excerpt":"","text":"å†™åœ¨å‰é¢è™½ç„¶ç›®å‰æ­£åœ¨å®ä¹ ï¼Œä½†ä¹Ÿå¯ä»¥é€æ­¥å¼€å§‹å¾®æœåŠ¡çš„ç›¸å…³å­¦ä¹ äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘çš„å­¦ä¹ ç›®æ ‡æ˜¯ï¼š åƒé€è¯¥é¡¹ç›®ï¼Œåœ¨çœ‹å®Œè§†é¢‘æ•™ç¨‹åç‹¬ç«‹å®Œæˆç›¸åº”éœ€æ±‚å¼€å‘ ä¸æ±‚é€Ÿåº¦ï¼Œæ±‚è´¨é‡ï¼Œè¿™ä¸ªé¡¹ç›®æ—¶é—´è¿˜æ˜¯æ¯”è¾ƒå……è£•çš„ å­¦ä¼šè¯¥é¡¹ç›®æ¶‰åŠæŠ€æœ¯æ ˆçš„æ—¥å¸¸åŸºç¡€ä½¿ç”¨ 10-23 day01nacosç¯å¢ƒæ­å»º1ã€é…ç½®è™šæ‹Ÿé•œåƒ æ›´æ”¹è™šæ‹Ÿæœºå­ç½‘åœ°å€ å›¾ä¸Šå†™é”™äº†ï¼Œæ˜¯é€‰æ‹©vm8ï¼Œç„¶åæ›´æ”¹å­ç½‘IP æ›´æ”¹è™šæ‹Ÿæœºè®¾ç½®-ç½‘ç»œé€‚é…å™¨-æ”¹ä¸ºvm8-netæ¨¡å¼ è§†é¢‘é‡Œé¢ç”¨çš„æ˜¯finalshellè¿æ¥çš„è™šæ‹Ÿæœºï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯xShellï¼Œæ³¨æ„å»ºç«‹è¿æ¥ï¼Œå¦‚æœæŒ‰ç…§è§†é¢‘é‡Œé¢192.168.200.130å»ºç«‹è¿æ¥çš„è¯ï¼Œéœ€è¦å…ˆçœ‹çœ‹è™šæ‹Ÿæœºé‡Œé¢çš„IPåœ°å€ï¼Œç„¶åå¯ä»¥æ›´æ”¹ä¸º192.168.200.130æ‰èƒ½è¿æ¥æˆåŠŸ æŒ‰ç…§å¦‚ä¸‹æ›´æ”¹å¥½ä¹‹åï¼Œå†å›åˆ°å›¾2é‡æ–°æ‰“å¼€ä¸€ä¸‹å¼€å…³å°±å¯ä»¥æ›´æ–°IPåœ°å€äº† ä»Šå¤©å…ˆåˆ°è¿™ã€‚ã€‚ã€‚è¦ç”¨dockerå®‰è£…nacosï¼Œï¼Œæˆ‘dockerè¿˜æ²¡å®‰è£…ï¼Œè´¹åŠ²ã€‚ã€‚ã€‚ã€‚ 10-24 day02dockerå®‰è£…å‘ç°centosæ ¹æœ¬è¿ä¸äº†ç½‘ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜ è™šæ‹Ÿä¸»æœºç½‘ç»œçš„ä¸‰ç§æ¨¡å¼åŒºåˆ«ç›´æ¥ç”¨ä¸Šä¸ªå›¾è¿™é‡Œæ¥è¯´ ä»…ä¸»æœºæ¨¡å¼ è™šæ‹Ÿæœºä»…å¯ä»¥ä¸ä¸»æœºè¿›è¡Œé€šä¿¡ æ¡¥æ¥æ¨¡å¼ å®¿ä¸»æœºå’Œè™šæ‹Ÿæœº,éƒ½æ˜¯ç”±å±€åŸŸç½‘è·¯ç”±(DHCP)è¿›è¡ŒIPçš„åˆ†é… å®¿ä¸»æœºå’Œæœ¬åœ°çš„è™šæ‹Ÿæœºä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨ä¹Ÿå¯ä»¥ä¸è™šæ‹Ÿæœºè¿›è¡Œé€šä¿¡ ç¼ºç‚¹ï¼šè™šæ‹Ÿæœºä¼šå ç”¨å¤§é‡çš„IP,å±€åŸŸç½‘å†…å¦‚æœæœºå™¨å¤ªå¤š,æˆ–è€…è™šæ‹Ÿæœºå¤ªå¤š,é‚£ä¹ˆä¼šå‡ºç°å¤§é‡çš„IPå†²çª é€šä¿—çš„è¯´ï¼šè™šæ‹Ÿæœºå°±ç›¸å½“äºä¸€å°çœŸå®çš„æœºå™¨ï¼Œå¦‚æœè™šæ‹Ÿæœºæ•°é‡å¤šçš„è¯ï¼Œä¼šå ç”¨å±€åŸŸç½‘å†…çš„IPï¼Œå¯èƒ½ä¼šé€ æˆå±€åŸŸç½‘å†…çš„IPå†²çª NATæ¨¡å¼ å®¿ä¸»æœºå’Œå…¶ä»–æœºå™¨çš„IPç”±å±€åŸŸç½‘è·¯ç”±è¿›è¡ŒIPçš„åˆ†é…,è™šæ‹Ÿæœºçš„IPé€šè¿‡VMnet8è™šæ‹Ÿäº¤æ¢æœºè¿›è¡Œåˆ†é… å®¿ä¸»æœºå’Œæœ¬åœ°çš„è™šæ‹Ÿæœºä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ ä¸ä¼šå ç”¨å®¿ä¸»æœºæ‰€åœ¨è·¯ç”±IP,ä¸ä¼šé€ æˆIPå†²çª é€šä¿—çš„è¯´ï¼šå®¿ä¸»æœºå†å†…ç½®ä¸€ä¸ªå±€åŸŸç½‘ï¼Œé‡Œé¢æ˜¯è¿™äº›è™šæ‹Ÿæœºï¼Œè¿™äº›è™šæ‹Ÿæœºå°±ä¸ä¼šå ç”¨ç°å®å±€åŸŸç½‘çš„IPäº†ï¼Œè™šæ‹Ÿæœºä¹Ÿå¯ä»¥ä¸å¤–ç½‘é€šä¿¡ï¼Œå”¯ä¸€çš„æ–¹å¼å°±æ˜¯å€ŸåŠ©å®¿ä¸»æœºï¼Œåˆ«äººè®¿é—®ä¸åˆ°ä½ çš„è™šæ‹Ÿæœºã€‚ç¼ºç‚¹ï¼šæ— æ³•ä¸å¤–ç•Œçš„è™šæ‹Ÿæœºé€šä¿¡ 10-27 day03 å“å“Ÿï¼Œè´¹äº†åŠå¤©åŠ²æŠŠcentosçš„ç½‘ç»œé—®é¢˜è§£å†³äº†ï¼Œç»“æœå®‰è£…dockeråˆåºŸäº†åŠå¤©åŠ²ï¼Œå‚è€ƒäº†è¿™ç¯‡ï¼Œæ‰ç®—è§£å†³å¥½dockerçš„å®‰è£…é—®é¢˜ï¼Œç„¶ånacosåˆå®‰è£…æ‹‰ä¸ä¸‹æ¥äº†ï¼Œå¥½åƒæ˜¯è¦é…ç½®é˜¿é‡Œçš„é•œåƒåŠ é€Ÿæºï¼Œç»“æœä¹Ÿæ²¡ç”¨ï¼Œï¼Œï¼Œå°±æ˜¯å›¾ä¸Šè¿™ä¸ªé—®é¢˜ æŠ¥é”™ï¼šError response from daemon: Get â€œhttps://registry-1.docker.io/v2/â€œ: net&#x2F;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers) å“å“Ÿæ— è¯­äº†ã€‚ã€‚ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"é¡¹ç›®","slug":"é¡¹ç›®","permalink":"http://example.com/tags/%E9%A1%B9%E7%9B%AE/"}]},{"title":"æ‚è°ˆ","slug":"æ‚è°ˆ","date":"2024-10-20T02:25:39.000Z","updated":"2024-10-20T02:39:06.660Z","comments":true,"path":"2024/10/20/æ‚è°ˆ/","permalink":"http://example.com/2024/10/20/%E6%9D%82%E8%B0%88/","excerpt":"","text":"ä»¥ä¸‹å†…å®¹ä»ç½‘ä¸Šçœ‹åˆ°çš„è®°å½•ä¸€ä¸‹ æ„Ÿè§‰â€œä¸èˆ’æœâ€çš„åœ°æ–¹è¦è¿œç¦»ï¼Œç›¸ä¿¡è‡ªå·±çš„ç›´è§‰ ä¸è¦éšä¾¿è¯´ä¸å‰åˆ©çš„è¯ï¼Œä¹Ÿä¸è¦éšä¾¿éª‚äººï¼Œç”šè‡³æ˜¯è¯…å’’åˆ«äººï¼Œä¸ç®¡åœ¨ç½‘ä¸Šè¿˜æ˜¯ç°å®ã€‚è¯­è¨€æ˜¯å¾ˆæœ‰èƒ½é‡çš„ä¸œè¥¿ï¼Œä¸è¦ç»™è‡ªå·±åˆ¶é€ è´Ÿèƒ½é‡ å®¶é‡Œï¼Œå°¤å…¶æ˜¯å§å®¤æœ€å¥½ä¸è¦æ‘†æ”¾äººå½¢ç©å¶ å‹¿ä»¥å–„å°è€Œä¸ä¸ºï¼Œå‹¿ä»¥æ¶å°è€Œä¸ºä¹‹ å®¶ä¸­çš„æ¤ç‰©å°½é‡é¿å…è•¨ç±»å’Œè—¤æ›¼ç±»çš„æ¤ç‰©ï¼Œä»¥é˜”å¶ç±»æ¤ç‰©ä¸ºä½³ æœªå®Œå¾…ç»­â€¦","categories":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"http://example.com/categories/%E7%94%9F%E6%B4%BB/"}],"tags":[{"name":"æ‚è°ˆè®°å½•","slug":"æ‚è°ˆè®°å½•","permalink":"http://example.com/tags/%E6%9D%82%E8%B0%88%E8%AE%B0%E5%BD%95/"}]},{"title":"æ­Œå•è¿ç§»","slug":"æ­Œå•è¿ç§»","date":"2024-10-17T14:15:39.000Z","updated":"2024-10-17T14:19:50.382Z","comments":true,"path":"2024/10/17/æ­Œå•è¿ç§»/","permalink":"http://example.com/2024/10/17/%E6%AD%8C%E5%8D%95%E8%BF%81%E7%A7%BB/","excerpt":"","text":"è¿ç§»ç½‘æ˜“äº‘&#x2F;QQéŸ³ä¹æ­Œå• è‡³ Apple&#x2F;Youtube&#x2F;Spotify Musicä¸€ã€æºéŸ³ä¹æ–‡ä»¶å¯¼å‡ºGo-Musicå®˜ç½‘ï¼šhttps://music.unmeta.cn/ Go-Music å¯ä»¥æŠŠç½‘æ˜“äº‘æˆ–è€…QQéŸ³ä¹å¹³å°ä¸Šé¢çš„æ­Œå•ï¼Œä»¥æ–‡æœ¬çš„å½¢å¼å¯¼å‡ºã€‚ äºŒã€è¿ç§»Tunemymusic å®˜ç½‘ï¼šhttps://www.tunemymusic.com/zh-CN/transfer æŒ‰æ­¥éª¤æ“ä½œå³å¯ï¼Œéœ€æ³¨æ„çš„æ˜¯å…è´¹ç‰ˆä¸€æ¬¡æœ€å¤šè¿ç§»500é¦–æ­Œæ›² å‚è€ƒæ–‡çŒ®ï¼šhttps://coderschool.cn/3791.html","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://example.com/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"éŸ³ä¹","slug":"éŸ³ä¹","permalink":"http://example.com/tags/%E9%9F%B3%E4%B9%90/"}]},{"title":"å‰ç«¯äº†è§£","slug":"æŠ€æœ¯ç±»/å‰ç«¯äº†è§£","date":"2024-10-17T12:29:34.000Z","updated":"2024-10-17T12:33:49.110Z","comments":true,"path":"2024/10/17/æŠ€æœ¯ç±»/å‰ç«¯äº†è§£/","permalink":"http://example.com/2024/10/17/%E6%8A%80%E6%9C%AF%E7%B1%BB/%E5%89%8D%E7%AB%AF%E4%BA%86%E8%A7%A3/","excerpt":"","text":"vscodeå®‰è£…æ’ä»¶HTML css support live serverï¼šåœ¨æµè§ˆå™¨ä¸­å®æ—¶é¢„è§ˆé¡µé¢çš„å˜åŒ– auto rename tagï¼šä¿®æ”¹HTMLæ ‡ç­¾çš„æ—¶å€™åŒæ­¥ä¿®æ”¹å¦ä¸€ä¸ªæ ‡ç­¾ ä¸€ã€HTMLæ ‡ç­¾å•æ ‡ç­¾ç”¨äºæ²¡æœ‰å†…å®¹çš„å…ƒç´ ï¼ŒåŒæ ‡ç­¾ç”¨äºæœ‰å†…å®¹çš„å…ƒç´  å¿«é€Ÿç”ŸæˆHTMLåˆå§‹ç»“æ„ï¼šåœ¨vocodeä¸­ï¼+tabé”® æ ‡é¢˜æ ‡ç­¾ h1-6åˆ†åˆ«å¯¹åº”1-6çº§æ ‡é¢˜ æ–‡æœ¬æ ‡ç­¾ pæ®µè½æ ‡ç­¾ bå­—ä½“åŠ ç²—ï¼Œiæ–œä½“ï¼Œuä¸‹åˆ’çº¿ï¼Œsåˆ é™¤çº¿ ulâ€”â€”liæ— åºæ ‡ç­¾ olâ€”â€”liæœ‰åºåˆ—è¡¨ 1 HTMLå±æ€§ è¯­æ³• &lt;å¼€å§‹æ ‡ç­¾ å±æ€§å&#x3D;â€œå±æ€§å€¼â€&gt; å±æ€§åä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†å±æ€§å€¼åŒºåˆ† é€‚ç”¨å¤§å¤šæ•°HTMLå…ƒç´ çš„å±æ€§ classï¼šä¸º HTMLå…ƒç´ å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªç±»å(ç±»åä»æ ·å¼æ–‡ä»¶å¼•å…¥) idï¼šå®šä¹‰å…ƒç´ å”¯ä¸€çš„ id styleï¼šè§„å®šå…ƒç´ çš„è¡Œå†…æ ·å¼ äºŒã€HTMLåŒºå—-å—å…ƒç´ ä¸è¡Œå†…å…ƒç´ å—çº§å…ƒç´ é€šå¸¸ç”¨äºç»„ç»‡å’Œå¸ƒå±€é¡µé¢çš„ä¸»è¦ç»“æ„å’Œå†…å®¹ï¼Œä¾‹å¦‚æ®µè½ã€æ ‡é¢˜ã€åˆ—è¡¨ã€è¡¨æ ¼ç­‰ã€‚å®ƒä»¬ç”¨äºåˆ›å»ºé¡µé¢çš„ä¸»è¦éƒ¨åˆ†ï¼Œå°†å†…å®¹åˆ†éš”æˆé€»è¾‘å—ã€‚ å—çº§å…ƒç´ é€šå¸¸ä¼šä»æ–°è¡Œå¼€å§‹ï¼Œå¹¶å æ®æ•´è¡Œçš„å®½åº¦ï¼Œå› æ­¤å®ƒä»¬ä¼šåœ¨é¡µé¢ä¸Šå‘ˆç°ä¸ºä¸€å—ç‹¬ç«‹çš„å†…å®¹å—ã€‚ å¯ä»¥åŒ…å«å…¶ä»–å—çº§å…ƒç´ å’Œè¡Œå†…å…ƒç´ ã€‚ å¸¸è§çš„å—çº§å…ƒç´ åŒ…æ‹¬div&gt;ï¼Œ&lt;p&gt;ï¼Œ&lt;h1&gt;åˆ°&lt;h6&gt;,,â€˜ç­‰ è¡Œå†…å…ƒç´ é€šå¸¸ç”¨äºæ·»åŠ æ–‡æœ¬æ ·å¼æˆ–ä¸ºæ–‡æœ¬ä¸­çš„ä¸€éƒ¨åˆ†åº”ç”¨æ ·å¼ã€‚å®ƒä»¬å¯ä»¥åœ¨æ–‡æœ¬ä¸­æ’å…¥å°çš„å…ƒç´ ï¼Œä¾‹å¦‚è¶…é“¾æ¥å¼ºè°ƒæ–‡æœ¬ç­‰ã€‚ è¡Œå†…å…ƒç´ é€šå¸¸åœ¨åŒä¸€è¡Œå†…å‘ˆç°ï¼Œä¸ä¼šç‹¬å ä¸€è¡Œã€‚ å®ƒä»¬åªå æ®å…¶å†…å®¹æ‰€éœ€çš„å®½åº¦ï¼Œè€Œä¸æ˜¯æ•´è¡Œçš„å®½åº¦ã€‚ è¡Œå†…å…ƒç´ ä¸èƒ½åŒ…å«å—çº§å…ƒç´ ï¼Œä½†å¯ä»¥åŒ…å«å…¶ä»–è¡Œå†…å…ƒç´ ã€‚ å¸¸è§çš„è¡Œå†…å…ƒç´ åŒ…æ‹¬span&gt;ï¼Œ&lt;img&gt;ï¼Œ&lt;br&gt;ï¼Œ&lt;input&gt;ç­‰, ä¸‰ã€HTMLè¡¨å•form spanæ ‡ç­¾ç­‰äºlabel CSS","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/tags/%E5%89%8D%E7%AB%AF/"}]},{"title":"å½±è§†ç‚¹è¯„","slug":"å½±è§†ç‚¹è¯„","date":"2024-10-10T13:36:25.000Z","updated":"2025-01-17T14:10:11.210Z","comments":true,"path":"2024/10/10/å½±è§†ç‚¹è¯„/","permalink":"http://example.com/2024/10/10/%E5%BD%B1%E8%A7%86%E7%82%B9%E8%AF%84/","excerpt":"","text":"ç”µè§†å‰§ äººæ°‘çš„åä¹‰ï¼š9åˆ† éƒ½æŒºå¥½ï¼š8.5åˆ† å¾æœï¼š9åˆ† ç ´å†°è¡ŒåŠ¨ï¼š8.5åˆ† ç‹‚é£™ï¼š9åˆ† é©¬å¤§å¸…1ï¼š8.5åˆ† æ­¦æ—å¤–ä¼ ï¼š10åˆ† å¯Œè´µï¼š9.5åˆ† æˆ‘æ˜¯ä½™æ¬¢æ°´ï¼š8åˆ†ï¼ˆæœ‰ç‚¹é«˜å¼€ä½èµ° æ²‰é»˜çš„çœŸç›¸ï¼š9åˆ† éšç§˜çš„è§’è½ï¼š9åˆ† æ¼«é•¿çš„å­£èŠ‚ï¼š9.åˆ† åœ°ä¸‹äº¤é€šç«™-ç¬¬ä¸€å­£ï¼š10åˆ† ä¸‰å›½æ¼”ä¹‰ï¼š10åˆ† å°‘å¸…ï¼š9åˆ† å¤§å®…é—¨ï¼š9.5åˆ†ï¼ è¾¹æ°´å¾€äº‹ï¼š7.5åˆ†ï¼ˆé«˜å¼€ä½èµ° æƒåŠ›çš„æ¸¸æˆ-ç»¼è¯„ï¼š9åˆ† é»‘è¢çº å¯Ÿé˜Ÿ-ç»¼è¯„ï¼š8.5åˆ† éŸ¦æ©ï¼šçœ‹çš„æ—¶é—´å¤ªé•¿æœ‰ç‚¹å¿˜äº†ï¼Œæš‚ç»™8åˆ† é—¯å…³ä¸œï¼š9.5åˆ†ï¼ æˆ‘æ˜¯å¤§å“¥å¤§ï¼š10åˆ†ï¼ å¤§æŸ“åŠï¼š9åˆ† ç”µå½± è®©å­å¼¹é£ï¼š10åˆ†ï¼ å¼‚æ¬¡å…ƒéª‡å®¢ï¼š10åˆ†ï¼","categories":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"http://example.com/categories/%E7%94%9F%E6%B4%BB/"}],"tags":[{"name":"å½±è§†","slug":"å½±è§†","permalink":"http://example.com/tags/%E5%BD%B1%E8%A7%86/"}]},{"title":"MybatisPluså­¦ä¹ ","slug":"æŠ€æœ¯ç±»/MybatisPluså­¦ä¹ ","date":"2024-10-09T14:49:21.000Z","updated":"2024-10-16T14:07:36.979Z","comments":true,"path":"2024/10/09/æŠ€æœ¯ç±»/MybatisPluså­¦ä¹ /","permalink":"http://example.com/2024/10/09/%E6%8A%80%E6%9C%AF%E7%B1%BB/MybatisPlus%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"ä¸€ã€å¿«é€Ÿå…¥é—¨1.1ã€ä½¿ç”¨1ã€å¼•å…¥ä¾èµ– æ³¨æ„ï¼šå¼•å…¥äº†MPçš„ä¾èµ–ï¼Œå°±ä¸ç”¨å¼•Mybatisçš„ä¾èµ–äº†ï¼Œè¿™ä¸ªä¾èµ–å·²ç»åŒ…å«äº†Mybatisçš„ 12345&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.5.4&lt;/version&gt; &lt;/dependency&gt; 2ã€å®šä¹‰Mapper è‡ªå®šä¹‰çš„Mapperç»§æ‰¿MybatisPlusæä¾›çš„BaseMapperæ¥å£ï¼ˆè¦åˆ¶å®šå®ä½“ç±»çš„ç±»å‹ï¼‰ 3ã€åœ¨å®ä½“ç±»ä¸Šæ·»åŠ æ³¨è§£å£°æ˜è¡¨ä¿¡æ¯ 4ã€åœ¨application.ymlä¸­æ ¹æ®éœ€è¦æ·»åŠ é…ç½® 1.2ã€å¸¸è§æ³¨è§£MyBatisPlusé€šè¿‡æ‰«æå®ä½“ç±»ï¼Œå¹¶åŸºäºåå°„è·å–å®ä½“ç±»ä¿¡æ¯ä½œä¸ºæ•°æ®åº“è¡¨ä¿¡æ¯ çº¦å®šï¼š ç±»åé©¼å³°è½¬ä¸‹åˆ’çº¿ä½œä¸ºè¡¨å åä¸ºidçš„å­—æ®µä½œä¸ºä¸»é”® å˜é‡åé©¼å³°è½¬ä¸‹åˆ’çº¿ä½œä¸ºè¡¨çš„å­—æ®µå å¦‚æœå®ä½“å’Œè¡¨çš„å¯¹åº”å…³ç³»ä¸ç¬¦åˆä»¥ä¸Šçº¦å®šï¼Œå°±è¦ç”¨æ³¨è§£æ¥é…ç½®äº† @TableNameï¼šç”¨æ¥æŒ‡å®šè¡¨å @TableIdï¼šç”¨æ¥æŒ‡å®šè¡¨ä¸­çš„ä¸»é”®å­—æ®µä¿¡æ¯ @TableFieldï¼šç”¨æ¥æŒ‡å®šè¡¨ä¸­çš„æ™®é€šå­—æ®µä¿¡æ¯ å¯¹äº@TableIdï¼ŒIdTypeæšä¸¾ï¼š AUTO:æ•°æ®åº“è‡ªå¢é•¿ INPUT:é€šè¿‡setæ–¹æ³•è‡ªè¡Œè¾“å…¥ ASSIGN_ID:åˆ†é…IDï¼Œæ¥å£ldentifierGeneratorçš„æ–¹æ³•nextldæ¥ç”Ÿæˆid ä½¿ç”¨@TableFieldçš„å¸¸è§åœºæ™¯ï¼š æˆå‘˜å˜é‡åä¸æ•°æ®åº“å­—æ®µåä¸ä¸€è‡´ æˆå‘˜å˜é‡åä»¥iså¼€å¤´ï¼Œä¸”æ˜¯å¸ƒå°”å€¼ æˆå‘˜å˜é‡åä¸æ•°æ®åº“å…³é”®å­—å†²çª æˆå‘˜å˜é‡ä¸æ˜¯æ•°æ®åº“å­—æ®µ äºŒã€æ ¸å¿ƒåŠŸèƒ½2.1ã€æ¡ä»¶æ„é€ å™¨MyBatisPlusæ”¯æŒå„ç§å¤æ‚çš„whereæ¡ä»¶ï¼Œå¯ä»¥æ»¡è¶³æ—¥å¸¸å¼€å‘çš„æ‰€æœ‰éœ€æ±‚ã€‚ ç¬¬ä¸€æ­¥ï¼šæ„å»ºæŸ¥è¯¢æ¡ä»¶ ç¬¬äºŒæ­¥ï¼šæ“ä½œï¼ˆæŸ¥è¯¢æ›´æ–°ç­‰ï¼‰ æ¨èè¿˜æ˜¯ç”¨lambdaçš„æ¨¡å¼ QueryWrapperå’ŒLambdaQueryWrapperé€šå¸¸ç”¨æ¥æ„å»ºselectdeleteã€updateçš„whereæ¡ä»¶éƒ¨åˆ†UpdateWrapperå’ŒLambdaUpdateWrapperé€šå¸¸åªæœ‰åœ¨setè¯­å¥æ¯”è¾ƒç‰¹æ®Šæ‰ä½¿ç”¨å°½é‡ä½¿ç”¨LambdaQueryWrapperå’ŒLambdaUpdateWrapperé¿å…ç¡¬ç¼–ç  2.2ã€è‡ªå®šä¹‰SQLMPæ“…é•¿whereæ¡ä»¶çš„æ„å»ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨MyBatisPlusçš„Wrapperæ¥æ„å»ºå¤æ‚çš„Whereæ¡ä»¶ï¼Œç„¶åè‡ªå·±å®šä¹‰SQLè¯­å¥ä¸­å‰©ä¸‹çš„éƒ¨åˆ†ã€‚ åŸºäºWrapperæ„å»ºwhereæ¡ä»¶ åœ¨mapperæ–¹æ³•å‚æ•°ä¸­ç”¨Paramæ³¨è§£å£°æ˜wrapperå˜é‡åç§°ï¼Œå¿…é¡»æ˜¯ew è‡ªå®šä¹‰SQLï¼Œå¹¶ä½¿ç”¨Wrapperæ¡ä»¶ 2.3ã€Serviceæ¥å£2.3.1ã€IServiceæ¥å£çš„åŸºæœ¬ä½¿ç”¨ MPçš„Serviceæ¥å£ä½¿ç”¨æµç¨‹æ˜¯æ€æ ·çš„? è‡ªå®šä¹‰Serviceæ¥å£ç»§æ‰¿IServiceæ¥å£ è‡ªå®šä¹‰Serviceå®ç°ç±»ï¼Œå®ç°è‡ªå®šä¹‰æ¥å£å¹¶ç»§æ‰¿Servicelmplç±»","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"MybatisPlus","slug":"MybatisPlus","permalink":"http://example.com/tags/MybatisPlus/"}]},{"title":"å¹¿å·å—åŒ—ç§‘æŠ€é¢ç»","slug":"é¢ç»/å¹¿å·å—åŒ—ç§‘æŠ€é¢ç»","date":"2024-10-09T13:23:30.000Z","updated":"2024-10-10T04:17:23.667Z","comments":true,"path":"2024/10/09/é¢ç»/å¹¿å·å—åŒ—ç§‘æŠ€é¢ç»/","permalink":"http://example.com/2024/10/09/%E9%9D%A2%E7%BB%8F/%E5%B9%BF%E5%B7%9E%E5%8D%97%E5%8C%97%E7%A7%91%E6%8A%80%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"å¹¿å·å°å‚ï¼Œé¢è¯•é—®çš„é—®é¢˜æ„Ÿè§‰å¾ˆå¥‡æ€ªï¼Œæ€»å…±èŠäº†åŠå°æ—¶ èŠäº†å¥½é•¿æ—¶é—´æœ¬ç§‘çš„æ¯•ä¸šè®¾è®¡å’Œç°åœ¨çš„ç ”ç©¶æ–¹å‘ ArrayListçš„åº•å±‚å®ç°ï¼Œæ‰©å®¹æœºåˆ¶ï¼› ç„¶åé—®æ‰©å®¹ï¼ŒArraylistæ­£åœ¨addå…ƒç´ çš„æ—¶å€™ï¼Œæ–°æ•°ç»„å’Œæ—§æ•°ç»„æ€ä¹ˆå¤„ç†ï¼ˆä¸æ˜¯å¾€æ–°æ•°ç»„é‡Œé¢æ‹·è´æ—§æ•°ç»„çš„å…ƒç´ å— HashMapé“¾è¡¨çš„æ‰©å®¹æœºåˆ¶ï¼Œé“¾è¡¨é‡Œé¢æ˜¯valuesï¼Œvaluesæ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼› ç­”ï¼šå¾—åˆ°åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œå¦‚æœè¯¥å¤„èŠ‚ç‚¹æ˜¯é“¾è¡¨ï¼Œä¼šåœ¨é“¾è¡¨ä¸­éå†æœ‰æ²¡æœ‰ç›¸åŒçš„keyï¼Œå¦‚æœæœ‰å°±æ›´æ–°valueï¼Œæ²¡æœ‰å°±åœ¨é“¾è¡¨æœ«å°¾æ’å…¥ï¼Œæœ€ååˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼ˆ8ï¼Œè¿™ä¸ªé˜ˆå€¼å¿˜äº†ï¼Œç›´æ¥è¯´çš„é˜ˆå€¼ï¼‰ï¼Œæ˜¯çš„è¯å°±è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œå¢åŠ æŸ¥æ‰¾æ•ˆç‡ é—®äº†ä¸‹å¹³æ—¶ç”¨ä»€ä¹ˆå¼€å‘å·¥å…· å¾ˆå¤§çš„è¡¨ï¼Œç”¨Select countå»ç»Ÿè®¡è¡¨çš„æ¡æ•°ï¼Œå‘ç°ç‰¹åˆ«æ…¢ï¼Œæ€ä¹ˆä¼˜åŒ– ä¸ä¼šï¼Œä¸€å¼€å§‹æ²¡å¬æ¸…æ¥šçç­”äº†ç´¢å¼•ï¼Œç„¶ååˆè¯´ä»€ä¹ˆselect countï¼ˆ1ï¼‰ï¼Œï¼Œè‡ªå·±éƒ½æœ‰ç‚¹æƒ³ç¬‘å“ˆå“ˆå“ˆ å¾ˆå¤§çš„è¡¨ï¼Œå‘ç°ä¸ç®¡å¹²å•¥éƒ½æ…¢ï¼Œæœ‰ä»€ä¹ˆåŠæ³•ä¼˜åŒ– ä¸ä¼šï¼Œæƒ³åˆ°äº†åˆ†åº“åˆ†è¡¨ï¼Œæ²¡çœ‹è¿™ä¸ªå…«è‚¡ï¼Œ ç„¶ååˆé—®åˆ†ï¼ˆåŒºï¼‰è¡¨ç­–ç•¥ï¼Œæ²¡äº†è§£ åé¢å°±èŠåˆ°æˆ‘çš„æœ¬ç§‘æ¯•ä¸šè®¾è®¡äº† ç„¶ååˆé—®springbootæ€ä¹ˆå®ç°â€˜çº¦å®šå¤§äºé…ç½®â€™çš„ï¼Œä¸ä¼š redisæ€ä¹ˆå®ç°åˆ†å¸ƒå¼é” setnxå‘½ä»¤ åˆè¯´çœ‹æˆ‘è¿™è¾¹æ˜¯ç”¨äº†luaè„šæœ¬ï¼Œç›´æ¥è¯´çš„æ²¡å­¦è¿‡ï¼Œå°±æ˜¯è·Ÿç€è§†é¢‘ç”¨çš„ æœ€ååé—®ç¯èŠ‚","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"æ—¥å¸¸å®ä¹ ","slug":"æ—¥å¸¸å®ä¹ ","permalink":"http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AE%9E%E4%B9%A0/"}]},{"title":"å¹¿å·æ³°è±ªè½¯ä»¶é¢ç»","slug":"é¢ç»/å¹¿å·æ³°è±ªè½¯ä»¶é¢ç»","date":"2024-10-09T13:15:47.000Z","updated":"2024-10-10T04:22:16.023Z","comments":true,"path":"2024/10/09/é¢ç»/å¹¿å·æ³°è±ªè½¯ä»¶é¢ç»/","permalink":"http://example.com/2024/10/09/%E9%9D%A2%E7%BB%8F/%E5%B9%BF%E5%B7%9E%E6%B3%B0%E8%B1%AA%E8%BD%AF%E4%BB%B6%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"ç”¨æ—¶å·®ä¸å¤šæ­£å¥½åŠå°æ—¶ï¼Œé¢çš„æ˜¯æ³°è±ªè½¯ä»¶ï¼ˆå¹¿å·ï¼‰ï¼Œé¢è¯•å®˜äººæ„Ÿè§‰ä¸é”™ã€‚ç¬¬ä¸€æ¬¡é¢è¯•æ„Ÿè§‰æ²¡æœ‰æƒ³è±¡ä¸­çš„é‚£ä¹ˆç´§å¼ ï¼Œå…«è‚¡å’Œé¡¹ç›®éƒ½é—®äº†ä¸€ç‚¹ã€‚ ä¸Šæ¥è‡ªæˆ‘ä»‹ç» å…«è‚¡ï¼š privateï¼Œdefaultï¼Œprotectedï¼Œpublicçš„åŒºåˆ«ï¼› &amp;å’Œ&amp;&amp;çš„åŒºåˆ«ï¼› finalå…³é”®å­—ï¼› breakï¼Œcontinueï¼Œreturnï¼› å•åˆ—é›†åˆï¼ŒListå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼› CopyOnWriteArrayListï¼› å¤šçº¿ç¨‹åŒæ­¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼ˆå°±å›ç­”äº†synchronizedå’Œlockï¼‰ï¼› å¸¸ç”¨çš„çº¿ç¨‹æ± æœ‰å“ªå‡ ç§ï¼ˆä¸€å¼€å§‹æƒ³è¯´é‚£ä¸ªè‹±æ–‡æ–¹æ³•åï¼Œç£•å·´äº†åŠå¤©æ²¡è¯´å‡ºæ¥è¿˜ï¼Œæœ€åç›´æ¥ç”¨ä¸­æ–‡è¯´äº†ï¼‰ï¼› çº¿ç¨‹ä¹‹é—´æ˜¯æ€ä¹ˆä¼ é€’æ•°æ®çš„ï¼ˆæ²¡å›ç­”å¥½ï¼Œæ²¡å‡†å¤‡è¿™ä¸ªå…«è‚¡ï¼‰ï¼› åˆ›å»ºçº¿ç¨‹æœ‰å‡ ç§æ–¹å¼ï¼› é¡¹ç›®ï¼š é™¤äº†MySQLè¿˜äº†è§£è¿‡å…¶å®ƒæ•°æ®åº“å—ï¼ˆæœ¬ç§‘çš„æ—¶å€™å­¦è¿‡Oracleï¼Œæ²¡äº†ï¼‰ï¼› è®¾è®¡redisçš„ç¼“å­˜æ›´æ–°ç­–ç•¥çš„æ—¶å€™ï¼Œè€ƒè™‘å“ªäº›å› ç´ ï¼ˆ1ã€è¿‡æœŸæ—¶é—´ï¼Œ2ã€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œæ›´æ–°ç¼“å­˜ã€‚ä¸çŸ¥é“ å›ç­”çš„å¯¹ä¸å¯¹ï¼‰ï¼› æ€ä¹ˆè§£å†³ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜ç©¿é€çš„ï¼ˆä»‹ç»äº†ä¸€ä¸‹è¿™ä¿©æ˜¯ä»€ä¹ˆï¼Œç„¶åå›ç­”çš„ï¼Œç¼“å­˜å‡»ç©¿ç­”å¾—ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œæœ‰ç‚¹æ··ä¹±äº†ï¼‰ï¼› åé¢å°±æ˜¯èŠå¤©äº† é—®äº†æ„å‘åŸå¸‚ï¼Œ ç„¶åå­¦ä¹ å’Œåšé¡¹ç›®çš„æ—¶å€™æœ‰æ²¡æœ‰ç¢°åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæ˜¯æ€ä¹ˆè§£å†³çš„ å¯¹å‰ç«¯æœ‰äº†è§£å—ï¼Œvueï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„å­¦ä¹ æ„¿ä¸æ„¿æ„äº†è§£ä¸€ä¸‹ é—®äº†ä¸‹å¦‚æœé€šè¿‡æœ€å¿«ä»€ä¹ˆæ—¶å€™èƒ½åˆ°å²— ä¸ªäººèŒä¸šè§„åˆ’ åé—®ç¯èŠ‚ï¼Œé—®äº†å‡ ä¸ªã€‚æœ€åé¢è¯•å®˜ä»‹ç»äº†ä¸€ä¸‹ä»–ä»¬å…¬å¸ä¸šåŠ¡ä»€ä¹ˆçš„","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"æ—¥å¸¸å®ä¹ ","slug":"æ—¥å¸¸å®ä¹ ","permalink":"http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AE%9E%E4%B9%A0/"}]},{"title":"RabbitMQå­¦ä¹ ","slug":"æŠ€æœ¯ç±»/RabbitMQ","date":"2024-10-09T08:39:20.000Z","updated":"2024-10-10T04:05:45.174Z","comments":true,"path":"2024/10/09/æŠ€æœ¯ç±»/RabbitMQ/","permalink":"http://example.com/2024/10/09/%E6%8A%80%E6%9C%AF%E7%B1%BB/RabbitMQ/","excerpt":"","text":"1ã€æ¶ˆæ¯é˜Ÿåˆ—æœ‰å•¥ç”¨ï¼Ÿ å¼‚æ­¥å¤„ç† ç³»ç»Ÿå¯ä»¥å°†é‚£äº›è€—æ—¶çš„ä»»åŠ¡æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¼‚æ­¥å¤„ç†ï¼Œä»è€Œå¿«é€Ÿå“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚æ¯”å¦‚è¯´ï¼Œç”¨æˆ·ä¸‹å•åï¼Œç³»ç»Ÿå¯ä»¥å…ˆè¿”å›ä¸€ä¸ªä¸‹å•æˆåŠŸçš„æ¶ˆæ¯ï¼Œç„¶åå°†è®¢å•ä¿¡æ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œåå°ç³»ç»Ÿå†å»å¤„ç†è®¢å•ä¿¡æ¯ã€‚ å‰Šå³°é™æµ å…ˆå°†çŸ­æ—¶é—´é«˜å¹¶å‘äº§ç”Ÿçš„äº‹åŠ¡æ¶ˆæ¯å­˜å‚¨åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶ååç«¯æœåŠ¡å†æ…¢æ…¢æ ¹æ®è‡ªå·±çš„èƒ½åŠ›å»æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œè¿™æ ·å°±é¿å…ç›´æ¥æŠŠåç«¯æœåŠ¡æ‰“å®æ‰ã€‚ é™ä½ç³»ç»Ÿè€¦åˆæ€§ ç”Ÿäº§è€…å°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´å°±ä¸éœ€è¦ç›´æ¥é€šä¿¡ï¼Œç”Ÿäº§è€…åªç®¡ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªç®¡æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¿™æ ·å°±å®ç°äº†è§£è€¦ã€‚ 2ã€å¸¸è§çš„MQäº§å“ è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka(å¤§ååé‡æ‰ä¼šå»ä½¿ç”¨) è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka 3ã€ RabbitMQ å·¥ä½œæ¨¡å¼ ç®€å•æ¨¡å¼ï¼š ç‰¹ç‚¹:ä½¿ç”¨å•ä¸ªç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°å•ä¸ªæ¶ˆè´¹è€…ã€‚ åº”ç”¨åœºæ™¯:é€‚ç”¨äºç®€å•çš„ä»»åŠ¡åˆ†å‘ï¼Œæ¶ˆæ¯çš„é¡ºåºä¸é‡è¦ å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼š ç‰¹ç‚¹:å¤šä¸ªç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ã€‚ åº”ç”¨åœºæ™¯:é€‚ç”¨äºä»»åŠ¡åˆ†å‘ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼š å¤šäº†ä¸€ä¸ª Exchange è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š ç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰ æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ äº¤æ¢æœºä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeä¸æ¶ˆæ¯é˜Ÿåˆ—çš„ç»‘å®šæ¨¡å¼ï¼š 3.1ã€å¹¿æ’­æ¨¡å¼ï¼ˆfanoutï¼‰ â€‹ å°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ— 3.2ã€è·¯ç”±æ¨¡å¼ï¼ˆå®šå‘æ¨¡å¼ï¼ŒDirect ï¼‰ â€‹ æŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—ï¼Œå¦‚æœè·¯ç”±é”®å®Œå…¨åŒ¹é…çš„è¯ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«æŠ•æ”¾åˆ°ç›¸åº”çš„é˜Ÿåˆ— 3.3ã€ä¸»é¢˜æ¨¡å¼ï¼ˆTopicï¼‰ â€‹ é€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—ï¼Œè®¾ç½®æ¨¡ç³Šçš„ç»‘å®šæ–¹å¼ï¼Œâ€œ*â€æ“ä½œç¬¦å°†â€œ.â€è§†ä¸ºåˆ†éš”ç¬¦ï¼ŒåŒ¹é…å•ä¸ªå­— ç¬¦ï¼›â€œ#â€æ“ä½œç¬¦æ²¡æœ‰åˆ†å—çš„æ¦‚å¿µï¼Œå®ƒå°†ä»»æ„â€œ.â€å‡è§†ä¸ºå…³é”®å­—çš„åŒ¹é…éƒ¨åˆ†ï¼Œèƒ½å¤ŸåŒ¹é…å¤šä¸ªå­—ç¬¦ 4ã€rabbitmqå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§? ç”Ÿäº§ç«¯(Producer)çš„å¯é æ€§ä¿è¯æªæ–½: å‘å¸ƒè€…ç¡®è®¤(Publisher Confirms):ç”Ÿäº§è€…å¯ä»¥é€šè¿‡å¯ç”¨å‘å¸ƒè€…ç¡®è®¤æœºåˆ¶ï¼Œåœ¨æ¶ˆæ¯æˆåŠŸå‘é€ç»™RabbitMQåæ¥æ”¶ç¡®è®¤å›æ‰§ï¼Œç¡®ä¿æ¶ˆæ¯å·²è¢«æ­£ç¡®æ¥æ”¶ã€‚ æœåŠ¡ç«¯(Broker)çš„å¯é æ€§ä¿è¯æªæ–½:æŒä¹…åŒ–(Durability): é˜Ÿåˆ—å’Œäº¤æ¢æœºå¯è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œä½¿å…¶åœ¨RabbitMQé‡æ–°å¯åŠ¨åä¸ä¼šä¸¢å¤± æŒä¹…åŒ–æ¶ˆæ¯:è¢«æ ‡è®°ä¸ºæŒä¹…åŒ–çš„æ¶ˆæ¯ï¼Œä¼šå†™å…¥ç£ç›˜ï¼Œç¡®ä¿æ¶ˆæ¯åœ¨æœåŠ¡å™¨æ•…éšœæ—¶ä¸ä¼šä¸¢å¤±ã€‚ æ¶ˆè´¹ç«¯(Consumer)çš„å¯é æ€§ä¿è¯æªæ–½:æ‰‹åŠ¨æ¶ˆæ¯ç¡®è®¤(Manual Message Acknowedgement):æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åï¼Œå‘é€ç¡®è®¤å›æ‰§ç»™RabbitMQï¼Œå‘ŠçŸ¥æ¶ˆæ¯å·²è¢«æˆåŠŸå¤„ç†ï¼ŒRabbitMQå¯ä»¥åˆ é™¤è¯¥æ¶ˆæ¯ã€‚ 5ã€rabbitmqå¦‚ä½•é¿å…æ¶ˆæ¯å †ç§¯?1.å»ä¼˜åŒ–æ¶ˆè´¹è€…ä»£ç ï¼Œæé«˜æ¶ˆè´¹èƒ½åŠ›ã€‚å‡å°‘æ¶ˆè´¹æ—¶é—´ 2.å¯ä»¥ç»™æ¶ˆè´¹è®¾ç½®å¹´é¾„ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œå¦‚æœè¶…æ—¶å°±ä¸¢å¼ƒæ‰ã€‚å¯ä»¥ä¸è®©æ¶ˆæ¯å¤§é‡å †ç§¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ 3.å¯ä»¥è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼šå¦‚æœè¶…è¿‡äº†ï¼Œå°±æ— æ³•æ¥æ”¶æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ã€‚ 6ã€MQå¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹RabbitMQçš„queueæœ¬èº«å°±æ˜¯é˜Ÿåˆ—ï¼Œæ˜¯å¯ä»¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºæŠ•é€’çš„ã€‚ ä½†æ˜¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹åˆ™æ˜¯å¦ä¸€å›äº‹äº†ï¼Œæ‰€è°“çš„â€œé¡ºåºæ¶ˆè´¹â€æ„å‘³ç€æ˜¯å¦é¡ºåºè¾¾åˆ°ç›®çš„åœ°ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“ã€‚ çœ‹çœ‹ä»¥ä¸‹åœºæ™¯ï¼š ä¸€ä¸ª queueï¼Œå¤šä¸ª consumerã€‚æ¯”å¦‚ï¼Œç”Ÿäº§è€…å‘ RabbitMQ é‡Œå‘é€äº†ä¸‰æ¡æ•°æ®ï¼Œé¡ºåºä¾æ¬¡æ˜¯ data1&#x2F;data2&#x2F;data3ï¼Œå‹å…¥çš„æ˜¯ RabbitMQ çš„ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ã€‚æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…åˆ†åˆ«ä» MQ ä¸­æ¶ˆè´¹è¿™ä¸‰æ¡æ•°æ®ä¸­çš„ä¸€æ¡ï¼Œç»“æœæ¶ˆè´¹è€…2å…ˆæ‰§è¡Œå®Œæ“ä½œï¼ŒæŠŠ data2 å­˜å…¥æ•°æ®åº“ï¼Œç„¶åæ˜¯ data1&#x2F;data3ã€‚è¿™ä¸æ˜æ˜¾ä¹±äº†ã€‚ äº§ç”Ÿå¤šä¸ªconsumerå»æ¶ˆè´¹ä¸€ä¸ªqueueï¼Œææœ‰å¯èƒ½æ˜¯å› ä¸ºï¼šæ¶ˆæ¯æ¶ˆè´¹å¤ªæ…¢ï¼Œæ‰€ä»¥ç›²ç›®è®©å¤šä¸ªconsumeråŒæ—¶æ¥æ¶ˆè´¹ï¼Œè€Œå¿½ç•¥äº†æ¶ˆæ¯æ¶ˆè´¹é¡ºåºæ€§ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ˜¯éœ€è¦ä¿è¯é¡ºåºæ€§çš„ï¼Œå¦‚æœä¸Šå›¾ä¸­çš„data1, data2, data3 åˆ†åˆ«æ„å‘³ç€å¯¹æŸæ¡æ•°æ®çš„å¢æ”¹åˆ ï¼Œä½†æ˜¯å¦‚æœä¹±åºä»¥åå°±å˜æˆäº†ï¼šåˆ æ”¹å¢ã€‚ è§£å†³æ–¹æ¡ˆï¼š å°†åŸæ¥çš„ä¸€ä¸ªqueueæ‹†åˆ†æˆå¤šä¸ªqueueï¼Œæ¯ä¸ªqueueéƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„consumerã€‚è¯¥ç§æ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯ç”Ÿäº§è€…åœ¨æŠ•é€’æ¶ˆæ¯çš„æ—¶å€™æ ¹æ®ä¸šåŠ¡æ•°æ®å…³é”®å€¼(ä¾‹å¦‚è®¢å•IDå“ˆå¸Œå€¼å¯¹è®¢å•é˜Ÿåˆ—æ•°å–æ¨¡)æ¥å°†éœ€è¦ä¿è¯å…ˆåé¡ºåºçš„åŒä¸€ç±»æ•°æ®(åŒä¸€ä¸ªè®¢å•çš„æ•°æ®)å‘é€åˆ°åŒä¸€ä¸ªqueueå½“ä¸­ã€‚ 7ã€MQå¦‚ä½•æ¶ˆæ¯ä¸ä¸¢å¤±ï¼ŒæŒä¹…åŒ– æ¶ˆæ¯æŒä¹…åŒ– ACKç¡®è®¤æœºåˆ¶ï¼ˆé¡¹ç›®ä¸­ä½¿ç”¨ï¼‰ï¼šACKç¡®è®¤æœºåˆ¶æ˜¯æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ”¶åˆ°æ¶ˆæ¯ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­å¦‚æœæ¶ˆè´¹è€…å‡ºç°æœåŠ¡å™¨å¼‚å¸¸ã€ç½‘ç»œä¸ç¨³å®šç­‰ï¼Œéƒ½ä¸ä¼šæœ‰ACKåº”ç­”ï¼Œè¿™æ—¶å€™RabbitMQå°±è®¤ä¸ºè¿™æ¡æ¶ˆæ¯æ²¡æœ‰æ­£å¸¸æ¶ˆè´¹æˆåŠŸï¼Œå°±ä¼šå°†æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ä¸­ã€‚ç›´åˆ°æ¶ˆè´¹è€…å‘é€ACKåº”ç­”ï¼Œè¿™æ¡æ¶ˆæ¯æ‰ä¼šä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ‰ã€‚ä½¿ç”¨ï¼šéœ€è¦æ‰‹åŠ¨å¼€å¯é…ç½®ï¼Œyamlæ–‡ä»¶ publisher-confirm-type: correlated # å¼€å¯ç¡®è®¤æœºåˆ¶å›è°ƒ å¿…é¡»é…ç½®è¿™ä¸ªæ‰ä¼šç¡®è®¤å›è°ƒ â€‹ publisher-returns: true # å¼€å¯returnæœºåˆ¶å›è°ƒ è®¾ç½®é›†ç¾¤é•œåƒæ¨¡å¼ æ¶ˆæ¯è¡¥å¿æœºåˆ¶ æ¶ˆæ¯æŒä¹…åŒ–è§£å†³ï¼š æ¶ˆæ¯ä¸­å¿ƒæ”¶åˆ°ç”Ÿäº§è€…çš„æ¶ˆæ¯åï¼Œå…ˆå°†æ¶ˆæ¯å­˜å‚¨åœ¨æœ¬åœ°æ•°æ®æ–‡ä»¶ï¼Œå†…å­˜æ•°æ®åº“æˆ–è€…è¿œç¨‹æ•°æ®åº“ï¼Œå†è¯•å›¾æŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œå‘é€æˆåŠŸåˆ™è®²æ¶ˆæ¯ä»å­˜å‚¨ä¸­åˆ é™¤ï¼Œå¦‚å¤±è´¥åˆ™ç»§ç»­å°è¯•å‘é€æ¶ˆæ¯ä¸­å¿ƒå¯åŠ¨æ—¶ï¼Œå…ˆä¼šæ£€æŸ¥æŒ‡å®šçš„å­˜å‚¨ä½ç½®ï¼Œå¦‚æœ‰æœªæˆåŠŸå‘é€çš„æ¶ˆæ¯ï¼Œåˆ™ä¼šæŠŠæ¶ˆæ¯å‘é€å‡ºå» Exchange è®¾ç½®æŒä¹…åŒ–ï¼šåŸºäºä»£ç çš„ï¼Œå‚æ•°è®¾ä¸ºtrue Queue è®¾ç½®æŒä¹…åŒ– MessageæŒä¹…åŒ–å‘é€ï¼šå‘é€æ¶ˆæ¯è®¾ç½®å‘é€æ¨¡å¼deliveryMode&#x3D;2ï¼Œä»£è¡¨æŒä¹…åŒ–æ¶ˆæ¯ 8ã€ æ­»ä¿¡é˜Ÿåˆ—æ˜¯ä»€ä¹ˆ DLXï¼Œå…¨ç§°ä¸º Dead-Letter-Exchange ï¼Œæ­»ä¿¡äº¤æ¢å™¨ï¼Œæ­»ä¿¡é‚®ç®±ã€‚å½“æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ (dead message) ä¹‹åï¼Œå®ƒèƒ½è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢å™¨ä¸­ï¼Œè¿™ä¸ªäº¤æ¢å™¨å°±æ˜¯ DLXï¼Œç»‘å®š DLX çš„é˜Ÿåˆ—å°±ç§°ä¹‹ä¸ºæ­»ä¿¡é˜Ÿåˆ—ã€‚ äº§ç”Ÿæ­»ä¿¡çš„æƒ…å†µï¼š æ¶ˆæ¯è¢«æ‹’ç»(Reiected)ï¼šå½“æ¶ˆè´¹è€…æ‹’ç»æ¶ˆè´¹æ¶ˆæ¯æˆ–è€…æ¶ˆæ¯è¶…è¿‡æ¶ˆè´¹è€…çš„æœ€å¤§é‡è¯•æ¬¡æ•°æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ æ¶ˆæ¯è¿‡æœŸ(Expired))ï¼šå¦‚æœæ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹è€…å¤„ç†ï¼Œå³è¶…è¿‡äº†æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œè¯¥æ¶ˆæ¯ä¹Ÿä¼šè¢«å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(Queue Length Limit)ï¼šå½“é˜Ÿåˆ—è¾¾åˆ°äº†å®šä¹‰çš„æœ€å¤§é•¿åº¦é™åˆ¶ï¼Œæ–°çš„æ¶ˆæ¯æ— æ³•è¿›å…¥é˜Ÿåˆ—ï¼Œä¼šå°†æ—§çš„æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ 9ã€RabbitMQæ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜ï¼ˆä¿è¯å¹‚ç­‰æ€§ï¼‰RabbitMQæ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜é€šå¸¸æ˜¯ç”±ä»¥ä¸‹åŸå› å¯¼è‡´çš„: ç”Ÿäº§è€…ç”¨äºå‘é€æ¶ˆæ¯å¤±è´¥åçš„é‡è¯•ï¼Œå¯¼è‡´åˆå‘é€äº†ä¸€æ¬¡é‡å¤çš„æ¶ˆæ¯ æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºåœ¨å¤„ç†æ¶ˆæ¯æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œå¯¼è‡´æ¶ˆæ¯ç¡®è®¤(ack)æ²¡æœ‰å‘é€ç»™RabbitMQï¼Œä»è€Œå¯¼è‡´RabbitMQå°†æ¶ˆæ¯é‡æ–°åˆ†å‘ç»™å…¶ä»–æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚ ç½‘ç»œé—®é¢˜æˆ–æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºé‡å¯æ—¶ï¼ŒRabbitMQæ— æ³•æ”¶åˆ°æ¶ˆæ¯ç¡®è®¤ï¼Œä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯é‡æ–°åˆ†å‘ã€‚ ä¸ºäº†è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜(ä¿è¯æ¶ˆè´¹å¹‚ç­‰æ€§)ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½: ç”Ÿäº§ç«¯: ç”Ÿäº§æ¶ˆæ¯æ—¶ï¼Œä¸ºæ¯ä¸ªæ¶ˆæ¯è®¾ç½®å”¯ä¸€çš„æ¶ˆæ¯ID(å¯ä»¥ä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆå”¯ä¸€ID)ã€‚ æ¶ˆè´¹ç«¯: åŠ é”ï¼šæ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯ä¹‹å‰ï¼Œä½¿ç”¨redis(æ›´å¥½çš„æ˜¯ä½¿ç”¨Redissonæ¡†æ¶ï¼Œå¯ä»¥è‡ªåŠ¨é”ç»­æœŸ)çš„setå‘½ä»¤æ·»åŠ nxé€‰é¡¹è®¾ç½®åˆ†å¸ƒå¼é”ï¼Œkeyä¸ºæ¶ˆæ¯idï¼Œå€¼æ˜¯ä»»æ„å€¼ã€‚å¦‚æœè®¾ç½®åˆ†å¸ƒå¼é”å¤±è´¥ï¼Œåˆ™å¿½ç•¥é‡å¤æ¶ˆæ¯ï¼Œæ‹’ç»å¤„ç†ã€‚å¦‚æœè®¾ç½®åˆ†å¸ƒå¼é”æˆåŠŸï¼Œåˆ™å¤„ç†ä¸šåŠ¡ã€‚ æ¶ˆæ¯ç¡®è®¤ï¼šæ¶ˆè´¹è€…åº”åŠæ—¶åœ°å‘é€æ¶ˆæ¯ç¡®è®¤(ack)ç»™RabbitMQï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸå¤„ç†äº†æ¶ˆæ¯ã€‚è¿™æ ·RabbitMQå°±ä¸ä¼šå°†æ¶ˆæ¯é‡æ–°åˆ†å‘ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"http://example.com/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"}]},{"title":"ä»è®¾å¤‡æ¥ç†è§£è®¡ç®—æœºç½‘ç»œ","slug":"æŠ€æœ¯ç±»/ä»è®¾å¤‡æ¥ç†è§£è®¡ç®—æœºç½‘ç»œ","date":"2024-10-03T12:17:15.000Z","updated":"2024-10-10T04:22:43.405Z","comments":true,"path":"2024/10/03/æŠ€æœ¯ç±»/ä»è®¾å¤‡æ¥ç†è§£è®¡ç®—æœºç½‘ç»œ/","permalink":"http://example.com/2024/10/03/%E6%8A%80%E6%9C%AF%E7%B1%BB/%E4%BB%8E%E8%AE%BE%E5%A4%87%E6%9D%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","excerpt":"","text":"ä¸€ã€Hubé›†çº¿å™¨ï¼ˆç‰©ç†å±‚ï¼‰å¹¿æ’­æ¶ˆæ¯ï¼Œç”±è®¾å¤‡è‡ªå·±åˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å‘é€ç»™è‡ªå·±çš„ ä½†å¦‚æœä¸¤ä¸ªè®¾å¤‡åŒæ—¶å‘é€ç”µå¹³ä¿¡å·ï¼Œä¼šå¯¼è‡´æ¶ˆæ¯æ‚ç³…èµ·æ¥ï¼Œå¯¼è‡´æƒ³æ¥æ”¶çš„è®¾å¤‡è§£æä¸äº† CSMA&#x2F;CDåè®®ï¼šè½½æ³¢ç›‘å¬åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰å…ˆæ£€æµ‹æœ‰æ— è®¾å¤‡æ­£åœ¨å‘é€æ¶ˆæ¯ ç¼ºç‚¹ï¼š åªèƒ½æœ‰ä¸€ä¸ªè®¾å¤‡åŒæ—¶å‘é€æ•°æ® éœ€è¦å¹¿æ’­æ¶ˆæ¯ï¼Œå ç”¨å¸¦å®½ äºŒã€SWäº¤æ¢æœºï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰äº¤æ¢æœºå¯è®°å½•æ ‡è¯†ï¼šï¼ˆè®¾å¤‡ï¼‰Macåœ°å€å’Œï¼ˆäº¤æ¢æœºï¼‰ç«¯å£çš„æ˜ å°„ å¯¹HUBçš„æ”¹è¿› æ‰€ä»¥è¿™ç§æ–¹å¼ä¸éœ€è¦å°†æ¶ˆæ¯å¹¿æ’­ è€Œä¸”äº¤æ¢æœºé‡‡ç”¨çš„æ˜¯å…¨åŒå·¥ï¼Œå°±æ˜¯å¯ä»¥è¾¹å‘è¾¹æ”¶ï¼Œè€Œé›†çº¿å™¨æ˜¯åŠåŒå·¥çš„ï¼Œä¸èƒ½åŒæ—¶æ”¶å‘æ¶ˆæ¯ äº¤æ¢æœºå¯ä»¥æ¡¥æ¥äº¤æ¢æœºï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡æŸä¸ªç«¯å£å‘å¦ä¸€ä¸ªäº¤æ¢æœºçš„è®¾å¤‡å‘é€æ¶ˆæ¯ ç¼ºç‚¹ï¼š å¯ä»¥åœ¨å±€åŸŸç½‘å†…ä½¿ç”¨ï¼Œåœ¨å¤§è§„æ¨¡ç½‘ç»œä¸­å°±æœ‰ç‚¹ä¹åŠ›äº†ï¼Œè¦æ‰¾åˆ°è®¾å¤‡éœ€è¦ä¸åœçš„å¹¿æ’­ï¼ˆä¸€å¼€å§‹äº¤æ¢æœºä¸­æœªè®°å½•å¯¹åº”æ˜ å°„çš„æ—¶å€™ï¼‰ï¼Œå¯èƒ½ä¼šé€ æˆæ³›æ´ª ä¸‰ã€è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰ï¼ˆç½‘ç»œå±‚ï¼‰å¤šä¸ªç½‘ç»œä¹‹é—´çš„é€šä¿¡ è¿™é‡Œæå‡ºIPåœ°å€ï¼šä¸€æ˜¯æ ‡è¯†ç½‘ç»œï¼ŒäºŒæ˜¯æ ‡è¯†è®¾å¤‡ã€‚ IPåœ°å€æ˜¯ä¸€ä¸ªæŠ½è±¡çš„åœ°å€ï¼ŒçœŸæ­£ä¼ è¾“çš„æ—¶å€™è¿˜æ˜¯éœ€è¦macåœ°å€ï¼ˆçœŸå®åœ°å€ï¼‰ æ‰€ä»¥åœ¨åŒä¸€ä¸ªç½‘ç»œå†…ä¼ è¾“æ—¶ å…ˆæ ¹æ®ç›®æ ‡IPåœ°å€å¾—åˆ°å…¶macåœ°å€ï¼ŒARPåè®® å°±å¯ä»¥è¿›è¡Œä¼ è¾“äº†","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"å¹¿å·äº¿è¿…ç§‘æŠ€é¢ç»","slug":"é¢ç»/å¹¿å·äº¿è¿…ç§‘æŠ€é¢ç»","date":"2024-09-29T10:43:20.000Z","updated":"2024-10-10T04:31:36.029Z","comments":true,"path":"2024/09/29/é¢ç»/å¹¿å·äº¿è¿…ç§‘æŠ€é¢ç»/","permalink":"http://example.com/2024/09/29/%E9%9D%A2%E7%BB%8F/%E5%B9%BF%E5%B7%9E%E4%BA%BF%E8%BF%85%E7%A7%91%E6%8A%80%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"å…¨ç¨‹å¤§æ¦‚åŠå°æ—¶å·¦å³ï¼Œéƒ½ä¸æ˜¯ä¸¥æ ¼çš„é—®ç­”ï¼Œæ¯”è¾ƒå¼€æ”¾å¼çš„ï¼Œæ„Ÿè§‰è·ŸæŠ¥èœåä¼¼çš„ï¼Œå…¨æ˜¯å…«è‚¡é¡¹ç›®å‡ ä¹æ²¡é—® èŠåˆ°ä¸€äº›é›†åˆç±»ï¼ŒæŠŠListï¼ŒMapï¼ŒSetéƒ½ä»‹ç»äº†ä¸€ä¸‹ï¼Œä»¥åŠå¯¹åº”çš„ä½¿ç”¨åœºæ™¯ ArrayListå’ŒLinkedListçš„åŒºåˆ« ArrayListçš„æ‰©å®¹æœºåˆ¶ HashMapç®€å•è¯´äº†ä¸€ä¸‹ï¼Œéƒ½æ²¡æ¶‰åŠåˆ°putæµç¨‹ I&#x2F;Oï¼Œä¸ç†Ÿ é¡¹ç›®ä¸­æ€ä¹ˆç”¨çš„ä¹è§‚é”æ‚²è§‚é” ç½‘ç»œç¼–ç¨‹ï¼ŒSocketï¼Œä¸ç†Ÿ NIO&#x2F;BIOï¼Œä¸ç†Ÿ åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ€ä¹ˆè®©ä¸€éƒ¨åˆ†æ•°æ®ä¸è¢«åºåˆ—åŒ–ï¼Œç¬¬äºŒä¸ªå¿˜äº† Springçš„IOCå’ŒAOP sqlçš„å…¨ç§°ï¼Œå¿˜äº†ã€‚ã€‚-_-|| ç„¶åé—®çš„è§†å›¾ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œéƒ½æ²¡èƒŒã€‚ã€‚ ç´¢å¼•ç®€å•ç­”äº†ä¸€ä¸‹åº•å±‚æ•°æ®ç»“æ„ è¡¨ä¹‹é—´çš„è¿æ¥ JDBCï¼Œæ²¡çœ‹ï¼Œ Stringï¼ŒStringBufferï¼ŒStringBulder &#x3D;&#x3D;å’Œequals åç»­10.8 OC","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"æ—¥å¸¸å®ä¹ ","slug":"æ—¥å¸¸å®ä¹ ","permalink":"http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AE%9E%E4%B9%A0/"}]},{"title":"Springé¢è¯•å¸¸é—®é¢˜ç›®","slug":"æŠ€æœ¯ç±»/Springé¢è¯•å¸¸é—®é¢˜ç›®","date":"2024-09-26T03:09:46.000Z","updated":"2024-10-10T04:06:18.686Z","comments":true,"path":"2024/09/26/æŠ€æœ¯ç±»/Springé¢è¯•å¸¸é—®é¢˜ç›®/","permalink":"http://example.com/2024/09/26/%E6%8A%80%E6%9C%AF%E7%B1%BB/Spring%E9%9D%A2%E8%AF%95%E5%B8%B8%E9%97%AE%E9%A2%98%E7%9B%AE/","excerpt":"","text":"ä¸€ã€Spring springç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼ˆä»æºç æ–¹é¢è¯¦ç»†è¯´è¯´ï¼‰ AOPåŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°è¿‡ç¨‹ï¼Œè¯¦ç»†è¯´æ˜ Springçš„åŸºæœ¬ç‰¹æ€§ï¼ˆè¯´äº†ä¸€ä¸‹IOCå’ŒAOPï¼Œå¾ªç¯ä¾èµ–é—®é¢˜è¯´çš„ä¸å¥½ï¼Œæ²¡æåˆ°ç¬¬ä¸‰å±‚ç¼“å­˜ï¼‰ springçš„è£…é…åŸç†ï¼ˆæ²¡è®²å‡ºæ¥ï¼‰ springæ¡†æ¶ä¸­æœ‰ç”¨è¿‡å“ªäº›åŠŸèƒ½ï¼Ÿ ç­”ï¼šioc + di + aop IOCæ˜¯æ€ä¹ˆå®ç°çš„ï¼ŒAOPä½¿ç”¨çš„ä»€ä¹ˆåŠ¨æ€ä»£ç† Springbootè‡ªåŠ¨è£…é… .Springä¸­å¦‚ä½•é…ç½®ä¸€ä¸ªç±»åŠ è½½ä¸€ä¸ªç±»ä¸åŠ è½½ ç”¨è¿‡å“ªäº›æ³¨è§£ @Autowireå’Œ@ResourceåŒºåˆ« springçš„AOPæ˜¯ä»€ä¹ˆï¼Ÿè°ˆè°ˆä½ çš„ç†è§£ï¼Ÿè¿™ä¸ªå’Œaspectjæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿä½ æœ‰å†™è¿‡é‚£äº›åˆ‡é¢ï¼Ÿ è¯´ä¸€ä¸‹spring spring bean çš„ç”Ÿå‘½å‘¨æœŸ äºŒã€SpringBoot springbootå¯åŠ¨æµç¨‹ï¼ˆé¢è¯•å‰çœ‹äº†ç‰›å®¢å…¶ä»–åŒå­¦çš„é¢ç»ï¼Œä½†æ˜¯æ²¡ç­”å‡ºæ¥tomcatå¯åŠ¨ï¼‰ tomcatå¦‚ä½•æ¥æ”¶httpè¯·æ±‚ï¼ˆå’‹æ¥æ”¶ï¼Œä¸æ˜¯æ‹¿å‚æ•°æ¥æ”¶çš„ï¼Ÿï¼‰ springbootæ˜¯æ€ä¹ˆæ‰§è¡Œçš„ è¯·æ±‚åˆ°SpringBootå…·ä½“å¤„ç†å‡½æ•°çš„æµç¨‹ ä¸‰ã€SpringMVC æ€ä¹ˆç†è§£MVCæ¡†æ¶ Springmvcçš„å…³é”®æŠ€æœ¯ æ‹¦æˆªå™¨çš„å…·ä½“è¿‡ç¨‹å’Œåº”ç”¨ springMVCçŸ¥é“å—ï¼ŸMVCçš„åŸç†ï¼Œåˆ†åˆ«æŒ‡ä»€ä¹ˆï¼Ÿ å››ã€SpringColoud SpringCloud çš„æ•´ä½“æ¶æ„ spring cloudä½ ç”¨è¿‡å“ªäº›å¸¸ç”¨çš„ç»„ä»¶ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ è¯´ä¸€ä¸‹springcloud å››ã€Mybatis mybatisæ€ä¹ˆå®ç°æ•ˆç‡çš„æå‡ï¼Œç»™å‡ºå‡ ç§æ–¹æ³• Mybatisä½¿ç”¨æ–¹å¼ mybatisè¿”å›ä¸€ä¸ªlistå¦‚ä½•å°è£…æˆä¸€ä¸ªobjectå¯¹è±¡ï¼ˆæ²¡è®²å‡ºæ¥ï¼‰ äº”ã€git gitå‘½ä»¤ï¼Œmrä»£ç å†²çªæ€ä¹ˆè§£å†³ï¼Œ ä½¿ç”¨è¿‡ git å—ï¼Œæœ‰ä½¿ç”¨ git åˆ›å»ºè¿‡åˆ†æ”¯å—ï¼Ÿ å…­ã€Linux ä½¿ç”¨è¿‡ linux å—ï¼Ÿä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ‰¾å‡ºé”™è¯¯çš„è¿è¡Œæ—¥å¿—ã€‚ æŸ¥çœ‹linuxç‰©ç†æœºæ–‡ä»¶ï¼Œæœç´¢æŸä¸ªå…³é”®è¯ linuxå¸¸ç”¨å‘½ä»¤ã€‚ linuxæŠ“åŒ…ï¼ˆä¸äº†è§£ï¼‰","categories":[],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"Mysqlå­¦ä¹ ","slug":"æŠ€æœ¯ç±»/Mysqlå­¦ä¹ ","date":"2024-09-11T10:40:44.000Z","updated":"2024-10-10T01:58:25.099Z","comments":true,"path":"2024/09/11/æŠ€æœ¯ç±»/Mysqlå­¦ä¹ /","permalink":"http://example.com/2024/09/11/%E6%8A%80%E6%9C%AF%E7%B1%BB/Mysql%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"SQLè¯­å¥DDLï¼ˆData Definition Languageï¼‰æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡(æ•°æ®åº“ï¼Œè¡¨ï¼Œå­—æ®µ) æ•°æ®åº“æ“ä½œ12345678910#æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“SHOW DATABASES; #æŸ¥è¯¢å½“å‰æ•°æ®åº“SELECT DATABASE; #åˆ›å»ºCREATE DATABASE [IF NOT EXISTS] æ•°æ®åº“å [DEFAULT CHARSET å­—ç¬¦é›†] [COLLATE æ’åºè§„åˆ™]; #åˆ é™¤DROP DATABASE[IF EXISTS] æ•°æ®åº“å;#ä½¿ç”¨USE æ•°æ®åº“åï¼› è¡¨æ“ä½œ123456789101112131415161718192021222324252627282930#æŸ¥è¯¢å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨SHOW TABLES;#æŸ¥è¯¢è¡¨ç»“æ„DESC è¡¨åï¼›#æŸ¥çœ‹æŒ‡å®šè¡¨çš„å»ºè¡¨è¯­å¥ï¼›SHOW CREATE è¡¨åï¼›#åˆ›å»ºè¡¨CREATE TABLE è¡¨åï¼ˆ å­—æ®µ1 å­—æ®µ1ç±»å‹ [COMMENT å­—æ®µ1æ³¨é‡Š(ç”¨å•å¼•å·æ‹¬èµ·æ¥)]ï¼Œ å­—æ®µ2 å­—æ®µ2ç±»å‹ [COMMENT å­—æ®µ2æ³¨é‡Š]ï¼Œ å­—æ®µ3 å­—æ®µ3ç±»å‹ [COMMENT å­—æ®µ3æ³¨é‡Š]ï¼Œ ... å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š])[COMMENT è¡¨æ³¨é‡Š];#æ·»åŠ å­—æ®µALTER TABLE è¡¨å ADD å­—æ®µå ç±»å‹ï¼ˆé•¿åº¦ï¼‰[COMMENT æ³¨é‡Š][çº¦æŸ];#ä¿®æ”¹æ•°æ®ç±»å‹ALTER TABLE è¡¨å MODIFY å­—æ®µå æ–°æ•°æ®ç±»å‹ï¼ˆé•¿åº¦ï¼‰;#ä¿®æ”¹å­—æ®µåå’Œæ•°æ®ç±»å‹ALTER TABLE è¡¨å CHANGE æ—§å­—æ®µå æ–°å­—æ®µå æ–°ç±»å‹ï¼ˆé•¿åº¦ï¼‰[COMMENT æ³¨é‡Š][çº¦æŸ];#åˆ é™¤å­—æ®µALTER TABLE è¡¨å DROP å­—æ®µå;#åˆ é™¤è¡¨DROP TABLE[IF EXISTS] è¡¨å;#åˆ é™¤æŒ‡å®šè¡¨ï¼Œå¹¶é‡æ–°åˆ›å»ºè¯¥è¡¨TRUNCATE TABLE è¡¨åï¼› DMLï¼ˆData Manipulation Languageï¼‰æ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥å¯¹æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ 123456789101112131415161718#æ·»åŠ æ•°æ®#1ã€ç»™æŒ‡å®šå­—æ®µæ·»åŠ æ•°æ®INSERT INTO è¡¨åï¼ˆå­—æ®µå1ï¼Œå­—æ®µå2ï¼Œ...ï¼‰ VALUES(å€¼1ï¼Œå€¼2ï¼Œ...);#2ã€ç»™å…¨éƒ¨å­—æ®µæ·»åŠ æ•°æ®INSERT INTO è¡¨å VALUES(å€¼1ï¼Œå€¼2ï¼Œ...);#3ã€æ‰¹é‡æ·»åŠ æ•°æ®INSERT INTO è¡¨åï¼ˆå­—æ®µå1ï¼Œå­—æ®µå2ï¼Œ...ï¼‰ VALUES(å€¼1ï¼Œå€¼2ï¼Œ...),(å€¼1ï¼Œå€¼2ï¼Œ...),(å€¼1ï¼Œå€¼2ï¼Œ...);INSERT INTO è¡¨å VALUES (å€¼1ï¼Œå€¼2ï¼Œ...),(å€¼1ï¼Œå€¼2ï¼Œ...),(å€¼1ï¼Œå€¼2ï¼Œ...);#å­—ç¬¦ä¸²å’Œæ—¥æœŸå‹æ•°æ®åº”è¯¥åŒ…å«åœ¨å¼•å·ä¸­ï¼Œæ’å…¥çš„æ•°æ®å¤§å°åº”è¯¥åœ¨å­—æ®µçš„è§„å®šèŒƒå›´å†…ï¼Œæ‹¬å·è¦åŠ #ä¿®æ”¹æ•°æ®UPDATE è¡¨å SET å­—æ®µå1=å€¼1ï¼Œå­—æ®µå2=å€¼2,...[WHERE æ¡ä»¶];#ä¿®æ”¹è¯­å¥çš„æ¡ä»¶å¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šä¿®æ”¹æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®#åˆ é™¤æ•°æ®DELETE FROM è¡¨å [WHERE æ¡ä»¶];#æ¡ä»¶å¯ä»¥æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šåˆ é™¤æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®#DELETEä¸èƒ½åˆ é™¤æŸä¸€ä¸ªå­—æ®µçš„å€¼ï¼ˆå¯ä»¥ç”¨UPDATE) DQLï¼ˆData Query Languageï¼‰æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½• åŸºæœ¬æŸ¥è¯¢12345678#åŸºæœ¬æŸ¥è¯¢#1ã€æŸ¥è¯¢å¤šä¸ªå­—æ®µSELECT å­—æ®µ1ï¼Œå­—æ®µ2ï¼Œå­—æ®µ3ï¼Œ...FROM è¡¨åï¼›SELECT * FROM è¡¨åï¼›#2ã€è®¾ç½®åˆ«åSELECT å­—æ®µ1[AS åˆ«å1],å­—æ®µ2[AS åˆ«å2] ...FROM è¡¨åï¼›#3ã€å»æ‰é‡å¤è®°å½•SELECT DISTINCT å­—æ®µåˆ—è¡¨ FROM è¡¨åï¼› æ¡ä»¶æŸ¥è¯¢123#æ¡ä»¶æŸ¥è¯¢#1ã€è¯­æ³•SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHERE æ¡ä»¶åˆ—è¡¨ï¼› æ¡ä»¶æŸ¥è¯¢çš„æ¡ä»¶åˆ—è¡¨ æ¯”è¾ƒè¿ç®—ç¬¦ åŠŸèƒ½ ï¼ï¼Œï¼&#x3D;ï¼Œ&lt;ï¼Œ&lt;&#x3D;ï¼Œ&#x3D;ï¼Œ&lt;&gt;æˆ–!&#x3D; æœ€åä¸€ä¸ªæ˜¯ä¸ç­‰äº BETWEEND..ANDâ€¦ åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…ï¼ˆå«æœ€å°ï¼Œæœ€å¤§å€¼ï¼‰å‰é¢å¯ä»¥åŠ ä¸€ä¸ªå­—æ®µ IN(â€¦) åœ¨inä¹‹åçš„åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¤šé€‰ä¸€ LIKE å ä½ç¬¦ æ¨¡ç³ŠåŒ¹é…ï¼ˆ_åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ%åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦ï¼‰ï¼Œå ä½ç¬¦ç”¨å•å¼•å·æ‹¬èµ·æ¥ IS NULL æ˜¯NULL é€»è¾‘è¿ç®—ç¬¦ åŠŸèƒ½ AND æˆ– &amp;&amp; å¹¶ä¸”ï¼ˆåŒæ—¶æˆç«‹ï¼‰ OR æˆ– || æˆ–è€…ï¼ˆä»»ä¸€æˆç«‹ï¼‰ NOT æˆ– ï¼ éï¼Œä¸æ˜¯ åˆ†ç»„æŸ¥è¯¢èšåˆå‡½æ•°å°†ä¸€åˆ—æ•°æ®ä½œä¸ºæ•´ä½“ï¼Œè¿›è¡Œçºµå‘è®¡ç®— å‡½æ•° åŠŸèƒ½ count ç»Ÿè®¡æ•°é‡ max æœ€å¤§å€¼ min æœ€å°å€¼ avg å¹³å‡å€¼ sum æ±‚å’Œ 12#è¯­æ³•SELECT èšåˆå‡½æ•°ï¼ˆå­—æ®µåˆ—è¡¨ï¼‰ FROM è¡¨åï¼› åˆ†ç»„æŸ¥è¯¢12#è¯­æ³•SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å [WHERE æ¡ä»¶] GROUP BY åˆ†ç»„å­—æ®µå [HAVING åˆ†ç»„åè¿‡æ»¤æ¡ä»¶]ï¼› è¿™é‡Œwhereå’Œhavingçš„åŒºåˆ« æ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯åˆ†ç»„å‰è¿›è¡Œè¿‡æ»¤ï¼Œhavingæ˜¯å¯¹åˆ†ç»„åçš„æ•°æ®è¿›è¡Œè¿‡æ»¤ åˆ¤æ–­æ¡ä»¶ä¸åŒï¼šwhereä¸èƒ½å¯¹èšåˆå‡½æ•°åˆ¤æ–­ï¼ˆå³ä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°ï¼‰ï¼Œhavingå¯ä»¥ æ‰§è¡Œé¡ºåºï¼šwhere &gt; èšåˆå‡½æ•° &gt; having åˆ†ç»„ä¹‹åï¼ŒæŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸ºèšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µï¼ŒæŸ¥è¯¢å…¶å®ƒå­—æ®µæ— æ„ä¹‰ æ’åºæŸ¥è¯¢12#è¯­æ³•SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å ORDER BY å­—æ®µ1 æ’åºæ–¹å¼1ï¼Œå­—æ®µ2 æ’åºæ–¹å¼2; æ’åºæ–¹å¼ ASC ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰ DESCï¼šé™åº æ³¨æ„ï¼šå¦‚æœæ˜¯å¤šå­—æ®µæ’åºï¼Œå½“ç¬¬ä¸€ä¸ªå­—æ®µå€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šæ ¹æ®ç¬¬äºŒä¸ªå­—æ®µæ’åº åˆ†é¡µæŸ¥è¯¢12#è¯­æ³•SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å LIMIT èµ·å§‹ç´¢å¼•ï¼ŒæŸ¥è¯¢è®°å½•æ•°ï¼› æ³¨æ„ï¼š èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œèµ·å§‹ç´¢å¼•&#x3D;ï¼ˆæŸ¥è¯¢é¡µç -1ï¼‰*æ¯é¡µè®°å½•æ•° å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ä¸ºlimit 10ã€‚ DQLçš„æ‰§è¡Œé¡ºåºç¼–å†™é¡ºåºå¦‚ä¸‹ï¼š 1234567891011121314SELECT #----ç¬¬å››æ­¥ å­—æ®µåˆ—è¡¨FROM #----ç¬¬ä¸€æ­¥ è¡¨ååˆ—è¡¨WHERE #----ç¬¬äºŒæ­¥ æ¡ä»¶åˆ—è¡¨GROUP BY #----ç¬¬ä¸‰æ­¥ åˆ†ç»„å­—æ®µåˆ—è¡¨HAVING åˆ†ç»„åæ¡ä»¶åˆ—è¡¨ORDER BY #----ç¬¬äº”æ­¥ æ’åºå­—æ®µåˆ—è¡¨LIMIT #----ç¬¬å…­æ­¥ åˆ†é¡µå‚æ•° DCLï¼ˆData Control Languageï¼‰æ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥åˆ›å»ºæ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ ç®¡ç†ç”¨æˆ·123456789101112#æŸ¥è¯¢ç”¨æˆ·USE mysql;SELECT * FROM user;#åˆ›å»ºç”¨æˆ·CREATE USER &#x27;ç”¨æˆ·å&#x27;@&#x27;ä¸»æœºåâ€˜ IDENTIFIED BY &#x27;å¯†ç &#x27;ï¼›#ä¿®æ”¹ç”¨æˆ·å¯†ç ALTER USER &#x27;ç”¨æˆ·å&#x27;@&#x27;ä¸»æœºåâ€™ IDENTIFIED WITH mysql_native_password BY &#x27;æ–°å¯†ç &#x27;ï¼›#åˆ é™¤ç”¨æˆ·DROP USER &#x27;ç”¨æˆ·å&#x27;@&#x27;ä¸»æœºåâ€™ï¼› æƒé™æ§åˆ¶ æƒé™ è¯´æ˜ ALL,ALL PRIVILEGES æ‰€æœ‰æƒé™ SELECT æŸ¥è¯¢æ•°æ® INSERT æ’å…¥æ•°æ® UPDATE ä¿®æ”¹æ•°æ® DELETE åˆ é™¤æ•°æ® ALTER ä¿®æ”¹è¡¨ DROP åˆ é™¤æ•°æ®åº“&#x2F;è¡¨&#x2F;è§†å›¾ CREATE åˆ›å»ºæ•°æ®åº“&#x2F;è¡¨ 12345678#æŸ¥è¯¢æƒé™SHOW GRANTS FOR &#x27;ç”¨æˆ·å&#x27;@â€˜ä¸»æœºåâ€™ï¼›#æˆäºˆæƒé™GRANT æƒé™åˆ—è¡¨ ON æ•°æ®åº“.è¡¨å TO &#x27;ç”¨æˆ·å&#x27;@â€˜ä¸»æœºåâ€™ï¼›#æ’¤é”€æƒé™REVOKE æƒé™åˆ—è¡¨ ON æ•°æ®åº“.è¡¨å FROM &#x27;ç”¨æˆ·å&#x27;@â€˜ä¸»æœºåâ€™ï¼› å¤šä¸ªæƒé™ä¹‹é—´ï¼Œç”¨é€—å·åˆ†éš” æˆæƒæ—¶ï¼Œæ•°æ®åº“åå’Œè¡¨åå¯ä»¥ç”¨*è¿›è¡Œé€šé… å‡½æ•°å­—ç¬¦ä¸²å‡½æ•° å‡½æ•° åŠŸèƒ½ CONCAT(S1,S2,â€¦Sn) å°†S1,S2,..SNæ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² LOWER(str) è½¬å°å†™ UPPER(str) è½¬å¤§å†™ LPAD(str,n,pad) å·¦å¡«å……ï¼Œç”¨padå¯¹strçš„å·¦è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦ RPAD(str,n,pad) å³å¡«å……ï¼Œç”¨padå¯¹strçš„å³è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦ TRIM(str) å»æ‰å­—ç¬¦ä¸²å¤´éƒ¨å’Œå°¾éƒ¨çš„ç©ºæ ¼ SUBSTRING(str,start,len) è¿”å›strä»startèµ·lenä¸ªé•¿åº¦çš„å­—ç¬¦ä¸² æ•°å€¼å‡½æ•° å‡½æ•° åŠŸèƒ½ CEIL(x) å‘ä¸Šå–æ•´ FLOOR(x) å‘ä¸‹å–æ•´ MOD(x,y) è¿”å›x&#x2F;yçš„æ¨¡ RAND() è¿”å›0~1çš„éšæœºæ•° ROUND(x,y) æ±‚å‚æ•°xçš„å››èˆäº”å…¥çš„å€¼ï¼Œä¿ç•™yä½å°æ•° æ—¥æœŸå‡½æ•° å‡½æ•° åŠŸèƒ½ CURDATE() è¿”å›å½“å‰æ—¥æœŸ CURTIME() è¿”å›å½“å‰æ—¶é—´ NOW() è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ YEAR(date) è·å–æŒ‡å®šdateçš„å¹´ä»½ MONTH(date) è·å–æŒ‡å®šdateçš„æœˆä»½ DAY(date) è·å–æŒ‡å®šdateçš„æ—¥æœŸ DATE_ADD(date,INTERVAL expr type) è¿”å›ä¸€ä¸ªæ—¥æœŸ&#x2F;æ—¶é—´å€¼åŠ ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”expråçš„æ—¶é—´å€¼ DATEDIFF(date1,date2) è¿”å›èµ·å§‹æ—¶é—´date1å’Œç»“æŸæ—¶é—´date2ä¹‹é—´çš„å¤©æ•° æµç¨‹å‡½æ•°å¯ä»¥åœ¨SQLè¯­å¥ä¸­å®ç°æ¡ä»¶ç­›é€‰ï¼Œä»è€Œæé«˜è¯­å¥çš„æ•ˆç‡ å‡½æ•° åŠŸèƒ½ IF(value,t,f) å¦‚æœvalueä¸ºtrueï¼Œè¿”å›tï¼Œå¦åˆ™è¿”å›f IFNULL(value1,value2) å¦‚æœvalueä¸ä¸ºç©ºï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2 CASE WHEN [val1] THEN [res1]â€¦ELSE [default] END å¦‚æœval1ä¸ºtrueï¼Œè¿”å›res1ï¼Œå¦åˆ™è¿”å›é»˜è®¤å€¼ CASE [expr] WHEN [val1] THEN [res1]â€¦ELSE [default] END å¦‚æœexprçš„å€¼ç­‰äºval1ï¼Œè¿”å›res1ï¼Œå¦åˆ™è¿”å›é»˜è®¤å€¼ çº¦æŸçº¦æŸæ˜¯ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ® çº¦æŸ åŠŸèƒ½ å…³é”®å­— éç©ºçº¦æŸ NOT NULL å”¯ä¸€çº¦æŸ UNIQUE ä¸»é”®çº¦æŸ ä¸»é”®æ˜¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œè¦æ±‚éç©ºä¸”å”¯ä¸€ PRIMARY KEY é»˜è®¤çº¦æŸ ä¿å­˜æ•°æ®æ—¶ï¼Œå¦‚æœæœªæŒ‡å®šè¯¥å­—æ®µçš„å€¼ï¼Œé‡‡ç”¨é»˜è®¤å€¼ DEFAULT æ£€æŸ¥çº¦æŸ ä¿è¯å­—æ®µå€¼æ»¡è¶³æŸä¸€ä¸ªæ¡ä»¶ CHECK å¤–é”®çº¦æŸ ç”¨æ¥è®©ä¸¤å¼ è¡¨çš„æ•°æ®ä¹‹é—´å»ºç«‹è”ç³»ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ FOREIGN KEY 1234567891011#è¯­æ³•ä¸€ã€åˆ›å»ºçš„æ—¶å€™æŒ‡å®šå¤–é”®çº¦æŸCREATE TABLE è¡¨åï¼ˆ å­—æ®µå æ•°æ®ç±»å‹ ... [CONSTRAINT] [å¤–é”®åç§°] FOREIGN KEY(å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨(ä¸»è¡¨åˆ—å));#è¯­æ³•äºŒã€å¯¹äºå·²åˆ›å»ºçš„è¡¨æ¥ä¿®æ”¹å¤–é”®çº¦æŸALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY(å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨(ä¸»è¡¨åˆ—å);#åˆ é™¤å¤–é”®ALTER TABLE è¡¨å DROP FOREIGN KEY å¤–é”®åç§°ï¼› åˆ é™¤&#x2F;æ›´æ–°è¡Œä¸º è¡Œä¸º è¯´æ˜ NO ACTION &#x2F; RESTRICT å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤&#x2F;æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤&#x2F;æ›´æ–°ã€‚(é»˜è®¤æƒ…å†µ) CASCADE å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤&#x2F;æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¹Ÿåˆ é™¤&#x2F;æ›´æ–°å¤–é”®åœ¨å­è¡¨ä¸­çš„è®°å½•ã€‚ SET NULL å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™è®¾ç½®å­è¡¨ä¸­è¯¥å¤–é”®å€¼ä¸ºnu(è¿™å°±è¦æ±‚è¯¥å¤–é”®å…è®¸å–nul) 12#è¯­æ³•ï¼Œåªéœ€åœ¨åé¢åŠ ä¸Šæ›´æ–°å’Œåˆ é™¤çš„æ–¹å¼ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY(å¤–é”®å­—æ®µå) REFERENCES ä¸»è¡¨(ä¸»è¡¨åˆ—å) ON UPDATE CASCADE ON DELETE CASCADE; å¤šè¡¨æŸ¥è¯¢å¤šè¡¨å…³ç³» ä¸€å¯¹å¤šï¼ˆå¤šå¯¹ä¸€ï¼‰ å¤šå¯¹å¤š ä¸€å¯¹ä¸€ å†…è¿æ¥æŸ¥è¯¢ä¸¤å¼ è¡¨çš„äº¤é›†éƒ¨åˆ† 12345#éšå¼å†…è¿æ¥SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1ï¼Œè¡¨2 WHERE æ¡ä»¶...ï¼›#æ˜¾å¼å†…è¿æ¥ ï¼ˆå’Œéšå¼æ²¡æœ‰åŒºåˆ«ï¼Œä»…æ˜¯å†™æ³•çš„ä¸åŒè€Œå·²ï¼‰[INNER å¯æœ‰å¯æ— SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 [INNER] JOIN è¡¨2 ON è¿æ¥æ¡ä»¶...ï¼› å¤–è¿æ¥å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥å·¦ï¼šæŸ¥è¯¢å·¦è¡¨çš„æ‰€æœ‰æ•°æ®å’Œå·¦å³è¡¨äº¤é›†éƒ¨åˆ†çš„æ•°æ® å³ï¼šæŸ¥è¯¢å³è¡¨çš„æ‰€æœ‰æ•°æ®å’Œå·¦å³è¡¨äº¤é›†éƒ¨åˆ†çš„æ•°æ® 12345#è¯­æ³•------å·¦ [OUTERå¯æœ‰å¯æ— SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 LEFT [OUTER] JOIN è¡¨2 ON æ¡ä»¶...;#è¯­æ³•------å³SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨1 RIGHT [OUTER] JOIN è¡¨2 ON æ¡ä»¶...; å³å¤–å¯æ”¹æˆå·¦å¤–ã€‚å·¦å¤–ä¼šå†™å°±è¡Œ è‡ªè¿æ¥12#è¯­æ³•SELECE å­—æ®µåˆ—è¡¨ FROM è¡¨A åˆ«åA JOIN è¡¨A è¡¨åB ON æ¡ä»¶...; è‡ªè¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯å†…è¿æ¥ä¹Ÿå¯ä»¥æ˜¯å¤–è¿æ¥ è”åˆæŸ¥è¯¢å¯¹äºunionæŸ¥è¯¢ï¼Œå°±æ˜¯æŠŠå¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æŸ¥è¯¢ç»“æœé›† 1234#è¯­æ³•SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨A ...UNION [ALL] #å¸¦ALLä¸ä¼šå¯¹æŸ¥è¯¢ç»“æœå»é‡SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨B ...; ä½¿ç”¨æ¡ä»¶ï¼šä¸¤ä¸ªè¯­å¥çš„å­—æ®µåˆ—è¡¨ï¼ˆæ•°é‡&#x2F;ç±»å‹ï¼‰è¦ä¿æŒä¸€è‡´ å­æŸ¥è¯¢SQLè¯­å¥ä¸­åµŒå¥—SELECTè¯­å¥ï¼Œç§°ä¸ºåµŒå¥—æŸ¥è¯¢ï¼Œåˆç§°å­æŸ¥è¯¢ã€‚å­æŸ¥è¯¢è¦ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¥ å­æŸ¥è¯¢å¤–éƒ¨çš„è¯­å¥å¯ä»¥æ˜¯INSERT&#x2F;UPADTE&#x2F;DELETE&#x2F;SELECT ä¸­çš„ä»»ä½•ä¸€ä¸ª æ ‡é‡å­æŸ¥è¯¢å­æŸ¥è¯¢ç»“æœä¸ºå•ä¸ªå€¼ å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š&#x3D;ï¼Œ&lt;&gt;,&gt;,&gt;&#x3D;,&lt;,&lt;&#x3D; åˆ—å­æŸ¥è¯¢å­æŸ¥è¯¢ç»“æœæ˜¯ä¸€åˆ— å¸¸ç”¨çš„æ“ä½œç¬¦ï¼šIN , NOT IN , ANY(æ»¡è¶³å­æŸ¥è¯¢åˆ—è¡¨çš„ä¸€ä¸ªå³å¯) , SOME(ä¸ANYåŒç­‰) ,ALL(å¿…é¡»å…¨éƒ¨æ»¡è¶³) è¡Œå­æŸ¥è¯¢å­æŸ¥è¯¢ç»“æœæ˜¯ä¸€è¡Œ å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š &#x3D; ï¼Œ&lt;&gt; , IN , NOT IN è¡¨å­æŸ¥è¯¢å­æŸ¥è¯¢ç»“æœæ˜¯å¤šè¡Œå¤šåˆ— å¸¸ç”¨çš„æ“ä½œç¬¦ï¼š IN äº‹åŠ¡äº‹åŠ¡ æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚ äº‹åŠ¡æ“ä½œ12345#å¼€å¯äº‹åŠ¡START TRANSATION#æäº¤/å›æ»šäº‹åŠ¡COMMIT / ROLLBACK; *äº‹åŠ¡å››å¤§ç‰¹æ€§ACID åŸå­æ€§ï¼ˆAtomicityï¼‰ ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼› ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ ï¼šæ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼› éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚ *è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» è„è¯»(Drity Read)ï¼šæŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚ ä¾‹å­:å°æ˜è¯»å–åˆ°å°çº¢æäº¤çš„100æ•°æ®.ä½†æ˜¯å°çº¢å¼‚å¸¸å›æ»šäº†æ•°æ®,100å˜æˆäº†90,è¿™ä¸ªæ—¶å€™å°æ˜è¿˜æ˜¯100,ä½†å®é™…æ˜¯90(è„è¯») ä¸å¯é‡å¤è¯»(Non-repeatable read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚ ä¾‹å­:å°æ˜å¤šæ¬¡è¯»å–Aæ•°æ®,å°çº¢åœ¨å°æ˜è¯»å–æ•°æ®æ—¶,æ¯æ¬¡è¯»å–éƒ½ä¿®æ”¹äº†æ•°æ®å¹¶æäº¤,å°æ˜å¤šæ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€è‡´ å¹»è¯»(Phantom Read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¸­æ•°æ®ç¬”æ•°ä¸ä¸€è‡´ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†å‡ åˆ—(Row)æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡å´åœ¨æ­¤æ—¶æ’å…¥äº†æ–°çš„å‡ åˆ—æ•°æ®ï¼Œå…ˆå‰çš„äº‹åŠ¡åœ¨æ¥ä¸‹æ¥çš„æŸ¥è¯¢ä¸­ï¼Œå°±ä¼šå‘ç°æœ‰å‡ åˆ—æ•°æ®æ˜¯å®ƒå…ˆå‰æ‰€æ²¡æœ‰çš„ã€‚ ä¾‹å­:å°æ˜ä¿®æ”¹äº†A,Bæ•°æ®,å°çº¢åŒæ—¶åˆæ’å…¥äº†ä¸€æ¡Cæ•°æ®,å°æ˜ä¼šæ„Ÿè§‰è‡ªå·±æ˜æ˜æ•°æ®éƒ½æ”¹äº†,çªç„¶å¤šå‡ºæ¥ä¸€æ¡,ä»¥ä¸ºå‡ºç°äº†å¹»è§‰è‡ªå·±æ¼äº†ä¸€æ¡ *äº‹åŠ¡çš„éš”ç¦»çº§åˆ« éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» Read uncommitted æœ‰ æœ‰ æœ‰ Read committed æ—  æœ‰ æœ‰ Repeatable Readï¼ˆMysqlçš„é»˜è®¤çº§åˆ«ï¼‰ æ—  æ—  æœ‰ Serializable æ—  æ—  æ—  çº§åˆ«è¶Šé«˜ï¼Œå®‰å…¨æ€§è¶Šé«˜ï¼Œæ‰§è¡Œæ•ˆç‡è¶Šä½ 12345#æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«SELECE @@TRANSATION_ISOLATION;#è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«SET [SESSION|GLOBAL] TRANSATION ISOLATION LEVEL &#123;çº§åˆ«&#125; å¼•æ“å­˜å‚¨å¼•æ“Storage engineï¼šMySQLä¸­çš„æ•°æ®ã€ç´¢å¼•ä»¥åŠå…¶ä»–å¯¹è±¡æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œæ˜¯ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ã€‚ MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ« Innodbå¼•æ“ï¼šInnodbå¼•æ“æä¾›äº†å¯¹æ•°æ®åº“ACIDäº‹åŠ¡çš„æ”¯æŒã€‚å¹¶ä¸”è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸã€‚ MyIASMå¼•æ“(åŸæœ¬Mysqlçš„é»˜è®¤å¼•æ“)ï¼šä¸æä¾›äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚ å­˜å‚¨å¼•æ“é€‰æ‹©å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œä½¿ç”¨é»˜è®¤çš„Innodbå³å¯ã€‚ MyISAMï¼šä»¥è¯»å†™æ’å…¥ä¸ºä¸»çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åšå®¢ç³»ç»Ÿã€æ–°é—»é—¨æˆ·ç½‘ç«™ã€‚ Innodbï¼šæ›´æ–°ï¼ˆåˆ é™¤ï¼‰æ“ä½œé¢‘ç‡ä¹Ÿé«˜ï¼Œæˆ–è€…è¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼›å¹¶å‘é‡é«˜ï¼Œæ”¯æŒäº‹åŠ¡å’Œå¤–é”®ã€‚æ¯”å¦‚OAè‡ªåŠ¨åŒ–åŠå…¬ç³»ç»Ÿã€‚ ç´¢å¼•ç´¢å¼•ä»‹ç»ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„æ•°æ®ç»“æ„ã€‚ ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ ä½¿ç”¨ç´¢å¼•å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ ç¼ºç‚¹ æ—¶é—´æ–¹é¢ï¼šåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œå…·ä½“åœ°ï¼Œå½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œä¼šé™ä½å¢&#x2F;æ”¹&#x2F;åˆ çš„æ‰§è¡Œæ•ˆç‡ï¼› ç©ºé—´æ–¹é¢ï¼šç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ã€‚ ç´¢å¼•ç»“æ„ç´¢å¼•åˆ†ç±»ä»æ•°æ®ç»“æ„è§’åº¦ æ ‘ç´¢å¼• Hashç´¢å¼• ä»ç‰©ç†å­˜å‚¨è§’åº¦ èšé›†ç´¢å¼• èšç°‡ç´¢å¼•æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡æ–¹å¼ï¼Œå®ƒå°†ç´¢å¼•å’Œæ•°æ®è¡Œå­˜å‚¨åœ¨ä¸€èµ·ï¼Œå³æ•°æ®è¡ŒæŒ‰ç…§ç´¢å¼•çš„é¡ºåºå­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚ èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯å®Œæ•´çš„æ•°æ®è¡Œï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„æŸ¥æ‰¾æ“ä½œå°±å¯ä»¥è·å–åˆ°æ‰€éœ€çš„æ•°æ®ã€‚ InnoDB å­˜å‚¨å¼•æ“çš„ä¸»é”®ç´¢å¼•å°±æ˜¯ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå¦‚æœè¡¨æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ä¸»é”®ï¼ŒInnoDB ä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä½œä¸ºèšç°‡ç´¢å¼•ã€‚ éèšé›†ç´¢å¼• éèšç°‡ç´¢å¼•æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡æ–¹å¼ï¼Œå®ƒå°†ç´¢å¼•å’Œæ•°æ®è¡Œåˆ†å¼€å­˜å‚¨ï¼Œå³ç´¢å¼•ä¿å­˜äº†æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆï¼ˆé€šå¸¸æ˜¯è¡Œçš„ç‰©ç†åœ°å€æˆ–ä¸»é”®å€¼ï¼‰ã€‚ éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯æŒ‡å‘æ•°æ®è¡Œçš„å¼•ç”¨ï¼Œå½“æŸ¥è¯¢éœ€è¦è·å–æ•°æ®æ—¶ï¼Œé¦–å…ˆæ ¹æ®ç´¢å¼•æŸ¥æ‰¾åˆ°ç›¸åº”çš„è¡ŒæŒ‡é’ˆï¼Œç„¶åå†é€šè¿‡è¡ŒæŒ‡é’ˆè·å–æ•°æ®è¡Œã€‚ åœ¨MySQLä¸­ï¼ŒMyISAM å­˜å‚¨å¼•æ“çš„ç´¢å¼•é€šå¸¸æ˜¯éèšç°‡ç´¢å¼•ã€‚ æ€»çš„æ¥è¯´ï¼Œèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«åœ¨äºç´¢å¼•å’Œæ•°æ®è¡Œçš„å­˜å‚¨æ–¹å¼ã€‚èšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®è¡Œå­˜å‚¨åœ¨ä¸€èµ·ï¼Œè€Œéèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®è¡Œåˆ†å¼€å­˜å‚¨ã€‚ å¯¹äºéèšç°‡ç´¢å¼•ï¼Œä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ ç­”ï¼šä¸ä¸€å®šã€‚è¯•æƒ³ä¸€ç§æƒ…å†µï¼Œç”¨æˆ·å‡†å¤‡ä½¿ç”¨ SQL æŸ¥è¯¢ç”¨æˆ·åï¼Œè€Œç”¨æˆ·åå­—æ®µæ­£å¥½å»ºç«‹äº†ç´¢å¼•ã€‚é‚£ä¹ˆè¿™ä¸ªç´¢å¼•çš„ key æœ¬èº«å°±æ˜¯ nameï¼ŒæŸ¥åˆ°å¯¹åº”çš„ name ç›´æ¥è¿”å›å°±è¡Œäº†ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚ è¿™ç§æƒ…å†µå°±ç§°ä¹‹ä¸ºç´¢å¼•è¦†ç›–ã€‚ ç´¢å¼•è¦†ç›–ï¼šå¦‚æœè¦æŸ¥è¯¢çš„å­—æ®µéƒ½å»ºç«‹è¿‡ç´¢å¼•ï¼Œé‚£ä¹ˆå¼•æ“ä¼šç›´æ¥åœ¨ç´¢å¼•è¡¨ä¸­æŸ¥è¯¢è€Œä¸ä¼šè®¿é—®åŸå§‹æ•°æ®ï¼ˆå¦åˆ™åªè¦æœ‰ä¸€ä¸ªå­—æ®µæ²¡æœ‰å»ºç«‹ç´¢å¼•å°±ä¼šåšå…¨è¡¨æ‰«æï¼‰ï¼Œè¿™å«ç´¢å¼•è¦†ç›–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„åœ¨selectååªå†™å¿…è¦çš„æŸ¥è¯¢å­—æ®µï¼Œä»¥å¢åŠ ç´¢å¼•è¦†ç›–çš„å‡ ç‡ã€‚ è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¸è¦æƒ³ç€ä¸ºæ¯ä¸ªå­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºä¼˜å…ˆä½¿ç”¨ç´¢å¼•çš„ä¼˜åŠ¿å°±åœ¨äºå…¶ä½“ç§¯å°ã€‚ ä»é€»è¾‘è§’åº¦ æ™®é€šç´¢å¼•ï¼šåŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰å”¯ä¸€æ€§çš„é™åˆ¶ï¼Œå…è®¸ä¸ºNULLå€¼ã€‚ å¯ä»¥é€šè¿‡ALTER TABLE table_name ADD INDEX index_name (column);åˆ›å»ºæ™®é€šç´¢å¼• å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸ºNULLå€¼ï¼Œä¸€ä¸ªè¡¨å…è®¸å¤šä¸ªåˆ—åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚ å¯ä»¥é€šè¿‡ ALTER TABLE table_name ADD UNIQUE (column); åˆ›å»ºå”¯ä¸€ç´¢å¼• å¯ä»¥é€šè¿‡ ALTER TABLE table_name ADD UNIQUE (column1,column2); åˆ›å»ºå”¯ä¸€ç»„åˆç´¢å¼• ä¸»é”®ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ä¸ºNULLï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚ è”åˆç´¢å¼•ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚ å¯ä»¥é€šè¿‡ALTER TABLE table_name ADD INDEX index_name(column1, column2, column3);åˆ›å»ºç»„åˆç´¢å¼• ç´¢å¼•è¯­æ³•SQLæ€§èƒ½åˆ†æSQLä¼˜åŒ–æ’å…¥æ•°æ®loadæŒ‡ä»¤ä¸€æ¬¡æ’å…¥å¤§æ‰¹é‡æ•°æ® ä¸»é”®ä¼˜åŒ– æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”® å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶å®ƒè‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å· ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ order by ä¼˜åŒ–group byä¼˜åŒ–","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"MySql","slug":"MySql","permalink":"http://example.com/tags/MySql/"}]},{"title":"javaå…«è‚¡","slug":"å…«è‚¡/javaåŸºç¡€","date":"2024-09-11T04:35:44.000Z","updated":"2025-03-12T12:09:23.380Z","comments":true,"path":"2024/09/11/å…«è‚¡/javaåŸºç¡€/","permalink":"http://example.com/2024/09/11/%E5%85%AB%E8%82%A1/java%E5%9F%BA%E7%A1%80/","excerpt":"JavaåŸºç¡€çŸ¥è¯†","text":"JavaåŸºç¡€çŸ¥è¯† 1.æ¦‚è¿°1.Java è¯­è¨€æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ è·¨å¹³å° å†…å­˜ç®¡ç†ï¼ˆåƒåœ¾å›æ”¶ï¼‰ ç”Ÿæ€ é¢å‘å¯¹è±¡ï¼ˆå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ï¼‰ï¼› 2.JVMã€JDK å’Œ JREçš„åŒºåˆ« JVMï¼šJava Virtual Machineï¼ŒJava è™šæ‹Ÿæœºï¼ŒJava ç¨‹åºè¿è¡Œåœ¨ Java è™šæ‹Ÿæœºä¸Šã€‚é’ˆå¯¹ä¸åŒç³»ç»Ÿçš„å®ç°ï¼ˆWindowsï¼ŒLinuxï¼ŒmacOSï¼‰ä¸åŒçš„ JVMï¼Œå› æ­¤ Java è¯­è¨€å¯ä»¥å®ç°è·¨å¹³å°ã€‚ JVM è´Ÿè´£å°† Java å­—èŠ‚ç è½¬æ¢ä¸ºç‰¹å®šå¹³å°çš„æœºå™¨ç ï¼Œå¹¶æ‰§è¡Œã€‚ JREï¼šJava è¿â¾æ—¶ç¯å¢ƒã€‚åŒ…å«äº†è¿è¡Œ Java ç¨‹åºæ‰€å¿…éœ€çš„åº“ï¼Œä»¥åŠ JVMã€‚ å®ƒæ˜¯è¿â¾å·²ç¼–è¯‘ Java ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰å†…å®¹çš„é›†åˆï¼ŒåŒ…æ‹¬ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ï¼ŒJava ç±»åº“ï¼ŒJava å‘½ä»¤å’Œå…¶ä»–çš„â¼€äº›åŸºç¡€æ„ä»¶ã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½â½¤äºåˆ›å»ºæ–°ç¨‹åºã€‚ JDK: Java Development Kitï¼Œå®ƒæ˜¯åŠŸèƒ½â»¬å…¨çš„ Java SDKã€‚å®ƒæ‹¥æœ‰ JRE æ‰€æ‹¥æœ‰çš„â¼€åˆ‡ï¼Œè¿˜æœ‰ç¼–è¯‘å™¨ï¼ˆjavacï¼‰å’Œâ¼¯å…·ï¼ˆå¦‚ javadoc å’Œ jdbï¼‰ã€‚å®ƒèƒ½å¤Ÿåˆ›å»ºå’Œç¼–è¯‘ç¨‹åºã€‚ 3.ä»€ä¹ˆæ˜¯å­—èŠ‚ç æ‰€è°“çš„å­—èŠ‚ç ï¼Œå°±æ˜¯ Java ç¨‹åºç»è¿‡ç¼–è¯‘ä¹‹ç±»äº§ç”Ÿçš„.class æ–‡ä»¶ï¼Œå­—èŠ‚ç èƒ½å¤Ÿè¢«è™šæ‹Ÿæœºè¯†åˆ«ï¼Œä»è€Œå®ç° Java ç¨‹åºçš„è·¨å¹³å°æ€§ã€‚ Java ç¨‹åºä»æºä»£ç åˆ°è¿è¡Œä¸»è¦æœ‰ä¸‰æ­¥ï¼š ç¼–è¯‘ï¼šå°†æˆ‘ä»¬çš„ä»£ç ï¼ˆ.javaï¼‰ç¼–è¯‘æˆè™šæ‹Ÿæœºå¯ä»¥è¯†åˆ«ç†è§£çš„å­—èŠ‚ç (.class) è§£é‡Šï¼šè™šæ‹Ÿæœºæ‰§è¡Œ Java å­—èŠ‚ç ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨èƒ½è¯†åˆ«çš„æœºå™¨ç  æ‰§è¡Œï¼šå¯¹åº”çš„æœºå™¨æ‰§è¡ŒäºŒè¿›åˆ¶æœºå™¨ç  4.Java æºç ä»ç¼–è¯‘åˆ°æ‰§è¡Œï¼Œå‘ç”Ÿäº†ä»€ä¹ˆ ç¼–è¯‘ï¼šç¼–è¯‘å™¨ (javac) å°† .java æ–‡ä»¶ç¼–è¯‘ä¸º .class å­—èŠ‚ç æ–‡ä»¶ã€‚ åŠ è½½ï¼šç±»åŠ è½½å™¨ (ClassLoader) åœ¨è¿è¡Œæ—¶å°† .class æ–‡ä»¶åŠ è½½åˆ° JVM çš„å†…å­˜ä¸­ã€‚ é“¾æ¥ï¼šé“¾æ¥å™¨å°†å„ç±»åŠ è½½çš„ä»£ç æ•´åˆåœ¨ä¸€èµ·ï¼Œä¸ºåç»­è¿è¡Œåšå‡†å¤‡ã€‚ æ‰§è¡Œï¼šJava è™šæ‹Ÿæœº (JVM) æ‰§è¡Œå­—èŠ‚ç ã€‚ å…³é”®ç»„ä»¶ï¼š æ–¹æ³•åŒº (Method Area)ï¼š å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ã€‚ å † (Heap)ï¼š å­˜å‚¨å¯¹è±¡å®ä¾‹ã€‚ æ ˆ (Stack)ï¼š å­˜å‚¨æ–¹æ³•è°ƒç”¨çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°ã€‚ ç¨‹åºè®¡æ•°å™¨ (PC)ï¼š è·Ÿè¸ªå½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ è¿‡ç¨‹ï¼š å­—èŠ‚ç è§£é‡Šå™¨ï¼š å°†å­—èŠ‚ç é€æ¡ç¿»è¯‘ä¸ºæœºå™¨ç å¹¶æ‰§è¡Œã€‚ è§£é‡Šæ‰§è¡Œé€Ÿåº¦è¾ƒæ…¢ã€‚ å³æ—¶ç¼–è¯‘å™¨ (JIT Compiler)ï¼š çƒ­ç‚¹ä»£ç ï¼ˆé«˜é¢‘æ‰§è¡Œçš„ä»£ç ï¼‰ä¼šè¢«ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œæé«˜æ€§èƒ½ã€‚ JIT ç¼–è¯‘ä¼˜åŒ–åŒ…æ‹¬å†…è”ã€é€ƒé€¸åˆ†æç­‰ã€‚ å›æ”¶ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼ŒJVM è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œé€šè¿‡åƒåœ¾å›æ”¶ (Garbage Collection) æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ 1234567891011121314æºä»£ç  (.java) â†“ ç¼–è¯‘å™¨ (javac) â†“å­—èŠ‚ç  (.class) â†“ ç±»åŠ è½½å™¨ (ClassLoader) â†“ éªŒè¯ã€å‡†å¤‡ã€è§£æ â†“ JVM æ‰§è¡Œå­—èŠ‚ç  â†“ åƒåœ¾å›æ”¶ä¸é€€å‡º 2.åŸºç¡€è¯­æ³•1.Java æœ‰å“ªäº›æ•°æ®ç±»å‹ æ•°å€¼å‹ æ•´æ•°ç±»å‹ï¼ˆbyteã€shortã€intã€longï¼‰(å å­—èŠ‚åˆ†åˆ«æ˜¯ 1ã€2ã€4ã€8) æµ®ç‚¹ç±»å‹ï¼ˆfloatã€doubleï¼‰(å å­—èŠ‚åˆ†åˆ«æ˜¯ 4ã€8) å­—ç¬¦å‹ï¼ˆcharï¼‰ï¼ˆå å­—èŠ‚2ï¼‰ å¸ƒå°”å‹ï¼ˆbooleanï¼‰ï¼ˆå å­—èŠ‚1ï¼‰ æ³¨æ„ï¼šæµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ä¸ºdoubleï¼ˆå¦‚æœéœ€è¦å£°æ˜ä¸€ä¸ªå¸¸é‡ä¸ºfloatå‹ï¼Œåˆ™å¿…é¡»è¦åœ¨æœ«å°¾åŠ ä¸Šfæˆ–Fï¼‰ï¼Œæ¯”å¦‚float f&#x3D;3.4 å°±ä¸å¯¹ï¼Œ3.4 æ˜¯åŒç²¾åº¦æ•°ï¼Œè½¬ä¸ºfloatä¼šæœ‰ç²¾åº¦æŸå¤± 2.ä»€ä¹ˆæ˜¯è‡ªåŠ¨æ‹†ç®±&#x2F;å°ç®± è£…ç®±ï¼šå°†åŸºæœ¬ç±»å‹ç”¨å®ƒä»¬å¯¹åº”çš„å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ï¼›å¼•ç”¨æ˜¯ Integer ç±»å‹ï¼Œ&#x3D; å³ä¾§æ˜¯ int åŸºæœ¬ç±»å‹æ—¶ï¼Œä¼šè¿›è¡Œè‡ªåŠ¨è£…ç®±ï¼Œè°ƒç”¨çš„å…¶å®æ˜¯ Integer.valueOf()æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨ IntegerCacheã€‚ æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼›è°ƒç”¨xxValue()æ–¹æ³• 3.åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶çœ‹ä¸€ä¸ªé¢˜ç›® Integer a&#x3D; 127ï¼ŒInteger b &#x3D; 127ï¼›Integer c&#x3D; 128ï¼ŒInteger d &#x3D; 128ï¼›ç›¸ç­‰å—? a å’Œ b ç›¸ç­‰ï¼Œc å’Œ d ä¸ç›¸ç­‰ã€‚ è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ° Java çš„è‡ªåŠ¨è£…ç®±æœºåˆ¶ä»¥åŠIntegerç±»çš„ç¼“å­˜æœºåˆ¶ã€‚ aå’Œbæ˜¯ç›¸ç­‰çš„ã€‚è¿™æ˜¯å› ä¸º Java åœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨Integer.valueOf()æ–¹æ³•æ¥åˆ›å»ºIntegerå¯¹è±¡ã€‚ Integer.valueOf()æ–¹æ³•ä¼šé’ˆå¯¹æ•°å€¼åœ¨**-128 åˆ° 127** ä¹‹é—´çš„Integerå¯¹è±¡ä½¿ç”¨ç¼“å­˜ã€‚å› æ­¤ï¼Œaå’Œbå®é™…ä¸Šå¼•ç”¨äº†å¸¸é‡æ± ä¸­ç›¸åŒçš„Integerå¯¹è±¡ã€‚ cå’Œdä¸ç›¸ç­‰ã€‚è¿™æ˜¯å› ä¸º 128 è¶…å‡ºäº†Integerç¼“å­˜çš„èŒƒå›´(-128 åˆ° 127)ã€‚ å› æ­¤ï¼Œè‡ªåŠ¨è£…ç®±è¿‡ç¨‹ä¼šä¸ºcå’Œdåˆ›å»ºä¸¤ä¸ªä¸åŒçš„Integerå¯¹è±¡ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„å¼•ç”¨åœ°å€ã€‚ 4.æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ ä½œç”¨åŸŸ æˆå‘˜å˜é‡ï¼šé’ˆå¯¹æ•´ä¸ªç±»æœ‰æ•ˆã€‚ å±€éƒ¨å˜é‡ï¼šåªåœ¨æŸä¸ªèŒƒå›´å†…æœ‰æ•ˆã€‚(ä¸€èˆ¬æŒ‡çš„å°±æ˜¯æ–¹æ³•,è¯­å¥ä½“å†…) å­˜å‚¨ä½ç½® æˆå‘˜å˜é‡ï¼šéšç€å¯¹è±¡çš„åˆ›å»ºè€Œå­˜åœ¨ï¼Œéšç€å¯¹è±¡çš„æ¶ˆå¤±è€Œæ¶ˆå¤±ï¼Œå­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚ å±€éƒ¨å˜é‡ï¼šåœ¨æ–¹æ³•è¢«è°ƒç”¨ï¼Œæˆ–è€…è¯­å¥è¢«æ‰§è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­ã€‚å½“æ–¹æ³•è°ƒç”¨å®Œï¼Œæˆ–è€…è¯­å¥ç»“æŸåï¼Œå°±è‡ªåŠ¨é‡Šæ”¾ã€‚ ç”Ÿå‘½å‘¨æœŸ æˆå‘˜å˜é‡ï¼šç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡ä¸€æ ·ï¼Œéšç€å¯¹è±¡çš„åˆ›å»ºè€Œå­˜åœ¨ï¼Œéšç€å¯¹è±¡çš„æ¶ˆå¤±è€Œæ¶ˆå¤± å±€éƒ¨å˜é‡ï¼šå½“æ–¹æ³•è°ƒç”¨å®Œï¼Œæˆ–è€…è¯­å¥ç»“æŸåï¼Œå°±è‡ªåŠ¨é‡Šæ”¾ã€‚ åˆå§‹å€¼ æˆå‘˜å˜é‡ï¼šæœ‰é»˜è®¤åˆå§‹å€¼ã€‚ å±€éƒ¨å˜é‡ï¼šæ²¡æœ‰é»˜è®¤åˆå§‹å€¼ï¼Œä½¿ç”¨å‰å¿…é¡»èµ‹å€¼ã€‚ 5.é™æ€å˜é‡å’Œå®ä¾‹å˜é‡çš„åŒºåˆ«é™æ€å˜é‡: æ˜¯è¢« static ä¿®é¥°ç¬¦ä¿®é¥°çš„å˜é‡ï¼Œä¹Ÿç§°ä¸ºç±»å˜é‡ï¼Œå®ƒå±äºç±»ï¼Œä¸å±äºç±»çš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªç±»ä¸ç®¡åˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡ï¼Œé™æ€å˜é‡åœ¨å†…å­˜ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚ å®ä¾‹å˜é‡: å¿…é¡»ä¾å­˜äºæŸä¸€å®ä¾‹ï¼Œéœ€è¦å…ˆåˆ›å»ºå¯¹è±¡ç„¶åé€šè¿‡å¯¹è±¡æ‰èƒ½è®¿é—®åˆ°å®ƒã€‚é™æ€å˜é‡å¯ä»¥å®ç°è®©å¤šä¸ªå¯¹è±¡å…±äº«å†…å­˜ã€‚ 5.&#x3D;&#x3D;å’Œ equals çš„åŒºåˆ«&#x3D;&#x3D; : å®ƒçš„ä½œâ½¤æ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯ä¸æ˜¯ç›¸ç­‰ã€‚å³ï¼Œåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒâ¼€ä¸ªå¯¹è±¡(åŸºæœ¬æ•°æ®ç±»å‹ &#x3D;&#x3D; æ¯”è¾ƒçš„æ˜¯å€¼ï¼Œå¼•â½¤æ•°æ®ç±»å‹ &#x3D;&#x3D; æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€)ã€‚ equals() : å®ƒçš„ä½œâ½¤ä¹Ÿæ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚ä½†æ˜¯è¿™ä¸ªâ€œç›¸ç­‰â€ä¸€èˆ¬ä¹Ÿåˆ†ä¸¤ç§æƒ…å†µï¼š é»˜è®¤æƒ…å†µï¼šç±»æ²¡æœ‰è¦†ç›– equals() â½…æ³•ã€‚åˆ™é€šè¿‡ equals() æ¯”è¾ƒè¯¥ç±»çš„ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œç­‰ä»·äºé€šè¿‡â€œ &#x3D;&#x3D; â€æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯ç›¸å½“äºæ¯”è¾ƒå†…å­˜åœ°å€ã€‚ è‡ªå®šä¹‰æƒ…å†µï¼šç±»è¦†ç›–äº† equals() â½…æ³•ã€‚æˆ‘ä»¬å¹³æ—¶è¦†ç›–çš„ equals()æ–¹æ³•ä¸€èˆ¬æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸åŒï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªç›¸ç­‰çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚ 6.ä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡»é‡å†™ hashCode â½…æ³•æ ¹æ® Java è§„èŒƒ ï¼Œè‹¥ä¸¤ä¸ªå¯¹è±¡é€šè¿‡ equals() æ–¹æ³•åˆ¤å®šä¸ºç›¸ç­‰ï¼Œåˆ™å®ƒä»¬çš„ hashCode() å¿…é¡»è¿”å›ç›¸åŒçš„å€¼ã€‚åä¹‹ï¼Œè‹¥ä¸¤ä¸ªå¯¹è±¡ hashCode() ç›¸åŒï¼Œå®ƒä»¬çš„ equals() å¯ä»¥ä¸ç­‰ã€‚ å› æ­¤ï¼Œequals â½…æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™ hashCode â½…æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›–ã€‚å¦‚æœé‡å†™äº† equals()æ–¹æ³•è€Œæ²¡æœ‰é‡å†™ hashCode()æ–¹æ³•ï¼Œé‚£ä¹ˆè¢«è®¤ä¸ºç›¸ç­‰çš„å¯¹è±¡å¯èƒ½ä¼šæœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œå¯¼è‡´é›†åˆæ— æ³•æ­£ç¡®è¯†åˆ«é‡å¤å¯¹è±¡ã€‚ ä¸ºä»€ä¹ˆä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šæ˜¯ç›¸ç­‰çš„ï¼Ÿ å› ä¸ºå¯èƒ½ä¼šç¢°æ’ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºå“ˆå¸Œç ï¼ˆhashCodeï¼‰çš„æœ¬è´¨å’Œç›®çš„æ‰€å†³å®šçš„ã€‚ å“ˆå¸Œç æ˜¯é€šè¿‡å“ˆå¸Œå‡½æ•°å°†å¯¹è±¡ä¸­æ˜ å°„æˆä¸€ä¸ªæ•´æ•°å€¼ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­å¿«é€Ÿå®šä½å¯¹è±¡çš„å­˜å‚¨ä½ç½®ã€‚ ç”±äºå“ˆå¸Œå‡½æ•°å°†ä¸€ä¸ªè¾ƒå¤§çš„è¾“å…¥åŸŸæ˜ å°„åˆ°ä¸€ä¸ªè¾ƒå°çš„è¾“å‡ºåŸŸï¼Œä¸åŒçš„è¾“å…¥å€¼ï¼ˆå³ä¸åŒçš„å¯¹è±¡ï¼‰å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºå€¼ï¼ˆå³ç›¸åŒçš„å“ˆå¸Œç ï¼‰ã€‚è¿™ç§æƒ…å†µè¢«ç§°ä¸ºå“ˆå¸Œå†²çªã€‚ 7.è®¿é—®ä¿®é¥°ç¬¦ publicã€privateã€protectedã€ä»¥åŠä¸å†™ï¼ˆé»˜è®¤ï¼‰çš„åŒºåˆ« default (å³é»˜è®¤ï¼Œä»€ä¹ˆä¹Ÿä¸å†™ï¼‰: åœ¨åŒä¸€åŒ…å†…å¯è§ï¼Œä¸ä½¿ç”¨ä»»ä½•ä¿®é¥°ç¬¦ã€‚å¯ä»¥ä¿®é¥°åœ¨ç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³•ã€‚ private : åœ¨åŒä¸€ç±»å†…å¯è§ã€‚å¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€‚æ³¨æ„ï¼šä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰ public : å¯¹æ‰€æœ‰ç±»å¯è§ã€‚å¯ä»¥ä¿®é¥°ç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³• protected : å¯¹åŒä¸€åŒ…å†…çš„ç±»å’Œæ‰€æœ‰å­ç±»å¯è§ã€‚å¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•ã€‚æ³¨æ„ï¼šä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰ã€‚ 8.finalå…³é”®å­— è¢«finalä¿®é¥°çš„ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿ è¢«finalä¿®é¥°çš„æ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™ è¢«finalä¿®é¥°çš„å˜é‡ä¸å¯ä»¥è¢«æ”¹å˜ï¼Œè¢«finalä¿®é¥°ä¸å¯å˜çš„æ˜¯å˜é‡çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¼•ç”¨æŒ‡å‘çš„å†…å®¹ï¼Œå¼•ç”¨æŒ‡å‘çš„å†…å®¹æ˜¯å¯ä»¥æ”¹å˜çš„ 9.finalã€finallyã€finalize final æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ã€‚å½“ final ä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼›å½“ final ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼›å½“ final ä¿®é¥°ä¸€ä¸ªå˜é‡æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªå˜é‡æ˜¯ä¸ªå¸¸é‡ï¼Œä¸€æ—¦èµ‹å€¼åï¼Œå°±ä¸èƒ½å†è¢«ä¿®æ”¹äº†ã€‚ finally æ˜¯ Java ä¸­å¼‚å¸¸å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥åˆ›å»º try å—åé¢çš„ finally å—ã€‚æ— è®º try å—ä¸­çš„ä»£ç æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œfinally å—ä¸­çš„ä»£ç æ€»æ˜¯ä¼šè¢«æ‰§è¡Œã€‚é€šå¸¸ï¼Œfinally å—è¢«ç”¨æ¥é‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚ finalize æ˜¯Object ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨åƒåœ¾å›æ”¶å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­æ¸…é™¤å‡ºå»ä¹‹å‰åšä¸€äº›å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚ è¿™ä¸ªæ–¹æ³•åœ¨åƒåœ¾å›æ”¶å™¨å‡†å¤‡é‡Šæ”¾å¯¹è±¡å ç”¨çš„å†…å­˜ä¹‹å‰è¢«è‡ªåŠ¨è°ƒç”¨ã€‚æˆ‘ä»¬ä¸èƒ½æ˜¾å¼åœ°è°ƒç”¨ finalize æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ç”±åƒåœ¾å›æ”¶å™¨åœ¨é€‚å½“çš„æ—¶é—´è‡ªåŠ¨è°ƒç”¨ã€‚ 3.é¢å‘å¯¹è±¡1.é¢å‘å¯¹è±¡æœ‰å“ªäº›ç‰¹æ€§ å°è£… å°è£…æŠŠâ¼€ä¸ªå¯¹è±¡çš„å±æ€§ç§æœ‰åŒ–ï¼ŒåŒæ—¶æä¾›â¼€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„å±æ€§çš„â½…æ³•ã€‚ ç»§æ‰¿ ç»§æ‰¿æ˜¯ä½¿â½¤å·²å­˜åœ¨çš„ç±»çš„å®šä¹‰ä½œä¸ºåŸºç¡€åˆ›å»ºæ–°çš„ç±»ï¼Œæ–°ç±»çš„å®šä¹‰å¯ä»¥å¢åŠ æ–°çš„å±æ€§æˆ–æ–°çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚é€šè¿‡ç»§æ‰¿å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œä»£ç å¤ç”¨ã€‚ æ³¨æ„ï¼š â¼¦ç±»æ‹¥æœ‰â½—ç±»å¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œâ½…æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§å’Œç§æœ‰â½…æ³•ï¼‰ï¼Œä½†æ˜¯â½—ç±»ä¸­çš„ç§æœ‰å±æ€§å’Œâ½…æ³•â¼¦ç±»æ˜¯â½†æ³•è®¿é—®ï¼Œåªæ˜¯æ‹¥æœ‰ã€‚ â¼¦ç±»å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å±æ€§å’Œâ½…æ³•ï¼Œå³â¼¦ç±»å¯ä»¥å¯¹â½—ç±»è¿›â¾æ‰©å±•ã€‚ â¼¦ç±»å¯ä»¥â½¤â¾ƒâ¼°çš„â½…å¼å®ç°â½—ç±»çš„â½…æ³•ã€‚ å¤šæ€ å¤šæ€ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯â€œå¤šç§å½¢æ€â€ã€‚åœ¨ Java ä¸­ï¼Œå®ƒæŒ‡çš„æ˜¯åŒä¸€ä¸ªæ–¹æ³•åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šè°ƒç”¨æ—¶ï¼Œå¯ä»¥è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯â€œä¸€ä¸ªæ¥å£ï¼Œå¤šç§å®ç°â€ã€‚ å¤šæ€çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šçˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œè°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯å­ç±»ä¸­é‡å†™åçš„æ–¹æ³•ã€‚ åœ¨ä»£ç å±‚é¢ï¼Œå¤šæ€ä¸»è¦ä¾èµ–äºä»¥ä¸‹å‡ ä¸ªè¦ç´ ï¼š ç»§æ‰¿ï¼ˆæˆ–å®ç°æ¥å£ï¼‰ï¼šå¤šæ€çš„å‰ææ˜¯å­ç±»è¦ç»§æ‰¿çˆ¶ç±»ï¼Œæˆ–è€…å®ç°æŸä¸ªæ¥å£ã€‚ æ–¹æ³•é‡å†™ï¼ˆOverrideï¼‰ï¼šå­ç±»è¦é‡å†™çˆ¶ç±»ï¼ˆæˆ–æ¥å£ï¼‰ä¸­çš„æ–¹æ³•ã€‚ 2.é‡è½½ï¼ˆoverloadï¼‰å’Œé‡å†™ï¼ˆoverrideï¼‰çš„åŒºåˆ«ï¼Ÿæ–¹æ³•çš„é‡è½½å’Œé‡å†™éƒ½æ˜¯å®ç°å¤šæ€çš„æ–¹å¼ï¼ŒåŒºåˆ«åœ¨äºå‰è€…å®ç°çš„æ˜¯ç¼–è¯‘æ—¶çš„å¤šæ€æ€§ï¼Œè€Œåè€…å®ç°çš„æ˜¯è¿è¡Œæ—¶çš„å¤šæ€æ€§ã€‚ é‡è½½å‘ç”Ÿåœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæ–¹æ³•åå¿…é¡»ç›¸åŒï¼Œå‚æ•°ç±»å‹ä¸åŒã€ä¸ªæ•°ä¸åŒã€é¡ºåºä¸åŒï¼Œæ–¹æ³•è¿”å›å€¼å’Œè®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¸åŒã€‚ é‡è½½å°±æ˜¯åŒä¸€ä¸ªç±»ä¸­å¤šä¸ªåŒåæ–¹æ³•æ ¹æ®ä¸åŒçš„ä¼ å‚æ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘å¤„ç†ã€‚ é‡å†™å‘ç”Ÿåœ¨å­ç±»ä¸çˆ¶ç±»ä¹‹é—´ï¼Œé‡å†™è¦æ±‚å­ç±»è¢«é‡å†™æ–¹æ³•ä¸çˆ¶ç±»è¢«é‡å†™æ–¹æ³•æœ‰ç›¸åŒçš„è¿”å›ç±»å‹ï¼Œæ¯”çˆ¶ç±»è¢«é‡å†™æ–¹æ³•æ›´å¥½è®¿é—®ï¼Œä¸èƒ½æ¯”çˆ¶ç±»è¢«é‡å†™æ–¹æ³•å£°æ˜æ›´å¤šçš„å¼‚å¸¸ï¼ˆé‡Œæ°ä»£æ¢åŸåˆ™ï¼‰ã€‚é‡å†™å°±æ˜¯å­ç±»å¯¹çˆ¶ç±»æ–¹æ³•çš„é‡æ–°æ”¹é€ ï¼Œå¤–éƒ¨æ ·å­ä¸èƒ½æ”¹å˜ï¼Œå†…éƒ¨é€»è¾‘å¯ä»¥æ”¹å˜ã€‚ æ–¹æ³•é‡è½½çš„è§„åˆ™ï¼š æ–¹æ³•åä¸€è‡´ï¼Œå‚æ•°åˆ—è¡¨ä¸­å‚æ•°çš„é¡ºåºï¼Œç±»å‹ï¼Œä¸ªæ•°ä¸åŒã€‚ é‡è½½ä¸æ–¹æ³•çš„è¿”å›å€¼æ— å…³ï¼Œå­˜åœ¨äºçˆ¶ç±»å’Œå­ç±»ï¼ŒåŒç±»ä¸­ã€‚ å¯ä»¥æŠ›å‡ºä¸åŒçš„å¼‚å¸¸ï¼Œå¯ä»¥æœ‰ä¸åŒä¿®é¥°ç¬¦ã€‚ 3.æŠ½è±¡ç±»(abstract class)å’Œæ¥å£(interface)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…±åŒç‚¹ï¼š å®ä¾‹åŒ–ï¼šæ¥å£å’ŒæŠ½è±¡ç±»éƒ½ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«å®ç°ï¼ˆæ¥å£ï¼‰æˆ–ç»§æ‰¿ï¼ˆæŠ½è±¡ç±»ï¼‰åæ‰èƒ½åˆ›å»ºå…·ä½“çš„å¯¹è±¡ã€‚ æŠ½è±¡æ–¹æ³•ï¼šæ¥å£å’ŒæŠ½è±¡ç±»éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œå¿…é¡»åœ¨å­ç±»æˆ–å®ç°ç±»ä¸­å®ç°ã€‚ ä¸¤è€…çš„ç‰¹ç‚¹ï¼š æŠ½è±¡ç±»ç”¨äºæè¿°ç±»çš„å…±åŒç‰¹æ€§å’Œè¡Œä¸ºï¼Œå¯ä»¥æœ‰æˆå‘˜å˜é‡ã€æ„é€ æ–¹æ³•å’Œå…·ä½“æ–¹æ³•ã€‚é€‚ç”¨äºæœ‰æ˜æ˜¾ç»§æ‰¿å…³ç³»çš„åœºæ™¯ã€‚ æ¥å£ç”¨äºå®šä¹‰è¡Œä¸ºè§„èŒƒï¼Œå¯ä»¥å¤šå®ç° ã€‚é€‚ç”¨äºå®šä¹‰ç±»çš„èƒ½åŠ›æˆ–åŠŸèƒ½ã€‚ ä¸¤è€…çš„åŒºåˆ«ï¼š 4.æ·±æ‹·è´å’Œæµ…æ‹·è´? æµ…æ‹·è´ï¼šæµ…æ‹·è´ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†è¿™ä¸ªæ–°å¯¹è±¡çš„å±æ€§ï¼ˆå­—æ®µï¼‰å’ŒåŸå¯¹è±¡çš„å±æ€§å®Œå…¨ç›¸åŒã€‚å¦‚æœå±æ€§æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‹·è´çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼›å¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„æ˜¯å¼•ç”¨åœ°å€ï¼Œå› æ­¤æ–°æ—§å¯¹è±¡å…±äº«åŒä¸€ä¸ªå¼•ç”¨å¯¹è±¡ã€‚ æ·±æ‹·è´ï¼šæ·±æ‹·è´ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†ä¼šé€’å½’åœ°å¤åˆ¶æ‰€æœ‰çš„å¼•ç”¨å¯¹è±¡ï¼Œç¡®ä¿æ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å®Œå…¨ç‹¬ç«‹ã€‚æ–°å¯¹è±¡ä¸åŸå¯¹è±¡çš„ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šç›¸äº’å½±å“ã€‚ 4ã€StringStringä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯å¼•ç”¨æ•°æ®ç±»å‹ 1.Stringã€StringBuilderã€StringBuffer Stringï¼šæ“ä½œå°‘é‡çš„æ•°æ® StringBuilderï¼šå•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ® StringBufferï¼šå¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ® 2.String str1 &#x3D; new String(â€œabcâ€) å’Œ String str2 &#x3D; â€œabcâ€ çš„åŒºåˆ«ç›´æ¥ä½¿ç”¨åŒå¼•å·ä¸ºå­—ç¬¦ä¸²å˜é‡èµ‹å€¼æ—¶ï¼ŒJava é¦–å…ˆä¼šæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ã€‚ å¦‚æœå­˜åœ¨ï¼ŒJava å°±ä¼šè®©æ–°çš„å˜é‡å¼•ç”¨æ± ä¸­çš„é‚£ä¸ªå­—ç¬¦ä¸²ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ”¾å…¥æ± ä¸­ï¼Œå¹¶è®©å˜é‡å¼•ç”¨å®ƒã€‚ ä½¿ç”¨ new String(&quot;abc&quot;) çš„æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²æ—¶ï¼Œå®é™…åˆ†ä¸ºä¸¤æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼Œå…ˆæ£€æŸ¥å­—ç¬¦ä¸²å­—é¢é‡ â€œabcâ€ æ˜¯å¦åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™å¼•ç”¨å®ƒã€‚ ç¬¬äºŒæ­¥ï¼Œåœ¨å †ä¸­å†åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ â€œabcâ€ çš„ä¸€ä¸ªå‰¯æœ¬ã€‚ ä¹Ÿå°±æ˜¯è¯´ 123456String s1 = &quot;æ²‰é»˜ç‹äºŒ&quot;;String s2 = &quot;æ²‰é»˜ç‹äºŒ&quot;;String s3 = new String(&quot;æ²‰é»˜ç‹äºŒ&quot;);System.out.println(s1 == s2); // è¾“å‡º trueï¼Œå› ä¸º s1 å’Œ s2 å¼•ç”¨çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åŒä¸€ä¸ªå¯¹è±¡ã€‚System.out.println(s1 == s3); // è¾“å‡º falseï¼Œå› ä¸º s3 æ˜¯é€šè¿‡ new å…³é”®å­—æ˜¾å¼åˆ›å»ºçš„ï¼ŒæŒ‡å‘å †ä¸Šä¸åŒçš„å¯¹è±¡ã€‚ String s &#x3D; new String(â€œabcâ€)åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ ä¸€ä¸ªæˆ–ä¸¤ä¸ª å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¦‚æœä¹‹å‰å·²ç»æœ‰ä¸€ä¸ªï¼Œåˆ™ä¸å†åˆ›å»ºæ–°çš„ï¼Œç›´æ¥å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªã€‚ å †ä¸­è‚¯å®šä¼šåˆ›å»ºä¸€ä¸ªï¼Œå› ä¸ºåªè¦ä½¿ç”¨äº† new å…³é”®å­—ï¼Œè‚¯å®šä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªã€‚å³ä½¿å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨ &quot;abc&quot;ï¼Œnew String(&quot;abc&quot;) ä¾ç„¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œä¸ä¼šç›´æ¥ä½¿ç”¨å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚ 3.å¦‚ä½•ä¿è¯ String ä¸å¯å˜(ä¸ºä»€ä¹ˆStringæ˜¯ä¸å¯å˜çš„)ç¬¬ä¸€ï¼ŒString ç±»å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªç§æœ‰çš„å­—ç¬¦æ•°ç»„æ¥å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚è¿™ä¸ªå­—ç¬¦æ•°ç»„åœ¨åˆ›å»ºå­—ç¬¦ä¸²æ—¶è¢«åˆå§‹åŒ–ï¼Œä¹‹åä¸å…è®¸è¢«æ”¹å˜ã€‚ ç¬¬äºŒï¼ŒString ç±»æ²¡æœ‰æä¾›ä»»ä½•å¯ä»¥ä¿®æ”¹å…¶å†…å®¹çš„å…¬å…±æ–¹æ³•ï¼Œ ç¬¬ä¸‰ï¼ŒString ç±»æœ¬èº«è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€å®ƒä¸èƒ½è¢«ç»§æ‰¿ã€‚è¿™é˜²æ­¢äº†å­ç±»å¯èƒ½é€šè¿‡æ·»åŠ ä¿®æ”¹æ–¹æ³•æ¥æ”¹å˜å­—ç¬¦ä¸²å†…å®¹çš„å¯èƒ½æ€§ã€‚ 6.å¼‚å¸¸å¤„ç†1.å¼‚å¸¸ä½“ç³»Throwable æ˜¯ Java è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯å’Œå¼‚å¸¸çš„åŸºç±»ã€‚å®ƒæœ‰ä¸¤ä¸ªä¸»è¦çš„å­ç±»ï¼šError å’Œ Exceptionï¼Œè¿™ä¸¤ä¸ªç±»åˆ†åˆ«ä»£è¡¨äº† Java å¼‚å¸¸å¤„ç†ä½“ç³»ä¸­çš„ä¸¤ä¸ªåˆ†æ”¯ã€‚ Error ç±»ä»£è¡¨é‚£äº›ä¸¥é‡çš„é”™è¯¯ï¼Œè¿™ç±»é”™è¯¯é€šå¸¸æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„ã€‚æ¯”å¦‚ï¼ŒOutOfMemoryError è¡¨ç¤ºå†…å­˜ä¸è¶³ï¼ŒStackOverflowError è¡¨ç¤ºæ ˆæº¢å‡ºã€‚è¿™äº›é”™è¯¯é€šå¸¸ä¸ JVM çš„è¿è¡ŒçŠ¶æ€æœ‰å…³ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œåº”ç”¨ç¨‹åºé€šå¸¸æ— æ³•æ¢å¤ã€‚ Exception ç±»ä»£è¡¨ç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸ã€‚å®ƒåˆ†ä¸ºä¸¤å¤§ç±»ï¼šå—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰å’Œè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰ä¹Ÿå«éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exception ï¼‰ã€‚ â‘ ã€å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼šè¿™ç±»å¼‚å¸¸åœ¨ç¼–è¯‘æ—¶å¿…é¡»è¢«æ˜¾å¼å¤„ç†ï¼ˆæ•è·æˆ–å£°æ˜æŠ›å‡ºï¼‰ã€‚ å¦‚æœæ–¹æ³•å¯èƒ½æŠ›å‡ºæŸç§ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œä½†æ²¡æœ‰æ•è·å®ƒï¼ˆtry-catchï¼‰æˆ–æ²¡æœ‰åœ¨æ–¹æ³•å£°æ˜ä¸­ç”¨ throws å­å¥å£°æ˜å®ƒï¼Œé‚£ä¹ˆç¼–è¯‘å°†ä¸ä¼šé€šè¿‡ã€‚ä¾‹å¦‚ï¼šIOExceptionã€SQLException ç­‰ã€‚ â‘¡ã€è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰ï¼šè¿™ç±»å¼‚å¸¸åœ¨è¿è¡Œæ—¶æŠ›å‡ºï¼Œå®ƒä»¬éƒ½æ˜¯ RuntimeException çš„å­ç±»ã€‚å¯¹äºè¿è¡Œæ—¶å¼‚å¸¸ï¼ŒJava ç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»å¤„ç†å®ƒä»¬ï¼ˆå³ä¸éœ€è¦æ•è·ä¹Ÿä¸éœ€è¦å£°æ˜æŠ›å‡ºï¼‰ã€‚ RuntimeException åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¯¼è‡´çš„ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ä¹Ÿå¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚ å¸¸è§çš„æœ‰ï¼š NullPointerException(ç©ºæŒ‡é’ˆé”™è¯¯) IllegalArgumentException(å‚æ•°é”™è¯¯æ¯”å¦‚æ–¹æ³•å…¥å‚ç±»å‹é”™è¯¯) NumberFormatExceptionï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯ï¼ŒIllegalArgumentExceptionçš„å­ç±»ï¼‰ ArrayIndexOutOfBoundsExceptionï¼ˆæ•°ç»„è¶Šç•Œé”™è¯¯ï¼‰ ClassCastExceptionï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰ ArithmeticExceptionï¼ˆç®—æœ¯é”™è¯¯ï¼‰ 2.å¼‚å¸¸çš„å¤„ç†æ–¹å¼ â‘ ã€é‡åˆ°å¼‚å¸¸æ—¶å¯ä»¥ä¸å¤„ç†ï¼Œç›´æ¥é€šè¿‡throw å’Œ throws æŠ›å‡ºå¼‚å¸¸ï¼Œäº¤ç»™ä¸Šå±‚è°ƒç”¨è€…å¤„ç†ã€‚ throws å…³é”®å­—ç”¨äºå£°æ˜å¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œ throw å…³é”®å­—ç”¨äºæŠ›å‡ºå¼‚å¸¸ã€‚ 123public void test() throws Exception &#123; throw new Exception(&quot;æŠ›å‡ºå¼‚å¸¸&quot;);&#125; â‘¡ã€ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸ï¼Œå¤„ç†å¼‚å¸¸ã€‚ 1234567try &#123; //åŒ…å«å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸çš„ä»£ç ä»¥åŠå£°æ˜å¼‚å¸¸çš„æ–¹æ³•&#125;catch(Exception e) &#123; //æ•è·å¼‚å¸¸å¹¶è¿›è¡Œå¤„ç†&#125;finally &#123; //å¯é€‰ï¼Œå¿…æ‰§è¡Œçš„ä»£ç &#125; 7.I&#x2F;O1.I&#x2F;OæµIO å³ Input/Outputï¼Œè¾“å…¥å’Œè¾“å‡ºã€‚æ•°æ®è¾“å…¥åˆ°è®¡ç®—æœºå†…å­˜çš„è¿‡ç¨‹å³è¾“å…¥ï¼Œåä¹‹è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ï¼ˆæ¯”å¦‚æ•°æ®åº“ï¼Œæ–‡ä»¶ï¼Œè¿œç¨‹ä¸»æœºï¼‰çš„è¿‡ç¨‹å³è¾“å‡ºã€‚ Java IO æµçš„ 40 å¤šä¸ªç±»éƒ½æ˜¯ä»å¦‚ä¸‹ 4 ä¸ªæŠ½è±¡ç±»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ã€‚ InputStream&#x2F;Reader: æ‰€æœ‰çš„è¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµã€‚ OutputStream&#x2F;Writer: æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµã€‚ 2.I&#x2F;Oæµä¸ºä»€ä¹ˆè¦åˆ†ä¸ºå­—ç¬¦æµå’Œå­—èŠ‚æµé—®é¢˜æœ¬è´¨æƒ³é—®ï¼šä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I&#x2F;O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ å­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ï¼› å¦‚æœä¸çŸ¥é“ç¼–ç ç±»å‹çš„è¯ï¼Œä½¿ç”¨å­—èŠ‚æµçš„è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ 3.BIOã€NIOã€AIOçš„åŒºåˆ«BIOï¼ˆBlocking I&#x2F;Oï¼‰ï¼šé‡‡ç”¨é˜»å¡å¼ I&#x2F;O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œ I&#x2F;O æ“ä½œæ—¶è¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œé€‚ç”¨äºè¿æ¥æ•°è¾ƒå°‘çš„åœºæ™¯ã€‚ NIOï¼ˆNew I&#x2F;O æˆ– Non-blocking I&#x2F;Oï¼‰ï¼šé‡‡ç”¨éé˜»å¡ I&#x2F;O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;O æ—¶å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé€šè¿‡ Selector ç›‘æ§å¤šä¸ª Channel ä¸Šçš„äº‹ä»¶ï¼Œé€‚ç”¨äºè¿æ¥æ•°å¤šä½†è¿æ¥æ—¶é—´çŸ­çš„åœºæ™¯ã€‚ AIOï¼ˆAsynchronous I&#x2F;Oï¼‰ï¼šä½¿ç”¨å¼‚æ­¥ I&#x2F;O æ¨¡å‹ï¼Œçº¿ç¨‹å‘èµ· I&#x2F;O è¯·æ±‚åç«‹å³è¿”å›ï¼Œå½“ I&#x2F;O æ“ä½œå®Œæˆæ—¶é€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥çº¿ç¨‹ï¼Œé€‚ç”¨äºè¿æ¥æ•°å¤šä¸”è¿æ¥æ—¶é—´é•¿çš„åœºæ™¯ã€‚ 8.åºåˆ—åŒ–1.ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Œä»€ä¹ˆæ˜¯ååºåˆ—åŒ–åºåˆ—åŒ–ï¼ˆSerializationï¼‰æ˜¯æŒ‡å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°†è¯¥å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“ï¼Œæˆ–è€…è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚ ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰å°±æ˜¯å°†å­—èŠ‚æµè½¬æ¢å›å¯¹è±¡çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿æ„å»ºåŸå§‹å¯¹è±¡ã€‚ Serializable æ¥å£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ Serializableæ¥å£ç”¨äºæ ‡è®°ä¸€ä¸ªç±»å¯ä»¥è¢«åºåˆ—åŒ–ã€‚ 12345public class Person implements Serializable &#123; private String name; private int age; // çœç•¥ getter å’Œ setter æ–¹æ³•&#125; serialVersionUID æœ‰ä»€ä¹ˆç”¨ï¼Ÿ serialVersionUID æ˜¯ Java åºåˆ—åŒ–æœºåˆ¶ä¸­ç”¨äºæ ‡è¯†ç±»ç‰ˆæœ¬çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒçš„ä½œç”¨æ˜¯ç¡®ä¿åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç±»çš„ç‰ˆæœ¬æ˜¯å…¼å®¹çš„ã€‚ æ‰€ä»¥serialVersionUlDå°±æ˜¯èµ·éªŒè¯ä½œç”¨ Java åºåˆ—åŒ–ä¸åŒ…å«é™æ€å˜é‡å—ï¼Ÿ æ˜¯çš„ï¼Œåºåˆ—åŒ–æœºåˆ¶åªä¼šä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ï¼Œä¸å±äºå¯¹è±¡çš„çŠ¶æ€ã€‚ å¦‚æœæœ‰äº›å˜é‡ä¸æƒ³åºåˆ—åŒ–ï¼Œæ€ä¹ˆåŠï¼Ÿ å¯ä»¥ä½¿ç”¨transientå…³é”®å­—ä¿®é¥°ä¸æƒ³åºåˆ—åŒ–çš„å˜é‡ã€‚ 12345public class Person implements Serializable &#123; private String name; private transient int age; // çœç•¥ getter å’Œ setter æ–¹æ³•&#125; åºåˆ—åŒ–çš„è¿‡ç¨‹ Javaåºåˆ—åŒ–å…³é”®ç±»å’Œæ¥å£ï¼šObjectOutputStream ç”¨äºåºåˆ—åŒ–ï¼ŒObjectInputStreamç”¨äºååºåˆ—åŒ–ã€‚ç±»å¿…é¡»å®ç°Serializableæ¥å£æ‰èƒ½è¢«åºåˆ—åŒ–ã€‚ 9.åå°„1.ä»€ä¹ˆæ˜¯åå°„Java åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œ å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼› è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º Java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚ åå°„çš„åŸç† Java ç¨‹åºçš„æ‰§è¡Œåˆ†ä¸ºç¼–è¯‘å’Œè¿è¡Œä¸¤æ­¥ï¼Œç¼–è¯‘ä¹‹åä¼šç”Ÿæˆå­—èŠ‚ç (.class)æ–‡ä»¶ï¼ŒJVM è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œä¼šåŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œå°†ç±»ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯åŠ è½½è¿›æ–¹æ³•åŒºï¼Œåå°„å°±æ˜¯å»è·å–è¿™äº›ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œå„ç§æ“ä½œã€‚ åå°„çš„åº”ç”¨åœºæ™¯ Spring æ¡†æ¶å°±å¤§é‡ä½¿ç”¨äº†åå°„æ¥åŠ¨æ€åŠ è½½å’Œç®¡ç† Beanã€‚ Java çš„åŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰æœºåˆ¶å°±ä½¿ç”¨äº†åå°„æ¥åˆ›å»ºä»£ç†ç±»ã€‚ä»£ç†ç±»å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€å¤„ç†æ–¹æ³•è°ƒç”¨ï¼Œè¿™åœ¨å®ç° AOP å’Œæ‹¦æˆªå™¨æ—¶éå¸¸æœ‰ç”¨ã€‚ æ³¨è§£ çš„å®ç°ä¹Ÿç”¨åˆ°äº†åå°„ã€‚ 10.æ³¨è§£1.æ³¨è§£çš„åŸç†æ³¨è§£æœ¬è´¨æ˜¯ä¸€ä¸ªç»§æ‰¿äº†Annotationçš„ç‰¹æ®Šæ¥å£ï¼Œå…¶å…·ä½“å®ç°ç±»æ˜¯Javaè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ã€‚ 11.SPISPI å³ Service Provider Interface ä¸“é—¨æä¾›ç»™æœåŠ¡æä¾›è€…æˆ–è€…æ‰©å±•æ¡†æ¶åŠŸèƒ½çš„å¼€å‘è€…å»ä½¿ç”¨çš„ä¸€ä¸ªæ¥å£ã€‚ SPI å°†æœåŠ¡æ¥å£å’Œå…·ä½“çš„æœåŠ¡å®ç°åˆ†ç¦»å¼€æ¥ï¼Œå°†æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°è€…è§£è€¦ï¼Œèƒ½å¤Ÿæå‡ç¨‹åºçš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€‚ å¾ˆå¤šæ¡†æ¶éƒ½ä½¿ç”¨äº† Java çš„ SPI æœºåˆ¶ï¼Œæ¯”å¦‚ï¼šSpring æ¡†æ¶ã€æ•°æ®åº“åŠ è½½é©±åŠ¨ã€æ—¥å¿—æ¥å£ã€ä»¥åŠ Dubbo çš„æ‰©å±•å®ç°ç­‰ç­‰ã€‚ SPIå’ŒAPIçš„åŒºåˆ« å½“å®ç°æ–¹æä¾›äº†æ¥å£å’Œå®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ç°æ–¹çš„æ¥å£ä»è€Œæ‹¥æœ‰å®ç°æ–¹ç»™æˆ‘ä»¬æä¾›çš„èƒ½åŠ›ï¼Œè¿™å°±æ˜¯ APIã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥å£å’Œå®ç°éƒ½æ˜¯æ”¾åœ¨å®ç°æ–¹çš„åŒ…ä¸­ã€‚è°ƒç”¨æ–¹é€šè¿‡æ¥å£è°ƒç”¨å®ç°æ–¹çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ å½“æ¥å£å­˜åœ¨äºè°ƒç”¨æ–¹è¿™è¾¹æ—¶ï¼Œè¿™å°±æ˜¯ SPI ã€‚ç”±æ¥å£è°ƒç”¨æ–¹ç¡®å®šæ¥å£è§„åˆ™ï¼Œç„¶åç”±ä¸åŒçš„å‚å•†æ ¹æ®è¿™ä¸ªè§„åˆ™å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ï¼Œä»è€Œæä¾›æœåŠ¡ã€‚ ç®€å•è¯´ï¼ŒAPIå°±æ˜¯æ¥å£å®ç°æ–¹åšå¥½APIï¼Œç„¶åè°ƒç”¨è€…åªç®¡è°ƒç”¨ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚ç»†èŠ‚ï¼› è€ŒSPIæ˜¯æ¥å£çš„è°ƒç”¨æ–¹å…ˆç¡®å®šå¥½è§„åˆ™ï¼Œç„¶åæ¥å£å®ç°æ–¹å»æŒ‰ç…§è¿™ä¸ªè§„åˆ™å»å®ç°æ¥å£ 12.è¯­æ³•ç³–è¯­æ³•ç³–ï¼ˆSyntactic sugarï¼‰ ä»£æŒ‡çš„æ˜¯ç¼–ç¨‹è¯­è¨€ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜å¼€å‘ç¨‹åºè€Œè®¾è®¡çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹ç¼–ç¨‹è¯­è¨€çš„åŠŸèƒ½å¹¶æ²¡æœ‰å½±å“ã€‚å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼ŒåŸºäºè¯­æ³•ç³–å†™å‡ºæ¥çš„ä»£ç å¾€å¾€æ›´ç®€å•ç®€æ´ä¸”æ›´æ˜“é˜…è¯»ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œè¯­æ³•ç³–è®©ç¨‹åºæ›´åŠ ç®€æ´ï¼Œæœ‰æ›´é«˜çš„å¯è¯»æ€§ã€‚ Java ä¸­æœ€å¸¸ç”¨çš„è¯­æ³•ç³–ä¸»è¦æœ‰æ³›å‹ã€è‡ªåŠ¨æ‹†è£…ç®±ã€å˜é•¿å‚æ•°ã€æšä¸¾ã€å†…éƒ¨ç±»ã€å¢å¼º for å¾ªç¯ã€try-with-resources è¯­æ³•ã€lambda è¡¨è¾¾å¼ç­‰ã€‚ ä¸è¿‡ï¼ŒJVM å…¶å®å¹¶ä¸èƒ½è¯†åˆ«è¯­æ³•ç³–ï¼ŒJava è¯­æ³•ç³–è¦æƒ³è¢«æ­£ç¡®æ‰§è¡Œï¼Œéœ€è¦å…ˆé€šè¿‡ç¼–è¯‘å™¨è¿›è¡Œè§£ç³–ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘é˜¶æ®µå°†å…¶è½¬æ¢æˆ JVM è®¤è¯†çš„åŸºæœ¬è¯­æ³•ã€‚è¿™ä¹Ÿä¾§é¢è¯´æ˜ï¼ŒJava ä¸­çœŸæ­£æ”¯æŒè¯­æ³•ç³–çš„æ˜¯ Java ç¼–è¯‘å™¨è€Œä¸æ˜¯ JVMã€‚ 13.JDK1.8æ–°ç‰¹æ€§ä¸»è¦è¿˜æ˜¯Stream APIå’Œlambdaè¡¨è¾¾å¼ Stream æ˜¯å¯¹ Java é›†åˆæ¡†æ¶çš„å¢å¼ºï¼Œå®ƒæä¾›äº†ä¸€ç§é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„æ•°æ®å¤„ç†æ–¹å¼ã€‚ 14.ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½ç†è§£çš„è®¾è®¡æ¨¡å¼ã€‚ç®€å•æ¥è¯´å°±æ˜¯ æˆ‘ä»¬ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥ä»£æ›¿å¯¹çœŸå®å¯¹è±¡(real object)çš„è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸç›®æ ‡å¯¹è±¡çš„å‰æä¸‹ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œæ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚ æ¯”å¦‚è¯´åœ¨ç›®æ ‡å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ‰§è¡Œå‰åä½ å¯ä»¥å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ é™æ€ä»£ç†å°±ä¸çœ‹äº†ï¼Œæ¯”è¾ƒç®€å•è€Œä¸”å®ç”¨æ€§ä¸å¤§ ç›´æ¥çœ‹åŠ¨æ€ä»£ç† çµæ´»æ€§ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ï¼ JVM å±‚é¢ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚è€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ 1.JDKåŠ¨æ€ä»£ç†åœ¨ Java åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ InvocationHandler æ¥å£å’Œ Proxy ç±»æ˜¯æ ¸å¿ƒã€‚ Proxy ç±»ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ–¹æ³•æ˜¯ï¼šnewProxyInstance() ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ JDKåŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤ å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼› è‡ªå®šä¹‰ InvocationHandler å¹¶é‡å†™invokeæ–¹æ³•ï¼Œåœ¨ invoke æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šè°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼ˆè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰å¹¶è‡ªå®šä¹‰ä¸€äº›å¤„ç†é€»è¾‘ï¼› é€šè¿‡ Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h) æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼› å…³é”®1ï¼šnewProxyInstance æ–¹æ³• 1234567public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException&#123; ......&#125; è¿™ä¸ªæ–¹æ³•ä¸€å…±æœ‰ 3 ä¸ªå‚æ•°ï¼š loader :ç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†å¯¹è±¡ã€‚ interfaces : è¢«ä»£ç†ç±»å®ç°çš„ä¸€äº›æ¥å£ï¼› h : å®ç°äº† InvocationHandler æ¥å£çš„å¯¹è±¡ï¼› å…³é”®2ï¼šInvocationHandler æ¥å£ 12345678public interface InvocationHandler &#123; /** * å½“ä½ ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•çš„æ—¶å€™å®é™…ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³• */ public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;&#125; invoke() æ–¹æ³•æœ‰ä¸‹é¢ä¸‰ä¸ªå‚æ•°ï¼š proxy :åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±» method : ä¸ä»£ç†ç±»å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ç›¸å¯¹åº” args : å½“å‰ method æ–¹æ³•çš„å‚æ•° ä½ é€šè¿‡Proxy ç±»çš„ newProxyInstance() åˆ›å»ºçš„ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…ä¼šè°ƒç”¨åˆ°å®ç°InvocationHandler æ¥å£çš„ç±»çš„ invoke()æ–¹æ³•ã€‚ ä½ å¯ä»¥åœ¨ invoke() æ–¹æ³•ä¸­è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚åœ¨æ–¹æ³•æ‰§è¡Œå‰ååšä»€ä¹ˆäº‹æƒ…ã€‚ 2.CGLIBåŠ¨æ€ä»£ç†JDK åŠ¨æ€ä»£ç†æœ‰ä¸€ä¸ªæœ€è‡´å‘½çš„é—®é¢˜æ˜¯å…¶åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶æ¥é¿å…ã€‚ CGLIB å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚ ä¾‹å¦‚ Spring ä¸­çš„ AOP æ¨¡å—ä¸­ï¼šå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œåˆ™é»˜è®¤é‡‡ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™é‡‡ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚ CGLIB åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤ å®šä¹‰ä¸€ä¸ªç±»ï¼› è‡ªå®šä¹‰ MethodInterceptor å¹¶é‡å†™ intercept æ–¹æ³•ï¼Œintercept ç”¨äºæ‹¦æˆªå¢å¼ºè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼Œå’Œ JDK åŠ¨æ€ä»£ç†ä¸­çš„ invoke æ–¹æ³•ç±»ä¼¼ï¼› é€šè¿‡ Enhancer ç±»çš„ create()åˆ›å»ºä»£ç†ç±»ï¼› åœ¨ CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ MethodInterceptor æ¥å£å’Œ Enhancer ç±»æ˜¯æ ¸å¿ƒã€‚ ä½ éœ€è¦è‡ªå®šä¹‰ MethodInterceptor å¹¶é‡å†™ intercept æ–¹æ³•ï¼Œintercept ç”¨äºæ‹¦æˆªå¢å¼ºè¢«ä»£ç†ç±»çš„æ–¹æ³•ã€‚ 12345public interface MethodInterceptorextends Callback&#123; // æ‹¦æˆªè¢«ä»£ç†ç±»ä¸­çš„æ–¹æ³• public Object intercept(Object obj, java.lang.reflect.Method method, Object[] args,MethodProxy proxy) throws Throwable;&#125; obj : è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆéœ€è¦å¢å¼ºçš„å¯¹è±¡ï¼‰ method : è¢«æ‹¦æˆªçš„æ–¹æ³•ï¼ˆéœ€è¦å¢å¼ºçš„æ–¹æ³•ï¼‰ args : æ–¹æ³•å…¥å‚ proxy : ç”¨äºè°ƒç”¨åŸå§‹æ–¹æ³• ä½ å¯ä»¥é€šè¿‡ Enhancerç±»æ¥åŠ¨æ€è·å–è¢«ä»£ç†ç±»ï¼Œå½“ä»£ç†ç±»è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ MethodInterceptor ä¸­çš„ intercept æ–¹æ³•ã€‚ JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†å¯¹æ¯” JDK åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»æˆ–è€…ç›´æ¥ä»£ç†æ¥å£ï¼Œè€Œ CGLIB å¯ä»¥ä»£ç†æœªå®ç°ä»»ä½•æ¥å£çš„ç±»ã€‚","categories":[{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}]}],"categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"},{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","permalink":"http://example.com/categories/%E5%AD%A6%E4%B9%A0/"},{"name":"å…«è‚¡","slug":"å…«è‚¡","permalink":"http://example.com/categories/%E5%85%AB%E8%82%A1/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"http://example.com/categories/%E7%94%9F%E6%B4%BB/"},{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"http://example.com/categories/%E6%8A%80%E6%9C%AF/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://example.com/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"IDEA","slug":"IDEA","permalink":"http://example.com/tags/IDEA/"},{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/tags/%E5%88%B7%E9%A2%98/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://example.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://example.com/tags/%E7%AE%97%E6%B3%95/"},{"name":"æ—¥å¸¸å®ä¹ ","slug":"æ—¥å¸¸å®ä¹ ","permalink":"http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AE%9E%E4%B9%A0/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Linux","slug":"Linux","permalink":"http://example.com/tags/Linux/"},{"name":"Git","slug":"Git","permalink":"http://example.com/tags/Git/"},{"name":"JavaSE","slug":"JavaSE","permalink":"http://example.com/tags/JavaSE/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://example.com/tags/RabbitMQ/"},{"name":"å®ä¹ ","slug":"å®ä¹ ","permalink":"http://example.com/tags/%E5%AE%9E%E4%B9%A0/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/tags/%E7%BD%91%E7%BB%9C/"},{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"},{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"},{"name":"Mysql","slug":"Mysql","permalink":"http://example.com/tags/Mysql/"},{"name":"Spring, SSM","slug":"Spring-SSM","permalink":"http://example.com/tags/Spring-SSM/"},{"name":"JUC","slug":"JUC","permalink":"http://example.com/tags/JUC/"},{"name":"é¡¹ç›®","slug":"é¡¹ç›®","permalink":"http://example.com/tags/%E9%A1%B9%E7%9B%AE/"},{"name":"æ‚è°ˆè®°å½•","slug":"æ‚è°ˆè®°å½•","permalink":"http://example.com/tags/%E6%9D%82%E8%B0%88%E8%AE%B0%E5%BD%95/"},{"name":"éŸ³ä¹","slug":"éŸ³ä¹","permalink":"http://example.com/tags/%E9%9F%B3%E4%B9%90/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/tags/%E5%89%8D%E7%AB%AF/"},{"name":"å½±è§†","slug":"å½±è§†","permalink":"http://example.com/tags/%E5%BD%B1%E8%A7%86/"},{"name":"MybatisPlus","slug":"MybatisPlus","permalink":"http://example.com/tags/MybatisPlus/"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"http://example.com/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"},{"name":"MySql","slug":"MySql","permalink":"http://example.com/tags/MySql/"},{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}]}